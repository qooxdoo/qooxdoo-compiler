function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("util").promisify,r=require("es6-promise-pool");qx.Class.define("qx.tool.utils.Promisify",{statics:{MAGIC_KEY:"__P_247_0",IGNORED_PROPS:/^(?:promises|length|name|arguments|caller|callee|prototype|__isPromisified__)$/,promisifyAll:function(e,t){var r=this;Object.getOwnPropertyNames(e).forEach(function(n){if(!(r.IGNORED_PROPS.test(n)||t&&!1===t(n,e)||"function"!=typeof e[n]||r.isPromisified(e[n]))){var o=n+"Async";e[o]=r.promisify(e[n]);[n,o].forEach(function(t){Object.defineProperty(e[t],r.MAGIC_KEY,{value:!0,configurable:!0,enumerable:!1,writable:!0})})}});return e},isPromisified:function(e){try{return!0===e[this.MAGIC_KEY]}catch(e){return!1}},promisify:function(e,r){e=t(e);r&&(e=e.bind(r));return e},poolEachOf:function(e,t,n){return _asyncToGenerator(regeneratorRuntime.mark(function t(){var o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=0;a=new r(function(){if(o>=e.length)return null;var t=e[o++];return n(t)},10);t.next=4;return a.start();case 4:case"end":return t.stop()}},t)}))()},map:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return qx.Promise.all(e.map(t));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r)}))()},some:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return new qx.Promise(function(r,n){var o=0;e.forEach(function(){qx.Promise.resolve(t.apply(void 0,arguments)).then(function(t){o++;if(t&&r){r(!0);r=null}o==e.length&&r&&r(!1);return null})})});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r)}))()},someEach:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=0;o=function r(){if(n>=e.length)return qx.Promise.resolve(!1);var o=e[n++];return qx.Promise.resolve(t(o)).then(function(e){return!!e||r()})};r.next=4;return o();case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r)}))()},somePool:function(e,t,n){return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return new qx.Promise(function(t,o){var a=0;new r(function(){if(!t)return null;if(a>=e.length){t(!1);return null}var r=e[a++];return n(r).then(function(e){if(e&&t){t(!0);t=null}})},10).start()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))()},call:function(e){return new Promise(function(t,r){e(function(e){if(e)r(e);else{for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];t.apply(void 0,o)}})})},callback:function(e,t){t&&(e=e.then(function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.apply(void 0,[null].concat(r))}).catch(function(e){return t(e)}));return e},fs:null,each:function(e,t){return qx.tool.utils.Promisify.eachOf(e,t)},forEachOf:function(e,t){return qx.tool.utils.Promisify.eachOf(e,t)},eachOf:function(e,t){var r=Object.keys(e).map(function(r){return t(e[r],r)});return qx.Promise.all(r)},eachSeries:function(e,t){return qx.tool.utils.Promisify.eachOfSeries(e,t)},forEachOfSeries:function(e,t){return qx.tool.utils.Promisify.eachOfSeries(e,t)},eachOfSeries:function(e,t){var r=Object.keys(e),n=0;return function o(){if(n==r.length)return qx.Promise.resolve();var a=r[n];n++;var i=t(e[a],a);return qx.Promise.resolve(i).then(o)}()}},defer:function(e){e.fs=e.promisifyAll(require("fs"),function(e,t){return"SyncWriteStream"!==e})}});qx.tool.utils.Promisify.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.Version":{},"qx.tool.compiler.Console":{},"qx.lang.Array":{},"qx.tool.config.Compile":{},"qx.tool.config.Lockfile":{},"qx.tool.cli.api.CompilerApi":{},"qx.tool.utils.Json":{},"qx.tool.cli.commands.package.Install":{},"qx.tool.utils.Utils":{},"qx.lang.Type":{},"qx.tool.cli.api.LibraryApi":{},"qx.lang.Object":{},"qx.tool.compiler.resources.ScssConverter":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("upath"),r=qx.tool.utils.Promisify.fs,n=require("semver");qx.Class.define("qx.tool.cli.Cli",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);if(qx.tool.cli.Cli.__P_200_0)throw new Error("qx.tool.cli.Cli has already been initialized!");qx.tool.cli.Cli.__P_200_0=this},members:{yargs:null,argv:null,_compilerApi:null,_compileJsFilename:null,_compileJsonFilename:null,_parsedArgs:null,__P_200_1:null,__P_200_2:!1,__P_200_3:function(){return this.yargs=require("yargs").locale("en").version().strict(!1).showHelpOnFail().help(!1).option("force",{describe:"Override warnings",type:"boolean",default:!1,alias:"F"}).option("config-file",{describe:"Specify the config file to use",type:"string",alias:"c"}).option("verbose",{alias:"v",describe:"enables additional progress output to console",default:!1,type:"boolean"}).option("quiet",{alias:"q",describe:"suppresses normal progress output to console",type:"boolean"})},__P_200_4:function(){var e="qooxdoo command line interface";e="\n"+e+"\n"+"=".repeat(e.length)+"\n";e+="Versions: @qooxdoo/compiler v".concat(qx.tool.compiler.Version.VERSION,"\n\n");e+="Typical usage:\n        qx <commands> [options]\n        \n      Type qx <command> --help for options and subcommands.";var t=this.__P_200_3().usage(e);this.argv=t.argv},__P_200_5:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.__P_200_3().help(!0).option("set",{describe:"sets an environment value for the compiler",nargs:1,requiresArg:!0,type:"string",array:!0}).option("set-env",{describe:"sets an environment value for the application",nargs:1,requiresArg:!0,type:"string",array:!0}).check(function(e){var t=/^[^=\s]+=.+$/,r=e["set-env"];if(void 0!==r&&r.some(function(e){return!t.test(e)}))throw new Error("Argument check failed: --set-env must be a key=value pair.");return!0});qx.tool.cli.Cli.addYargsCommands(r,["Add","Clean","Compile","Config","Deploy","Package","Pkg","Create","Lint","Run","Test","Serve"],"qx.tool.cli.commands");t.next=4;return r.demandCommand().strict().argv;case 4:e.argv=t.sent;t.next=7;return e.__P_200_6();case 7:case"end":return t.stop()}},t)}))()},__P_200_6:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.__P_200_2){t.next=2;break}return t.abrupt("return");case 2:e.__P_200_2=!0;r=0,n=e._compilerApi.getLibraryApis();case 4:if(!(r<n.length)){t.next=11;break}o=n[r];t.next=8;return o.load();case 8:r++;t.next=4;break;case 11:t.next=13;return e._compilerApi.afterLibrariesLoaded();case 13:case"end":return t.stop()}},t)}))()},processCommand:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:qx.tool.compiler.Console.getInstance().setVerbose(t.argv.verbose);t._compilerApi.setCommand(e);r.next=4;return t.__P_200_6();case 4:r.prev=4;r.next=7;return e.process();case 7:return r.abrupt("return",r.sent);case 10:r.prev=10;r.t0=r.catch(4);qx.tool.compiler.Console.error("Error: "+(r.t0.stack||r.t0.message));process.exit(1);return r.abrupt("return",null);case 15:case"end":return r.stop()}},r,null,[[4,10]])}))()},getParsedArgs:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.__P_200_1;case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))()},run:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(r=qx.lang.Array.clone(process.argv)).shift();process.title=r.join(" ");e.__P_200_1=e.__P_200_7();t.next=6;return e.__P_200_1;case 6:case"end":return t.stop()}},t)}))()},__P_200_7:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C,S,T,A,E,R,O,I,j;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:e.__P_200_4();a=e.argv.configFile||qx.tool.config.Compile.config.fileName;i={version:qx.tool.config.Lockfile.getInstance().getVersion()};s=qx.tool.cli.Cli.compileJsFilename;c=qx.tool.config.Compile.config.fileName;a&&(a.match(/\.js$/)?s=a:c=a);o.next=8;return r.existsAsync(c);case 8:if(!o.sent){o.next=10;break}e._compileJsonFilename=c;case 10:l=qx.tool.cli.api.CompilerApi;o.next=13;return r.existsAsync(s);case 13:if(!o.sent){o.next=19;break}o.next=16;return e.__P_200_8(s);case 16:u=o.sent;e._compileJsFilename=s;u.CompilerApi&&(l=u.CompilerApi);case 19:p=e._compilerApi=new l(e).set({rootDir:".",configFilename:c});o.next=22;return p.load();case 22:f=p.getConfiguration();if(!a){o.next=85;break}m=qx.tool.config.Lockfile.config.fileName;o.prev=25;d=t.join(t.dirname(a),m);o.next=29;return qx.tool.utils.Json.loadJsonAsync(d);case 29:o.t0=o.sent;if(o.t0){o.next=32;break}o.t0=i;case 32:i=o.t0;o.next=37;break;case 35:o.prev=35;o.t1=o.catch(25);case 37:_=n.coerce(qx.tool.config.Lockfile.getInstance().getVersion(),!0).raw;h=i&&i.version?n.coerce(i.version,!0).raw:"1.0.0";if(!(n.major(_)>n.major(h))){o.next=85;break}if(!e.argv.force){o.next=84;break}g={verbose:e.argv.verbose,quiet:e.argv.quiet,save:!1};x=new qx.tool.cli.commands.package.Install(g);y=x.getLockfilePath();v=y+".old";o.next=47;return r.copyFileAsync(y,v);case 47:e.argv.quiet||qx.tool.compiler.Console.warn("*** A backup of ".concat(m," has been saved to ").concat(v,", in case you need to revert to it. ***"));o.next=50;return x.deleteLockfile();case 50:b=_createForOfIteratorHelper(i.libraries);o.prev=51;b.s();case 53:if((q=b.n()).done){o.next=71;break}P=q.value;o.next=57;return x.isInstalled(P.uri,P.repo_tag);case 57:if(o.sent){o.next=68;break}if(!P.repo_tag){o.next=63;break}o.next=61;return x.install(P.uri,P.repo_tag);case 61:o.next=66;break;case 63:if(!P.path||!r.existsSync(P.path)){o.next=66;break}o.next=66;return x.installFromLocaPath(P.path,P.uri);case 66:o.next=69;break;case 68:e.argv.verbose&&qx.tool.compiler.Console.info(">>> ".concat(P.uri,"@").concat(P.repo_tag," is already installed."));case 69:o.next=53;break;case 71:o.next=76;break;case 73:o.prev=73;o.t2=o.catch(51);b.e(o.t2);case 76:o.prev=76;b.f();return o.finish(76);case 79:o.next=81;return x.getLockfileData();case 81:i=o.sent;o.next=85;break;case 84:throw new qx.tool.utils.Utils.UserError("*** Warning ***\n"+"The schema of '".concat(m,"' has changed. Execute 'qx clean && qx compile --force' to delete and regenerate it.\n")+"You might have to re-apply manual modifications to '".concat(m,"'."));case 85:f.libraries||r.existsSync("Manifest.json")&&(f.libraries=["."]);if(i.libraries){f.packages={};i.libraries.forEach(function(e){f.libraries.push(e.path);f.packages[e.uri]=e.path})}k=qx.lang.Type.isArray(e.argv._)&&"clean"!==e.argv._[0];if(!f.libraries||!k){o.next=122;break}if(f.libraries.every(function(e){return r.existsSync(e+"/Manifest.json")})){o.next=94;break}qx.tool.compiler.Console.log("One or more libraries not found - trying to install them from library repository...");w=new qx.tool.cli.commands.package.Install({quiet:!0,save:!1});o.next=94;return w.process();case 94:C=_createForOfIteratorHelper(f.libraries);o.prev=95;C.s();case 97:if((S=C.n()).done){o.next=114;break}T=S.value;A=t.join(T,qx.tool.cli.Cli.compileJsFilename);E=qx.tool.cli.api.LibraryApi;o.next=103;return r.existsAsync(A);case 103:if(!o.sent){o.next=108;break}o.next=106;return e.__P_200_8(A);case 106:(R=o.sent).LibraryApi&&(E=R.LibraryApi);case 108:O=(new E).set({rootDir:T,compilerApi:p});p.addLibraryApi(O);o.next=112;return O.initialize();case 112:o.next=97;break;case 114:o.next=119;break;case 116:o.prev=116;o.t3=o.catch(95);C.e(o.t3);case 119:o.prev=119;C.f();return o.finish(119);case 122:o.next=124;return e.__P_200_5();case 124:I={target:e.argv.target,outputPath:null,locales:null,writeAllTranslations:e.argv.writeAllTranslations,environment:{},verbose:e.argv.verbose};e.argv.locale&&e.argv.locale.length&&(I.locales=e.argv.locale);e.argv["set-env"]&&e.argv["set-env"].forEach(function(e){var t=e.match(/^([^=\s]+)(=(.+))?$/),r=t[1],n=t[3];I.environment[r]=n});f.targetType=I.target||f.defaultTarget||"source";f.locales||(f.locales=[]);"boolean"==typeof I.writeAllTranslations&&(f.writeAllTranslations=I.writeAllTranslations);f.environment||(f.environment={});if(f.targets){(j=f.targets.find(function(e){return e.type===f.targetType})).environment=j.environment||{};qx.lang.Object.mergeWith(j.environment,I.environment,!0)}f.sass&&void 0!==f.sass.compiler?qx.tool.compiler.resources.ScssConverter.USE_V6_COMPILER="latest"==f.sass.compiler:qx.tool.compiler.resources.ScssConverter.USE_V6_COMPILER=null;f.serve||(f.serve={});e.isExplicitArg("listen-port")?f.serve.listenPort=e.argv.listenPort:f.serve.listenPort=f.serve.listenPort||e.argv.listenPort;o.next=137;return p.getConfiguration();case 137:e._parsedArgs=o.sent;return o.abrupt("return",e._parsedArgs);case 139:case"end":return o.stop()}},o,null,[[25,35],[51,73,76,79],[95,116,119,122]])}))()},__P_200_8:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;n=require(t.resolve(r));return e.abrupt("return",n);case 5:e.prev=5;e.t0=e.catch(0);o=e.t0.stack.split("\n");for(a=0;a<o.length;a++)o[a].match(/^\s+at/)&&o.splice(a);if(void 0===(i=o[0].split("evalmachine.<anonymous>:")[1])){e.next=15;break}o.shift();throw new Error("Error while reading "+r+" at line "+i+"\n"+o.join("\n"));case 15:throw new Error("Error while reading "+r+"\n"+o.join("\n"));case 16:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),getCompilerApi:function(){return this._compilerApi},getCompileJsFilename:function(){return this._compileJsFilename},getCompileJsonFilename:function(){return this._compileJsonFilename},isExplicitArg:function(e){function t(e){return process.argv.indexOf(e)>-1}return t("-".concat(e))||t("--".concat(e))}},statics:{compileJsFilename:"compile.js",__P_200_0:null,getInstance:function(){if(!qx.tool.cli.Cli.__P_200_0)throw new Error("CompileJs has not been initialized yet!");return qx.tool.cli.Cli.__P_200_0},addYargsCommands:function(e,r,n){var o=null;n.split(".").forEach(function(e){o=null===o?window[e]:o[e]});r.forEach(function(r){require(t.join(qx.tool.$$classPath,n.replace(/\./g,"/"),r));var a=o[r],i=a.getYargsCommand();if(i){void 0===i.handler&&(i.handler=function(e){return qx.tool.cli.Cli.getInstance().processCommand(new a(e))});e.command(i)}})}}});qx.tool.cli.Cli.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.Version",{extend:qx.core.Object,statics:{VERSION:null},defer:function(e){var t=require("../../../../../package.json");e.VERSION=t.version}});qx.tool.compiler.Version.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"qx.lang.String":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.Console",{extend:qx.core.Object,properties:{verbose:{init:!1,check:"Boolean"},machineReadable:{init:!1,check:"Boolean"},writer:{init:null,nullable:!0,check:"Function"},colorOn:{init:"",nullable:!1,check:"String"}},members:{print:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var o=0;o<r.length;o++){var a=r[o];"string"!=typeof a&&"number"!=typeof a&&null!==a&&(r[o]=String(a))}if(this.isMachineReadable()){var i="##"+e+":"+JSON.stringify(r);console.log(i)}else{var s=this.getWriter(),c=this.decode.apply(this,[e].concat(r));s?s.apply(void 0,[c,e].concat(r)):console.log(c)}},decode:function(e){for(var t=qx.tool.compiler.Console.MESSAGE_IDS[e],r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if(t){return qx.lang.String.format(t.message,n||[])}return e+JSON.stringify(n)},getMessageType:function(e){var t=qx.tool.compiler.Console.MESSAGE_IDS[e];return t?t.type:null},log:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log(this.getColorOn()+t.join(" "))},debug:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.debug(this.getColorOn()+t.join(" "))},info:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.info(this.getColorOn()+t.join(" "))},warn:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn(this.getColorOn()+t.join(" "))},error:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error(this.getColorOn()+t.join(" "))}},defer:function(e){e.addMessageIds({"qx.tool.compiler.class.invalidProperties":"Invalid 'properties' key in class definition","qx.tool.compiler.compiler.missingClassDef":"FATAL Missing class definition - no call to qx.Class.define (or qx.Mixin.define etc)","qx.tool.compiler.compiler.syntaxError":"FATAL Syntax error: %1","qx.tool.compiler.compiler.invalidExtendClause":"FATAL Invalid `extend` clause - expected to find a class name (without quotes or `new`)","qx.tool.compiler.compiler.invalidClassDefinitionEntry":"Unexpected property %2 in %1 definition","qx.tool.compiler.compiler.wrongClassName":"Wrong class name or filename - expected to find at least %1 but only found [%2]","qx.tool.compiler.application.partRecursive":"Part %1 has recursive dependencies on other parts","qx.tool.compiler.application.duplicatePartNames":"Duplicate parts named '%1'","qx.tool.compiler.application.noBootPart":"Cannot find a boot part","qx.tool.compiler.application.conflictingExactPart":"Conflicting exact match for %1, could be %2 or %3","qx.tool.compiler.application.conflictingBestPart":"Conflicting best match for %1, could be %2 or %3","qx.tool.compiler.application.missingRequiredLibrary":"Cannot find required library %1","qx.tool.compiler.application.missingScriptResource":"Cannot find script resource: %1","qx.tool.compiler.application.missingCssResource":"Cannot find CSS resource: %1","qx.tool.compiler.target.missingAppLibrary":"Cannot find library required to create application for %1","qx.tool.compiler.library.emptyManifest":"Empty Manifest.json in library at %1","qx.tool.compiler.library.cannotCorrectCase":"Unable to correct case for library in %1 because it uses source/resource directories which are outside the library","qx.tool.compiler.library.cannotFindPath":"Cannot find path %2 required by library %1","qx.tool.compiler.build.uglifyParseError":"Parse error in output file %4, line %1 column %2: %3","qx.tool.compiler.webfonts.error":"Error compiling webfont %1, error=%2","qx.tool.compiler.maker.appFatalError":"Cannot write application '%1' because it has fatal errors"},"error");e.addMessageIds({"qx.tool.compiler.translate.invalidMessageId":"Cannot interpret message ID %1","qx.tool.compiler.translate.invalidMessageIds":"Cannot interpret message ID %1, %2","qx.tool.compiler.translate.invalidMessageIds3":"Cannot interpret message ID %1, %2, %3","qx.tool.compiler.testForUnresolved":"Unexpected termination when testing for unresolved symbols, node type %1","qx.tool.compiler.testForFunctionParameterType":"Unexpected type of function parameter, node type %1","qx.tool.compiler.defer.unsafe":"Unsafe use of 'defer' method to access external class: %1","qx.tool.compiler.symbol.unresolved":"Unresolved use of symbol %1","qx.tool.compiler.target.missingBootJs":"There is no reference to index.js script in the index.html copied from %1 (see https://git.io/fh7NI)","qx.tool.compiler.target.missingPreBootJs":"There is no reference to ${preBootJs} in the index.html copied from %1 (see https://git.io/fh7NI)","qx.tool.compiler.maker.appNotHeadless":"Compiling application '%1' but the target supports non-headless output, you may find unwanted dependencies are loaded during startup"},"warning")},statics:{__P_220_0:null,getInstance:function(){this.__P_220_0||(this.__P_220_0=new qx.tool.compiler.Console);return this.__P_220_0},print:function(){var e;return(e=this.getInstance()).print.apply(e,arguments)},decode:function(){var e;return(e=this.getInstance()).decode.apply(e,arguments)},log:function(){var e;return(e=this.getInstance()).log.apply(e,arguments)},debug:function(){var e;return(e=this.getInstance()).debug.apply(e,arguments)},info:function(){var e;return(e=this.getInstance()).info.apply(e,arguments)},warn:function(){var e;return(e=this.getInstance()).warn.apply(e,arguments)},error:function(){var e;return(e=this.getInstance()).error.apply(e,arguments)},MESSAGE_IDS:{},addMessageIds:function(e,t){for(var r in e)this.MESSAGE_IDS[r]={id:r,message:e[r],type:t||"message"}},decodeMarker:function(e,t){var r=qx.tool.compiler.Console.MESSAGE_IDS[e.msgId]||e.msgId,n=r.type?r.type+": ":"",o="",a=e.pos;if(!1!==t&&a&&a.start&&a.start.line){o+="["+a.start.line;a.start.column&&(o+=","+a.start.column);if(a.end&&a.end.line&&a.end.line!==a.start.line&&a.end.column!==a.start.column){o+=" to "+a.end.line;a.end.column&&(o+=","+a.end.column)}o+="] "}try{o+=n+qx.lang.String.format(r.message,e.args||[])}catch(t){throw new Error("Unknown message id ".concat(e.msgId,"."))}return o}}});qx.tool.compiler.Console.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.lang.Type":{construct:!0},"qx.tool.utils.Json":{},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{},"qx.tool.config.Manifest":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("process"),n=require("upath"),o=require("semver"),a=require("get-value"),i=require("set-value"),s=require("unset-value");qx.Class.define("qx.tool.config.Abstract",{extend:qx.core.Object,statics:{schemaBaseUrl:"https://qooxdoo.org/schema"},construct:function(e){qx.core.Object.constructor.call(this);qx.lang.Type.isObject(e)&&this.set(e);for(var t=0,n=["fileName","version"];t<n.length;t++){var o=n[t];if(!this.get(o))throw new Error("Property ".concat(o," must be set when instantiating ").concat(this.classname))}e.baseDir||this.setBaseDir(r.cwd())},properties:{fileName:{check:"String"},baseDir:{check:"String"},version:{validate:function(e){return null!==o.coerce(e)},check:"String",nullable:!0},data:{check:"Object",event:"changeData",validate:"_validateData",nullable:!1},dirty:{check:"Boolean",init:!1,event:"changeDirty"},loaded:{check:"Boolean",init:!1,event:"changeLoaded"},warnOnly:{check:"Boolean",init:!1},validate:{check:"Boolean",init:!0},createIfNotExists:{check:"Boolean",init:!1},templateFunction:{check:"Function",nullable:!1}},members:{__P_244_0:null,_validateData:function(e){if(this.isValidate()&&null!==this.getVersion()){if(!this.__P_244_0)throw new Error("Cannot validate - no schema available! Please load the model first.");try{qx.tool.utils.Json.validate(e,this.__P_244_0)}catch(e){var t="Error validating data for ".concat(this.getRelativeDataPath(),": ").concat(e.message);if(!this.isWarnOnly())throw new qx.tool.utils.Utils.UserError(t);qx.tool.compiler.Console.warn(t)}}},getDataPath:function(){return n.join(this.getBaseDir(),this.getFileName())},getRelativeDataPath:function(){return n.relative(r.cwd(),this.getDataPath())},_getSchemaFileName:function(){var e=this.getFileName().split(/\./),t=_slicedToArray(e,2),r=t[0],n=t[1],a=String(o.coerce(this.getVersion())).replace(/\./g,"-");return"".concat(r,"-").concat(a,".").concat(n)},getSchemaPath:function(){return n.join(qx.tool.$$resourceDir,"schema",this._getSchemaFileName())},getSchemaUri:function(){return qx.tool.config.Abstract.schemaBaseUrl+"/"+this._getSchemaFileName()},getSchema:function(){return this.__P_244_0},exists:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return t.existsAsync(e.getDataPath());case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r)}))()},load:function(){var e=arguments,r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var a,i,s,c,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(a=e.length>0&&void 0!==e[0]?e[0]:void 0)){n.next=32;break}if(!r.isLoaded()){n.next=4;break}return n.abrupt("return",r);case 4:n.next=6;return t.existsAsync(r.getDataPath());case 6:if(!n.sent){n.next=14;break}n.t0=qx.tool.utils.Json;n.next=10;return t.readFileAsync(r.getDataPath(),"utf8");case 10:n.t1=n.sent;a=n.t0.parseJson.call(n.t0,n.t1);n.next=32;break;case 14:if(!r.isCreateIfNotExists()){n.next=31;break}n.next=17;return qx.tool.config.Manifest.getInstance().exists();case 17:if(!n.sent){n.next=28;break}if(!(i=r.getTemplateFunction())){n.next=25;break}a=i.bind(r)();if(qx.lang.Type.isObject(a)){n.next=23;break}throw new Error("Template for config file ".concat(r.getRelativeDataPath()," is invalid. Must be an object."));case 23:n.next=26;break;case 25:throw new Error("Cannot create config file ".concat(r.getRelativeDataPath()," without a template."));case 26:n.next=29;break;case 28:throw new Error("Cannot create config file ".concat(r.getRelativeDataPath()," since no Manifest exists. Are you in the library root?"));case 29:n.next=32;break;case 31:throw new Error("Cannot load config file: ".concat(r.getRelativeDataPath()," does not exist. Are you in the library root?"));case 32:if(!r.isValidate()||null===r.getVersion()){n.next=45;break}if(r.__P_244_0){n.next=39;break}if(t.existsSync(r.getSchemaPath())){n.next=36;break}throw new Error("No schema file exists at ".concat(r.getSchemaPath()));case 36:n.next=38;return qx.tool.utils.Json.loadJsonAsync(r.getSchemaPath());case 38:r.__P_244_0=n.sent;case 39:if(s=qx.tool.utils.Json.getSchemaInfo(a)){n.next=42;break}throw new Error("Invalid data: no schema found, must be of schema ".concat(r.getSchemaUri(),"!"));case 42:c=o.coerce(s.version);l=o.coerce(r.getVersion());c!==l&&(a=r._migrateData(a,c,l));case 45:r.setData(a);r.setLoaded(!0);return n.abrupt("return",r);case 48:case"end":return n.stop()}},n)}))()},_migrateData:function(e,t,r){var n=Number(o.major(t)),a=Number(o.major(r));switch(!0){case n===a:return e;case 0===n&&1===a:e.$schema=this.getSchemaUri();break;default:throw new Error("Configuration file schema version mismatch: expected v".concat(a,", found v").concat(n,". Could not migrate data."))}this.setDirty(!0);return e},getValue:function(e,t){return a(this.getData(),e,t)},setValue:function(e,t,r){var n=this.getValue(e,r);i(this.getData(),e,t,r);try{this.validate()}catch(t){void 0===n?s(this.getData(),e):i(this.getData(),e,n,r);throw t}this.setDirty(!0);return this},unset:function(e,t){var r=this.getValue(e,t);s(this.getData(),e);try{this.validate()}catch(n){i(this.getData(),e,r,t);throw n}this.setDirty(!0);return this},transform:function(e,t,r){var n=t(this.getValue(e,r));if(void 0===n)throw new Error("Return value of transformation fuction must not be undefined.");this.setValue(e,n,r);return this},keyExists:function(e){if(qx.lang.Type.isString(e))return void 0!==this.getValue(e);if(qx.lang.Type.isObject(e)){var t,r=!1,n=_createForOfIteratorHelper(Object.getOwnPropertyNames(e));try{for(n.s();!(t=n.n()).done;){var o=t.value;e[o]=this.keyExists(o);r=r||e[o]}}catch(e){n.e(e)}finally{n.f()}return r}throw new TypeError("Invalid argument")},validate:function(){this._validateData(this.getData())},save:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.validate();t.next=3;return qx.tool.utils.Json.saveJsonAsync(e.getDataPath(),e.getData());case 3:case"end":return t.stop()}},t)}))()}}});qx.tool.config.Abstract.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.config.Abstract":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.config.Compile",{extend:qx.tool.config.Abstract,type:"singleton",statics:{config:{fileName:"compile.json",version:"^1.0.0"}},construct:function(){qx.tool.config.Abstract.constructor.call(this,qx.tool.config.Compile.config)}});qx.tool.config.Compile.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.cli.LogAppender":{construct:!0},"qx.tool.cli.ConfigDb":{},"qx.tool.cli.commands.package.Migrate":{},"qx.tool.config.Registry":{},"qx.tool.utils.Json":{},"qx.lang.Type":{},"qx.tool.config.Manifest":{},"qx.tool.config.Compile":{},"qx.tool.utils.Utils":{},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("../../utils/Utils");var t=qx.tool.utils.Promisify.fs,r=require("process"),n=require("child_process"),o=require("upath"),a=require("semver"),i=require("replace-in-file");qx.Class.define("qx.tool.cli.commands.Command",{extend:qx.core.Object,statics:{TEMPLATE_DIR:o.join(qx.tool.$$resourceDir,"cli/templates"),NODE_MODULES_DIR:o.join(qx.tool.$$rootDir,"node_modules")},construct:function(e){qx.core.Object.constructor.call(this);this.argv=e;e.verbose&&qx.tool.cli.LogAppender.setMinLevel("debug")},members:{argv:null,compileJs:null,process:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.argv).set){t.next=6;break}t.next=4;return qx.tool.cli.ConfigDb.getInstance();case 4:n=t.sent;r.set.forEach(function(e){var t=e.match(/^([^=\s]+)(=(.+))?$/);if(!t)throw new Error("Failed to parse environment setting commandline option '--set ".concat(e,"'"));var r=t[1],o=t[3];n.setOverride(r,o)});case 6:t.next=8;return new qx.tool.cli.commands.package.Migrate(e.argv).process(!0);case 8:case"end":return t.stop()}},t)}))()},getProjectData:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=o.join(r.cwd(),qx.tool.config.Registry.config.fileName);a={libraries:[],applications:[]};e.next=4;return t.existsAsync(n);case 4:if(!e.sent){e.next=10;break}e.next=7;return qx.tool.utils.Json.loadJsonAsync(n);case 7:i=e.sent;qx.lang.Type.isArray(i.libraries)&&(a.libraries=i.libraries);qx.lang.Type.isArray(i.applications)&&(a.applications=i.applications);case 10:e.next=12;return t.existsAsync(o.join(r.cwd(),qx.tool.config.Manifest.config.fileName));case 12:if(!e.sent){e.next=14;break}a.libraries.find(function(e){return"."===e.path})||a.libraries.push({path:"."});case 14:e.next=16;return t.existsAsync(o.join(r.cwd(),qx.tool.config.Compile.config.fileName));case 16:if(!e.sent){e.next=18;break}a.applications.find(function(e){return"."===e.path})||a.applications.push({path:"."});case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),getLibraryPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getProjectData();case 2:t=e.sent;if(!((n=t.libraries)instanceof Array&&n.length)){e.next=6;break}return e.abrupt("return",o.resolve(r.cwd(),n[0].path));case 6:throw new qx.tool.utils.Utils.UserError("Cannot find library path - are you in the right directory?");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getApplicationPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getProjectData();case 2:t=e.sent;if(!((n=t.applications)instanceof Array&&n.length)){e.next=6;break}return e.abrupt("return",o.resolve(r.cwd(),n[0].path));case 6:throw new qx.tool.utils.Utils.UserError("Cannot find application path - are you in the right directory?");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getAppQxPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,a,i,s,c,l,u,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return t.existsAsync(o.join(r.cwd(),qx.tool.config.Compile.config.fileName));case 2:if(e.sent){e.next=4;break}return e.abrupt("return",this.getGlobalQxPath());case 4:e.next=6;return qx.tool.config.Compile.getInstance().load();case 6:n=e.sent;a=!1;e.next=10;return this.getApplicationPath();case 10:i=e.sent;if(!(s=n.getValue("libraries"))){e.next=43;break}c=_createForOfIteratorHelper(s);e.prev=14;c.s();case 16:if((l=c.n()).done){e.next=35;break}u=l.value;p=u;o.isAbsolute(u)||(p=o.join(i,p));p=o.join(p,qx.tool.config.Manifest.config.fileName);e.next=23;return qx.tool.utils.Json.loadJsonAsync(p);case 23:f=e.sent;e.prev=24;if(!f.provides||"qx"!==f.provides.namespace){e.next=28;break}a=o.dirname(p);return e.abrupt("return",a);case 28:e.next=33;break;case 30:e.prev=30;e.t0=e.catch(24);qx.tool.compiler.Console.warn("Invalid manifest file ".concat(p,"."));case 33:e.next=16;break;case 35:e.next=40;break;case 37:e.prev=37;e.t1=e.catch(14);c.e(e.t1);case 40:e.prev=40;c.f();return e.finish(40);case 43:return e.abrupt("return",this.getGlobalQxPath());case 44:case"end":return e.stop()}},e,this,[[14,37,40,43],[24,30]])}));return function(){return e.apply(this,arguments)}}(),getGlobalQxPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,n,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.ConfigDb.getInstance();case 2:r=e.sent;if(!(n=r.db("qx.library"))){e.next=10;break}a=o.join(n,qx.tool.config.Manifest.config.fileName);e.next=8;return t.existsAsync(a);case 8:if(!e.sent){e.next=10;break}return e.abrupt("return",n);case 10:e.next=12;return t.existsAsync("node_modules/@qooxdoo/framework/"+qx.tool.config.Manifest.config.fileName);case 12:if(!e.sent){e.next=14;break}return e.abrupt("return",o.resolve("node_modules/@qooxdoo/framework"));case 14:i=require.resolve("@qooxdoo/framework/package.json");return e.abrupt("return",o.dirname(i));case 16:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),getUserQxPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getAppQxPath();case 2:t=e.sent;return e.abrupt("return",o.isAbsolute(t)?t:o.resolve(t));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getUserQxVersion:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getUserQxPath();case 2:t=e.sent;e.next=5;return this.getLibraryVersion(t);case 5:r=e.sent;return e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getLibraryVersion:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=o.join(t,qx.tool.config.Manifest.config.fileName);e.next=3;return qx.tool.utils.Json.loadJsonAsync(r);case 3:n=e.sent;e.prev=4;i=n.info.version;e.next=11;break;case 8:e.prev=8;e.t0=e.catch(4);throw new qx.tool.utils.Utils.UserError("No valid version data in manifest.");case 11:if(a.valid(i)){e.next=13;break}throw new qx.tool.utils.Utils.UserError("Manifest at ".concat(r,' contains invalid version number "').concat(i,'". Please use a semver compatible version.'));case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}},e,null,[[4,8]])}));return function(t){return e.apply(this,arguments)}}(),run:function(e,t){var o=this,a={env:r.env};return new Promise(function(r,i){var s=n.spawn(e,t,a);s.stdout.on("data",function(e){o.argv.verbose&&qx.tool.compiler.Console.log(e.toString())});s.stderr.on("data",function(e){o.argv.verbose&&qx.tool.compiler.Console.error(e.toString())});s.on("close",function(n){if(0!==n){var o="Error executing '".concat(e," ").concat(t.join(" "),"'. Use --verbose to see what went wrong.");throw new qx.tool.utils.Utils.UserError(o)}r(0)});s.on("error",i)})},exec:function(e){return new Promise(function(t,r){n.exec(e,function(e,n,o){e&&r(e);o&&r(new Error(o));t(n)})})},getTemplateDir:function(){return qx.tool.cli.commands.Command.TEMPLATE_DIR},getNodeModuleDir:function(){return qx.tool.cli.commands.Command.NODE_MODULES_DIR},isExplicitArg:function(e){function t(e){return r.argv.indexOf(e)>-1}return t("-".concat(e))||t("--".concat(e))},checkFilesToRename:function(e){var r,n=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;){var a=_slicedToArray(r.value,2),i=a[0],s=a[1];!t.existsSync(i)&&t.existsSync(s)&&n.push([i,s])}}catch(e){o.e(e)}finally{o.f()}return n},migrate:function(e){var n=arguments,o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:s=n.length>1&&void 0!==n[1]?n[1]:[];c=n.length>2&&void 0!==n[2]&&n[2];l=o.argv.quiet;if(!qx.lang.Type.isArray(e)){a.next=37;break}if(!(u=o.checkFilesToRename(e)).length){a.next=37;break}if(!c){a.next=12;break}qx.tool.compiler.Console.warn("*** Warning: Some metadata filenames have changed. The following files will be renamed:");p=_createForOfIteratorHelper(u);try{for(p.s();!(f=p.n()).done;){m=_slicedToArray(f.value,2),d=m[0],_=m[1];qx.tool.compiler.Console.warn("    '".concat(_,"' => '").concat(d,"'."))}}catch(e){p.e(e)}finally{p.f()}a.next=37;break;case 12:h=_createForOfIteratorHelper(u);a.prev=13;h.s();case 15:if((g=h.n()).done){a.next=29;break}x=_slicedToArray(g.value,2),y=x[0],v=x[1];a.prev=17;a.next=20;return t.renameAsync(v,y);case 20:l||qx.tool.compiler.Console.info("Renamed '".concat(v,"' to '").concat(y,"'."));a.next=27;break;case 23:a.prev=23;a.t0=a.catch(17);qx.tool.compiler.Console.error("Renaming '".concat(v,"' to '").concat(y,"' failed: ").concat(a.t0.message,"."));r.exit(1);case 27:a.next=15;break;case 29:a.next=34;break;case 31:a.prev=31;a.t1=a.catch(13);h.e(a.t1);case 34:a.prev=34;h.f();return a.finish(34);case 37:if(!qx.lang.Type.isArray(s)||!s.length){a.next=67;break}b=_createForOfIteratorHelper(s);a.prev=39;b.s();case 41:if((q=b.n()).done){a.next=59;break}P=q.value;if(!c){a.next=46;break}qx.tool.compiler.Console.warn("*** In the file(s) ".concat(P.files,", '").concat(P.from,"' will be changed to '").concat(P.to,"'."));return a.abrupt("return");case 46:a.prev=46;a.next=49;return i(P);case 49:k=a.sent;if(!l){w=k.filter(function(e){return e.hasChanged}).map(function(e){return e.file});qx.tool.compiler.Console.info("The following files were changed: ".concat(w.join(", ")))}a.next=57;break;case 53:a.prev=53;a.t2=a.catch(46);qx.tool.compiler.Console.error("Error replacing in files: ".concat(a.t2.message));r.exit(1);case 57:a.next=41;break;case 59:a.next=64;break;case 61:a.prev=61;a.t3=a.catch(39);b.e(a.t3);case 64:a.prev=64;b.f();return a.finish(64);case 67:case"end":return a.stop()}},a,null,[[13,31,34,37],[17,23],[39,61,64,67],[46,53]])}))()}}});qx.tool.cli.commands.Command.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.log.Logger":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.cli.LogAppender",{statics:{__P_202_0:"warn",__P_202_1:["error","warn","info","debug","trace"],setMinLevel:function(e){this.__P_202_0=e},process:function(e){if(!((this.__P_202_1[e.level]||0)>this.__P_202_0)){var t="debug"!==e.level&&console[e.level]?e.level:"log";if(console[t]){var r=this.toText(e);console[t](r)}}},toText:function(e){return this.toTextArray(e).join(" ")},toTextArray:function(e){for(var t,r,n=[],o=e.items,a=0,i=o.length;a<i;a++){r=(t=o[a]).text;t.trace&&t.trace.length>0&&(r+="\n"+t.trace);if(r instanceof Array){for(var s=[],c=0,l=r.length;c<l;c++)s.push(r[c].text);"map"===t.type?n.push("{",s.join(", "),"}"):n.push("[",s.join(", "),"]")}else n.push(r)}return n},formatOffset:function(e,t){for(var r=e.toString(),n=(t||6)-r.length,o="",a=0;a<n;a++)o+="0";return o+r}},defer:function(e){qx.log.Logger.register(e)}});qx.tool.cli.LogAppender.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.cli.Cli":{},"qx.tool.config.Lockfile":{},"qx.tool.config.Manifest":{},"qx.tool.compiler.Console":{},"qx.tool.cli.ConfigDb":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("./Command");require("@qooxdoo/framework");var t=qx.tool.utils.Promisify.fs,r=require("upath"),n=require("process"),o=require("jsonlint"),a=require("json-stable-stringify");qx.Class.define("qx.tool.cli.commands.Package",{extend:qx.tool.cli.commands.Command,statics:{cache_dir:"qx_packages",legacy_cache_dir:"contrib",package_cache_name:"package-cache.json",legacy_package_cache_name:"contrib-cache.json",lockfile:{filename:"qx-lock.json",legacy_filename:"contrib.json"},repository_cache_url:"https://raw.githubusercontent.com/qooxdoo/package-cache/master/cache.json",getYargsCommand:function(){return{command:"package <command> [options]",desc:"manages qooxdoo packages",builder:function(e){qx.tool.cli.Cli.addYargsCommands(e,["Install","List","Publish","Remove","Update","Upgrade","Migrate"],"qx.tool.cli.commands.package");return e.showHelpOnFail().help()}}}},members:{__P_210_0:null,getLockfilePath:function(){return r.join(n.cwd(),qx.tool.config.Lockfile.config.fileName)},deleteLockfile:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return t.unlinkAsync(e.getLockfilePath());case 2:case"end":return r.stop()}},r)}))()},getLockfileData:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.getLockfileModel();case 2:return t.abrupt("return",t.sent.getData());case 3:case"end":return t.stop()}},t)}))()},getLockfileModel:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qx.tool.config.Lockfile.getInstance().load());case 1:case"end":return e.stop()}},e)}))()},getManifestModel:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qx.tool.config.Manifest.getInstance().load());case 1:case"end":return e.stop()}},e)}))()},_getConfigData:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.getManifestModel();case 2:t.t0=t.sent;t.next=5;return e.getLockfileModel();case 5:t.t1=t.sent;return t.abrupt("return",[t.t0,t.t1]);case 7:case"end":return t.stop()}},t)}))()},_saveConfigData:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e._getConfigData();case 2:r=t.sent;n=_slicedToArray(r,2);o=n[0];a=n[1];if(!e.argv.save||!o.isDirty()){t.next=10;break}t.next=9;return o.save();case 9:e.argv.verbose&&qx.tool.compiler.Console.info(">>> Saved dependency data to ".concat(o.getRelativeDataPath()));case 10:if(!a.isDirty()){t.next=14;break}t.next=13;return a.save();case 13:e.argv.verbose&&qx.tool.compiler.Console.info(">>> Saved library data to ".concat(a.getRelativeDataPath()));case 14:case"end":return t.stop()}},t)}))()},getInstalledLibraryTag:function(e,t){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return r.getLockfileModel();case 2:o=n.sent.getValue("libraries").find(function(r){return r.repo_name===e&&r.library_name===t});return n.abrupt("return",!!o&&o.repo_tag);case 4:case"end":return n.stop()}},n)}))()},getInstalledLibraryData:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return t.getLockfileModel();case 2:return r.abrupt("return",r.sent.getValue("libraries").find(function(t){return t.library_name===e}));case 3:case"end":return r.stop()}},r)}))()},getCachePath:function(){return r.join(qx.tool.cli.ConfigDb.getDirectory(),qx.tool.cli.commands.Package.package_cache_name)},getRepositoryCacheUrl:function(){return qx.tool.cli.commands.Package.repository_cache_url},getCache:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.__P_210_0&&"object"==_typeof(this.__P_210_0))return this.__P_210_0;try{this.__P_210_0=o.parse(t.readFileSync(this.getCachePath(),"UTF-8"))}catch(e){this.__P_210_0={repos:{list:[],data:{}},compat:{}}}return this.__P_210_0},setCache:function(e){this.__P_210_0=e},saveCache:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Utils.makeParentDir(this.getCachePath());case 2:e.next=4;return t.writeFileAsync(this.getCachePath(),JSON.stringify(this.__P_210_0,null,2),"UTF-8");case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),exportCache:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;o=this.__P_210_0||this.getCache(!0);i=a(o,{space:2});e.next=5;return t.writeFileAsync(r,i,"UTF-8");case 5:e.next=11;break;case 7:e.prev=7;e.t0=e.catch(0);qx.tool.compiler.Console.error("Error exporting cache to ".concat(r,":")+e.t0.message);n.exit(1);case 11:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),clearCache:function(){this.__P_210_0=null;try{t.unlinkSync(this.getCachePath())}catch(e){}}}});qx.tool.cli.commands.Package.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.config.Abstract":{construct:!0,require:!0},"qx.tool.cli.commands.Package":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.config.Lockfile",{extend:qx.tool.config.Abstract,type:"singleton",statics:{config:{fileName:qx.tool.cli.commands.Package.lockfile.filename,version:"2.1.0",validate:!1,createIfNotExists:!0,templateFunction:function(){return{libraries:[],version:"2.1.0"}}}},construct:function(){qx.tool.config.Abstract.constructor.call(this,qx.tool.config.Lockfile.config)}});qx.tool.config.Lockfile.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.cli.api.AbstractApi",{extend:qx.core.Object,properties:{rootDir:{check:"String",nullable:!1}},members:{initialize:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}}});qx.tool.cli.api.AbstractApi.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.api.AbstractApi":{construct:!0,require:!0},"qx.tool.utils.Json":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("path"),r=qx.tool.utils.Promisify.fs;qx.Class.define("qx.tool.cli.api.CompilerApi",{extend:qx.tool.cli.api.AbstractApi,construct:function(){qx.tool.cli.api.AbstractApi.constructor.call(this);this.__P_204_0={}},properties:{configFilename:{check:"String",nullable:!1},configuration:{},command:{init:null,nullable:!0,check:"qx.tool.cli.commands.Command",event:"changeCommand"}},members:{__P_204_0:null,load:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=t.join(e.getRootDir(),e.getConfigFilename());a={};n.next=4;return r.existsAsync(o);case 4:if(!n.sent){n.next=8;break}n.next=7;return qx.tool.utils.Json.loadJsonAsync(o);case 7:a=n.sent;case 8:e.setConfiguration(a);return n.abrupt("return",a);case 10:case"end":return n.stop()}},n)}))()},afterLibrariesLoaded:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.getLibraryApis(),n=0;case 1:if(!(n<r.length)){t.next=7;break}t.next=4;return r[n].afterLibrariesLoaded();case 4:n++;t.next=1;break;case 7:case"end":return t.stop()}},t)}))()},addLibraryApi:function(e){var r=t.resolve(e.getRootDir());this.__P_204_0[r]=e},getLibraryApis:function(){return Object.values(this.__P_204_0)}}});qx.tool.cli.api.CompilerApi.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.utils.json.Parser":{},"qx.tool.utils.json.Stringify":{},"qx.lang.Type":{},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("ajv"),r=require("better-ajv-errors"),n=qx.tool.utils.Promisify.fs;qx.Class.define("qx.tool.utils.Json",{statics:{parseJson:function(e){if(null===e||!e.trim())return null;var t=qx.tool.utils.json.Parser.parseToAst(e.trim());return qx.tool.utils.json.Stringify.astToObject(t)},validate:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new t({allErrors:!0,jsonPointers:!0});if(qx.lang.Type.isArray(n)){a.addSchema(n);n=n[0].$id}if(a.validate(n,e))return!0;if(o){var i=r(n.$id,e,a.errors,{format:"cli",indent:2});qx.tool.compiler.Console.warn("JSON data does not validate against "+n.$id+":\n"+i);return!1}var s,c=r(n.$id,e,a.errors,{format:"js"});s=Array.isArray(c)&&c.length?c.reduce(function(e,t,r){return"".concat(e," ").concat(r+1,") ").concat(t.error)},"").trim():Array.isArray(a.errors)?a.errors.reduce(function(e,t,r){return"".concat(e," ").concat(r+1,") ").concat(t.dataPath," ").concat(t.message)},"").trim():"Unknown error during validation.";throw new Error(s)},getSchemaInfo:function(e){var t={};if(e.$schema){var r=e.$schema.match(/\/([^-]+)-([^.]+)\.json$/);if(r){t.type=r[1].toLocaleLowerCase();t.version=r[2].replace(/-/g,".")}else{var n=e.$schema.match(/\/v([^/]+)\/([^.]+)\.json$/);if(n){t.type=n[2].toLocaleLowerCase();t.version=n[1]}}}else if(e.targets){t.type="compile";t.version="0"}else if(e.info&&e.provides){t.type="manifest";t.version="0"}else if(e.libraries||e.contribs){t.type="qooxdoo";t.version="0"}return 0===Object.getOwnPropertyNames(t).length?null:t},loadJsonAsync:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return n.existsAsync(t);case 2:if(e.sent){e.next=4;break}return e.abrupt("return",null);case 4:e.next=6;return n.readFileAsync(t,"utf8");case 6:r=e.sent;e.prev=7;return e.abrupt("return",qx.tool.utils.Json.parseJson(r));case 11:e.prev=11;e.t0=e.catch(7);throw new Error("Failed to load "+t+": "+e.t0);case 14:case"end":return e.stop()}},e,null,[[7,11]])}));return function(t){return e.apply(this,arguments)}}(),saveJsonAsync:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===r){e.next=5;break}e.next=3;return n.writeFileAsync(t,JSON.stringify(r,null,2),"utf8");case 3:e.next=9;break;case 5:e.next=7;return n.existsAsync(t);case 7:if(!e.sent){e.next=9;break}n.unlinkAsync(t);case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()}});qx.tool.utils.Json.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{},"qx.lang.Type":{},"qx.tool.cli.commands.package.Update":{},"qx.tool.cli.commands.package.List":{},"qx.tool.config.Manifest":{},"qx.tool.utils.Json":{},"qx.tool.config.Compile":{},"qx.tool.config.Lockfile":{},"qx.Promise":{},"qx.core.Assert":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("download"),r=qx.tool.utils.Promisify.fs,n=require("upath"),o=require("process"),a=require("semver"),i=require("rimraf");qx.Class.define("qx.tool.cli.commands.package.Install",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"install [uri[@release_tag]]",describe:'installs the latest compatible release of package (as per Manifest.json). Use "-r <release tag>" or @<release tag> to install a particular release.\n        examples: \n           * qx package install name: Install latest published version\n           * qx package install name@v0.0.2: Install version 0.0.2,\n           * qx package install name@master: Install current master branch from github',builder:{release:{alias:"r",describe:"Use a specific release tag instead of the tag of the latest compatible release",nargs:1,requiresArg:!0,type:"string"},ignore:{alias:"i",describe:"Ignore unmatch of qooxdoo"},verbose:{alias:"v",describe:"Verbose logging"},quiet:{alias:"q",describe:"No output"},save:{alias:"s",default:!0,describe:"Save the libraries as permanent dependencies"},"from-path":{alias:"p",nargs:1,describe:"Install a library/the given library from a local path"}}}}},members:{__P_214_0:!1,install:function(e,t){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=e+(t?"@"+t:"");r.argv.verbose&&qx.tool.compiler.Console.info(">>> To be installed: ".concat(o));r.argv.uri=o;r.argv.fromPath=!1;n.next=6;return r.process();case 6:case"end":return n.stop()}},n)}))()},installFromLocaPath:function(e,t){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n.isAbsolute(e)||(e=n.join(o.cwd(),e));r.argv.verbose&&qx.tool.compiler.Console.info(">>> To be installed: ".concat(t||"local libarary"," from ").concat(e));r.argv.uri=t;r.argv.fromPath=e;a.next=6;return r.process();case 6:case"end":return a.stop()}},a)}))()},isInstalled:function(e,t){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return r.getLockfileModel();case 2:return n.abrupt("return",n.sent.getValue("libraries").some(function(r){return r.uri===e&&(void 0===t||t===r.repo_tag)}));case 3:case"end":return n.stop()}},n)}))()},process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,o,i,s,c,l,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.commands.package.Install.prototype.process.base.call(this);case 2:e.next=4;return this.__P_214_1();case 4:e.next=6;return this._getConfigData();case 6:t=e.sent;r=_slicedToArray(t,2);n=r[0];o=r[1];this.argv.uri=this.argv.uri||this.argv["uri@release_tag"];if(this.argv.uri||this.argv.fromPath){e.next=22;break}if(!o.getValue("libraries").length){e.next=17;break}e.next=15;return this.__P_214_2();case 15:e.next=21;break;case 17:e.next=19;return this.__P_214_3(n.getData());case 19:e.next=21;return this._saveConfigData();case 21:return e.abrupt("return");case 22:i=this.argv.uri;if(this.argv.release)s=this.argv.release;else if(i){c=i.split(/@/);l=_slicedToArray(c,2);i=l[0];s=l[1]}if(a.valid(s)&&"v"!==s[0]){this.argv.verbose&&qx.tool.compiler.Console.info('>>> Prepending "v" to '.concat(s,"."));s="v".concat(s)}if(!this.argv.fromPath){e.next=33;break}if(!s){e.next=28;break}throw new qx.tool.utils.Utils.UserError("Version identifier cannot be used when installing from local path.");case 28:u=!!i&&this.argv.save;e.next=31;return this.__P_214_4(i,this.argv.fromPath,u);case 31:e.next=40;break;case 33:if(!(!s||qx.lang.Type.isString(s)&&s.startsWith("v"))){e.next=38;break}e.next=36;return this.__P_214_5(i,s,this.argv.save);case 36:e.next=40;break;case 38:e.next=40;return this.__P_214_6(i,s,this.argv.save);case 40:e.next=42;return this._saveConfigData();case 42:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Done.");case 43:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_214_1:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.getCache().repos.list.length){t.next=8;break}e.argv.quiet||qx.tool.compiler.Console.info(">>> Updating cache...");e.clearCache();t.next=6;return new qx.tool.cli.commands.package.Update({quiet:!0}).process();case 6:t.next=8;return new qx.tool.cli.commands.package.List({quiet:!0}).process();case 8:case"end":return t.stop()}},t)}))()},__P_214_7:function(e){if(!e)throw new qx.tool.utils.Utils.UserError("No package resource identifier given");var t=e.split(/\//),r=t.slice(0,2).join("/"),n=t.length>2?t.slice(2).join("/"):"";if(!this.getCache().repos.data[r])throw new qx.tool.utils.Utils.UserError("A repository '".concat(r,"' cannot be found."));return{repo_name:r,package_path:n}},__P_214_5:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,o){var a,i,s,c,l,u,p,f,m,d,_,h,g,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getUserQxVersion();case 2:a=e.sent;i=this.__P_214_7(t),s=i.repo_name,c=i.package_path;if(r){e.next=14;break}if(void 0!==(l=this.getCache()).compat[a]){e.next=11;break}this.argv.verbose&&!this.argv.quiet&&qx.tool.compiler.Console.info(">>> Updating cache...");e.next=10;return new qx.tool.cli.commands.package.List({quiet:!0,all:!0}).process();case 10:l=this.getCache(!0);case 11:if(r=l.compat[a][s]){e.next=14;break}throw new qx.tool.utils.Utils.UserError("'".concat(s,"' has no stable release compatible with qooxdoo version ").concat(a,".\n             To install anyways, use --release x.y.z.\n             Please ask the library maintainer to release a compatible version"));case 14:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Installing '".concat(t,"', release '").concat(r,"' for qooxdoo version: ").concat(a));e.next=17;return this.__P_214_8(s,r);case 17:u=e.sent;p=u.download_path;f=!1;if(m=this.getCache().repos.data[s]){e.next=23;break}throw new qx.tool.utils.Utils.UserError("A repository '".concat(s,"' cannot be found."));case 23:if(d=m.releases.data[r]){e.next=26;break}throw new qx.tool.utils.Utils.UserError("'".concat(s,"' has no release '").concat(r,"'."));case 26:_=_createForOfIteratorHelper(d.manifests);e.prev=27;_.s();case 29:if((h=_.n()).done){e.next=39;break}g=h.value.path;if(!c||n.dirname(g)===c){e.next=33;break}return e.abrupt("continue",37);case 33:x=n.join(s,n.dirname(g));f=!0;e.next=37;return this.__P_214_9(x,r,p,o);case 37:e.next=29;break;case 39:e.next=44;break;case 41:e.prev=41;e.t0=e.catch(27);_.e(e.t0);case 44:e.prev=44;_.f();return e.finish(44);case 47:if(f){e.next=49;break}throw new qx.tool.utils.Utils.UserError("The package/library identified by '".concat(t,"' could not be found."));case 49:case"end":return e.stop()}},e,this,[[27,41,44,47]])}));return function(t,r,n){return e.apply(this,arguments)}}(),__P_214_6:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var o,a,i,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getUserQxVersion();case 2:o=e.sent;this.argv.verbose&&qx.tool.compiler.Console.info(">>> Installing '".concat(t,"' from tree hash '").concat(r,"' for qooxdoo version ").concat(o));a=this.__P_214_7(t),i=a.repo_name;e.next=7;return this.__P_214_8(i,r);case 7:s=e.sent;c=s.download_path;e.next=11;return this.__P_214_9(t,r,c,n);case 11:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),__P_214_4:function(e,t){var r=arguments,n=this;return _asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:a=r.length>2&&void 0!==r[2]&&r[2];o.next=3;return n.getUserQxVersion();case 3:i=o.sent;n.argv.verbose&&qx.tool.compiler.Console.info(">>> Installing '".concat(e,"' from '").concat(t,"' for qooxdoo version ").concat(i));o.next=7;return n.__P_214_9(e,void 0,t,a);case 7:case"end":return o.stop()}},o)}))()},__P_214_9:function(e,t,a,i){var s=this;return _asyncToGenerator(regeneratorRuntime.mark(function c(){var l,u,p,f,m,d,_,h,g,x,y,v,b,q;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:l=e?s.__P_214_7(e):{repo_name:"",package_path:""},u=l.repo_name,p=l.package_path;c.next=3;return s._getConfigData();case 3:f=c.sent;m=_slicedToArray(f,2);d=m[0];_=m[1];h=n.join(a,p);g=n.join(h,qx.tool.config.Manifest.config.fileName);if(r.existsSync(g)){c.next=11;break}throw new qx.tool.utils.Utils.UserError("No manifest file in '".concat(h,"'."));case 11:x=qx.tool.utils.Json.parseJson(r.readFileSync(g,"utf-8")),y=x.info;v=n.relative(o.cwd(),h);b={library_name:y.name,library_version:y.version,path:v};e&&(b.uri=e);if(u){b.repo_name=u;t&&(b.repo_tag=t)}if((q=_.getValue("libraries").findIndex(function(t){return e&&t.uri===e||!e&&t.path===v}))>=0){_.setValue(["libraries",q],b);s.argv.verbose&&qx.tool.compiler.Console.info(">>> Updating already existing lockfile entry for ".concat(y.name,", ").concat(y.version,", installed from '").concat(e||v,"'."))}else{_.transform("libraries",function(e){return e.push(b)&&e});s.argv.verbose&&qx.tool.compiler.Console.info(">>> Added new lockfile entry for ".concat(y.name,", ").concat(y.version,", installed from '").concat(e||v,"'."))}i&&d.setValue(["requires",e],"^"+y.version);c.next=21;return s.__P_214_10(h);case 21:!c.sent&&s.argv.verbose&&qx.tool.compiler.Console.info(">>> No applications installed for ".concat(e,"."));c.next=25;return s.__P_214_11(h);case 25:!c.sent&&s.argv.verbose&&qx.tool.compiler.Console.info(">>> No dependencies installed for ".concat(e,"."));s.argv.quiet||qx.tool.compiler.Console.info("Installed ".concat(y.name," (").concat(e,", ").concat(y.version,")"));case 28:case"end":return c.stop()}},c)}))()},__P_214_11:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.join(t,qx.tool.config.Manifest.config.fileName);e.next=3;return qx.tool.utils.Json.loadJsonAsync(r);case 3:if((o=e.sent).requires){e.next=7;break}this.argv.verbose&&qx.tool.compiler.Console.info(">>> ".concat(r," does not contain library dependencies."));return e.abrupt("return",!1);case 7:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Installing libraries from ".concat(r,"."));return e.abrupt("return",this.__P_214_3(o));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),__P_214_3:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o,i,s,c,l,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=_createForOfIteratorHelper(Object.getOwnPropertyNames(e.requires));r.prev=1;n.s();case 3:if((o=n.n()).done){r.next=43;break}i=o.value;s=e.requires[i];r.t0=i;r.next="qooxdoo-compiler"===r.t0?9:"@qooxdoo/compiler"===r.t0?9:"qooxdoo-sdk"===r.t0?10:"@qooxdoo/framework"===r.t0?10:16;break;case 9:return r.abrupt("break",41);case 10:r.next=12;return t.getUserQxVersion();case 12:c=r.sent;if(a.satisfies(c,s,{loose:!0})||!t.argv.ignore){r.next=15;break}throw new qx.tool.utils.Utils.UserError("Library '".concat(i,"' needs @qooxdoo/framework version ").concat(s,", found ").concat(c));case 15:return r.abrupt("break",41);case 16:if(!a.validRange(s)){r.next=28;break}l=t.__P_214_12(i,s);if(u=l.tag){r.next=20;break}throw new qx.tool.utils.Utils.UserError("No satisfying release found for ".concat(i,"@").concat(s,"!"));case 20:r.next=22;return t.isInstalled(i,u);case 22:if(r.sent){r.next=26;break}r.next=25;return t.__P_214_5(i,u,!1);case 25:return r.abrupt("break",41);case 26:t.argv.verbose&&qx.tool.compiler.Console.info(">>> ".concat(i,"@").concat(u," is already installed."));return r.abrupt("break",41);case 28:r.next=30;return t.isInstalled(i,s);case 30:if(r.sent){r.next=40;break}r.prev=31;r.next=34;return t.__P_214_6(i,s,!1);case 34:return r.abrupt("break",41);case 37:r.prev=37;r.t1=r.catch(31);throw new qx.tool.utils.Utils.UserError("Could not install ".concat(i,"@").concat(s,": ").concat(r.t1.message));case 40:t.argv.verbose&&qx.tool.compiler.Console.info(">>> ".concat(i,"@").concat(s," is already installed."));case 41:r.next=3;break;case 43:r.next=48;break;case 45:r.prev=45;r.t2=r.catch(1);n.e(r.t2);case 48:r.prev=48;n.f();return r.finish(48);case 51:return r.abrupt("return",!0);case 52:case"end":return r.stop()}},r,null,[[1,45,48,51],[31,37]])}))()},__P_214_12:function(e,t){var r=this.__P_214_7(e).repo_name,n=this.getCache().repos.data[r];if(!n)throw new qx.tool.utils.Utils.UserError("".concat(e," is not in the library registry!"));var o={},i=n.releases.list.map(function(e){var t=n.releases.data[e].manifests[0].info.version;o[t]=e;return t}),s=a.maxSatisfying(i,t,{loose:!0});return{version:s,tag:o[s]}},__P_214_10:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Json.loadJsonAsync(n.join(t,qx.tool.config.Manifest.config.fileName));case 2:if((r=e.sent).provides&&r.provides.application){e.next=5;break}return e.abrupt("return",!1);case 5:o=r.provides.application;e.next=8;return qx.tool.config.Compile.getInstance();case 8:a=e.sent;e.next=11;return a.exists();case 11:if(e.sent){e.next=14;break}qx.tool.compiler.Console.info(">>> Cannot install application "+(o.name||o.class)+" because compile.json does not exist (you must manually add it)");return e.abrupt("return",!1);case 14:a.load();if(!(i=a.getValue("applications").find(function(e){return o.name&&e.name?o.name===e.name:o.class===e.class}))){a.transform("applications",function(e){return e.concat([o])});i=o}if(!a.isDirty()){e.next=20;break}e.next=20;return a.save();case 20:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Installed application "+(i.name||i.class));return e.abrupt("return",!0);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),__P_214_2:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Downloading libraries listed in ".concat(qx.tool.config.Lockfile.config.fileName,"..."));e.next=3;return this.getLockfileData();case 3:t=e.sent.libraries;return e.abrupt("return",qx.Promise.all(t.filter(function(e){return e.repo_name&&e.repo_tag}).map(function(e){return r.__P_214_8(e.repo_name,e.repo_tag)})));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_214_8:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(a){var s,c,l,u,p,f,m,d=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=d.length>1&&void 0!==d[1]?d[1]:null;c=d.length>2&&void 0!==d[2]&&d[2];qx.core.Assert.assertNotNull(s,"Empty tree-ish id is not allowed");l="https://github.com/".concat(a,"/archive/").concat(s,".zip");u="".concat(a,"_").concat(s).replace(/[\^./*?"'<>:]/g,"_");p=[o.cwd(),qx.tool.cli.commands.Package.cache_dir,u];m=p.reduce(function(e,t){var o=e+n.sep+t;if(r.existsSync(o))f=!0;else{r.mkdirSync(o);f=!1}return o});if(c||!f){e.next=11;break}this.argv.verbose&&qx.tool.compiler.Console.info(">>> Repository '".concat(a,"', '").concat(s,"' has already been downloaded to ").concat(m,". To download again, execute 'qx clean'."));e.next=23;break;case 11:this.argv.verbose&&qx.tool.compiler.Console.info(">>> Downloading repository '".concat(a,"', '").concat(s,"' from ").concat(l," to ").concat(m));e.prev=12;e.next=15;return t(l,m,{extract:!0,strip:1});case 15:e.next=23;break;case 17:e.prev=17;e.t0=e.catch(12);this.argv.verbose&&qx.tool.compiler.Console.info(">>> Download failed: ".concat(e.t0.message,". Removing download folder."));i.sync(m);qx.tool.compiler.Console.error("Could not install '".concat(a,"@").concat(s,"'. Use the --verbose flag for more information."));o.exit(1);case 23:return e.abrupt("return",{download_path:m,dir_exists:f});case 24:case"end":return e.stop()}},e,this,[[12,17]])}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.Install.$$dbClassInfo=e}();function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){t&&_defineProperties(e.prototype,t);r&&_defineProperties(e,r);return e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&_setPrototypeOf(e,t)}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}});return _setPrototypeOf(r,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));r&&_setPrototypeOf(o,r.prototype);return o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("util").promisify,r=require("path");require("./Promisify");var n=require("../compiler/util");qx.Class.define("qx.tool.utils.Utils",{extend:qx.core.Object,statics:{newExternalPromise:function(){var e,t,r=new Promise(function(r,n){e=r;t=n});r.resolve=e;r.reject=t;return r},UserError:function(e){"use strict";_inherits(r,e);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);(n=t.call(this,e)).name="UserError";n.stack=null;return n}return r}(_wrapNativeSuper(Error)),formatTime:function(e){var t=Math.floor(e/1e3),r=Math.floor(t/60),n=Math.floor(r/60);e%=1e3;var o="";n&&(o+=(n>9?n:"0"+n)+"h ");(n||r)&&(o+=(r>9?r:"0"+r)+"m ");t>9||!n&&!r?o+=t:(n||r)&&(o+="0"+t);return o+="."+(e>99?"":e>9?"0":"00")+e+"s"},makeParentDir:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=r.dirname(t);e.next=3;return qx.tool.utils.Utils.makeDirs(n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),makeDirs:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=t(n.mkpath);e.next=3;return o(r);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),LineCountingTransform:null,StripSourceMapTransform:null,ToStringWriteStream:null,isPlainObject:function(e){if("object"==_typeof(e)&&null!==e){if("function"==typeof Object.getPrototypeOf){var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"==Object.prototype.toString.call(e)}return!1}},defer:function(e){var t=require("stream"),r=t.Writable,n=t.Transform,o=function(e){"use strict";_inherits(r,n);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);(n=t.call(this,e)).__P_248_0=1;return n}_createClass(r,[{key:"_write",value:function(e,t,r){for(var n=e.toString(),o=0;o<n.length;o++)"\n"==n[o]&&this.__P_248_0++;this.push(n);r()}},{key:"getLineNumber",value:function(){return this.__P_248_0}}]);return r}();e.LineCountingTransform=o;var a=function(e){"use strict";_inherits(r,n);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);(n=t.call(this,e)).__P_248_1="";return n}_createClass(r,[{key:"_transform",value:function(e,t,r){var n=this.__P_248_1+e.toString(),o=n.lastIndexOf("\n");if(o>-1){this.__P_248_1=n.substring(o);n=n.substring(0,o)}else{this.__P_248_1=n;n=""}n=n.replace(/\n\/\/\#\s*sourceMappingURL=.*$/m,"");this.push(n);r()}},{key:"_flush",value:function(e){var t=this.__P_248_1;this.__P_248_1=null;t=t.replace(/\n\/\/\#\s*sourceMappingURL=.*$/m,"");this.push(t);e()}}]);return r}();e.StripSourceMapTransform=a;var i=function(e){"use strict";_inherits(n,r);var t=_createSuper(n);function n(e,r){var o;_classCallCheck(this,n);(o=t.call(this,r)).__P_248_2=e;o.__P_248_3="";return o}_createClass(n,[{key:"_write",value:function(e,t,r){this.__P_248_3+=e.toString();this.__P_248_2?this.__P_248_2.write(e,t,r):r&&r()}},{key:"toString",value:function(){return this.__P_248_3}}]);return n}();e.ToStringWriteStream=i}});qx.tool.utils.Utils.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.api.AbstractApi":{require:!0},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("path"),r=require("fs");qx.Class.define("qx.tool.cli.api.LibraryApi",{extend:qx.tool.cli.api.AbstractApi,properties:{compilerApi:{nullable:!1,check:"qx.tool.cli.api.CompilerApi"}},members:{load:function(){},afterLibrariesLoaded:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()},require:function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}(function(e){r.existsSync(t.join(process.cwd(),"node_modules",e))||this.loadNpmModule(e);return require(e)}),loadNpmModule:function(e){var t=require("child_process").execSync,r="npm install --no-save --no-package-lock ".concat(e);qx.tool.compiler.Console.info(r);t(r,{stdio:"inherit"})}}});qx.tool.cli.api.LibraryApi.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.lang.Type":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.resources.AbstractMatcher",{extend:qx.core.Object,type:"abstract",construct:function(e){qx.core.Object.constructor.call(this);if(e)if(qx.lang.Type.isArray(e)){e=e.map(function(e){"."!=e[0]&&(e="."+e);return e});this.__P_230_0=function(t){return e.some(function(e){return t.endsWith(e)})}}else if("string"==typeof e){"."!=e[0]&&(e="."+e);this.__P_230_0=function(t){return t.endsWith(e)}}else this.__P_230_0=function(t){return e.test(t)}},members:{__P_230_0:null,matches:function(e){return null!==this.__P_230_0&&this.__P_230_0(e)}}});qx.tool.compiler.resources.AbstractMatcher.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.resources.AbstractMatcher":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.resources.ResourceConverter",{extend:qx.tool.compiler.resources.AbstractMatcher,type:"abstract",members:{isDoNotCopy:function(e){return!1},needsConvert:function(e,t,r,n,o){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}},e)}))()},getDestFilename:function(e,t){return null},compile:function(e,t,r,n,o){var a=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("No implementation for "+a.classname+".convert");case 1:case"end":return e.stop()}},e)}))()}}});qx.tool.compiler.resources.ResourceConverter.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.resources.ResourceConverter":{construct:!0,require:!0},"qx.tool.compiler.resources.ScssFile":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath"),r=require("node-sass"),n=qx.tool.utils.Promisify.fs;qx.Class.define("qx.tool.compiler.resources.ScssConverter",{extend:qx.tool.compiler.resources.ResourceConverter,construct:function(){qx.tool.compiler.resources.ResourceConverter.constructor.call(this,".scss")},members:{isDoNotCopy:function(e){return"_"===t.basename(e)[0]},getDestFilename:function(e,r){return qx.tool.compiler.resources.ScssConverter.isNewCompiler()?t.join(e.getOutputDir(),"resource",r.getFilename().replace(/\.scss$/,".css")):t.join(e.getOutputDir(),"resource",r.getFilename().replace(/\bscss\b/g,"css"))},convert:function(e,t,r,n,o){if(!qx.tool.compiler.resources.ScssConverter.isNewCompiler())return this.legacyMobileSassConvert(e,t,r,n);var a=new qx.tool.compiler.resources.ScssFile(e,t.getLibrary(),t.getFilename());a.setThemeFile(o);return a.compile(n)},legacyMobileSassConvert:function(e,o,a,i){return _asyncToGenerator(regeneratorRuntime.mark(function o(){var s,c,l,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:s=e.getAnalyser().getQooxdooPath();o.next=3;return n.readFileAsync(a,"utf8");case 3:if((c=o.sent)&&c.trim()){o.next=11;break}o.next=7;return n.writeFileAsync(i,"");case 7:o.next=9;return n.unlinkAsync(i+".map");case 9:o.next=19;break;case 11:l={data:c,includePaths:[t.dirname(a),t.join(s,"source/resource/qx/mobile/scss"),t.join(s,"source/resource/qx/scss")],outFile:i,sourceMap:i+".map",outputStyle:"compressed"};o.next=14;return qx.tool.utils.Promisify.call(function(e){return r.render(l,function(t,r){t?e(new Error(t.message)):e(null,r)})});case 14:u=o.sent;o.next=17;return n.writeFileAsync(i,u.css);case 17:o.next=19;return n.writeFileAsync(i+".map",u.map);case 19:case"end":return o.stop()}},o)}))()}},statics:{USE_V6_COMPILER:!0,isNewCompiler:function(){if(null===qx.tool.compiler.resources.ScssConverter.USE_V6_COMPILER){console.warn("DEPRECATED: Using the Qooxdoo v5 style of SASS Compilation; this is backwards compatible but the default will change in v7 to use the new style (see https://git.io/JfTPV for details, and how to disable this warning).");qx.tool.compiler.resources.ScssConverter.USE_V6_COMPILER=!1}return qx.tool.compiler.resources.ScssConverter.USE_V6_COMPILER}}});qx.tool.compiler.resources.ScssConverter.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.config.Abstract":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.config.Manifest",{extend:qx.tool.config.Abstract,type:"singleton",statics:{config:{fileName:"Manifest.json",version:"1.0.0"}},construct:function(){qx.tool.config.Abstract.constructor.call(this,qx.tool.config.Manifest.config)}});qx.tool.config.Manifest.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.Json":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("path");qx.Class.define("qx.tool.cli.ConfigDb",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);this.__P_201_0={}},properties:{path:{nullable:!1,check:"String",apply:"_applyPath"}},members:{__P_201_1:null,__P_201_0:null,_applyPath:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_201_1={};case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),load:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Json.loadJsonAsync(this.getPath());case 2:e.t0=e.sent;if(e.t0){e.next=5;break}e.t0={};case 5:this.__P_201_1=e.t0;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),save:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Utils.makeParentDir(this.getPath());case 2:e.next=4;return qx.tool.utils.Json.saveJsonAsync(this.getPath(),this.__P_201_1);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),setOverride:function(e,t){void 0===t?delete this.__P_201_0[e]:this.__P_201_0[e]=t},db:function(e,t){if(e){var r=this.__P_201_0[e];if(r)return r;for(var n=this.__P_201_1,o=e.split("."),a=0;a<o.length;a++){var i=o[a],s=n[i];if(void 0===s){if(void 0===t)return;s=a==o.length-1?n[i]=t:n[i]={}}n=s}return n}return this.__P_201_1}},defer:function(e){e.__P_201_2=t.join(require("os").homedir(),".qooxdoo/")},statics:{__P_201_3:null,__P_201_2:null,getInstance:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=qx.tool.cli.ConfigDb.__P_201_3){e.next=6;break}(r=qx.tool.cli.ConfigDb.__P_201_3=new qx.tool.cli.ConfigDb).setPath(t.join(qx.tool.cli.ConfigDb.getDirectory(),"config.json"));e.next=6;return r.load();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),getDirectory:function(){return this.__P_201_2},db:function(e,t){return qx.tool.cli.ConfigDb.getInstance().db(e,t)}}});qx.tool.cli.ConfigDb.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.cli.ConfigDb":{},"qx.tool.compiler.Console":{},"qx.tool.cli.commands.package.Upgrade":{},"qx.tool.config.Registry":{},"qx.tool.config.Abstract":{},"qx.tool.config.Manifest":{},"qx.lang.Type":{},"qx.tool.compiler.Version":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("process"),r=require("upath"),n=require("semver"),o=qx.tool.utils.Promisify.fs;qx.Class.define("qx.tool.cli.commands.package.Migrate",{extend:qx.tool.cli.commands.Package,statics:{migrationInProcess:!1,getYargsCommand:function(){return{command:"migrate",describe:"migrates the package system to a newer version.",builder:{verbose:{alias:"v",describe:"Verbose logging"},quiet:{alias:"q",describe:"No output"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C,S,T,A,E,R=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=R.length>0&&void 0!==R[0]&&R[0];if(!(i=qx.tool.cli.commands.package.Migrate).migrationInProcess){e.next=4;break}return e.abrupt("return");case 4:i.migrationInProcess=!0;s=!1;c=qx.tool.cli.commands.Package;l=t.cwd();u=[[r.join(l,c.lockfile.filename),r.join(l,c.lockfile.legacy_filename)],[r.join(l,c.cache_dir),r.join(l,c.legacy_cache_dir)],[r.join(qx.tool.cli.ConfigDb.getDirectory(),c.package_cache_name),r.join(qx.tool.cli.ConfigDb.getDirectory(),c.legacy_package_cache_name)]];if(!this.checkFilesToRename(u).length){e.next=21;break}p=[{files:r.join(l,".gitignore"),from:c.legacy_cache_dir+"/",to:c.cache_dir+"/"}];e.next=13;return this.migrate(u,p,a);case 13:if(!a){e.next=17;break}s=!0;e.next=21;break;case 17:this.argv.quiet||qx.tool.compiler.Console.info("Fixing path names in the lockfile...");this.argv.reinstall=!0;e.next=21;return new qx.tool.cli.commands.package.Upgrade(this.argv).process();case 21:f=qx.tool.config.Registry.getInstance();m=[];e.next=25;return f.exists();case 25:if(!e.sent){e.next=33;break}e.next=28;return f.load();case 28:d=f.getLibraries();_=_createForOfIteratorHelper(d);try{for(_.s();!(h=_.n()).done;){g=h.value;m.push(new qx.tool.config.Abstract(qx.tool.config.Manifest.config).set({baseDir:r.join(l,g.path)}))}}catch(e){_.e(e)}finally{_.f()}e.next=34;break;case 33:o.existsSync(qx.tool.config.Manifest.config.fileName)&&m.push(qx.tool.config.Manifest.getInstance());case 34:x=0,y=m;case 35:if(!(x<y.length)){e.next=80;break}v=y[x];e.next=39;return v.set({warnOnly:!0}).load();case 39:v.setValidate(!1);s=!1;b="";if(!qx.lang.Type.isArray(v.getValue("info.authors"))){s=!0;b+="   missing info.authors\n"}if(!n.valid(v.getValue("info.version"))){s=!0;b+="   missing or invalid info.version\n"}q={"info.qooxdoo-versions":null,"info.qooxdoo-range":null,"provides.type":null,"requires.qxcompiler":null,"requires.qooxdoo-sdk":null,"requires.qooxdoo-compiler":null};if(v.keyExists(q)){s=!0;b+="   obsolete entry:\n";for(P in q)q[P]&&(b+="      "+P+"\n")}if(!s){e.next=55;break}if(!a){e.next=51;break}qx.tool.compiler.Console.warn("*** Manifest(s) need to be updated:\n"+b);e.next=55;break;case 51:v.transform("info.authors",function(e){return""===e?[]:qx.lang.Type.isString(e)?[{name:e}]:qx.lang.Type.isObject(e)?[{name:e.name,email:e.email}]:qx.lang.Type.isArray(e)?e.map(function(e){return qx.lang.Type.isObject(e)?{name:e.name,email:e.email}:{name:e}}):[]}).transform("info.version",function(e){var t=n.coerce(e);if(null===t){qx.tool.compiler.Console.warn("*** Version string '".concat(e,"' could not be interpretted as semver, changing to 1.0.0"));return"1.0.0"}return String(t)}).unset("info.qooxdoo-versions").unset("info.qooxdoo-range").unset("provides.type").unset("requires.qxcompiler").unset("requires.qooxdoo-compiler").unset("requires.qooxdoo-sdk");e.next=54;return v.save();case 54:this.argv.quiet||qx.tool.compiler.Console.info("Updated settings in ".concat(v.getRelativeDataPath(),"."));case 55:k=qx.tool.compiler.Version.VERSION;w=v.getValue("requires.@qooxdoo/compiler")||k;e.t0=this;e.next=60;return this.getGlobalQxPath();case 60:e.t1=e.sent;e.next=63;return e.t0.getLibraryVersion.call(e.t0,e.t1);case 63:C=e.sent;S=v.getValue("requires.@qooxdoo/framework")||C;if(n.satisfies(k,w)&&n.satisfies(C,S)){e.next=76;break}s=!0;if(!a){e.next=71;break}qx.tool.compiler.Console.warn("*** Framework and/or compiler dependencies in Manifest need to be updated.");e.next=76;break;case 71:v.setValue("requires.@qooxdoo/compiler","^"+k).setValue("requires.@qooxdoo/framework","^"+C);v.setWarnOnly(!1);e.next=75;return v.save();case 75:this.argv.quiet||qx.tool.compiler.Console.info("Updated dependencies in ".concat(v.getRelativeDataPath(),"."));case 76:v.setValidate(!0);case 77:x++;e.next=35;break;case 80:if(a){e.next=85;break}T=r.join(t.cwd(),"compile.json");A=[{files:T,from:"qx/browser",to:"@qooxdoo/qx/browser"}];e.next=85;return this.migrate([T],A);case 85:E=r.join(t.cwd(),"compile.js");e.next=88;return o.existsAsync(E);case 88:if(!e.sent){e.next=93;break}e.next=91;return o.readFileAsync(E,"utf8");case 91:e.sent.indexOf("module.exports")<0&&qx.tool.compiler.Console.warn("*** Your compile.js appears to be missing a `module.exports` statement - please see https://git.io/fjBqU for more details");case 93:i.migrationInProcess=!1;if(s){if(a){qx.tool.compiler.Console.error("*** Please run 'qx package migrate' to apply the changes. If you don't want this, downgrade to a previous version of the compiler.");t.exit(1)}qx.tool.compiler.Console.info("Migration completed.")}else a||this.argv.quiet||qx.tool.compiler.Console.info("Everything is up-to-date. No migration necessary.");case 95:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.Migrate.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.config.Abstract":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.config.Registry",{extend:qx.tool.config.Abstract,type:"singleton",statics:{config:{fileName:"qooxdoo.json",version:"1.0.0"}},construct:function(){qx.tool.config.Abstract.constructor.call(this,qx.tool.config.Registry.config)},members:{getLibraries:function(){return this.getValue("libraries")}}});qx.tool.config.Registry.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.json.Parser":{}}};qx.Bootstrap.executePendingDefers(e);var t={LEFT_BRACE:0,RIGHT_BRACE:1,LEFT_BRACKET:2,RIGHT_BRACKET:3,COLON:4,COMMA:5,STRING:6,NUMBER:7,TRUE:8,FALSE:9,NULL:10,COMMENT:11,WHITESPACE:12};qx.Class.define("qx.tool.utils.json.Tokenizer",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.input=e;this.settings=t||{};this.tokens=null;this.tokenIndex=-1},members:{token:function(){if(null===this.tokens)throw new Error("No tokens to return (have you called tokenize?)");if(this.tokenIndex>=this.tokens.length)throw new Error("No more tokens available");return this.tokenIndex<0?this.next():this.tokens[this.tokenIndex]},hasMore:function(){var e=qx.tool.utils.json.Tokenizer.tokenTypes;if(null===this.tokens)throw new Error("No tokens to return (have you called tokenize?)");if(this.settings.returnWhitespace)return this.tokenIndex<this.tokens.length;var t=this.tokenIndex;t<0&&(t=0);for(;t<this.tokens.length;t++){var r=this.tokens[t];if(r.type!=e.COMMENT&&r.type!=e.WHITESPACE)return!0}return!1},next:function(){var e=qx.tool.utils.json.Tokenizer.tokenTypes;if(null===this.tokens)throw new Error("No tokens to return (have you called tokenize?)");if(this.tokenIndex>=this.tokens.length)throw new Error("No more tokens to get");if(this.settings.returnWhitespace){if(this.tokenIndex<this.tokens.length)return this.tokens[++this.tokenIndex]}else for(++this.tokenIndex;this.tokenIndex<this.tokens.length;this.tokenIndex++){var t=this.tokens[this.tokenIndex];if(t.type!=e.COMMENT&&t.type!=e.WHITESPACE)return t}return null},tokenize:function(){for(var e=qx.tool.utils.json.Tokenizer,t=1,r=1,n=0,o=this.tokens=[],a=this.input;n<a.length;){var i=[a,n,t,r,this.settings],s=e.parseWhitespace.apply(e,i)||e.parseComment.apply(e,i)||e.parseChar.apply(e,i)||e.parseKeyword.apply(e,i)||e.parseString.apply(e,i)||e.parseNumber.apply(e,i);if(s){var c={type:s.type,value:s.value,loc:qx.tool.utils.json.Parser.location(t,r,n,s.line,s.column,s.index,this.settings.source)};s.rawValue&&(c.rawValue=s.rawValue);o.push(c);n=s.index;t=s.line;r=s.column}else qx.tool.utils.json.Parser.error(e.cannotTokenizeSymbol(a.charAt(n),t,r),a,t,r)}return o}},statics:{tokenTypes:t,punctuatorTokensMap:{"{":t.LEFT_BRACE,"}":t.RIGHT_BRACE,"[":t.LEFT_BRACKET,"]":t.RIGHT_BRACKET,":":t.COLON,",":t.COMMA},keywordTokensMap:{true:{type:t.TRUE,value:!0},false:{type:t.FALSE,value:!1},null:{type:t.NULL,value:null}},stringStates:{_START_:0,START_QUOTE_OR_CHAR:1,ESCAPE:2},escapes:{'"':0,"\\":1,"/":2,b:3,f:4,n:5,r:6,t:7,u:8},numberStates:{_START_:0,MINUS:1,ZERO:2,DIGIT:3,POINT:4,DIGIT_FRACTION:5,EXP:6,EXP_DIGIT_OR_SIGN:7},isDigit1to9:function(e){return e>="1"&&e<="9"},isDigit:function(e){return e>="0"&&e<="9"},isHex:function(e){return qx.tool.utils.json.Tokenizer.isDigit(e)||e>="a"&&e<="f"||e>="A"&&e<="F"},isExp:function(e){return"e"===e||"E"===e},cannotTokenizeSymbol:function(e,t,r){return"Cannot tokenize symbol <".concat(e,"> at ").concat(t,":").concat(r)},parseWhitespace:function(e,t,r,n){for(var o="";;){var a=e.charAt(t);if("\r"===a){t++;r++;n=1;o+=a;if("\n"===e.charAt(t)){t++;o+="\n"}}else if("\n"===a){t++;r++;n=1;o+=a}else{if("\t"!==a&&" "!==a)break;t++;n++;o+=a}}return 0==o.length?null:{index:t,line:r,column:n,type:qx.tool.utils.json.Tokenizer.tokenTypes.WHITESPACE,value:o}},parseComment:function(e,t,r,n){var o=e.substring(t,t+2),a=t;if("/*"===o){for(t+=2;t<e.length;t++){if("*"===(i=e[t])&&"/"===e[t+1]){t+=2;n+=2;break}if("\r"===i){t++;r++;n=1;"\n"===e.charAt(t)&&t++}else if("\n"===i){t++;r++;n=1}else n++}return{index:t,line:r,column:n,type:qx.tool.utils.json.Tokenizer.tokenTypes.COMMENT,value:e.substring(a,t)}}if("//"===o){for(t+=2;t<e.length;t++){var i;if("\r"===(i=e[t])){t++;r++;n=1;"\n"===e.charAt(t)&&t++;break}if("\n"===i){t++;r++;n=1;break}}return{index:t,line:r,column:n,type:qx.tool.utils.json.Tokenizer.tokenTypes.COMMENT,value:e.substring(a,t)}}return null},parseChar:function(e,t,r,n){var o=e.charAt(t),a=qx.tool.utils.json.Tokenizer.punctuatorTokensMap;return o in a?{type:a[o],line:r,column:n+1,index:t+1,value:o}:null},parseKeyword:function(e,t,r,n){var o=qx.tool.utils.json.Tokenizer.keywordTokensMap;for(var a in o)if(o.hasOwnProperty(a)&&e.substr(t,a.length)===a){var i=o[a],s=i.type,c=i.value;return{type:s,line:r,column:n+a.length,index:t+a.length,value:c}}return null},parseString:function(e,t,r,n,o){for(var a=qx.tool.utils.json.Tokenizer,i=a.stringStates,s=a.tokenTypes,c=a.escapes,l=t,u="",p=i._START_;t<e.length;){var f=e.charAt(t);switch(p){case i._START_:if('"'!==f)return null;p=i.START_QUOTE_OR_CHAR;t++;break;case i.START_QUOTE_OR_CHAR:if("\\"===f){p=i.ESCAPE;u+=f;t++}else{if('"'===f){t++;var m={type:s.STRING,line:r,column:n+t-l,index:t,value:u};o.verbose&&(m.rawValue=e.substring(l,t));return m}u+=f;t++}break;case i.ESCAPE:if(!(f in c))return null;u+=f;t++;if("u"===f)for(var d=0;d<4;d++){var _=e.charAt(t);if(!_||!qx.tool.utils.json.Tokenizer.isHex(_))return null;u+=_;t++}p=i.START_QUOTE_OR_CHAR}}return null},parseNumber:function(e,t,r,n){var o=qx.tool.utils.json.Tokenizer.numberStates,a=t,i=t,s=o._START_;e:for(;t<e.length;){var c=e.charAt(t);switch(s){case o._START_:if("-"===c)s=o.MINUS;else if("0"===c){i=t+1;s=o.ZERO}else{if(!qx.tool.utils.json.Tokenizer.isDigit1to9(c))return null;i=t+1;s=o.DIGIT}break;case o.MINUS:if("0"===c){i=t+1;s=o.ZERO}else{if(!qx.tool.utils.json.Tokenizer.isDigit1to9(c))return null;i=t+1;s=o.DIGIT}break;case o.ZERO:if("."===c)s=o.POINT;else{if(!qx.tool.utils.json.Tokenizer.isExp(c))break e;s=o.EXP}break;case o.DIGIT:if(qx.tool.utils.json.Tokenizer.isDigit(c))i=t+1;else if("."===c)s=o.POINT;else{if(!qx.tool.utils.json.Tokenizer.isExp(c))break e;s=o.EXP}break;case o.POINT:if(!qx.tool.utils.json.Tokenizer.isDigit(c))break e;i=t+1;s=o.DIGIT_FRACTION;break;case o.DIGIT_FRACTION:if(qx.tool.utils.json.Tokenizer.isDigit(c))i=t+1;else{if(!qx.tool.utils.json.Tokenizer.isExp(c))break e;s=o.EXP}break;case o.EXP:if("+"===c||"-"===c)s=o.EXP_DIGIT_OR_SIGN;else{if(!qx.tool.utils.json.Tokenizer.isDigit(c))break e;i=t+1;s=o.EXP_DIGIT_OR_SIGN}break;case o.EXP_DIGIT_OR_SIGN:if(!qx.tool.utils.json.Tokenizer.isDigit(c))break e;i=t+1}t++}return i>0?{type:qx.tool.utils.json.Tokenizer.tokenTypes.NUMBER,line:r,column:n+i-a,index:i,value:parseFloat(e.substring(a,i))}:null}}});qx.tool.utils.json.Tokenizer.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&_setPrototypeOf(e,t)}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}});return _setPrototypeOf(r,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));r&&_setPrototypeOf(o,r.prototype);return o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.utils.json.Tokenizer":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.utils.json.Parser",{statics:{literals:[qx.tool.utils.json.Tokenizer.tokenTypes.STRING,qx.tool.utils.json.Tokenizer.tokenTypes.NUMBER,qx.tool.utils.json.Tokenizer.tokenTypes.TRUE,qx.tool.utils.json.Tokenizer.tokenTypes.FALSE,qx.tool.utils.json.Tokenizer.tokenTypes.NULL],objectStates:{_START_:0,OPEN_OBJECT:1,PROPERTY:2,COMMA:3},propertyStates:{_START_:0,KEY:1,COLON:2},arrayStates:{_START_:0,OPEN_ARRAY:1,VALUE:2,COMMA:3},defaultSettings:{verbose:!0,source:null},location:function(e,t,r,n,o,a,i){return{start:{line:e,column:t,offset:r},end:{line:n,column:o,offset:a},source:i||null}},comment:function(e,t,r){if(void 0!==r.comments){var n=e[t];void 0===n&&(n=e[t]=[]);r.comments.forEach(function(e){n.push({loc:e.loc,source:e.value})})}},parseObject:function(e,t,r){for(var n,o=qx.tool.utils.json.Parser.objectStates,a=qx.tool.utils.json.Tokenizer.tokenTypes,i={type:"object",children:[]},s=o._START_;t.hasMore();){var c=t.token();switch(s){case o._START_:if(c.type!==a.LEFT_BRACE)return null;n=c;s=o.OPEN_OBJECT;if(r.verbose){i.startToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(i,"leadingComments",c)}t.next();break;case o.OPEN_OBJECT:if(c.type===a.RIGHT_BRACE){if(r.verbose){i.loc=qx.tool.utils.json.Parser.location(n.loc.start.line,n.loc.start.column,n.loc.start.offset,c.loc.end.line,c.loc.end.column,c.loc.end.offset,r.source);i.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(i,"trailingComments",c)}t.next();return{value:i}}var l=qx.tool.utils.json.Parser.parseProperty(e,t,r);i.children.push(l.value);s=o.PROPERTY;break;case o.PROPERTY:if(c.type===a.RIGHT_BRACE){if(r.verbose){i.loc=qx.tool.utils.json.Parser.location(n.loc.start.line,n.loc.start.column,n.loc.start.offset,c.loc.end.line,c.loc.end.column,c.loc.end.offset,r.source);i.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(i,"trailingComments",c)}t.next();return{value:i}}if(c.type===a.COMMA){qx.tool.utils.json.Parser.comment(i.children[i.children.length-1],"trailingComments",c);s=o.COMMA;t.next()}else qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(c.loc.start.offset,c.loc.end.offset),c.loc.start.line,c.loc.start.column),e,c.loc.start.line,c.loc.start.column);break;case o.COMMA:var u=qx.tool.utils.json.Parser.parseProperty(e,t,r);if(u){i.children.push(u.value);s=o.PROPERTY}else qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(c.loc.start.offset,c.loc.end.offset),c.loc.start.line,c.loc.start.column),e,c.loc.start.line,c.loc.start.column)}}qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedEnd());return null},parseProperty:function(e,t,r){for(var n,o=qx.tool.utils.json.Parser,a=o.objectStates,i=o.propertyStates,s=qx.tool.utils.json.Tokenizer.tokenTypes,c={type:"property",key:null,value:null},l=a._START_;t.hasMore();){var u=t.token();switch(l){case i._START_:if(u.type!==s.STRING)return null;var p={type:"identifier",value:u.value};if(r.verbose){p.loc=u.loc;c.startToken=p.startToken=p.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(p,"leadingComments",u)}n=u;c.key=p;l=i.KEY;t.next();break;case i.KEY:if(u.type===s.COLON){if(r.verbose){qx.tool.utils.json.Parser.comment(c.key,"trailingComments",u);c.colonToken=u}l=i.COLON;t.next()}else qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(u.loc.start.offset,u.loc.end.offset),u.loc.start.line,u.loc.start.column),e,u.loc.start.line,u.loc.start.column);break;case i.COLON:var f=qx.tool.utils.json.Parser.parseValue(e,t,r);c.value=f.value;if(r.verbose){c.endToken=f.value.endToken;c.loc=qx.tool.utils.json.Parser.location(n.loc.start.line,n.loc.start.column,n.loc.start.offset,f.value.loc.end.line,f.value.loc.end.column,f.value.loc.end.offset,r.source)}return{value:c}}}return null},parseArray:function(e,t,r){for(var n,o,a=qx.tool.utils.json.Parser.arrayStates,i=qx.tool.utils.json.Tokenizer.tokenTypes,s={type:"array",children:[]},c=a._START_;t.hasMore();){o=t.token();switch(c){case a._START_:if(o.type!==i.LEFT_BRACKET)return null;n=o;if(r.verbose){s.startToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(s,"leadingComments",o)}c=a.OPEN_ARRAY;t.next();break;case a.OPEN_ARRAY:if(o.type===i.RIGHT_BRACKET){if(r.verbose){s.loc=qx.tool.utils.json.Parser.location(n.loc.start.line,n.loc.start.column,n.loc.start.offset,o.loc.end.line,o.loc.end.column,o.loc.end.offset,r.source);s.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(s,"trailingComments",o)}t.next();return{value:s}}var l=qx.tool.utils.json.Parser.parseValue(e,t,r);s.children.push(l.value);c=a.VALUE;break;case a.VALUE:if(o.type===i.RIGHT_BRACKET){if(r.verbose){s.loc=qx.tool.utils.json.Parser.location(n.loc.start.line,n.loc.start.column,n.loc.start.offset,o.loc.end.line,o.loc.end.column,o.loc.end.offset,r.source);s.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(s,"trailingComments",o)}t.next();return{value:s}}if(o.type===i.COMMA){c=a.COMMA;t.next()}else qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(o.loc.start.offset,o.loc.end.offset),o.loc.start.line,o.loc.start.column),e,o.loc.start.line,o.loc.start.column);break;case a.COMMA:var u=qx.tool.utils.json.Parser.parseValue(e,t,r);s.children.push(u.value);c=a.VALUE}}qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedEnd());return null},parseLiteral:function(e,t,r){var n=t.token();if(-1!==qx.tool.utils.json.Parser.literals.indexOf(n.type)){var o=n.value;n.type==qx.tool.utils.json.Tokenizer.tokenTypes.STRING&&(o=o.replace(/\\(.)/g,"$1"));var a={type:"literal",value:o,rawValue:e.substring(n.loc.start.offset,n.loc.end.offset)};if(r.verbose){a.loc=n.loc;a.startToken=a.endToken=t.tokenIndex;qx.tool.utils.json.Parser.comment(a,"leadingComments",n)}t.next();return{value:a}}return null},parseValue:function(e,t,r){var n,o,a,i=t.token(),s=(n=qx.tool.utils.json.Parser).parseLiteral.apply(n,arguments)||(o=qx.tool.utils.json.Parser).parseObject.apply(o,arguments)||(a=qx.tool.utils.json.Parser).parseArray.apply(a,arguments);if(s)return s;qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(i.loc.start.offset,i.loc.end.offset),i.loc.start.line,i.loc.start.column),e,i.loc.start.line,i.loc.start.column);return null},parseToAst:function(e,t){t=Object.assign({},qx.tool.utils.json.Parser.defaultSettings,t);var r=new qx.tool.utils.json.Tokenizer(e,t);r.tokenize();r.hasMore()||qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedEnd());var n=qx.tool.utils.json.Parser.parseValue(e,r,t);if(!r.hasMore()){var o=n.value;t.verbose&&(o.tokenizer=r);return o}var a=r.next();qx.tool.utils.json.Parser.error(qx.tool.utils.json.Parser.unexpectedToken(e.substring(a.loc.start.offset,a.loc.end.offset),a.loc.start.line,a.loc.start.column),e,a.loc.start.line,a.loc.start.column);return null},parse:function(e,t){return qx.tool.utils.json.Parser.parseToAst(e,t)},unexpectedEnd:function(){return"Unexpected end of JSON input"},unexpectedToken:function(e,t,r){return"Unexpected token <".concat(e,"> at ").concat(t,":").concat(r)},error:function(e,t,r,n){throw new(function(e){"use strict";_inherits(r,e);var t=_createSuper(r);function r(e,n,o,a){var i;_classCallCheck(this,r);var s=o?e+"\n"+function(e,t,r){return e.split(/\n|\r\n?|\f/)[t-1]+"\n"+new Array(r).join(" ")+"^"}(n,o,a):e;(i=t.call(this,s)).rawMessage=e;return i}return r}(_wrapNativeSuper(SyntaxError)))(e,t,r,n)}}});qx.tool.utils.json.Parser.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"qx.tool.utils.json.Writer":{},"qx.lang.Type":{},"qx.tool.utils.json.Tokenizer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.utils.json.Stringify",{extend:qx.core.Object,statics:{prettyPrint:function(e){var t=new qx.tool.utils.json.Writer;!function e(r){switch(r.type){case"object":t.comments(r.leadingComments);t.write("{\n").indent(1);r.children.forEach(function(r,n){n>0&&t.write(",\n");t.write('"'+r.key.value+'" : ');e(r.value)});r.children.length&&t.write("\n");t.comments(r.trailingComments);t.indent(-1).write("}");break;case"array":t.comments(r.leadingComments);t.write("[\n").indent(1);r.children.forEach(function(r,n){n>0&&t.write(",\n");e(r.value)});r.children.length&&t.write("\n");t.comments(r.trailingComments);t.indent(-1).write("]\n");break;case"property":e(r.key);t.write(" : ");e(r.value);break;case"identifier":t.write('"'+r.value+'"');break;case"literal":t.comments(r.leadingComments);t.write(r.rawValue);t.comments(r.trailingComments);break;default:throw new Error("Unexpected node type '"+r.type+"'")}}(e);return t.buffer},reprint:function(e,t){var r=new qx.tool.utils.json.Writer;if(!t){o(e);return r.buffer}var n=t.tokenizer;function o(e){if("string"==typeof e)r.write('"'+e+'"');else if("number"==typeof e)r.write(e);else if("boolean"==typeof e)r.write(e?"true":"false");else if(qx.lang.Type.isArray(e)){r.write("[ ");e.forEach(function(e,t){0!=t&&r.write(", ");o(e)});r.write(" ]")}else{var t=!0,n=r.matchIndent();r.write("{\n").indent(1);for(var a in e){t||r.write(",\n");r.write('"'+a+'": ');o(e[a]);t=!1}r.write("\n").indent(-1).write("}");r.resetIndent(n)}}function a(e,t){r.write('"'+e+'": ');o(t)}var i=0;function s(e){if(i>-1)for(;i<e;){var t=n.tokens[i];r.write(t.rawValue||t.value);i++}}!function e(t,c){function l(e,t){var r;if(void 0!==t.endToken)r=t.endToken;else{if(void 0===t.startToken)return e;r=t.startToken}return e>r?e:r}if(void 0!==c.startToken)switch(c.type){case"object":if(!qx.tool.utils.json.Stringify.isPlainObject(t)){o(t);return}var u={};c.children.forEach(function(e,t){u[e.key.value]=e});var p={};for(var f in t)p[f]=t[f];s(c.startToken+1);for(var m=-1,d=!0,_=0;_<c.children.length;_++){var h=(y=c.children[_]).key.value,g=t[h];if(void 0!==g){d=!1;m=l(m,y.value);s(y.value.startToken);e(g,y.value);delete p[h]}else{s(y.key.startToken);i=y.value.endToken+1;if(d&&_<c.children.length-1){for(;n.tokens[i].type!=qx.tool.utils.json.Tokenizer.tokenTypes.COMMA;)i++;i++}}}d=0===c.children.length;var x=r.matchIndent();for(var f in p){if(!d){r.write(",\n");d=!1}a(f,p[f])}r.resetIndent(x);i=-1===m?c.endToken:m+1;s(c.endToken+1);break;case"array":if(!qx.lang.Type.isArray(t)){o(t);return}s(c.startToken+1);for(_=0;_<t.length;_++){var y;if(void 0!==(y=_<c.children.length?c.children[_]:void 0)){s(y.startToken);e(t[_],y);i=y.endToken+1}else{x=r.matchIndent();0!=_&&r.write(",\n");o(t[_]);r.resetIndent(x)}}s(c.endToken+1);break;case"property":break;case"literal":if(!qx.tool.utils.json.Stringify.isLiteral(t)){o(t);i=c.endToken+1;return}if(qx.tool.utils.json.Stringify.isSameLiteral(c,t))s(c.startToken+1);else{s(c.startToken);"string"==typeof t?r.write('"'+t+'"'):r.write(t);i=c.startToken+1}break;default:throw new Error("Unexpected node type '"+c.type+"'")}else!function(e){var t=qx.tool.utils.json.Stringify.prettyPrint(e);r.write(t);i=-1}(c)}(e,t);if(i>-1)for(;i<n.tokens.length;){var c=n.tokens[i++];if(c.type!=qx.tool.utils.json.Tokenizer.tokenTypes.COMMENT&&c.type!=qx.tool.utils.json.Tokenizer.tokenTypes.WHITESPACE)break;r.write(c.rawValue||c.value)}return r.buffer},astToObject:function(e,t){return function e(t){var r;switch(t.type){case"object":r={};t.children.forEach(function(t,n){r[t.key.value]=e(t.value)});break;case"array":r=[];t.children.forEach(function(t,n){r.push(e(t))});break;case"literal":r=t.value;break;default:throw new Error("Unexpected node type '"+t.type+"'")}return r}(e)},isPlainObject:function(e){if("object"===_typeof(e)&&null!==e){var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return!1},isLiteral:function(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e},isSameLiteral:function(e,t){return null===e.rawValue&&null===t||!(null!==e.rawValue&&null===t||null===e.rawValue&&null!==t)&&(_typeof(e.value)===_typeof(t)&&("string"==typeof e.value?e.value===t:e.rawValue==t))}}});qx.tool.utils.json.Stringify.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.cli.ConfigDb":{},"qx.tool.utils.Utils":{},"qx.tool.utils.Json":{},"qx.tool.config.Manifest":{},"qx.tool.config.Lockfile":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("process"),r=require("github-api/dist/components/Search"),n=require("github-api/dist/components/Repository"),o=require("node-fetch"),a=require("semver"),i=require("inquirer"),s=require("upath");qx.Class.define("qx.tool.cli.commands.package.Update",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"update [repository]",describe:"updates information on packages from github. Has to be called before the other commands. If a package URI is supplied, only update information on that package",builder:{file:{alias:"f",describe:"Output result to a file"},search:{alias:"S",describe:"Search GitHub for repos (as opposed to using the cached nightly data)"},"all-versions":{alias:"a",describe:"Retrieve all releases (as opposed to the latest minor/patch release of each major release)"},verbose:{alias:"v",describe:"Verbose logging"},quiet:{alias:"q",describe:"No output"},"export-only":{alias:"E",describe:"Export the current cache without updating it first (requires --file)"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var c,l,u,p,f,m,d,_,h,g,x,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y=function(){return(y=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o,i,p,d,_,h,g,x,y,v,b,q,P,k,w,C,S,T,A,E,R,O,I,j,D,N,L,M,G,F,U,B,$,W,J;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o={token:f.token};i=new r({},o);p=0;l.quiet||qx.tool.compiler.Console.log("Searching for package repositories on GitHub...");d="topic:qooxdoo-package fork:true";u&&(d+=" "+u);e.next=8;return i.forRepositories({q:d});case 8:_=e.sent;d="topic:qooxdoo-contrib fork:true";u&&(d+=" "+u);e.next=13;return i.forRepositories({q:d});case 13:h=e.sent;g=_.data.concat(h.data);x={};y=m.getCache().repos.data;v=_createForOfIteratorHelper(g);e.prev=18;v.s();case 20:if((b=v.n()).done){e.next=137;break}q=b.value;P=q.full_name;if(!x[P]){e.next=25;break}return e.abrupt("continue",135);case 25:x[P]=q;if(!u||P===u){e.next=28;break}return e.abrupt("continue",135);case 28:l.verbose&&qx.tool.compiler.Console.info("### Found ".concat(P," ..."));c.push(P);k=new n(P,o);y[P]={description:q.description,url:q.url,releases:{list:[],data:{}}};e.prev=32;e.next=35;return k.listReleases();case 35:w=e.sent;e.next=42;break;case 38:e.prev=38;e.t0=e.catch(32);qx.tool.compiler.Console.error("Error retrieving releases: "+e.t0);return e.abrupt("continue",135);case 42:C=w.data.filter(function(e){return!!l["all-versions"]||a.valid(e.tag_name,!0)}).map(function(e){e.version=a.valid(e.tag_name,!0)||"0.0.0";return e}).sort(function(e,t){return a.compare(e.version,t.version)}).filter(function(e,t,r){return"0.0.0"!==e.version&&(!!l["all-versions"]||(t===r.length-1||a.major(r[t+1].version)>a.major(e.version)))});S=C.map(function(e){return e.version});l.verbose&&qx.tool.compiler.Console.info(">>> Retrieved ".concat(C.length," release(s) of ").concat(P,": ").concat(S.join(", "),"."));T=_createForOfIteratorHelper(C);e.prev=46;T.s();case 48:if((A=T.n()).done){e.next=127;break}E=A.value;R=E.tag_name;O=y[P].releases;I=[{path:"."}];j=void 0;l.verbose&&qx.tool.compiler.Console.log(">>> Trying to retrieve 'qooxdoo.json' for ".concat(P," ").concat(R,"..."));e.prev=55;e.next=58;return k.getContents(R,"qooxdoo.json",!0);case 58:j=e.sent;l.verbose&&qx.tool.compiler.Console.log(">>>  File exists, checking for libraries...");if("string"==typeof(D=j.data))try{D=qx.tool.utils.Json.parseJson(D)}catch(e){l.verbose&&qx.tool.compiler.Console.warn("!!!  Parse error: ".concat(e.message))}I=D.libraries||D.contribs;e.next=68;break;case 65:e.prev=65;e.t1=e.catch(55);e.t1.message.match(/404/)?l.verbose&&qx.tool.compiler.Console.log(">>> No qooxdoo.json"):l.verbose&&qx.tool.compiler.Console.warn("!!! Error: ".concat(e.t1.message));case 68:N=_createForOfIteratorHelper(I.entries());e.prev=69;N.s();case 71:if((L=N.n()).done){e.next=114;break}M=_slicedToArray(L.value,2),G=M[0],F=M[1].path;U=void 0;F=s.join(F,qx.tool.config.Manifest.config.fileName);e.prev=75;l.verbose&&qx.tool.compiler.Console.log(">>> Retrieving Manifest file '".concat(F,"' for ").concat(P," ").concat(R,"..."));e.next=79;return k.getContents(R,F,!0);case 79:U=e.sent;e.next=86;break;case 82:e.prev=82;e.t2=e.catch(75);e.t2.message.match(/404/)?l.verbose&&qx.tool.compiler.Console.warn("!!!  File does not exist."):l.verbose&&qx.tool.compiler.Console.warn("!!! Error: ".concat(e.t2.message));return e.abrupt("continue",112);case 86:if("string"!=typeof(B=U.data)){e.next=96;break}e.prev=88;B=qx.tool.utils.Json.parseJson(B);e.next=96;break;case 92:e.prev=92;e.t3=e.catch(88);if(l.verbose){qx.tool.compiler.Console.warn("!!! Parse error: ".concat(e.t3.message));qx.tool.compiler.Console.log(B)}return e.abrupt("continue",112);case 96:$=B.info["qooxdoo-versions"];W=B.requires&&(B.requires["@qooxdoo/framework"]||B.requires["qooxdoo-sdk"])||B.info["qooxdoo-range"];l.verbose&&B.info["qooxdoo-range"]&&qx.tool.compiler.Console.warn('!!! info.qooxdoo-range is deprecated. Please use the requires["@qooxdoo/framework"] key instead.');l.verbose&&B.requires&&B.requires["qooxdoo-sdk"]&&qx.tool.compiler.Console.warn('!!! requires["qooxdoo-sdk"] is deprecated. Please use the requires["@qooxdoo/framework"] key instead.');if("string"==typeof $&&!W){W=$;l.verbose&&qx.tool.compiler.Console.warn('!!! info.qooxdoo-version is deprecated. Please use the requires["@qooxdoo/framework"] key instead.')}if($ instanceof Array&&$.length&&!W){W=$.join(" || ");l.verbose&&qx.tool.compiler.Console.warn("!!! Manifest key 'info.qooxdoo-version' is deprecated. Please use the requires[\"@qooxdoo/framework\"] key instead.")}if(W){e.next=105;break}l.verbose&&qx.tool.compiler.Console.warn("!!! No compatibility information, skipping...");return e.abrupt("continue",112);case 105:if(a.validRange(W,{loose:!0})){e.next=108;break}l.verbose&&qx.tool.compiler.Console.warn("!!! Invalid compatibility information, skipping...");return e.abrupt("continue",112);case 108:$=W;I[G]={path:F,qx_versions:$,info:B.info,requires:B.requires,provides:B.provides};p++;l.verbose?qx.tool.compiler.Console.log(">>> ".concat(P," ").concat(R,": Found package '").concat(B.info.name,"' (compatible with ").concat($,")")):l.quiet||t.stdout.write(".");case 112:e.next=71;break;case 114:e.next=119;break;case 116:e.prev=116;e.t4=e.catch(69);N.e(e.t4);case 119:e.prev=119;N.f();return e.finish(119);case 122:J="https://github.com/".concat(P,"/archive/").concat(R,".zip");O.list.push(R);O.data[R]={id:E.id,published_at:E.published_at,comment:E.body,title:E.name,prerelease:E.prerelease,manifests:I,zip_url:J};case 125:e.next=48;break;case 127:e.next=132;break;case 129:e.prev=129;e.t5=e.catch(46);T.e(e.t5);case 132:e.prev=132;T.f();return e.finish(132);case 135:e.next=20;break;case 137:e.next=142;break;case 139:e.prev=139;e.t6=e.catch(18);v.e(e.t6);case 142:e.prev=142;v.f();return e.finish(142);case 145:m.getCache().version=qx.tool.config.Lockfile.getInstance().getVersion();m.getCache().num_libraries=p;u||(m.getCache().repos.list=c.sort());l.quiet||l.verbose||t.stdout.write("\n");case 149:case"end":return e.stop()}},e,null,[[18,139,142,145],[32,38],[46,129,132,135],[55,65],[69,116,119,122],[75,82],[88,92]])}))).apply(this,arguments)};x=function(){return y.apply(this,arguments)};g=function(){return(g=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l.quiet||qx.tool.compiler.Console.log("Downloading cache from GitHub ...");t=m.getRepositoryCacheUrl();e.prev=2;e.next=5;return o(t);case 5:r=e.sent;e.next=8;return r.json();case 8:n=e.sent;m.setCache(n);e.next=15;break;case 12:e.prev=12;e.t0=e.catch(2);throw new qx.tool.utils.Utils.UserError(e.t0.message);case 15:case"end":return e.stop()}},e,null,[[2,12]])}))).apply(this,arguments)};h=function(){return g.apply(this,arguments)};c=[];l=this.argv;u=l.repository;if(!l.exportOnly){e.next=11;break}if(!l.file){qx.tool.compiler.Console.error("Path required via --file argument.");t.exit(1)}this.exportCache(l.file);return e.abrupt("return");case 11:u||this.clearCache();e.next=14;return qx.tool.cli.ConfigDb.getInstance();case 14:p=e.sent;f=p.db("github",{});m=this;if(l.search){e.next=22;break}e.next=20;return h();case 20:e.next=33;break;case 22:if(f.token){e.next=31;break}e.next=25;return i.prompt([{type:"input",name:"token",message:"Searching GitHub requires an API token - visit https://github.com/settings/tokens to obtain one (you do not need to assign any permissions, just create a token);\nWhat is your GitHub API Token ? "}]);case 25:if((d=e.sent).token){e.next=29;break}qx.tool.compiler.Console.error("You have not provided a GitHub token.");return e.abrupt("return");case 29:f.token=d.token;p.save();case 31:e.next=33;return x();case 33:if((_=this.getCache().num_libraries)&&!l.quiet){qx.tool.compiler.Console.info("Found ".concat(_," releases of libraries."));qx.tool.compiler.Console.info("Run 'qx package list' in the root dir of your project to see which versions of these libraries are compatible.")}e.next=37;return this.saveCache();case 37:if(!l.file){e.next=40;break}e.next=40;return this.exportCache(l.file);case 40:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.Update.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{},"qx.lang.Type":{},"qx.tool.config.Manifest":{},"qx.tool.utils.Json":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("semver"),r=require("columnify"),n=require("upath");qx.Class.define("qx.tool.cli.commands.package.List",{extend:qx.tool.cli.commands.Package,statics:{localPathRepoName:"_local_",getYargsCommand:function(){return{command:"list [repository]",describe:'if no repository name is given, lists all available packages that are compatible with the project\'s qooxdoo version ("--all" lists incompatible ones as well). Otherwise, list all compatible packages.',builder:{all:{alias:"a",describe:"Show all versions, including incompatible ones"},verbose:{alias:"v",describe:"Verbose logging"},quiet:{alias:"q",describe:"No output"},json:{alias:"j",describe:"Output list as JSON literal"},installed:{alias:"i",describe:"Show only installed libraries"},namespace:{alias:"n",describe:"Display library namespace"},match:{alias:"m",describe:"Filter by regular expression (case-insensitive)"},libraries:{alias:"l",describe:"List libraries only (no repositories)"},short:{alias:"s",describe:"Omit title and description to make list more compact"},noheaders:{alias:"H",describe:"Omit header and footer"},prereleases:{alias:"p",describe:"Include prereleases into latest compatible releases"},"uris-only":{alias:"u",describe:"Output only the GitHub URIs of the packages which are used to install the packages. Implies --noheaders and --libraries."}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o,a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.commands.package.List.prototype.process.base.call(this);case 2:this.__P_215_0=[];this.__P_215_1={};this.__P_215_2={};o=qx.tool.cli.commands.package.List.localPathRepoName;a=this.getCache().repos;e.next=9;return this.getUserQxVersion();case 9:i=e.sent;e.next=12;return this.__P_215_3(i);case 12:s=e.sent;this.argv.verbose&&qx.tool.compiler.Console.log(">>> We have ".concat(s," packages compatible with qooxdoo version ").concat(i));if(0!==s||this.argv.all||this.argv.quiet){e.next=17;break}qx.tool.compiler.Console.info("Currently, no packages compatible with qooxdoo version ".concat(i," exist."));return e.abrupt("return");case 17:if(!(c=this.argv.repository)){e.next=23;break}if(a.list.includes(c)){e.next=21;break}throw new qx.tool.utils.Utils.UserError("Repository ".concat(c," does not exist or is not a qooxdoo package repo."));case 21:if(this.__P_215_1[c]&&this.__P_215_1[c].length){l={columnSplitter:"   ",config:{description:{maxWidth:60},compatibility:{dataTransform:function(e){switch(e){case"false":return"not compatible / untested";case"true":return"";default:return""}}},installedVersion:{dataTransform:function(e){switch(e){case"false":return"-";default:return e}}}}};if(!this.argv.quiet){u=this.__P_215_1[c].map(function(e){return Object.assign({},e)}).sort(function(e,t){return e.name.localeCompare(t.name)});p=u.map(function(e){return Object.assign({},e)}).map(function(e,t){delete e.manifest;if(t){var r,n=u[t-1],o=_createForOfIteratorHelper(Object.getOwnPropertyNames(e).reverse());try{for(o.s();!(r=o.n()).done;){var a=r.value;["compatibility","required_qx_version"].indexOf(a)>-1||e[a]===n[a]&&e.name===n.name&&(e[a]="")}}catch(e){o.e(e)}finally{o.f()}}return e});this.argv.json?qx.tool.compiler.Console.info(JSON.stringify(u,null,2)):qx.tool.compiler.Console.info(r(p,l))}}else this.argv.verbose&&qx.tool.compiler.Console.info("Repository ".concat(c," does not contain suitable qooxdoo libraries."));return e.abrupt("return");case 23:if(this.argv.urisOnly){f=["uri"];this.argv.noheaders=!0;this.argv.libraries=!0}else f=this.argv.short?["uri","installedVersion","latestVersion","latestCompatible"]:["uri","name","description","installedVersion","latestVersion","latestCompatible"];(this.argv.namespace||this.argv.installed)&&f.splice(1,0,"namespace");m={showHeaders:!this.argv.noheaders,columnSplitter:"   ",columns:f,config:{name:{maxWidth:25},description:{maxWidth:60},installedVersion:{headingTransform:function(){return"INSTALLED"},dataTransform:function(e){return"false"===e?"":e}},latestVersion:{headingTransform:function(){return"LATEST"},dataTransform:function(e){return"false"===e?"-":e}},latestCompatible:{headingTransform:function(){return"COMPATIBLE"},dataTransform:function(e){return"false"===e?"-":e}}}};(d=this.argv.all?this.__P_215_0:this.__P_215_0.filter(function(e){return e.latestCompatible||w.argv.installed&&e.name===o})).sort(function(e,t){return(e=e.name.toLowerCase())<(t=t.name.toLowerCase())?-1:e>t?1:0});_=[];h=_createForOfIteratorHelper(d);e.prev=30;h.s();case 32:if((g=h.n()).done){e.next=60;break}x=g.value;y=[];if(qx.lang.Type.isArray(this.__P_215_1[x.name])){e.next=37;break}return e.abrupt("continue",58);case 37:v=_createForOfIteratorHelper(this.__P_215_1[x.name]);e.prev=38;v.s();case 40:if((b=v.n()).done){e.next=48;break}q=b.value;if(t.valid(q.version)){e.next=45;break}this.argv.verbose&&qx.tool.compiler.Console.warn(">>> Ignoring '".concat(x.name,"' ").concat(q.name,"': invalid version format '").concat(q.version,"'."));return e.abrupt("continue",46);case 45:if(x.name===o||t.eq(q.version,x.latestVersion)){P=x.name===qx.tool.cli.commands.package.List.localPathRepoName?q.path:n.join(x.name,q.path||"");y.push({type:"library",uri:P,namespace:q.namespace,name:q.name,description:q.summary||x.description,installedVersion:q.installedVersion,latestVersion:x.latestVersion,latestCompatible:x.latestCompatible,manifest:q.manifest})}case 46:e.next=40;break;case 48:e.next=53;break;case 50:e.prev=50;e.t0=e.catch(38);v.e(e.t0);case 53:e.prev=53;v.f();return e.finish(53);case 56:if(y.length>1&&!this.argv.libraries&&!this.argv.short&&x.name!==o){_.push({type:"repository",uri:x.name,name:"",description:x.description,installedVersion:"",latestVersion:x.latestVersion,latestCompatible:x.latestCompatible});this.argv.json||this.argv.installed||this.argv.match||this.argv.urisOnly||(y=y.map(function(e){e.uri="| "+e.uri;return e}))}_=_.concat(y);case 58:e.next=32;break;case 60:e.next=65;break;case 62:e.prev=62;e.t1=e.catch(30);h.e(e.t1);case 65:e.prev=65;h.f();return e.finish(65);case 68:if(this.argv.match){k=new RegExp(this.argv.match,"i");_=_.filter(function(e){return e.uri.match(k)||e.name.match(k)||e.description.match(k)})}this.argv.installed&&(_=_.filter(function(e){return Boolean(e.installedVersion)}));if(this.argv.json)qx.tool.compiler.Console.info(JSON.stringify(_,null,2));else if(!this.argv.quiet){qx.tool.compiler.Console.info(r(_,m));if(!this.argv.noheaders){qx.tool.compiler.Console.info();qx.tool.compiler.Console.info("Note on columns: LATEST: Latest release that can be installed with this CLI;");qx.tool.compiler.Console.info("                 COMPATIBLE: Latest release that is semver-compatible with the qooxdoo version used.");this.argv.all||qx.tool.compiler.Console.info("To see all libraries, including potentially incompatible ones, use 'qx package list --all'.")}}this.getCache().compat[i]=this.__P_215_2[i];e.next=74;return this.saveCache();case 74:case"end":return e.stop()}},e,this,[[30,62,65,68],[38,50,53,56]])}));return function(){return e.apply(this,arguments)}}(),__P_215_0:null,__P_215_1:null,__P_215_2:null,__P_215_3:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var o,a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C,S,T,A,E,R,O,I,j,D,N,L,M,G,F,U,B,$,W,J;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.argv.installed){e.next=29;break}o=qx.tool.cli.commands.package.List.localPathRepoName;this.__P_215_0.push({name:o,description:"Libraries on local filesystem"});this.__P_215_1[o]=[];e.next=6;return this.getLockfileData();case 6:a=e.sent;i=_createForOfIteratorHelper(a.libraries);e.prev=8;i.s();case 10:if((s=i.n()).done){e.next=21;break}if((c=s.value).repo_name){e.next=19;break}l=n.join(process.cwd(),c.path,qx.tool.config.Manifest.config.fileName);e.next=16;return qx.tool.utils.Json.loadJsonAsync(l);case 16:u=e.sent;p=u.info;this.__P_215_1[o].push({name:p.name,namespace:u.provides.namespace,summary:p.summary,version:"v"+p.version,compatibility:t.satisfies(r,u.requires["qooxdoo-sdk"],!0),path:n.relative(process.cwd(),n.dirname(l)),installedVersion:"v"+p.version,manifest:u});case 19:e.next=10;break;case 21:e.next=26;break;case 23:e.prev=23;e.t0=e.catch(8);i.e(e.t0);case 26:e.prev=26;i.f();return e.finish(26);case 29:f=this.getCache().repos;m=0;void 0===this.__P_215_2[r]&&(this.__P_215_2[r]={});d=_createForOfIteratorHelper(f.list);e.prev=33;d.s();case 35:if((_=d.n()).done){e.next=113;break}h=_.value;g=f.data[h];x=g.description;if(this.argv.all||!x||!x.includes("(deprecated)")&&!x.includes("(unlisted)")){e.next=42;break}this.argv.verbose&&qx.tool.compiler.Console.warn(">>> Ignoring ".concat(h,": Deprecated or unlisted. "));return e.abrupt("continue",111);case 42:y=g.releases.list;v=g.description;b=!1;q=!1;P=!1;k=_createForOfIteratorHelper(y);e.prev=48;k.s();case 50:if((w=k.n()).done){e.next=101;break}C=w.value;S=g.releases.data[C];T=S.prerelease,A=S.manifests;E=_createForOfIteratorHelper(A);e.prev=55;E.s();case 57:if((R=E.n()).done){e.next=91;break}O=R.value;I=O.qx_versions,j=O.info,D=O.provides,N=O.path;L=!1;if(void 0!==j){e.next=64;break}this.argv.verbose&&qx.tool.compiler.Console.warn(">>> Ignoring ".concat(h," ").concat(C,": Undefined info field. "));return e.abrupt("continue",89);case 64:M=j.name;G=j.version;F=C.replace(/v/,"");if(G===F.substr(0,G.length)){e.next=70;break}this.argv.verbose&&qx.tool.compiler.Console.warn(">>> Ignoring ".concat(h," ").concat(C,", library '").concat(M,"': mismatch between tag version '").concat(F,"' and library version '").concat(G,"'."));return e.abrupt("continue",89);case 70:try{q&&!t.gt(G,q,!0)||(q=C)}catch(e){this.argv.verbose&&qx.tool.compiler.Console.warn(">>> Ignoring ".concat(h," ").concat(C,", library '").concat(M,"': invalid version format '").concat(G,"'."))}e.next=73;return this.getInstalledLibraryTag(h,M);case 73:if(!(U=e.sent)){e.next=79;break}L=U;P=U;e.next=83;break;case 79:e.next=81;return this.getInstalledLibraryData(M);case 81:(B=e.sent)&&(L="v"+B.library_version);case 83:$=t.satisfies(r,I,!0);void 0===this.__P_215_1[h]&&(this.__P_215_1[h]=[]);W=this.__P_215_2[r][h];J=W?W.replace(/v/,""):void 0;if(!0===$&&(void 0===W||t.gt(F,J,!1)&&(!T||this.argv.prereleases))){this.__P_215_2[r][h]=C;b=!0}this.__P_215_1[h].push({name:j.name,namespace:D?D.namespace:"",summary:j.summary,version:G,compatibility:$,required_qx_version:I,path:n.dirname(N),installedVersion:L,manifest:O});case 89:e.next=57;break;case 91:e.next=96;break;case 93:e.prev=93;e.t1=e.catch(55);E.e(e.t1);case 96:e.prev=96;E.f();return e.finish(96);case 99:e.next=50;break;case 101:e.next=106;break;case 103:e.prev=103;e.t2=e.catch(48);k.e(e.t2);case 106:e.prev=106;k.f();return e.finish(106);case 109:b&&m++;this.__P_215_0.push({name:h,description:v,installedVersion:P,latestVersion:q,latestCompatible:!!b&&this.__P_215_2[r][h]});case 111:e.next=35;break;case 113:e.next=118;break;case 115:e.prev=115;e.t3=e.catch(33);d.e(e.t3);case 118:e.prev=118;d.f();return e.finish(118);case 121:return e.abrupt("return",m);case 122:case"end":return e.stop()}},e,this,[[8,23,26,29],[33,115,118,121],[48,103,106,109],[55,93,96,99]])}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.List.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("upath"),n=require("node-sass");qx.Class.define("qx.tool.compiler.resources.ScssFile",{extend:qx.core.Object,construct:function(e,t,r){qx.core.Object.constructor.call(this);this.__P_233_0=t;this.__filename=r;this.__P_233_1=e;this.__P_233_2={};this.__P_233_3={}},properties:{file:{nullable:!1,check:"String",event:"changeFile"},themeFile:{init:!1,check:"Boolean"}},members:{__P_233_0:null,__filename:null,__P_233_4:null,__P_233_5:null,__P_233_2:null,__P_233_3:null,compile:function(e){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:o.__P_233_4=r.dirname(e);o.__P_233_5={};a.next=4;return o.loadSource(o.__filename,o.__P_233_0);case 4:i=a.sent;a.next=7;return new qx.Promise(function(a,s){n.render({file:o.__filename,data:i,outputStyle:"compressed",sourceMap:!0,outFile:r.basename(e),importer:function(e,t,r){var n=o.__P_233_2[e];if(!n){var a=o.__P_233_3[e];a&&(n=o.__P_233_2[a])}return n?{contents:n}:null},functions:{"qooxdooUrl($filename, $url)":function(e,t,r){return o.__P_233_6(e,t,r)}}},function(r,n){if(r){o.error("Error status "+r.status+" in "+o.__filename+"["+r.line+","+r.column+"]: "+r.message);a(r)}else t.writeFileAsync(e,n.css.toString(),"utf8").then(function(){return t.writeFileAsync(e+".map",n.map.toString(),"utf8")}).then(function(){return a(null)}).catch(s)})});case 7:return a.abrupt("return",Object.keys(o.__P_233_2));case 8:case"end":return a.stop()}},a)}))()},_analyseFilename:function(e,t){var n=e.match(/^([a-z0-9_.]+):(\/?[^\/].*)/);if(n)return{namespace:n[1],filename:n[2],externalUrl:null};if(e.match(/^[a-z0-9_]+:\/\//))return{externalUrl:e};if("/"==e[0])return{namespace:null,filename:e};var o=r.dirname(t),a=r.resolve(o,e),i=this.__P_233_1.getAnalyser().getLibraries().find(function(e){return a.startsWith(r.resolve(e.getRootDir()))});if(!i){this.error("Cannot find library for "+e+" in "+t);return null}var s=r.join(i.getRootDir(),this.isThemeFile()?i.getThemePath():i.getResourcePath());return{namespace:i.getNamespace(),filename:r.relative(s,a),externalUrl:null}},reloadSource:function(e){e=r.resolve(e);delete this.__P_233_2[e];return this.loadSource(e)},loadSource:function(e,n){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i,s,c,l,u,p;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:e=r.relative(process.cwd(),r.resolve(o.isThemeFile()?n.getThemeFilename(e):n.getResourceFilename(e)));i=e;""==r.extname(i)&&(i+=".scss");if(!(s=t.existsSync(i))&&"_"!=(c=r.basename(i))[0]){l=r.join(r.dirname(i),"_"+c);(s=t.existsSync(l))&&(i=l)}if(s){a.next=8;break}o.__P_233_2[i]=null;return a.abrupt("return",null);case 8:if(void 0===o.__P_233_2[i]){a.next=10;break}return a.abrupt("return",qx.Promise.resolve(o.__P_233_2[i]));case 10:a.next=12;return t.readFileAsync(i,"utf8");case 12:u=a.sent;p=[];u=(u=u.replace(/@import\s+["']([^;]+)["']/gi,function(e,t,n){var a=o._analyseFilename(t,i);if(a.externalUrl)return'@import "'+a.externalUrl+'"';var s=o.__P_233_1.getAnalyser().findLibrary(a.namespace);if(!s){o.error("Cannot find file to import, url="+t+" in file "+i);return null}p.push(o.loadSource(a.filename,s));return'@import "'+r.relative(process.cwd(),s.getResourceFilename(a.filename))+'"'})).replace(/\burl\s*\(\s*([^\)]+)*\)/gi,function(t,n){var a=n[0];"'"!==a&&'"'!==a||(n=n.substring(1));"'"!==(a=n[n.length-1])&&'"'!==a||(n=n.substring(0,n.length-1));var i=o._analyseFilename(n,e);if(i){if(i.externalUrl)return'url("'.concat(i.externalUrl,'")');if(i.namespace){var s=r.relative(process.cwd(),r.join(o.__P_233_1.getOutputDir(),"resource",i.filename)),c=r.relative(o.__P_233_4,s);return'url("'.concat(c,'")')}}return'url("'.concat(n,'")')});o.__P_233_2[i]=u;o.__P_233_3[e]=i;a.next=20;return qx.Promise.all(p);case 20:return a.abrupt("return",u);case 21:case"end":return a.stop()}},a)}))()},getSourceFilenames:function(){return Object.keys(this.__P_233_2)},__P_233_6:function(e,t,o){var a=e.getValue(),i=t.getValue(),s=this._analyseFilename(i,a);if(s){if(s.externalUrl)return n.types.String("url("+s.externalUrl+")");if(s.namespace){var c=r.relative(process.cwd(),r.join(this.__P_233_1.getOutputDir(),"resource",s.filename)),l=r.relative(this.__P_233_4,c);return n.types.String("url("+l+")")}}return n.types.String("url("+i+")")}}});qx.tool.compiler.resources.ScssFile.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.cli.commands.package.Update":{},"qx.tool.cli.commands.package.List":{},"qx.tool.compiler.Console":{},"qx.tool.cli.commands.package.Install":{},"qx.lang.Type":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");qx.Class.define("qx.tool.cli.commands.package.Upgrade",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"upgrade [library_uri]",describe:"if no library URI is given, upgrades all available libraries to the latest compatible version, otherwise upgrade only the package identified by the URI.",builder:{quiet:{alias:"q",describe:"No output"},verbose:{alias:"v",describe:"Verbose logging"},"releases-only":{alias:"r",describe:"Upgrade regular releases only (this leaves versions based on branches, commits etc. untouched)",default:!0},reinstall:{alias:"R",describe:"Do not upgrade, reinstall current version"},dryrun:{alias:"d",describe:"Show result only, do not actually upgrade"},prereleases:{alias:"p",describe:"Use prereleases if available"}}}}},members:{process:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,o,a,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.cli.commands.package.Upgrade.prototype.process.base.call(e);case 2:t.next=4;return new qx.tool.cli.commands.package.Update({quiet:!0,prereleases:e.argv.prereleases}).process();case 4:t.next=6;return new qx.tool.cli.commands.package.List({quiet:!0,prereleases:e.argv.prereleases}).process();case 6:e.argv.quiet||qx.tool.compiler.Console.info("Upgrading project dependencies to their latest available releases...");t.next=9;return e.getLockfileData();case 9:r=t.sent;n=!1;o=new qx.tool.cli.commands.package.Install({quiet:e.argv.quiet,verbose:e.argv.verbose});a=_createForOfIteratorHelper(r.libraries);t.prev=13;a.s();case 15:if((i=a.n()).done){t.next=44;break}if((s=i.value).repo_name&&s.repo_tag){t.next=19;break}return t.abrupt("continue",42);case 19:s.uri||(s.uri=s.repo_name);if(!e.argv.library_uri||s.uri===e.argv.library_uri){t.next=22;break}return t.abrupt("continue",42);case 22:n=!0;if(!e.argv.releasesOnly||qx.lang.Type.isString(s.repo_tag)&&s.repo_tag.startsWith("v")){t.next=26;break}e.argv.quiet||qx.tool.compiler.Console.info("Skipping ".concat(s.library_name," (").concat(s.uri,"@").concat(s.repo_tag,") since it is not a release."));return t.abrupt("continue",42);case 26:t.prev=26;if(!e.argv.dryrun){t.next=30;break}qx.tool.compiler.Console.info("Dry run. Not upgrading ".concat(s.library_name," (").concat(s.uri,"@").concat(s.repo_tag,")."));return t.abrupt("continue",42);case 30:if(!s.repo_tag||!e.argv.reinstall){t.next=35;break}t.next=33;return o.install(s.uri,s.repo_tag);case 33:t.next=37;break;case 35:t.next=37;return o.install(s.uri);case 37:t.next=42;break;case 39:t.prev=39;t.t0=t.catch(26);qx.tool.compiler.Console.warn(t.t0.message);case 42:t.next=15;break;case 44:t.next=49;break;case 46:t.prev=46;t.t1=t.catch(13);a.e(t.t1);case 49:t.prev=49;a.f();return t.finish(49);case 52:if(n){t.next=54;break}throw new qx.tool.utils.Utils.UserError("Library '".concat(e.argv.library_uri,"' is not installed."));case 54:case"end":return t.stop()}},t,null,[[13,46,49,52],[26,39]])}))()}}});qx.tool.cli.commands.package.Upgrade.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.utils.json.Writer",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);this.buffer="";this.__P_252_0=0;this.__P_252_1="";this.__P_252_2=0},members:{write:function(e){if(null===e)e="null";else if(void 0===e)e="undefined";else if("number"==typeof e)e=e.toString();else if("boolean"==typeof e)e=e?"true":"false";else if("string"!=typeof e)throw new Error("Can only write strings and numbers");for(var t=0;;){var r=e.indexOf("\n",t);if(!(r>-1)){this.buffer+=e.substring(t);break}this.buffer+=e.substring(t,r+1);this.__P_252_2=this.buffer.length;this.buffer+=this.__P_252_1;t=r+1}return this},comments:function(e){var t=this;e&&e.forEach(function(e){t.write(e.source+"\n")})},indent:function(e){if(this.__P_252_0+e<0)throw new Error("Unbalanced indent");this.__P_252_0+=e;var t=this.__P_252_1;if(e>0){for(var r="",n=0;n<e;n++)r+="  ";t+=r}else t=t.substring(0,t.length+2*e);this.buffer.substring(this.__P_252_2).match(/[^\s]/)||(this.buffer=this.buffer.substring(0,this.__P_252_2)+t);this.__P_252_1=t;return this},matchIndent:function(){var e=this.buffer.substring(this.__P_252_2).match(/^([\s]*)/)[0],t=this.__P_252_1;this.__P_252_1=e;return t},resetIndent:function(e){this.__P_252_1=e}}});qx.tool.utils.json.Writer.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.Utils":{},"qx.tool.config.Compile":{},"qx.tool.utils.files.Utils":{},"qx.tool.compiler.Console":{defer:"runtime"},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("fs"),r=require("upath"),n=require("chokidar");require("../utils/Utils");require("../compiler");qx.Class.define("qx.tool.cli.Watch",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_203_0=e;this.__P_203_1={classesCompiled:0};this.__P_203_2={};this.__P_203_3=[]},events:{making:"qx.event.type.Event",remaking:"qx.event.type.Event",made:"qx.event.type.Event",configChanged:"qx.event.type.Event"},members:{__P_203_4:null,__P_203_5:null,__P_203_6:!1,__P_203_0:null,__P_203_1:null,__P_203_7:null,__P_203_8:!1,__P_203_9:null,__P_203_10:null,__P_203_2:null,__P_203_3:null,setConfigFilenames:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.__P_203_3=e?e.map(function(e){return r.resolve(e)}):[];case 1:case"end":return n.stop()}},n)}))()},start:function(){var e=this;if(this.__P_203_4)throw new Error("Cannot start watching more than once");this.__P_203_4=qx.tool.utils.Utils.newExternalPromise();var o=[],a=this.__P_203_0.getAnalyser();a.addListener("compiledClass",function(){this.__P_203_1.classesCompiled++},this);o.push(qx.tool.config.Compile.config.fileName);o.push("compile.js");a.getLibraries().forEach(function(e){var t=r.join(e.getRootDir(),e.getSourcePath());o.push(t);t=r.join(e.getRootDir(),e.getResourcePath());o.push(t);t=r.join(e.getRootDir(),e.getThemePath());o.push(t)});var i=this.__P_203_5=[];this.__P_203_0.getApplications().forEach(function(e){var t={application:e,dependsOn:{},outOfDate:!1};i.push(t);var r=e.getBootPath();r&&!o.includes(r)&&o.push(r)});var s=[];Promise.all(o.map(function(e){return new Promise(function(n,o){e=r.resolve(e);t.stat(e,function(t){t?"ENOENT"==t.code?n():o(t):qx.tool.utils.files.Utils.correctCase(e).then(function(e){s.push(e);n()})})})})).then(function(){var t=e._watcher=n.watch(s,{});t.on("change",function(t){return e.__P_203_11("change",t)});t.on("add",function(t){return e.__P_203_11("add",t)});t.on("unlink",function(t){return e.__P_203_11("unlink",t)});t.on("ready",function(){e.__P_203_6=!0;e.__P_203_12()});t.on("error",function(e){qx.tool.compiler.Console.print("ENOSPC"==e.code?"qx.tool.cli.watch.enospcError":"qx.tool.cli.watch.watchError",e)})})},stop:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.__P_203_8=!0;e._watcher.close();if(!e.__P_203_7){t.next=5;break}t.next=5;return e.__P_203_7;case 5:case"end":return t.stop()}},t)}))()},__P_203_12:function(){if(this.__P_203_7)return this.__P_203_7;this.fireEvent("making");var e=this,t=qx.tool.compiler.Console;return this.__P_203_7=function n(){t.print("qx.tool.cli.watch.makingApplications");var o=(new Date).getTime();e.__P_203_1.classesCompiled=0;e.__P_203_9=!1;return e.__P_203_0.make().then(function(){if(e.__P_203_8){t.print("qx.tool.cli.watch.makeStopping");return null}if(e.__P_203_9)return new qx.Promise(function(r){setImmediate(function(){t.print("qx.tool.cli.watch.restartingMake");e.fireEvent("remaking");n().then(r)})});var a=e.__P_203_0.getAnalyser(),i=a.getDatabase(),s=[];e.__P_203_5.forEach(function(e){e.dependsOn={};e.application.getDependencies().forEach(function(t){var n=i.classInfo[t],o=a.findLibrary(n.libraryName),s=[o.getRootDir(),o.getSourcePath()].concat(t.split(".")),c=r.resolve.apply(r,s)+".js";e.dependsOn[c]=!0});var t=r.resolve(e.application.getLoaderTemplate());s.push(qx.tool.utils.files.Utils.correctCase(t).then(function(t){return e.dependsOn[t]=!0}))});return Promise.all(s).then(function(){var r=(new Date).getTime();t.print("qx.tool.cli.watch.compiledClasses",e.__P_203_1.classesCompiled,qx.tool.utils.Utils.formatTime(r-o));e.fireEvent("made")})}).then(function(){e.__P_203_7=null}).catch(function(r){t.print("qx.tool.cli.watch.compileFailed",r);e.__P_203_7=null;e.fireEvent("made")})}()},__P_203_13:function(){var e=this;if(!e.__P_203_7){e.__P_203_10&&clearTimeout(e.__P_203_10);e.__P_203_10=setTimeout(function(){e.__P_203_12()},500)}},__P_203_11:function(e,t){var n=this;if(!this.__P_203_6)return null;t=r.normalize(t);var o=function(){var o=_asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i,s,c,l,u,p;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:a=!1;if(!n.__P_203_3.find(function(e){return e==t})){o.next=4;break}n.fireEvent("configChanged");return o.abrupt("return");case 4:n.__P_203_5.forEach(function(e){if(e.dependsOn[t])a=!0;else{var n=e.application.getBootPath();if(n){n=r.resolve(n);t.startsWith(n)&&(a=!0)}}});i=n.__P_203_0.getAnalyser();s="";if(!i.getLibraries().some(function(e){var n=r.resolve(r.join(e.getRootDir(),e.getResourcePath()));if(t.startsWith(n)){s=r.relative(n,t);return!0}n=r.resolve(r.join(e.getRootDir(),e.getThemePath()));if(t.startsWith(n)){s=r.relative(n,t);return!0}return!1})){o.next=20;break}c=i.getResourceManager();l=n.__P_203_0.getTarget();if(!(u=c.getAsset(s,"unlink"!=e))||"unlink"==e){o.next=20;break}o.next=15;return u.sync(l);case 15:if(!(p=u.getDependsOnThisAsset())){o.next=19;break}o.next=19;return qx.Promise.all(p.map(function(e){return e.sync(l)}));case 19:delete n.__P_203_2[t];case 20:if(a){n.__P_203_9=!0;n.__P_203_13()}case 21:case"end":return o.stop()}},o)}));return function(){return o.apply(this,arguments)}}(),a=this.__P_203_2[t];a||(a=this.__P_203_2[t]={types:{}});a.types[e]=!0;if(a.promise){a.restart=1;return a.promise}if(a.timerId){clearTimeout(a.timerId);a.timerId=null}a.timerId=setTimeout(function(){return function e(r){r.timerId=null;r.promise=o().then(function(){r.restart?e(r):delete n.__P_203_2[t]})}(a)},150);return null},__P_203_14:function(){this.__P_203_4.resolve()}},defer:function(){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.watch.makingApplications":">>> Making the applications...","qx.tool.cli.watch.restartingMake":">>> Code changed during make, restarting...","qx.tool.cli.watch.makeStopping":">>> Not restarting make because make is stopping...","qx.tool.cli.watch.compiledClasses":">>> Compiled %1 classes in %2"});qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.watch.compileFailed":">>> Fatal error during compile: %1","qx.tool.cli.watch.enospcError":">>> ENOSPC error occured - try increasing fs.inotify.max_user_watches","qx.tool.cli.watch.watchError":">>> Error occured while watching files - file modifications may not be detected; error: %1"},"error")}});qx.tool.cli.Watch.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("path"),n=require("../../compiler/util");require("@qooxdoo/framework");var o=require("rimraf"),a=n.promisify(t.stat),i=n.promisify(t.mkdir),s=n.promisify(t.readdir),c=n.promisify(t.rename);qx.Class.define("qx.tool.utils.files.Utils",{extend:qx.core.Object,statics:{findAllFiles:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0;n.next=3;return s(e);case 3:o=n.sent;n.next=11;break;case 6:n.prev=6;n.t0=n.catch(0);if("ENOENT"!=n.t0.code){n.next=10;break}return n.abrupt("return");case 10:throw n.t0;case 11:n.next=13;return qx.Promise.all(o.map(function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(o){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:i=r.join(e,o);n.next=3;return a(i);case 3:if(!n.sent.isDirectory()){n.next=9;break}n.next=7;return qx.tool.utils.files.Utils.findAllFiles(i,t);case 7:n.next=11;break;case 9:n.next=11;return t(i);case 11:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()));case 13:case"end":return n.stop()}},n,null,[[0,6]])}))()},sync:function(e,t,r){var n=this;function o(o,a){if(o.isDirectory()){return(null===a?i(t):Promise.resolve()).then(function(){return s(e).then(function(o){return Promise.all(o.map(function(o){return n.sync(e+"/"+o,t+"/"+o,r)}))})})}if(o.isFile())return qx.Promise.resolve(!r||r(e,t)).then(function(r){return r&&n.copyFile(e,t)})}return new Promise(function(r,i){var s=null,c=null;a(e).then(function(e){s=e;return a(t).then(function(e){return c=e}).catch(function(e){if("ENOENT"!==e.code)throw e})}).then(function(){return c&&s.isDirectory()==c.isDirectory()?s.isDirectory()||s.mtime.getTime()>c.mtime.getTime()||s.size!=c.size?o(s,c):void 0:n.deleteRecursive(t).then(function(){return o(s,c)})}).then(r).catch(i)})},copyFile:function(e,r){return new Promise(function(o,a){n.mkParentPath(r,function(){var n=t.createReadStream(e,{flags:"r",encoding:"binary"}),i=t.createWriteStream(r,{flags:"w",encoding:"binary"});n.on("end",function(){o()});n.on("error",a);i.on("error",a);n.pipe(i)})})},safeStat:function(e){return new Promise(function(r,n){t.stat(e,function(e,t){e&&"ENOENT"!=e.code?n(e):r(e?null:t)})})},safeUnlink:function(e){return new Promise(function(r,n){t.unlink(e,function(e){e&&"ENOENT"!=e.code?n(e):r()})})},safeRename:function(e,r){return new Promise(function(n,o){t.rename(e,r,function(e){e&&"ENOENT"!=e.code?o(e):n()})})},rotateUnique:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.safeStat(t);case 2:e.t0=e.sent;if(!e.t0){e.next=5;break}e.t0=r>1;case 5:if(!e.t0){e.next=26;break}n=null;o=r;case 8:if(!(o>0)){e.next=24;break}a=t+"."+o;if(o!=r){e.next=15;break}e.next=13;return this.safeUnlink(a);case 13:e.next=20;break;case 15:e.next=17;return this.safeStat(a);case 17:if(!e.sent){e.next=20;break}e.next=20;return c(a,n);case 20:n=a;case 21:o--;e.next=8;break;case 24:e.next=26;return c(t,n);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),deleteRecursive:function(e){return new Promise(function(t,r){o(e,function(e){e?r(e):t()})})},correctCase:function(e){var r="";if("win32"===process.platform&&e.match(/^[a-zA-Z]:/)){r=e.substring(0,2);e=e.substring(2)}var n,o,a=(e=e.replace(/\\/g,"/")).split("/");if(!a.length)return r+e;if(a[0].length){n="";o=0}else{n="/";o=1}function i(e){o++;n.length&&"/"!==n&&(n+="/");n+=e;return s()}function s(){if(o==a.length){"win32"===process.platform&&(n=n.replace(/\//g,"\\"));return Promise.resolve(r+n)}var e=a[o];return"."==e||".."==e?i(e):new Promise(function(o,a){t.readdir(0==n.length?".":r+n,{encoding:"utf8"},function(t,r){if(t)a(t);else{for(var n=e.toLowerCase(),s=!1,c=null,l=0;l<r.length;l++){if(r[l]===e){s=!0;break}r[l].toLowerCase()===n&&(c=r[l])}!s&&c&&(e=c);i(e).then(o)}})})}return new Promise(function(n,o){t.stat(r+e,function(t){t?"ENOENT"==t.code?n(r+e):o(t):s().then(n)})})}}});module.exports=qx.tool.utils.files.Utils;qx.tool.utils.files.Utils.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.cli.api.Test",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.setName(e)},properties:{name:{check:"String",event:"changeName"},description:{check:"String",event:"changeDescription"},exitCode:{check:"Number",event:"changeExitCode",nullable:!0,init:null}}});qx.tool.cli.api.Test.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.cli.Cli":{}}};qx.Bootstrap.executePendingDefers(e);require("./Command");require("@qooxdoo/framework");qx.Class.define("qx.tool.cli.commands.Add",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"add <command> [options]",desc:"adds new elements to an existing qooxdoo application/library",builder:function(e){qx.tool.cli.Cli.addYargsCommands(e,["Class","Script"],"qx.tool.cli.commands.add");return e.demandCommand().showHelpOnFail().help()},handler:function(e){}}}},members:{}});qx.tool.cli.commands.Add.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.config.Compile":{},"qx.tool.cli.commands.Package":{},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);require("./Package");require("@qooxdoo/framework");var t=require("fs"),r=require("process"),n=require("upath"),o=require("rimraf");qx.Class.define("qx.tool.cli.commands.Clean",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"clean",describe:"cleans generated files and caches.",builder:{verbose:{alias:"v",describe:"Verbose logging"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.config.Compile.getInstance().load();case 2:t=e.sent;o=_createForOfIteratorHelper(t.getValue("targets"));e.prev=4;o.s();case 6:if((a=o.n()).done){e.next=12;break}i=a.value;e.next=10;return this.__P_205_0(n.join(r.cwd(),i.outputPath));case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14;e.t0=e.catch(4);o.e(e.t0);case 17:e.prev=17;o.f();return e.finish(17);case 20:e.next=22;return this.__P_205_0(n.join(r.cwd(),qx.tool.cli.commands.Package.cache_dir));case 22:case"end":return e.stop()}},e,this,[[4,14,17,20]])}));return function(){return e.apply(this,arguments)}}(),__P_205_0:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return t.existsAsync(r);case 2:if(!e.sent){e.next=6;break}this.argv.verbose&&qx.tool.compiler.Console.info("Removing ".concat(r,"..."));e.next=6;return new Promise(function(e,t){o(r,{},function(r){r?t(r):e()})});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.Clean.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.cli.ConfigDb":{},"qx.tool.compiler.Console":{defer:"runtime"},"qx.tool.utils.Utils":{},"qx.tool.cli.Cli":{},"qx.Promise":{},"qx.tool.utils.files.Utils":{},"qx.tool.cli.Watch":{},"qx.lang.Array":{},"qx.tool.compiler.app.Library":{},"qx.tool.compiler.makers.AppMaker":{},"qx.lang.Object":{},"qx.tool.compiler.targets.BuildTarget":{},"qx.tool.compiler.app.Application":{},"qx.lang.String":{},"qx.tool.compiler.app.Part":{},"qx.tool.compiler.ClassFile":{},"qx.tool.cli.commands.package.Install":{},"qx.tool.compiler.Version":{},"qx.tool.compiler.targets.SourceTarget":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("process"),r=require("gauge"),n=require("semver"),o=require("upath"),a=require("console-control-strings"),i=qx.tool.utils.Promisify.fs;require("app-module-path").addPath(t.cwd()+"/node_modules");require("./Command");qx.Class.define("qx.tool.cli.commands.Compile",{extend:qx.tool.cli.commands.Command,statics:{YARGS_BUILDER:{target:{alias:"t",describe:"Set the target type: source or build or class name. Default is first target in config file",requiresArg:!0,type:"string"},"output-path-prefix":{describe:"Sets a prefix for the output path of the target - used to compile a version into a non-standard directory",type:"string"},download:{alias:"d",describe:"Whether to automatically download missing libraries",type:"boolean",default:!0},locale:{alias:"l",describe:"Compile for a given locale",nargs:1,requiresArg:!0,type:"string",array:!0},"update-po-files":{alias:"u",describe:"enables detection of translations and writing them out into .po files",type:"boolean",default:!1},"library-po":{describe:"The policy for updating translations in libraries",type:["ignore","untranslated","all"],default:"ignore"},"write-all-translations":{describe:"enables output of all translations, not just those that are explicitly referenced",type:"boolean"},"app-class":{describe:"sets the application class",nargs:1,requiresArg:!0,type:"string"},"app-theme":{describe:"sets the theme class for the current application",nargs:1,requiresArg:!0,type:"string"},"app-name":{describe:"sets the name of the current application",nargs:1,requiresArg:!0,type:"string"},watch:{describe:"enables watching for changes and continuous compilation",type:"boolean",alias:"w"},"machine-readable":{alias:"M",describe:"output compiler messages in machine-readable format",type:"boolean"},minify:{alias:"m",describe:"disables minification (build targets only)",choices:["off","minify","mangle","beautify"],default:"mangle"},"save-source-in-map":{describe:"Saves the source code in the map file (build target only)",type:"boolean",default:!1},"save-unminified":{alias:"u",describe:"Saves a copy of the unminified version of output files (build target only)",type:"boolean",default:!1},erase:{alias:"e",describe:"Enabled automatic deletion of the output directory when compiler version or environment variables change",type:"boolean",default:!0},feedback:{describe:"Shows gas-gauge feedback",type:"boolean",default:null,alias:"f"},typescript:{alias:"T",describe:"Outputs typescript definitions in qooxdoo.d.ts",type:"boolean"},"add-created-at":{describe:"Adds code to populate object's $$createdAt",type:"boolean"},clean:{alias:"D",describe:"Deletes the target dir before compile",type:"boolean"},"warn-as-error":{alias:"E",describe:"Handle compiler warnings as error",type:"boolean",default:!1},"write-library-info":{alias:"I",describe:"Write library information to the script, for reflection",type:"boolean",default:!0},bundling:{alias:"b",describe:"Whether bundling is enabled",type:"boolean",default:!0}},getYargsCommand:function(){return{command:"compile",describe:"compiles the current application, using compile.json",builder:qx.tool.cli.commands.Compile.YARGS_BUILDER}}},events:{writingApplications:"qx.event.type.Event",writingApplication:"qx.event.type.Data",writtenApplication:"qx.event.type.Data",writtenApplications:"qx.event.type.Event",compilingClass:"qx.event.type.Data",compiledClass:"qx.event.type.Data",saveDatabase:"qx.event.type.Data",checkEnvironment:"qx.event.type.Data",making:"qx.event.type.Event",made:"qx.event.type.Event"},members:{__P_206_0:null,__P_206_1:null,__P_206_2:null,__P_206_3:null,__P_206_4:!1,process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,o,i,s,c,l,u,p,f,m,d,_,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.commands.Compile.prototype.process.base.call(this);case 2:e.next=4;return qx.tool.cli.ConfigDb.getInstance();case 4:n=e.sent;null===this.argv.feedback&&(this.argv.feedback=n.db("qx.default.feedback",!0));if(!this.argv["machine-readable"]){e.next=10;break}qx.tool.compiler.Console.getInstance().setMachineReadable(!0);e.next=16;break;case 10:e.next=12;return qx.tool.cli.ConfigDb.getInstance();case 12:o=e.sent;if(i=o.db("qx.default.color",null)){s=a.color(i.split(" "));t.stdout.write(s+a.eraseLine());c=a.color("reset");t.on("exit",function(){return t.stdout.write(c+a.eraseLine())});qx.tool.compiler.Console.getInstance().setColorOn(s)}if(this.argv.feedback){l=require("gauge/themes");u=l.newTheme(l({hasUnicode:!0,hasColor:!0}));p=qx.tool.compiler.Console.getInstance().getColorOn();u.preProgressbar=p+u.preProgressbar;u.preSubsection=p+u.preSubsection;u.progressbarTheme.postComplete+=p;u.progressbarTheme.postRemaining+=p;this.__P_206_0=new r;this.__P_206_0.setTheme(u);this.__P_206_0.show("Compiling",0);f={error:"ERROR",warning:"Warning"};qx.tool.compiler.Console.getInstance().setWriter(function(e,t){if((t=qx.tool.compiler.Console.MESSAGE_IDS[t])&&"message"===t.type)h.__P_206_0.show(p+e);else{h.__P_206_0.hide();qx.tool.compiler.Console.log(p+f[(t||{}).type||"error"]+": "+e);h.__P_206_0.show()}})}case 16:if(this.__P_206_0){this.addListener("writingApplications",function(){return h.__P_206_0.show("Writing Applications",0)});this.addListener("writtenApplications",function(){return h.__P_206_0.show("Writing Applications",1)});this.addListener("writingApplication",function(e){return h.__P_206_0.pulse("Writing Application "+e.getData().getName())});this.addListener("compilingClass",function(e){return h.__P_206_0.pulse("Compiling "+e.getData().classFile.getClassName())});this.addListener("minifyingApplication",function(e){return h.__P_206_0.pulse("Minifying "+e.getData().application.getName()+" "+e.getData().filename)})}else{this.addListener("writingApplication",function(e){return qx.tool.compiler.Console.print("qx.tool.cli.compile.writingApplication",e.getData().getName())});this.addListener("minifyingApplication",function(e){return qx.tool.compiler.Console.print("qx.tool.cli.compile.minifyingApplication",e.getData().application.getName(),e.getData().filename)});if(this.argv.verbose){m={};this.addListener("compilingClass",function(e){var t=e.getData().classFile.getClassName();m[t]=new Date;qx.tool.compiler.Console.print("qx.tool.cli.compile.compilingClass",t)});this.addListener("compiledClass",function(e){var t=e.getData().classFile.getClassName(),r=m[t],n=(new Date).getTime()-r.getTime();qx.tool.compiler.Console.print("qx.tool.cli.compile.compiledClass",t,qx.tool.utils.Utils.formatTime(n))})}}this.addListener("making",function(e){h.__P_206_0?h.__P_206_0.show("Compiling",1):qx.tool.compiler.Console.print("qx.tool.cli.compile.makeBegins")});this.addListener("made",function(e){h.__P_206_0?h.__P_206_0.show("Compiling",1):qx.tool.compiler.Console.print("qx.tool.cli.compile.makeEnds")});this.addListener("writtenApplications",function(e){if(h.argv.verbose){qx.tool.compiler.Console.log("\nCompleted all applications, libraries used are:");Object.values(h.__P_206_3).forEach(function(e){return qx.tool.compiler.Console.log("   ".concat(e.getNamespace()," (").concat(e.getRootDir(),")"))})}});e.next=22;return this._loadConfigAndStartMaking();case 22:if(!this.argv.watch){d=this.__P_206_1.every(function(e){return e.getSuccess()});_=this.__P_206_1.every(function(e){return e.getHasWarnings()});d&&_&&this.argv.warnAsError&&(d=!1);!this.argv.__P_206_5&&!this.argv["machine-readable"]&&this.argv.feedback&&this.__P_206_4&&qx.tool.compiler.Console.warn("   *******************************************************************************************\n   **                                                                                       **\n   **  Your compilation will include temporary files that are only necessary during         **\n   **  development; these files speed up the compilation, but take up space that you would  **\n   **  probably not want to put on a production server.                                     **\n   **                                                                                       **\n   **  When you are ready to deploy, try running `qx deploy` to get a minimised version     **\n   **                                                                                       **\n   *******************************************************************************************");t.exitCode=d?0:1}case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),_loadConfigAndStartMaking:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.cli.Cli.getInstance().getParsedArgs();case 2:if(r=e.__P_206_2=t.sent){t.next=5;break}throw new qx.tool.utils.Utils.UserError("Error: Cannot find any configuration");case 5:t.next=7;return e.createMakersFromConfig(r);case 7:if((n=e.__P_206_1=t.sent)&&n.length){t.next=10;break}throw new qx.tool.utils.Utils.UserError("Error: Cannot find anything to make");case 10:o=0;a=function(t){1==o&&e.dispatchEvent(t.clone())};t.next=14;return qx.Promise.all(n.map(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var s,c,l,u,p,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=n.getAnalyser();t.next=3;return qx.tool.cli.ConfigDb.getInstance();case 3:c=t.sent;s.setWritePoLineNumbers(c.db("qx.translation.strictPoCompatibility",!1));t.next=7;return i.existsAsync(n.getOutputDir());case 7:if(t.sent){t.next=9;break}e.__P_206_4=!0;case 9:if(!e.argv.clean){t.next=16;break}t.next=12;return n.eraseOutputDir();case 12:t.next=14;return qx.tool.utils.files.Utils.safeUnlink(s.getDbFilename());case 14:t.next=16;return qx.tool.utils.files.Utils.safeUnlink(s.getResDbFilename());case 16:r.ignores&&s.setIgnores(r.ignores);l=n.getTarget();n.addListener("writingApplications",a);n.addListener("writtenApplications",a);n.addListener("writingApplication",function(t){return e.dispatchEvent(t.clone())});n.addListener("writtenApplication",function(t){return e.dispatchEvent(t.clone())});s.addListener("compilingClass",function(t){return e.dispatchEvent(t.clone())});s.addListener("compiledClass",function(t){return e.dispatchEvent(t.clone())});s.addListener("saveDatabase",function(t){return e.dispatchEvent(t.clone())});l.addListener("checkEnvironment",function(t){return e.dispatchEvent(t.clone())});l.addListener("minifyingApplication",function(t){return e.dispatchEvent(t.clone())});u=qx.tool.utils.files.Utils.safeStat("source/index.html").then(function(e){return e&&qx.tool.compiler.Console.print("qx.tool.cli.compile.legacyFiles","source/index.html")});if(e.argv.watch){t.next=32;break}n.addListener("making",function(){1==++o&&e.fireEvent("making")});n.addListener("made",function(){0==--o&&e.fireEvent("made")});return t.abrupt("return",u.then(function(){return n.make()}));case 32:(p=new qx.tool.cli.Watch(n)).addListener("making",function(){1==++o&&e.fireEvent("making")});p.addListener("made",function(){0==--o&&e.fireEvent("made")});p.addListener("configChanged",_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return p.stop();case 2:setImmediate(function(){return e._loadConfigAndStartMaking()});case 3:case"end":return t.stop()}},t)})));f=[e._compileJsFilename,e._compileJsonFilename].filter(function(e){return Boolean(e)});p.setConfigFilenames(f);return t.abrupt("return",u.then(function(){return p.start()}));case 39:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 14:case"end":return t.stop()}},t)}))()},createMakersFromConfig:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n,a,i,s,c,l,u,p,f,m,d,_=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=qx.tool.compiler.Console.getInstance();a=this;if(r.babelOptions){if(r.babelConfig)qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedBabelOptionsConflicting");else{r.babelConfig={options:r.babelOptions};qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedBabelOptions")}delete r.babelOptions}i=null;a.argv["app-name"]&&(i=a.argv["app-name"].split(","));r.targets.forEach(function(e,t){return e.index=t});s=[];c=null;r.targets.forEach(function(e){e.type===r.targetType&&(e["application-names"]||e["application-types"]?s.push(e):c?qx.tool.compiler.Console.print("qx.tool.cli.compile.multipleDefaultTargets"):c=e)});l={};r.applications.forEach(function(e,t){if(e.name){if(l[e.name])throw new qx.tool.utils.Utils.UserError("Multiple applications with the same name '".concat(e.name,"'"));l[e.name]=e}e.index=t;var r=e.type||"browser",n=s.filter(function(t){var n=t["application-types"];if(n&&!qx.lang.Array.contains(n,r))return!1;var o=t["application-names"];return!(e.name&&o&&!qx.lang.Array.contains(o,e.name))});if(0==n.length){if(!c)throw new qx.tool.utils.Utils.UserError("Cannot find any suitable targets for application #".concat(t," (named ").concat(e.name||"unnamed",")"));n=[c]}n.forEach(function(t){t.appConfigs||(t.appConfigs=[]);t.appConfigs.push(e);e.targetConfigs||(e.targetConfigs=[]);e.targetConfigs.push(t)})});c&&c.appConfigs&&s.push(c);u=this.__P_206_3={};e.next=15;return qx.Promise.all(r.libraries.map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.compiler.app.Library.createLibrary(t);case 2:r=e.sent;u[r.getNamespace()]=r;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 15:if(p=u.qx){e.next=26;break}e.t0=qx.tool.compiler.app.Library;e.next=20;return this.getGlobalQxPath();case 20:e.t1=e.sent;e.next=23;return e.t0.createLibrary.call(e.t0,e.t1);case 23:f=e.sent;u[f.getNamespace()]=f;p=u.qx;case 26:this.argv.verbose&&n.log("QooxDoo found in "+p.getRootDir());e.next=29;return this.__P_206_6(Object.values(u),r.packages);case 29:if(!((m=e.sent).length>0)){e.next=36;break}if(!this.argv.warnAsError){e.next=35;break}throw new qx.tool.utils.Utils.UserError(m.join("\n"));case 35:qx.tool.compiler.Console.log(m.join("\n"));case 36:s.forEach(function(e){var t=!1;e.defaultAppConfig=null;if(e.appConfigs){e.appConfigs.forEach(function(r){if(!r.type||"browser"==r.type){var n;if(void 0!==r.writeIndexHtmlToRoot){qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedCompileSeeOther","application.writeIndexHtmlToRoot","application.default");n=r.writeIndexHtmlToRoot}else void 0!==r.default&&(n=r.default);if(void 0!==n){if(n){if(t)throw new qx.tool.utils.Utils.UserError("Error: Can only set one application to be the default application!");t=!0;e.defaultAppConfig=r}}else e.defaultAppConfig||(e.defaultAppConfig=r)}});!t&&e.appConfigs.length>1&&(e.defaultAppConfig=e.appConfigs[0])}});d=[];s.forEach(function(e){if(e.appConfigs){var s=e.appConfigs.filter(function(e){return!e.name||!i||qx.lang.Array.contains(i,e.name)});if(s.length){var c=e.outputPath;_.argv.outputPathPrefix&&(c=o.join(_.argv.outputPathPrefix,c));if(!c)throw new qx.tool.utils.Utils.UserError("Missing output-path for target "+e.type);var l=new qx.tool.compiler.makers.AppMaker;_.argv.erase||l.setNoErase(!0);var p=e.targetClass?_.resolveTargetClass(e.targetClass):null;!p&&e.type&&(p=_.resolveTargetClass(e.type));if(!p)throw new qx.tool.utils.Utils.UserError("Cannot find target class: "+(e.targetClass||e.type));var f,m=new p(c);e.uri&&qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedUri","target.uri",e.uri);e.writeCompileInfo&&m.setWriteCompileInfo(!0);r.i18nAsParts&&m.setI18nAsParts(!0);m.setWriteLibraryInfo(_.argv.writeLibraryInfo);m.setUpdatePoFiles(_.argv.updatePoFiles);m.setLibraryPoPolicy(_.argv.libraryPo);t.argv.indexOf("--minify")>-1&&(f=a.argv.minify);"boolean"==typeof(f=f||e.minify||a.argv.minify)&&(f=f?"minify":"off");f||(f="mangle");"function"==typeof m.setMinify&&m.setMinify(f);var h=e["save-source-in-map"]||a.argv.saveSourceInMap;"boolean"==typeof h&&"function"==typeof m.setSaveSourceInMap&&m.setSaveSourceInMap(h);var g=e["save-unminified"]||a.argv["save-unminified"];"boolean"==typeof g&&"function"==typeof m.setSaveUnminified&&m.setSaveUnminified(g);var x=e.deployPath;x&&"function"==typeof m.setDeployDir&&m.setDeployDir(x);var y=e["deploy-source-maps"];"boolean"==typeof y&&"function"==typeof m.setDeployDir&&m.setDeployMap(y);l.setTarget(m);l.setLocales(r.locales||["en"]);r.writeAllTranslations&&l.setWriteAllTranslations(r.writeAllTranslations);"string"==typeof e.typescript?l.set({outputTypescript:!0,outputTypescriptTo:e.typescript}):"boolean"==typeof e.typescript&&l.set({outputTypescript:!0});_.argv.typescript&&l.set({outputTypescript:!0});r.environment&&l.setEnvironment(r.environment);e.environment&&m.setEnvironment(e.environment);if(r["path-mappings"])for(var v in r["path-mappings"]){var b=r["path-mappings"][v];m.addPathMapping(v,b)}var q=qx.lang.Object.clone(r.babel||{},!0);q.options=q.options||{};qx.lang.Object.mergeWith(q.options,e.babelOptions||{});l.getAnalyser().setBabelConfig(q);(e.addCreatedAt||a.argv.addCreatedAt)&&l.getAnalyser().setAddCreatedAt(!0);for(var P in u)l.getAnalyser().addLibrary(u[P]);l.getAnalyser().setManglePrivates(m instanceof qx.tool.compiler.targets.BuildTarget?"unreadable":"readable");var k={};s.forEach(function(t){var n=t.app=new qx.tool.compiler.app.Application(t.class);n.setTemplatePath(a.getTemplateDir());["type","theme","name","environment","outputPath","bootPath","loaderTemplate","publish","standalone"].forEach(function(e){if(void 0!==t[e]){var r="set"+qx.lang.String.firstUp(e);n[r](t[e])}});k[n.getType()]=!0;t.uri&&qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedUri","application.uri",t.uri);t.title&&n.setTitle(t.title);t.description&&n.setDescription(t.description);var o=t.parts||e.parts||r.parts;if(o){if(!o.boot)throw new qx.tool.utils.Utils.UserError("Cannot determine a boot part for application "+(t.index+1)+" "+(t.name||""));for(var i in o){var s=o[i],c="string"==typeof s.include?[s.include]:s.include,u="string"==typeof s.exclude?[s.exclude]:s.exclude,p=new qx.tool.compiler.app.Part(i,c,u).set({combine:Boolean(s.combine),minify:Boolean(s.minify)});n.addPart(p)}}if("source"==m.getType()&&a.argv.bundling){var f=t.bundle||e.bundle||r.bundle;if(f){f.include&&n.setBundleInclude(f.include);f.exclude&&n.setBundleExclude(f.exclude)}}n.set({exclude:T([],r.exclude,e.exclude,t.exclude),include:T([],r.include,e.include,t.include)});l.addApplication(n)});var w=qx.tool.compiler.ClassFile,C=[];qx.lang.Array.append(C,w.QX_GLOBALS);qx.lang.Array.append(C,w.COMMON_GLOBALS);k.browser&&qx.lang.Array.append(C,w.BROWSER_GLOBALS);k.node&&qx.lang.Array.append(C,w.NODE_GLOBALS);k.rhino&&qx.lang.Array.append(C,w.RHINO_GLOBALS);l.getAnalyser().setGlobalSymbols(C);e.defaultAppConfig?e.defaultAppConfig.app.setWriteIndexHtmlToRoot(!0):qx.tool.utils.files.Utils.safeUnlink(m.getOutputDir()+"index.html");var S=function(e,t){t&&t.forEach(function(t){var r=qx.tool.compiler.Console.decodeMarker(t);n.warn(e+": "+r)})};l.getAnalyser().addListener("compiledClass",function(e){var t=e.getData();S(t.classFile.getClassName(),t.dbClassInfo.markers)});l.getAnalyser().addListener("alreadyCompiledClass",function(e){var t=e.getData();S(t.className,t.dbClassInfo.markers)});d.push(l)}}else qx.tool.compiler.Console.print("qx.tool.cli.compile.unusedTarget",e.type,e.index);function T(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach(function(t){t&&t.forEach(function(r){qx.lang.Array.contains(e,t)||e.push(r)})});return e}});return e.abrupt("return",d);case 40:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),__P_206_6:function(e,t){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i,s,c,l,u,p,f,m,d,_,h,g,x,y,v;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=qx.tool.compiler.Console.getInstance();s=[];a.next=4;return r.getUserQxVersion();case 4:c=a.sent;l=_createForOfIteratorHelper(e);a.prev=6;l.s();case 8:if((u=l.n()).done){a.next=32;break}p=u.value;(f=p.getRequires())||(f={});t||(t={});if(m=p.getLibraryInfo()["qooxdoo-range"]){r.argv.verbose&&i.warn("".concat(p.getNamespace(),': The configuration setting "qooxdoo-range" in Manifest.json has been deprecated in favor of "requires.@qooxdoo/framework".'));f["@qooxdoo/framework"]||(f["@qooxdoo/framework"]=m)}d=Object.getOwnPropertyNames(f).filter(function(t){return!e.find(function(e){return e.getLibraryInfo().name==t})});_=d.filter(function(e){return!e.startsWith("qooxdoo-")&&"@qooxdoo/framework"!==e&&"@qooxdoo/compiler"!==e});h=Object.getOwnPropertyNames(t);if(!(_.length>0&&0===h.length)){a.next=28;break}if(!r.argv.download){a.next=27;break}r.argv.verbose&&i.info(">>> Installing latest compatible version of required libraries...");g=new qx.tool.cli.commands.package.Install({verbose:r.argv.verbose,save:!1});a.next=24;return g.process();case 24:throw new qx.tool.utils.Utils.UserError("Added missing library information from Manifest. Please restart the compilation.");case 27:throw new qx.tool.utils.Utils.UserError("No library information available. Try 'qx compile --download'");case 28:x=_createForOfIteratorHelper(d);try{v=function(){var a=y.value,l=f[a],u=/^[0-9a-f]{40}$/.test(l);switch(a){case"qooxdoo-compiler":case"@qooxdoo/compiler":var m=qx.tool.compiler.Version.VERSION;n.satisfies(m,l,{loose:!0,includePrerelease:!0})||0===Number(n.major(m))&&n.gtr(m,l,!0)||s.push("".concat(p.getNamespace(),": Needs @qooxdoo/compiler version ").concat(l,", found ").concat(m));break;case"qooxdoo-sdk":case"@qooxdoo/framework":var d=c;n.satisfies(d,l,{loose:!0})||s.push("".concat(p.getNamespace(),": Needs @qooxdoo/framework version ").concat(l,", found ").concat(d));break;default:var _=e.find(function(e){return o.relative("",e.getRootDir())===t[a]});if(!_){s.push("".concat(p.getNamespace(),": Cannot find required library '").concat(a,"'"));break}var h=_.getLibraryInfo().version;n.valid(h,{loose:!0})?u?r.argv.quiet||i.warn("".concat(a,": Cannot check whether commit hash ").concat(l," corresponds to version ").concat(h)):n.satisfies(h,l,{loose:!0})||s.push("".concat(p.getNamespace(),": Needs ").concat(a," version ").concat(l,", found ").concat(h)):r.argv.quiet||i.warn("".concat(a,": Version is not valid: ").concat(h))}};for(x.s();!(y=x.n()).done;)v()}catch(e){x.e(e)}finally{x.f()}case 30:a.next=8;break;case 32:a.next=37;break;case 34:a.prev=34;a.t0=a.catch(6);l.e(a.t0);case 37:a.prev=37;l.f();return a.finish(37);case 40:return a.abrupt("return",s);case 41:case"end":return a.stop()}},a,null,[[6,34,37,40]])}))()},resolveTargetClass:function(e){if(!e)return null;if("Class"==e.$$type)return e;if("build"==e)return qx.tool.compiler.targets.BuildTarget;if("source"==e)return qx.tool.compiler.targets.SourceTarget;if("typescript"==e)throw new qx.tool.utils.Utils.UserError("Typescript targets are no longer supported - please use `typescript: true` in source target instead");if(e){return e.indexOf(".")<0?qx.Class.getByName("qx.tool.compiler.targets."+e):qx.Class.getByName(e)}return null},getMakers:function(){return this.__P_206_1},getMaker:function(){if(1==this.__P_206_1.length)return this.__P_206_1[0];throw new Error("Cannot get a single maker - there are "+this.__P_206_1.length+" available")},getMakersForApp:function(e){return this.__P_206_1.filter(function(t){return t.getApplications().find(function(t){return t.getName()==e})})},_getConfig:function(){return this.__P_206_2},getLibraries:function(){return this.__P_206_3}},defer:function(e){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.compile.writingApplication":"Writing application %1","qx.tool.cli.compile.minifyingApplication":"Minifying %1 %2","qx.tool.cli.compile.compilingClass":"Compiling class %1","qx.tool.cli.compile.compiledClass":"Compiled class %1 in %2s","qx.tool.cli.compile.makeBegins":"Making applications...","qx.tool.cli.compile.makeEnds":"Applications are made"});qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.compile.multipleDefaultTargets":"Multiple default targets found!","qx.tool.cli.compile.unusedTarget":"Target type %1, index %2 is unused","qx.tool.cli.compile.selectingDefaultApp":"You have multiple applications, none of which are marked as 'default'; the first application named %1 has been chosen as the default application","qx.tool.cli.compile.legacyFiles":"File %1 exists but is no longer used","qx.tool.cli.compile.deprecatedCompile":"The configuration setting %1 in compile.json is deprecated","qx.tool.cli.compile.deprecatedCompileSeeOther":"The configuration setting %1 in compile.json is deprecated (see %2)","qx.tool.cli.compile.deprecatedUri":"URIs are no longer set in compile.json, the configuration setting %1=%2 in compile.json is ignored (it's auto detected)","qx.tool.cli.compile.deprecatedProvidesBoot":"Manifest.Json no longer supports provides.boot - only Applications can have boot; specified in %1","qx.tool.cli.compile.deprecatedBabelOptions":"Deprecated use of `babelOptions` - these should be moved to `babel.options`","qx.tool.cli.compile.deprecatedBabelOptionsConflicting":"Conflicting use of `babel.options` and the deprecated `babelOptions` (ignored)"},"warning")}});qx.tool.cli.commands.Compile.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.files.Utils":{},"qx.tool.utils.Json":{},"qx.Promise":{},"qx.tool.compiler.app.WebFont":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("path");require("@qooxdoo/framework");var r=require("fs"),n=require("async"),o=require("../util").createLog("library");qx.Class.define("qx.tool.compiler.app.Library",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);this.__P_223_0={};this.__P_223_1={}},properties:{namespace:{check:"String"},version:{check:"String"},rootDir:{check:"String",transform:"_transformRootDir"},sourcePath:{init:"source/class",check:"String"},transpiledPath:{init:"source/transpiled",check:"String"},libraryInfo:{check:"Map"},resourcePath:{init:"source/resource",check:"String"},themePath:{init:"source/theme",check:"String"},translationPath:{init:"source/translation",check:"String"},webFonts:{init:null,nullable:!0,check:"Array"},addScript:{init:null},addCss:{init:null},requires:{init:null}},members:{__P_223_0:null,__P_223_1:null,__P_223_2:null,_transformRootDir:function(e){return e},loadManifest:function(e){return this.__P_223_2?this.__P_223_2:this.__P_223_2=this.__P_223_3(e)},__P_223_3:function(e){var n=this,o=qx.tool.compiler.Console.getInstance(),a=this,i=e;return qx.tool.utils.files.Utils.correctCase(t.resolve(e)).then(function(e){return n.setRootDir(i=e)}).then(function(){return qx.tool.utils.Json.loadJsonAsync(i+"/Manifest.json")}).then(function(e){if(!e)throw new Error(o.decode("qx.tool.compiler.library.emptyManifest",i));a.setNamespace(e.provides.namespace);a.setVersion(e.info.version);function n(e){var n=t.resolve(i,e);if(!r.existsSync(n)){a.warn(o.decode("qx.tool.compiler.library.cannotFindPath",a.getNamespace(),e));return qx.Promise.resolve(e)}return qx.tool.utils.files.Utils.correctCase(n).then(function(r){if(r.substring(0,i.length+1)!=i+t.sep){a.warn(o.decode("qx.tool.compiler.library.cannotCorrectCase",i));return e}return r=r.substring(i.length+1)})}return n(e.provides.class).then(function(e){return a.setSourcePath(e)}).then(function(){return n(e.provides.resource)}).then(function(t){return a.setResourcePath(e.provides.resource)}).then(function(){a.setLibraryInfo(e.info);if(e.provides.transpiled)a.setTranspiledPath(e.provides.transpiled);else{var t=a.getSourcePath().match(/^(.*)\/([^/]+)$/);t&&3==t.length?a.setTranspiledPath(t[1]+"/transpiled"):a.setTranspiledPath("transpiled")}e.provides.translation&&a.setTranslationPath(e.provides.translation);if(e.provides.webfonts){var r=[];e.provides.webfonts.forEach(function(e){var t=new qx.tool.compiler.app.WebFont(a).set(e);r.push(t)});a.setWebFonts(r)}if(e.externalResources){e.externalResources.script&&a.setAddScript(e.externalResources.script);e.externalResources.css&&a.setAddCss(e.externalResources.css)}e.requires&&a.setRequires(e.requires);e.provides&&e.provides.boot&&qx.tool.compiler.Console.print("qx.tool.cli.compile.deprecatedProvidesBoot",i)})})},scanForClasses:function(e){var a=this,i=[];var s=t.join(a.getRootDir(),a.getSourcePath());if(r.existsSync(s))!function e(s,c,l){r.readdir(s,function(u,p){u?l(u):n.each(p,function(n,l){"."!=n[0]?r.stat(t.join(s,n),function(r,u){if(!r&&u)if(u.isDirectory()){var p=c;p.length&&(p+=".");p+=n;e(t.join(s,n),p,l)}else{var f=n.match(/(.*)(\.\w+)$/);if(f){var m=f[1],d=f[2];c.length&&(m=c+"."+m);if(m.match(/__init__/))l();else{if(".js"==d||".ts"==d){a.__P_223_0[m]="class";a.__P_223_1[m]=d;i.push(m)}else a.__P_223_0[n]="resource";if(Boolean(c)&&!a.__P_223_0[c]){a.__P_223_0[c]="package";var _;p=c;for(;(_=p.lastIndexOf("."))>-1;){p=p.substring(0,_);a.__P_223_0[p]="package"}}l()}}else{o.trace("Skipping file "+s+"/"+n);l()}}else l(r)}):l()},l)})}(s,"",function(t){e(t,i)});else{var c=qx.tool.compiler.Console.getInstance();this.warn(c.decode("qx.tool.compiler.library.cannotFindPath",a.getNamespace(),s));e(null,[])}},getSymbolType:function(e){if(!e.length)return null;var t=this.__P_223_0[e];if(t)return{symbolType:this.__P_223_0[e],className:"class"==t?e:null,name:e};for(var r,n=e;(r=n.lastIndexOf("."))>-1;){n=n.substring(0,r);if(t=this.__P_223_0[n])return"class"==t?{symbolType:"member",className:n,name:e}:null}return null},isClass:function(e){return"class"===this.__P_223_0[e]},getKnownSymbols:function(){return this.__P_223_0},getSourceFileExtension:function(e){return this.__P_223_1[e]},getFilename:function(e){return t.join(this.getRootDir(),this.getSourcePath(),e)},getResourceFilename:function(e){return t.join(this.getRootDir(),this.getResourcePath(),e)},getThemeFilename:function(e){return t.join(this.getRootDir(),this.getThemePath(),e)}},statics:{createLibrary:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=new qx.tool.compiler.app.Library;t.next=3;return r.loadManifest(e);case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}},t)}))()}}});module.exports=qx.tool.compiler.app.Library;qx.tool.compiler.app.Library.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.files.Utils":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath");require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.makers.Maker",{extend:qx.core.Object,type:"abstract",construct:function(){qx.core.Object.constructor.call(this);this._compiledClasses={}},properties:{dbFilename:{init:null,nullable:!0,check:"String",apply:"__P_229_0"},environment:{init:null,nullable:!0},outputTypescript:{init:!1,nullable:!1,check:"Boolean"},outputTypescriptTo:{init:"qooxdoo.d.ts",nullable:!1,check:"String"},noErase:{init:!1,check:"Boolean"},success:{init:null,nullable:!0,check:"Boolean"},hasWarnings:{init:null,nullable:!0,check:"Boolean"}},events:{making:"qx.event.type.Event",made:"qx.event.type.Event",writingApplications:"qx.event.type.Event",writingApplication:"qx.event.type.Data",writtenApplication:"qx.event.type.Data",writtenApplications:"qx.event.type.Event"},members:{_analyser:null,_compiledClasses:null,make:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("No implementation for "+this.classname+".make");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getOutputDir:function(){throw new Error("No implementation for "+this.classname+".getOutputDir")},eraseOutputDir:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.resolve(this.getOutputDir());if(!((n=t.resolve(process.cwd())).startsWith(r)&&r.length<=n.length)){e.next=4;break}throw new Error("Output directory ("+r+") is a parent directory of PWD");case 4:e.next=6;return qx.tool.utils.files.Utils.deleteRecursive(this.getOutputDir());case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_229_0:function(e,t){if(this._analyser)throw new Error("Cannot change the database filename once an Analyser has been created")},getAnalyser:function(){var e=this;if(this._analyser)return this._analyser;this._analyser=this._createAnalyser();this._analyser.addListener("compiledClass",function(t){var r=t.getData();e._compiledClasses[r.classFile.getClassName()]=!0});return this._analyser},getRecentlyCompiledClasses:function(e){var t=this._compiledClasses;e&&(this._compiledClasses={});return t},_createAnalyser:function(){var e=this._analyser=new(require("../Analyser"))(t.join(this.getOutputDir(),this.getDbFilename()||"db.json"));e.setOutputDir(this.getOutputDir());return e}}});module.exports=qx.tool.compiler.makers.Maker;qx.tool.compiler.makers.Maker.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.makers.Maker":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./Maker");qx.Class.define("qx.tool.compiler.makers.AbstractAppMaker",{extend:qx.tool.compiler.makers.Maker,type:"abstract",properties:{target:{nullable:!1,check:"qx.tool.compiler.targets.Target",apply:"__P_227_0"},locales:{nullable:!1,init:["en"],apply:"_applyLocales"},writeAllTranslations:{init:!1,nullable:!1,check:"Boolean",apply:"__P_227_1"}},members:{getOutputDir:function(){return this.getTarget().getOutputDir()},__P_227_0:function(e,t){this._analyser&&this._analyser.setOutputDir(e?e.getOutputDir():null);e&&e.set({locales:this.getLocales(),writeAllTranslations:this.getWriteAllTranslations()})},__P_227_1:function(e,t){this.getTarget()&&this.getTarget().setWriteAllTranslations(e)},_applyLocales:function(e,t){this.getTarget()&&this.getTarget().setLocales(e)}}});qx.tool.compiler.makers.AbstractAppMaker.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.makers.AbstractAppMaker":{construct:!0,require:!0},"qx.tool.compiler.app.Application":{construct:!0},"qx.tool.utils.Values":{},"qx.tool.compiler.ClassFile":{},"qx.tool.compiler.Version":{},"qx.tool.utils.Promisify":{},"qx.tool.compiler.Console":{},"qx.Promise":{},"qx.tool.compiler.targets.TypeScriptWriter":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./AbstractAppMaker");var t=require("../util"),r=t.promisify(t.mkParentPath),n=t.createLog("analyser");qx.Class.define("qx.tool.compiler.makers.AppMaker",{extend:qx.tool.compiler.makers.AbstractAppMaker,construct:function(e,t){qx.tool.compiler.makers.AbstractAppMaker.constructor.call(this);this.__P_228_0=[];if(e){var r=new qx.tool.compiler.app.Application(e);t&&r.setTheme(t);this.addApplication(r)}},members:{__P_228_0:null,addApplication:function(e){this.__P_228_0.push(e)},getApplications:function(){return this.__P_228_0},make:function(){var e=this,o=this.getAnalyser();this.fireEvent("making");this.setSuccess(null);this.setHasWarnings(null);var a=!0,i=!1,s=qx.tool.utils.Values.merge({},qx.tool.compiler.ClassFile.ENVIRONMENT_CONSTANTS,{"qx.compilerVersion":qx.tool.compiler.Version.VERSION},this.getEnvironment(),this.getTarget().getDefaultEnvironment(),this.getTarget().getEnvironment()),c={};this.getApplications().forEach(function(e){c[e.toHashCode()]=qx.tool.utils.Values.merge({},s,e.getCalculatedEnvironment())});var l={};this.getApplications().forEach(function(e){var t=c[e.toHashCode()];Object.keys(t).forEach(function(e){l[e]?l[e].value!==t[e]&&(l[e].same=!1):l[e]={value:t[e],same:!0}})});this.getApplications().forEach(function(e){var t=c[e.toHashCode()];Object.keys(l).forEach(function(e){l[e].same?delete t[e]:void 0===t[e]&&(t[e]=s[e])})});Object.keys(l).forEach(function(e){l[e].same?s[e]=l[e].value:delete s[e]});return o.open().then(function(){o.setEnvironment(s);if(!e.isNoErase()&&o.isContextChanged()){n.log("enviroment changed - delete output dir");return e.eraseOutputDir().then(function(){return r(e.getOutputDir())}).then(function(){return o.resetDatabase()})}return Promise.resolve()}).then(function(){return t.promisifyThis(o.initialScan,o)}).then(function(){return o.updateEnvironmentData()}).then(function(){e.getTarget().setAnalyser(o);e.__P_228_0.forEach(function(e){return e.setAnalyser(o)});return e.getTarget().open()}).then(function(){e.isOutputTypescript()&&o.getLibraries().forEach(function(e){var t=e.getKnownSymbols();for(var r in t){"class"===t[r]&&"q"!==r&&"qxWeb"!==r&&o.addClass(r)}});e.__P_228_0.forEach(function(e){e.getRequiredClasses().forEach(function(e){o.addClass(e)});e.getTheme()&&o.addClass(e.getTheme())});return qx.tool.utils.Promisify.call(function(e){return o.analyseClasses(e)})}).then(function(){return o.saveDatabase()}).then(function(){var t=e.getTarget();e.fireEvent("writingApplications");var r=e.getRecentlyCompiledClasses(!0),n=e.__P_228_0.filter(function(e){var t=e.getDependencies();return!t||!t.length||t.some(function(e){return Boolean(r[e])})}),l=o.getDatabase(),u=n.map(function(r){"browser"==r.getType()||s["qx.headless"]||qx.tool.compiler.Console.print("qx.tool.compiler.maker.appNotHeadless",r.getName());var n=qx.tool.utils.Values.merge({},s,c[r.toHashCode()]);r.calcDependencies();if(!r.getFatalCompileErrors()){i||r.getDependencies().forEach(function(e){l.classInfo[e]&&l.classInfo[e].markers&&l.classInfo[e].markers.forEach(function(e){"warning"==qx.tool.compiler.Console.getInstance().getMessageType(e.msgId)&&(i=!0)})});e.fireDataEvent("writingApplication",r);return t.generateApplication(r,n).then(function(){return e.fireDataEvent("writtenApplication",r)})}qx.tool.compiler.Console.print("qx.tool.compiler.maker.appFatalError",r.getName());a=!1});return qx.Promise.all(u).then(function(){e.fireEvent("writtenApplications");if(e.isOutputTypescript())return new qx.tool.compiler.targets.TypeScriptWriter(t).set({outputTo:e.getOutputTypescriptTo()}).run()})}).then(function(){return o.saveDatabase()}).then(function(){e.fireEvent("made");e.setSuccess(a);e.setHasWarnings(i)})}}});qx.tool.compiler.makers.AppMaker.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.targets.meta.ApplicationMeta":{},"qx.tool.compiler.Console":{},"qx.tool.compiler.targets.meta.BootJs":{},"qx.tool.compiler.targets.meta.PolyfillJs":{},"qx.tool.compiler.app.Application":{},"qx.tool.compiler.targets.meta.Javascript":{},"qx.Promise":{},"qx.tool.compiler.app.Cldr":{},"qx.tool.utils.files.Utils":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs;require("@qooxdoo/framework");var r=require("../util"),n=require("upath");qx.Class.define("qx.tool.compiler.targets.Target",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.setOutputDir(e)},properties:{type:{init:"source",nullable:!1,check:["source","build"]},outputDir:{init:"output",nullable:!1,check:"String",transform:"_transformOutputDir"},generateIndexHtml:{init:!0,check:"Boolean"},environment:{init:null,nullable:!0},defaultEnvironment:{init:null,inheritable:!0,nullable:!0},analyser:{nullable:!1},locales:{nullable:!1,init:["en"],transform:"_transformLocales"},i18nAsParts:{init:!1,nullable:!1,check:"Boolean"},writeAllTranslations:{init:!1,nullable:!1,check:"Boolean"},updatePoFiles:{init:!1,nullable:!1,check:"Boolean"},libraryPoPolicy:{init:"ignore",check:["ignore","untranslated","all"]},writeCompileInfo:{init:!1,nullable:!1,check:"Boolean"},writeLibraryInfo:{init:!0,nullable:!1,check:"Boolean"}},events:{checkEnvironment:"qx.event.type.Data"},members:{__P_235_0:null,open:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),_transformOutputDir:function(e){e&&"/"!=e[e.length-1]&&(e+="/");return e},getApplicationRoot:function(e){return n.join(this.getOutputDir(),this.getProjectDir(e))+"/"},getProjectDir:function(e){return e.getOutputPath()||e.getName()},_getOutputRootUri:function(e){var t=this.getApplicationRoot(e);return n.relative(t,this.getOutputDir())+"/"},addPathMapping:function(e,t){e=n.resolve(e);null===this.__P_235_0&&(this.__P_235_0={});this.__P_235_0[e]=t},getPathMapping:function(e){if(this.__P_235_0){var t=n.resolve(e);for(var r in this.__P_235_0)if(t.startsWith(r)){return e=this.__P_235_0[r]+t.substring(r.length)}}return null},mapToUri:function(e,t){var r=this.getPathMapping(e);if(null!==r)return r;t&&(e=n.relative(t,e));return e},_copyClassesToFile:function(e,r){var o=n.join(this.getOutputDir(),"transpiled"),a=[];return qx.tool.utils.Promisify.eachOfSeries(e,function(e){return t.readFileAsync(n.join(o,e),"utf8").then(function(e){return a.push(e)})}).then(function(){return t.writeFileAsync(r,a.join("\n"))})},generateApplication:function(e,t){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=o;s=e.getAnalyser();c=s.getResourceManager();if((l=new qx.tool.compiler.targets.meta.ApplicationMeta(o,e)).getAppLibrary()){a.next=7;break}qx.tool.compiler.Console.print("qx.tool.compiler.target.missingAppLibrary",e.getClassName());return a.abrupt("return");case 7:u=i._getOutputRootUri(e);p=o.getApplicationRoot(e);f=o.getPathMapping(n.join(p,o.getOutputDir(),"transpiled/"));l.setSourceUri(f||u+"transpiled/");f=o.getPathMapping(n.join(p,o.getOutputDir(),"resource"));l.setResourceUri(f||u+"resource");m=e.getRequiredLibraries();a.next=16;return r.mkpathAsync(p);case 16:l.setEnvironment({"qx.application":e.getClassName(),"qx.revision":"","qx.theme":e.getTheme(),"qx.version":s.getQooxdooVersion()});d=function(e,t){e&&e.forEach(function(e){if(e.match(/^https?:/))l.addExternal(t,e);else{var r=c.getAsset(e);if(r){var o=r.getDestFilename(i);o=n.relative(p,o);l.addPreload(t,o)}}})};m.forEach(function(e){var t=s.findLibrary(e);l.addLibrary(t);if(o.isWriteLibraryInfo()){l.getEnvironmentValue("qx.libraryInfoMap",{})[e]=t.getLibraryInfo()}d(t.getAddScript(),"urisBefore");d(t.getAddCss(),"cssBefore")});for(_ in t)l.setEnvironmentValue(_,t[_]);i.fireDataEvent("checkEnvironment",{application:e,environment:l.getEnvironment()});h=new qx.tool.compiler.targets.meta.BootJs(l);g=l.createPackage();l.setBootMetaJs(h);g.addJavascriptMeta(new qx.tool.compiler.targets.meta.PolyfillJs(l));x=e.getPartsDependencies();y=qx.tool.compiler.app.Application.createWildcardMatchFunction(e.getBundleInclude(),e.getBundleExclude());v=g;b={boot:g};x.forEach(function(e,t){var r=l.createPart(e.name);0==t&&r.addPackage(g);e.classes.forEach(function(t){var a=t.replace(/\./g,"/")+".js",i=n.join(o.getOutputDir(),"transpiled",a),c=s.getDatabase().classInfo[t],u=s.findLibrary(c.libraryName).getFilename(a),p=new qx.tool.compiler.targets.meta.Javascript(l,i,u),f=y(t)?"__P_235_1":e.name,m=b[f];if(!m||m!==v){m=b[f]=l.createPackage();"__P_235_1"==f&&m.setEmbedAllJavascript(!0);r.addPackage(m)}m.addJavascriptMeta(p);m.addClassname(t);v=m})});q=[s.getCldr("en").then(function(e){return g.addLocale("C",e)}),i._writeTranslations(l)];P=0;m.forEach(function(t){var r=s.findLibrary(t).getWebFonts();if(r){var n=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,o,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;t.next=3;return r.generateForTarget(i);case 3:n=t.sent;t.next=6;return r.generateForApplication(i,e);case 6:o=t.sent;for(a in o)l.addResource(a,o[a]);(s=r.getBootstrapCode(i,e,0==P++))&&l.addPreBootCode(s);t.next=15;break;case 12:t.prev=12;t.t0=t.catch(0);qx.tool.compiler.Console.print("qx.tool.compiler.webfonts.error",r.toString(),t.t0.toString());case 15:q.push(n);case 16:case"end":return t.stop()}},t,null,[[0,12]])}));return function(e){return t.apply(this,arguments)}}();r.forEach(function(e){return q.push(n(e))})}});a.next=35;return qx.Promise.all(q);case 35:k=e.getAssetUris(i,c,l.getEnvironment());a.next=38;return c.saveDatabase();case 38:c.getAssetsForPaths(k).forEach(function(e){return g.addAsset(e)});a.next=41;return i._writeApplication(l);case 41:case"end":return a.stop()}},a)}))()},_writeTranslations:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=e.getAnalyser();if(!t.isUpdatePoFiles()){r.next=10;break}if("ignore"==(o=t.getLibraryPoPolicy())){r.next=8;break}r.next=6;return n.updateTranslations(e.getAppLibrary(),t.getLocales(),e.getLibraries(),"all"==o);case 6:r.next=10;break;case 8:r.next=10;return n.updateTranslations(e.getAppLibrary(),t.getLocales(),null,!1);case 10:r.next=12;return t._writeLocales(e);case 12:if(!t.getWriteAllTranslations()){r.next=17;break}r.next=15;return t._writeAllTranslations(e);case 15:r.next=19;break;case 17:r.next=19;return t._writeRequiredTranslations(e);case 19:case"end":return r.stop()}},r)}))()},_transformLocales:function(e){return e?e.map(function(e){var t=(e=e.toLowerCase()).indexOf("_");t>-1&&(e=e.substring(0,t)+e.substring(t).toUpperCase());return e}):e},_writeLocales:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o,a,i,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=function(e){var t=null;return function e(r){return o.getCldr(r).then(function(n){if(t)for(var o in n){var a=t[o];null!==a&&void 0!==a||(t[o]=n[o])}else t=n;var i=qx.tool.compiler.app.Cldr.getParentLocale(r);return i?e(i):t})}(e)};n=t;o=e.getAnalyser();a=e.getPackages()[0];s=n.getLocales().map(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(n){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return i(n);case 2:o=r.sent;(t.isI18nAsParts()?e.getLocalePackage(n):a).addLocale(n,o);case 5:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}());r.next=7;return qx.Promise.all(s);case 7:case"end":return r.stop()}},r)}))()},_writeAllTranslations:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this;n=t.getAnalyser();o=t.getPackages()[0];a={};i=[];r.getLocales().forEach(function(e){var r=s.isI18nAsParts()?t.getLocalePackage(e):o;function c(e,t){return n.getTranslation(e,t).then(function(n){var o=e.getNamespace()+":"+t;a[o]=n;var i=n.getEntries();for(var s in i)r.addTranslationEntry(t,i[s])})}t.getLibraries().forEach(function(r){r!==t.getAppLibrary()&&i.push(c(r,e))});i.push(c(t.getAppLibrary(),e))});e.next=8;return qx.Promise.all(i);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),_writeRequiredTranslations:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o,a,i,s,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=t;o=e.getAnalyser();a=o.getDatabase();i=e.getPackages()[0];s={};c=[];n.getLocales().forEach(function(r){var n=t.isI18nAsParts()?e.getLocalePackage(r):i;e.getLibraries().forEach(function(e){c.push(o.getTranslation(e,r).then(function(t){var o=e.getNamespace()+":"+r;s[o]=t;var a=t.getEntry("");a&&n.addTranslationEntry(r,a)}))})});r.next=9;return qx.Promise.all(c);case 9:e.getPackages().forEach(function(r){r.getClassnames().forEach(function(o){var i=a.classInfo[o];i.translations&&n.getLocales().forEach(function(n){var o=t.isI18nAsParts()?e.getLocalePackage(n):r;i.translations.forEach(function(t){var r,a=e.getAppLibrary().getNamespace()+":"+n,c=s[a];c&&(r=c.getEntry(t.msgid));var l=i.libraryName+":"+n;if(!r&&a!==l){var u=s[l];u&&(r=u.getEntry(t.msgid))}r&&o.addTranslationEntry(n,r)})})})});case 10:case"end":return r.stop()}},r)}))()},_writeApplication:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a,i,s,c,l,u,p,f;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=r;a=e.getApplication();i=e.getApplicationRoot();s=e.getBootMetaJs();c=e.getPackages(),l=0;case 5:if(!(l<c.length)){n.next=13;break}if((u=c[l]).isEmpty()){u.setNeedsWriteToDisk(!1);s.addEmbeddedJs(u.getJavascript())}n.next=10;return u.getJavascript().unwrap().writeToDisk();case 10:l++;n.next=5;break;case 13:n.next=15;return e.getBootMetaJs().unwrap().writeToDisk();case 15:n.next=17;return r._writeIndexHtml(e);case 17:if(o.isWriteCompileInfo()){n.next=19;break}return n.abrupt("return");case 19:p=e.getPackages()[0];f={appClass:a.getClassName(),libraries:e.getLibraries().map(function(e){return e.getNamespace()}),parts:[],resources:p.getAssets().map(function(e){return e.getFilename()}),locales:r.getLocales(),environment:e.getEnvironment(),urisBefore:e.getPreloads().urisBefore,cssBefore:e.getPreloads().cssBefore};a.getPartsDependencies().forEach(function(e){f.parts.push({classes:e.classes,include:e.include,exclude:e.exclude,minify:e.minify,name:e.name})});n.next=24;return t.writeFileAsync(i+"/compile-info.json",JSON.stringify(f,null,2)+"\n",{encoding:"utf8"});case 24:case"end":return n.stop()}},n)}))()},_writeIndexHtml:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i,s,c,l,u,p,f,m,d;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:u=function(e){for(var t in l)e=e.replace(new RegExp("\\${".concat(t,"}"),"g"),l[t]);return e};a=r;if((i=e.getApplication()).isBrowserApp()){o.next=5;break}return o.abrupt("return");case 5:if(r.isGenerateIndexHtml()){o.next=7;break}return o.abrupt("return");case 7:s=r.getApplicationRoot(i);c=n.relative(n.join(a.getOutputDir(),a.getProjectDir(i)),a.getOutputDir())+"/";l={resourcePath:c+"resource/",targetPath:c,appPath:"",preBootJs:"",appTitle:i.getTitle()||"Qooxdoo Application"};p='<!DOCTYPE html>\n<html>\n<head>\n  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n  <title>${appTitle}</title>\n</head>\n<body>\n  \x3c!-- This index.html can be customised by creating a boot/index.html (do not include Qooxdoo application script tags like\n       the one below because they will be added automatically)\n    --\x3e\n${preBootJs}\n  <script type="text/javascript" src="${appPath}index.js"><\/script>\n</body>\n</html>\n';f=i.getBootPath();m=null;if(!f){o.next=21;break}f=n.join(e.getAppLibrary().getRootDir(),i.getBootPath());o.next=17;return qx.tool.utils.files.Utils.safeStat(f);case 17:if(!(d=o.sent)||!d.isDirectory()){o.next=21;break}o.next=21;return qx.tool.utils.files.Utils.sync(f,s,function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,o){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.endsWith(".html")){e.next=2;break}return e.abrupt("return",!0);case 2:e.next=4;return t.readFileAsync(r,"utf8");case 4:a=e.sent;if("index.html"==n.basename(r)){if(!a.match(/\$\{\s*preBootJs\s*\}/)){a=a.replace("</body>","\n${preBootJs}\n</body>");qx.tool.compiler.Console.print("qx.tool.compiler.target.missingPreBootJs",r)}if(!a.match(/\s*index.js\s*/)){a=a.replace("</body>",'\n  <script type="text/javascript" src="${appPath}index.js"><\/script>\n</body>');qx.tool.compiler.Console.print("qx.tool.compiler.target.missingBootJs",r)}m=a}a=u(a);e.next=9;return t.writeFileAsync(o,a,"utf8");case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}());case 21:if(m){o.next=25;break}m=p;o.next=25;return t.writeFileAsync(s+"index.html",u(m),{encoding:"utf8"});case 25:if(!i.getWriteIndexHtmlToRoot()){o.next=30;break}c="";l={resourcePath:"resource/",targetPath:"",appPath:a.getProjectDir(i)+"/",preBootJs:"",appTitle:i.getTitle()||"Qooxdoo Application"};o.next=30;return t.writeFileAsync(a.getOutputDir()+"index.html",u(m),{encoding:"utf8"});case 30:case"end":return o.stop()}},o)}))()}}});module.exports=qx.tool.compiler.targets.Target;qx.tool.compiler.targets.Target.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.Target":{require:!0},"qx.tool.compiler.targets.meta.Uglify":{}}};qx.Bootstrap.executePendingDefers(e);require("../../utils/Promisify");require("@qooxdoo/framework");require("./Target");module.exports=qx.Class.define("qx.tool.compiler.targets.BuildTarget",{extend:qx.tool.compiler.targets.Target,properties:{minify:{init:"mangle",check:["off","minify","mangle","beautify"],nullable:!1},saveUnminified:{init:!1,check:"Boolean",nullable:!1},saveSourceInMap:{init:!1,check:"Boolean",nullable:!1},deployDir:{init:null,nullable:!0,check:"String",transform:"_transformOutputDir"},deployMap:{init:!1,check:"Boolean",nullable:!1},defaultEnvironment:{init:{"qx.debug":!1},refine:!0}},events:{minifyingApplication:"qx.event.type.Data",minifiedApplication:"qx.event.type.Data"},members:{_writeApplication:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e.setSourceUri(".");r.next=3;return e.syncAssets();case 3:n="off"!=e.getTarget().getMinify();o=e.getBootMetaJs();a=e.getParts()[0];e.getPackages().forEach(function(t){t.setEmbedAllJavascript(!0);if(a.hasPackage(t)){t.setNeedsWriteToDisk(!1);o.addEmbeddedJs(t.getJavascript())}n&&t.isNeedsWriteToDisk()&&t.getJavascript().wrap(new qx.tool.compiler.targets.meta.Uglify(e,t.getJavascript()))});n&&e.getBootMetaJs().wrap(new qx.tool.compiler.targets.meta.Uglify(e,o));r.next=10;return qx.tool.compiler.targets.BuildTarget.prototype._writeApplication.base.call(t,e);case 10:return r.abrupt("return",r.sent);case 11:case"end":return r.stop()}},r)}))()},toString:function(){return"Build Target: "+this.getOutputDir()}}});qx.tool.compiler.targets.BuildTarget.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.lang.Array":{construct:!0},"qx.lang.Type":{construct:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.IndexedArray":{},"qx.core.Assert":{},"qx.tool.utils.Values":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath");require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.app.Application",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.initType();var t=qx.lang.Array.fromArguments(arguments),r=this;this.__P_222_0=[];t.forEach(function(e){qx.lang.Type.isArray(e)?qx.lang.Array.append(r.__P_222_0,e):r.__P_222_0.push(e)});this.set({include:[],exclude:[]})},properties:{type:{init:"browser",check:["browser","rhino","node"],apply:"_applyType"},environment:{init:null,nullable:!0},analyser:{init:null,nullable:!0},theme:{init:"qx.theme.Simple",check:"String"},name:{init:"index",nullable:!1,check:"String"},title:{init:null,nullable:!0,check:"String"},description:{init:null,nullable:!0,check:"String"},outputPath:{init:null,nullable:!0,check:"String"},bootPath:{init:null,nullable:!0,check:"String"},templatePath:{init:"",nullable:!1,check:"String",apply:"_applyType"},publish:{type:"Boolean",init:!0},standalone:{type:"Boolean",init:!0},include:{nullable:!1,check:"Array",transform:"__P_222_1"},exclude:{nullable:!1,check:"Array",transform:"__P_222_1"},bundleInclude:{init:null,nullable:!0,check:"Array",transform:"__P_222_1"},bundleExclude:{init:null,nullable:!0,check:"Array",transform:"__P_222_1"},loaderTemplate:{nullable:!1,check:"String"},writeIndexHtmlToRoot:{init:!1,check:"Boolean"}},members:{__P_222_2:null,__P_222_3:null,__P_222_4:null,__P_222_5:null,__P_222_0:null,__P_222_6:null,isBrowserApp:function(){return"browser"===this.getType()},calcDependencies:function(){var e=this,t=qx.tool.compiler.Console.getInstance(),r=this.getAnalyser(),n=r.getDatabase(),o=new qx.tool.utils.IndexedArray,a={},i=[];this.__P_222_2=null;var s={},c=[],l=null,u={};if(this.__P_222_3&&this.__P_222_3.length){c=[];e.__P_222_3.forEach(function(e){if(s[e.getName()])throw new Error(t.decode("qx.tool.compiler.application.duplicatePartNames",e.getName()));var r={name:e.getName(),include:e.getInclude(),exclude:e.getExclude(),classes:[],dependsOn:{},combine:e.getCombine(),minify:e.getMinify()};r.match=qx.tool.compiler.app.Application.createWildcardMatchFunction(e.getInclude(),e.getExclude());s[e.getName()]=r;c.push(r)});if(!(l=s.boot))throw new Error(t.decode("qx.tool.compiler.application.noBootPart"))}else{l={name:"boot",include:["*"],exclude:[],classes:[],dependsOn:{},combine:!1,minify:!1,match:function(){return!0}};s.boot=l;c.push(l)}var p=new qx.tool.utils.IndexedArray,f=0,m=new qx.tool.utils.IndexedArray;var d=0;function _(e){if(!a[e]&&!o.contains(e)&&!m.contains(e)){var r=n.classInfo[e];if(r){r.fatalCompileError&&i.push(e);d++;var s={};if(r.environment&&r.environment.required)for(var h in r.environment.required){var g=r.environment.required[h];g.defer&&(s[g.className]=!0)}var x=[];if(r.dependsOn){m.push(e);for(var y in r.dependsOn){var v=r.dependsOn[y];v.load||v.require||s[y]?_(y):v.defer?x.push(y):o.contains(y)||p.push(y)}m.remove(e)}if(c&&!o.contains(e)){var b=function(e){if(u[e])return u[e];var r=u[e]={classname:e,parts:{},best:null,actual:null};c.forEach(function(n){if(n!==l){var o=n.match(e);if(null!==o){r.parts[n.name]=o;var a=r.best&&r.parts[r.best.name];if(void 0===a||null===a)r.best=n;else if("exact"===a)"exact"===o&&t.print("qx.tool.compiler.application.conflictingExactPart",e,n.name,r.best.name);else{qx.core.Assert.assertTrue("number"==typeof a);if("exact"===o){r.best=n;r.exact=!0}else{qx.core.Assert.assertTrue("number"==typeof o);a===o?t.print("qx.tool.compiler.application.conflictingBestPart",e,n.name,r.best.name):a<o&&(r.best=n)}}}}});return r}(e),q=b.best||l;q.classes.push(e);b.actual=q}o.push(e);x.forEach(function(e){var t=[];!function(e,t){var r={},a={};a[e]=!0;!function e(t){if(!r[t]){r[t]=!0;var i=n.classInfo[t];if(i&&i.dependsOn)for(var s in i.dependsOn){var c=i.dependsOn[s];if(c.load||c.require||c.defer||c.construct){o.contains(s)||(a[s]=!0);e(s)}}}}(e);for(var i in a)t.push(i)}(e,t);t.forEach(_)});if(1===d)for(;f<p.getLength();)_(e=p.getItem(f++));d--}}}a={};e.__P_222_7(e.getExclude()).forEach(function(e){return a[e]=!0});_("qx.core.Object");e.getRequiredClasses().forEach(function(e){_(e)});e.getTheme()&&_(e.getTheme());for(;f<p.length;){_(p[f++])}if(c&&c.length>1){c.forEach(function(e){var t={};e.classes.forEach(function r(o){if(!t[o]){t[o]=!0;var a=u[o];a.actual!==e&&(e.dependsOn[a.actual.name]=!0);for(var i in n.classInfo.dependsOn)r(i)}});e.dependsOn=Object.keys(e.dependsOn)});c.forEach(function(e){var r={};e.dependsOn.some(function t(n){if(r[n])return!1;r[n]=!0;return s[n]===e||e.dependsOn.some(t)})&&t.print("qx.tool.compiler.application.partRecursive",e.name)})}this.__P_222_2=o.toArray();var h={};this.__P_222_2.forEach(function(e){var t=n.classInfo[e];t.assets&&t.assets.forEach(function(e){var t=e.indexOf("/");if(t>-1){var n=e.substring(0,t);r.findLibrary(n)&&(h[n]=!0)}});h[t.libraryName]=!0});this.__P_222_4=[];for(var g in h)r.findLibrary(g)?this.__P_222_4.push(g):t.print("qx.tool.compiler.application.missingRequiredLibrary",g);this.__P_222_6=c;this.__P_222_5=i.length?i:null},getFatalCompileErrors:function(){return this.__P_222_5},getUris:function(){var e=[],t=this.getAnalyser().getDatabase();this.__P_222_2.forEach(function(r){var n=t.classInfo[r];e.push(n.libraryName+":"+r.replace(/\./g,"/")+".js")});return e},getDependencies:function(){return this.__P_222_2},getPartsDependencies:function(){return this.__P_222_6},getRequiredLibraries:function(){return this.__P_222_4},getAssetUris:function(e,r,n){var o=[],a=this.getAnalyser(),i=a.getDatabase(),s={};function c(e){var t=i.classInfo[e];if(t){if(t.aliases)for(var r in t.aliases)s[r]=t.aliases[r];t.extends&&c(t.extends)}}var l=i.classInfo[this.getTheme()];if(l&&l.themeMeta)for(var u in l.themeMeta)c(l.themeMeta[u]);for(var p={},f=this.__P_222_2.slice(),m=0;m<f.length;m++){var d=f[m],_=i.classInfo[d],h=_.assets;h&&h.forEach(function(e){var t=e.indexOf("/");if(t>-1){var n=e.substring(0,t),a=s[n];a&&(e=a+e.substring(t))}r.findLibrariesForResource(e).forEach(function(t){return o.push(t.getNamespace()+":"+e)})});p[_.libraryName]||(p[_.libraryName]=a.findLibrary(_.libraryName))}var g=a.getResourceManager();function x(r,n){r&&r.forEach(function(r){if(!r.match(/^https?:/)){var a=g.getAsset(r);if(a){var i=a.getDestFilename(e);i=t.relative(t.join(e.getOutputDir(),"resource"),i);o.push(a.getLibrary().getNamespace()+":"+i)}else qx.tool.compiler.Console.print(n,r)}})}for(var y in p){var v=p[y];if(v){x(v.getAddScript(),"qx.tool.compiler.application.missingScriptResource");x(v.getAddCss(),"qx.tool.compiler.application.missingCssResource")}}for(var b=0;b<o.length;b++){var q=o[b],P=q.match(/\$\{([^}]+)\}/);if(P){var k=P[0],w=P[1],C=q.indexOf(k),S=q.substring(0,C),T=q.substring(C+k.length),A=n[w];void 0!==A&&(qx.lang.Type.isArray(A)?A.forEach(function(e){o.push(S+e+T)}):o.push(S+A+T));qx.lang.Array.removeAt(o,b--)}}o.sort();for(var E=1;E<o.length;E++){var R=o[E],O=o[E-1];if(R!=O){if("*"==O[O.length-1]){var I=O.substring(0,O.length-1);if(R.substring(0,I.length)==I){o.splice(E--,1);continue}}}else o.splice(E--,1)}return o},getClassName:function(){return this.__P_222_0[0]},getRequiredClasses:function(){var e={};this.__P_222_0.forEach(function(t){return e[t]=!0});this.__P_222_7(this.getInclude()).forEach(function(t){return e[t]=!0});this.__P_222_7(this.getExclude()).forEach(function(t){return delete e[t]});return Object.keys(e).sort()},addPart:function(e){this.__P_222_3||(this.__P_222_3=[]);this.__P_222_3.push(e)},getParts:function(){return this.__P_222_3||[]},getCalculatedEnvironment:function(){return qx.tool.utils.Values.merge({"qx.headless":"browser"!=this.getType()},this.getEnvironment())},__P_222_7:function(e){var t=this,r={};e.forEach(function(e){var n=e.indexOf("*");if(n<0)r[e]=!0;else{var o=e.substring(0,n);o&&t.getAnalyser().getLibraries().forEach(function(e){var t=e.getKnownSymbols();for(var n in t)"class"==t[n]&&n.startsWith(o)&&(r[n]=!0)});var a=e.substring(n+1);a&&t.getAnalyser().getLibraries().forEach(function(e){var t=e.getKnownSymbols();for(var n in t)"class"==t[n]&&n.endsWith(a)&&(r[n]=!0)})}});return Object.keys(r)},_applyType:function(e,r){var n=t.join(this.getTemplatePath(),"loader","loader-"+this.getType()+".tmpl.js");this.setLoaderTemplate(n);this.setTheme(null)},__P_222_1:function(e){return e?qx.lang.Type.isArray(e)?e:[e]:null}},statics:{createWildcardMatchFunction:function(e,t){var r=[];t&&t.forEach(function(e){var t;(t=e.indexOf("*"))>-1?r.push('  if (value.startsWith("'+e.substring(0,t)+'"))\n    return null; // '+e):r.push('  if (value === "'+e+'")\n  return null;')});e&&e.forEach(function(e){var t;t=-1;for(var n=0;(t=e.indexOf(".",t+1))>-1;)n++;(t=e.indexOf("*"))>-1?r.push('  if (value.startsWith("'+e.substring(0,t)+'"))\n    return '+n+"; // "+e):r.push('  if (value === "'+e+'")\n  return "exact";')});r.push("  return null;");return new Function("value",r.join("\n"))}}});module.exports=qx.tool.compiler.app.Application;qx.tool.compiler.app.Application.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.app.Part",{extend:qx.core.Object,construct:function(e,t,r){qx.core.Object.constructor.call(this);this.set({name:e,include:t,exclude:r||[]})},properties:{name:{nullable:!1,check:"String"},combine:{init:!1,nullable:!1,check:"Boolean"},minify:{init:!1,nullable:!1,check:"Boolean"},include:{nullable:!1,check:"Array"},exclude:{nullable:!1,check:"Array"}}});qx.tool.compiler.app.Part.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.lang.Type":{},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.lang.Object":{},"qx.tool.compiler.Console":{},"qx.lang.Array":{},"qx.tool.compiler.jsdoc.Parser":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs"),r=require("@babel/core");require("@qooxdoo/framework");var n=require("./util"),o=require("@babel/types"),a=require("@babel/parser"),i=require("async"),s=require("upath");require("./jsdoc/Parser");var c=n.createLog("analyser");function l(e){var t=!1;return function e(r){if("ThisExpression"==r.type)return"this";if("Identifier"==r.type)return r.name;if("ArrayExpression"==r.type){var n=[];r.elements.forEach(function(t){return n.push(e(t))});return n}if("MemberExpression"!=r.type)return"("+r.type+")";if(o.isIdentifier(r.object)){var a=r.object.name;r.property.name?a+="."+r.property.name:t=!0;return a}var i;i="ArrayExpression"==r.object.type?"[]":e(r.object);if(t)return i;r.computed?t=!0:r.property.name?i+="."+r.property.name:t=!0;return i}(e)}function u(e){var t=e.type;return"Literal"===t||"StringLiteral"===t||"NumericLiteral"===t||"BooleanLiteral"===t||"BigIntLiteral"===t}function p(e){for(var t=e.split("."),r=o.memberExpression(o.identifier(t[0]),o.identifier(t[1])),n=2;n<t.length;n++)r=o.memberExpression(r,o.identifier(t[n]));return r}function f(e){if(null===e||void 0===e)return o.nullLiteral();if("boolean"==typeof e)return o.booleanLiteral(e);if("number"==typeof e)return o.numericLiteral(e);if("string"==typeof e)return o.stringLiteral(e);if(qx.lang.Type.isRegExp(e))return o.regExpLiteral(e.toString());if(qx.lang.Type.isDate(e))return o.stringLiteral(e.toString());if(qx.lang.Type.isArray(e)){var t=[];e.forEach(function(e){t.push(f(e))});return o.arrayExpression(t)}if("object"!=_typeof(e)){c.error("Cannot serialise value "+e+" into AST");return o.nullLiteral()}var r=[];for(var n in e){var a=f(e[n]),i=o.objectProperty(o.stringLiteral(n),a);r.push(i)}return o.objectExpression(r)}function m(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?JSON.stringify(e):"object"===_typeof(e)&&e instanceof Date?"new Date("+e.getTime()+")":e.toString()}qx.Class.define("qx.tool.compiler.ClassFile",{extend:qx.core.Object,construct:function(e,t,r){var n=this;qx.core.Object.constructor.call(this);this.__P_219_0=e;this.__P_219_1=t;this.__P_219_2=[];this.__P_219_3={};this.__P_219_4=r;this.__P_219_5=qx.tool.compiler.ClassFile.getSourcePath(r,t);this.__P_219_6={};this.__P_219_7={provided:{},required:{}};this.__P_219_8=[];this.__P_219_9=[];this.__P_219_10=[];this.__P_219_11={};this.__P_219_12={parent:null,vars:{},unresolved:{}};this.__P_219_13=[];this.__P_219_14=i.queue(function(e,t){e(t)});this.__P_219_14.drain=this._onTaskQueueDrain;this.__P_219_14.error=function(e){n.error(e.stack||e)};e.getIgnores().forEach(function(e){return n.addIgnore(e)});this.__P_219_15={};this.__P_219_16={};this.__P_219_17=e.getManglePrivates();var o=qx.tool.compiler.ClassFile,a=function(e){return e.forEach(function(e){return n.__P_219_15[e]=!0})};if(e.getGlobalSymbols().length)a(e.getGlobalSymbols());else{a(o.QX_GLOBALS);a(o.COMMON_GLOBALS);a(o.BROWSER_GLOBALS)}},members:{__P_219_0:null,__P_219_1:null,__P_219_18:0,__P_219_4:null,__P_219_6:null,__P_219_7:null,__P_219_8:null,__P_219_19:null,__P_219_12:null,__P_219_20:!1,__P_219_21:!1,__P_219_14:null,__P_219_13:null,__P_219_10:null,__P_219_11:null,__P_219_22:null,__P_219_2:null,__P_219_3:null,__P_219_23:!1,__P_219_9:null,__P_219_24:null,__P_219_25:null,__P_219_26:null,__P_219_5:null,__P_219_27:null,__P_219_15:null,__P_219_16:null,_onTaskQueueDrain:function(){var e=this.__P_219_27;this.__P_219_27=[];e.forEach(function(e){e()})},_waitForTaskQueueDrain:function(e){0==this.__P_219_14.length()?e():this.__P_219_13.push(e)},_queueTask:function(e){this.__P_219_14.push(e)},getSourcePath:function(){return this.__P_219_5},getOutputPath:function(){return qx.tool.compiler.ClassFile.getOutputPath(this.__P_219_0,this.__P_219_1)},load:function(e){var o=this,a=this.__P_219_1;o.__P_219_23=!1;o.__P_219_18=0;t.readFile(this.getSourcePath(),{encoding:"utf-8"},function(i,s){if(i)e(i);else{var c;try{var l=o.__P_219_0.getBabelConfig()||{},u=qx.lang.Object.clone(l.options||{},!0);u.modules=!1;var p=[{plugins:[]}];if(l.plugins)for(var f in l.plugins)!0===l.plugins[f]?p[0].plugins.push(require.resolve(f)):l.plugins[f]&&p[0].plugins.push([require.resolve(f),l.plugins[f]]);var m=o._babelClassPlugins(),d={babelrc:!1,sourceFileName:o.getSourcePath(),filename:o.getSourcePath(),sourceMaps:!0,presets:[[{plugins:[m.CodeElimination]}],[{plugins:[m.Compiler]}],[require.resolve("@babel/preset-env"),u],[require.resolve("@babel/preset-typescript")],[require.resolve("@babel/preset-react"),qx.tool.compiler.ClassFile.JSX_OPTIONS]],parserOpts:{sourceType:"script"},passPerPreset:!0};p[0].plugins.length&&d.presets.push(p);"unreadable"==this.__P_219_17&&(d.blacklist=["spec.functionName"]);c=r.transform(s,d)}catch(t){qx.tool.compiler.Console.log(t);o.addMarker("compiler.syntaxError",t.loc,t.message);o.__P_219_23=!0;o._compileDbClassInfo();e();return}if(o.__P_219_18){if(!o.__P_219_3[a]){o.addMarker("compiler.wrongClassName",null,a,Object.keys(o.__P_219_3).join(", "));o._compileDbClassInfo()}var _=a.lastIndexOf("."),h=_>-1?a.substring(_+1):a,g=o.getOutputPath();n.mkParentPath(g,function(r){r?e(r):t.writeFile(g,c.code+"\n\n//# sourceMappingURL="+h+".js.map?dt="+(new Date).getTime(),{encoding:"utf-8"},function(r){r?e(r):t.writeFile(g+".map",JSON.stringify(c.map,null,2),{encoding:"utf-8"},function(t){t?e(t):o._waitForTaskQueueDrain(function(){e()})})})})}else{o.addMarker("compiler.missingClassDef");o.__P_219_23=!0;o._compileDbClassInfo();e()}}})},writeDbInfo:function(e){delete e.unresolved;delete e.dependsOn;delete e.assets;delete e.translations;delete e.markers;delete e.fatalCompileError;for(var t in this.__P_219_24)e[t]=this.__P_219_24[t]},_compileDbClassInfo:function(){var e=this,t=this.__P_219_24={},r=this.getRequiredClasses();if(e.__P_219_28){var n=qx.tool.compiler.ClassFile.JSX_OPTIONS.pragma,o=n.lastIndexOf(".");r[n=n.substring(0,o)]||(r[n]={})}for(var a in r){var i=r[a];if(!i.ignore){t.dependsOn||(t.dependsOn={});t.dependsOn[a]=i}}function s(e){e&&Object.keys(e).forEach(function(t){if("@"==t[0]){var r=e[t];delete e[t];t=t.substring(1);var n=e[t];if(n){n.annotations||(n.annotations=[]);n.annotations.push(r)}}})}var c=this.getOuterClassMeta();if(c){s(c.events);s(c.members);s(c.statics);c.properties&&c.members&&Object.keys(c.properties).forEach(function(e){var t=c.properties[e];if(t.apply){var r=c.members[t.apply];if(r){r.applyFor||(r.applyFor=[]);r.applyFor.push(e)}}});t.extends=c.superClass;t.include=c.mixins.slice(0);t.implement=c.interfaces.slice(0)}if(Object.keys(this.__P_219_7.provided).length||Object.keys(this.__P_219_7.required).length){t.environment={provided:[],required:{}};for(var l in this.__P_219_7.provided)t.environment.provided.push(l);for(var u in this.__P_219_7.required)t.environment.required[u]=this.__P_219_7.required[u]}t.hasDefer=this.hasDefer();t.unresolved=[];for(var p in this.__P_219_12.unresolved){var f=this.__P_219_12.unresolved[p];if(void 0!==f&&!this.__P_219_3[p]){var m=e.__P_219_0.getSymbolType(p);if(m&&m.className)e._requireClass(m.className,{load:f.load,defer:f.defer});else if(m&&"package"==m.symbolType)e.deleteReference(p);else{t.unresolved.push(f);for(var d=0;d<f.locations.length;d++)e.addMarker("symbol.unresolved#"+p,f.locations[d].start,p)}}}t.unresolved.length||delete t.unresolved;var _=this.getAssets();_.length&&(t.assets=_);if(c){if(c.aliases){t.aliases={};for(var h in c.aliases.aliasMap)t.aliases[h]=c.aliases.aliasMap[h]}if(c.themeMeta){t.themeMeta={};for(var g in c.themeMeta.themeMetaMap)t.themeMeta[g]=c.themeMeta.themeMetaMap[g]}}this.__P_219_9.length&&(t.translations=this.__P_219_9.slice(0));this.__P_219_10.length&&(t.markers=qx.lang.Array.clone(this.__P_219_10));this.__P_219_23&&(t.fatalCompileError=!0);return t},getOuterClassMeta:function(){var e=this.__P_219_3[this.__P_219_1]||null;if(!e)return e;var t={};Object.keys(e).filter(function(e){return"_"!=e[0]}).forEach(function(r){return t[r]=e[r]});return t},_babelClassPlugins:function(){var e=this;function t(e){return"StringLiteral"==e.type?e.value:e.name}function r(e){var t=function(e){if(!e)return null;qx.lang.Type.isArray(e)||(e=[e]);var t={};e.forEach(function(e){var r=qx.tool.compiler.jsdoc.Parser.parseComment(e.value);for(var n in r){var o=r[n];t[n]?qx.lang.Array.append(t[n],o):t[n]=o}});return t}(e.leadingComments);t&&n(t,e.loc);return t}function n(t,r){if(!t)return t;t["@use"]&&t["@use"].forEach(function(t){e._requireClass(t.body,{where:"use",load:!1,location:r})});t["@require"]&&t["@require"].forEach(function(t){e._requireClass(t.body,{where:"require",load:!1,location:r})});t["@optional"]&&t["@optional"].forEach(function(t){e.addIgnore(t.body)});t["@ignore"]&&t["@ignore"].forEach(function(t){e.addIgnore(t.body)});t["@asset"]&&t["@asset"].forEach(function(t){e._requireAsset(t.body)});return t}function i(t,n,o){n=n||t.node;o=o||n.id||null;var a=e.__P_219_22&&e.__P_219_22._topLevel&&"members"==e.__P_219_22._topLevel.keyName&&t.parentPath.parentPath.parentPath==e.__P_219_22._topLevel.path;o&&e.addDeclaration(o.name);e.pushScope(o?o.name:null,n,a);n.params.forEach(function(t){"AssignmentPattern"==t.type?e.addDeclaration(t.left.name):"RestElement"==t.type?e.addDeclaration(t.argument.name):"Identifier"==t.type?e.addDeclaration(t.name):"ArrayPattern"==t.type?t.elements.forEach(function(t){return e.addDeclaration(t.name)}):"ObjectPattern"==t.type?t.properties.forEach(function(t){return e.addDeclaration(t.value.name)}):e.addMarker("testForFunctionParameterType",n.loc,t.type)});r(n)}function s(t,r){r=r||t.node;e.popScope(r)}var d={enter:function(e){return i(e)},exit:function(e){return s(e)}};function _(t,n,o){var a;if(n){var i=e.__P_219_22[t];void 0===i&&(i=e.__P_219_22[t]={});void 0===(a=i[n])&&(a=i[n]={})}else void 0===(a=e.__P_219_22[t])&&(a=e.__P_219_22[t]={});a.location=o.loc;if(o.leadingComments){var s=r(o);s&&(a.jsdoc=s)}if("members"===t||"statics"===t){"ObjectMethod"==o.type||"FunctionExpression"===o.value.type?a.type="function":a.type="variable";n.startsWith("__P_219_29")?a.access="private":n.startsWith("_")?a.access="protected":a.access="public"}return a}var h=!1,g={MemberExpression:function(t){var r=l(t.node);e._requireClass(r,{location:t.node.loc});var n=e.__P_219_0.getSymbolType(r);n&&"class"==n.symbolType&&this.collectedClasses.push(r)}};function x(t){var r;if("ObjectExpression"==t.type){r={};t.properties.forEach(function(e){var t=e.key.name,n=x(e.value);r[t]=n})}else if("Literal"==t.type||"StringLiteral"==t.type||"BooleanLiteral"==t.type||"NumericLiteral"==t.type||"NullLiteral"==t.type){"string"==typeof t.value&&(t.value=e.encodePrivate(t.value));r=t.value}else if("ArrayExpression"==t.type){r=[];t.elements.forEach(function(e){r.push(x(e))})}else if("Identifier"==t.type){t.name=e.encodePrivate(t.name);r=t.name}else if("CallExpression"==t.type||"FunctionExpression"==t.type||"ArrowFunctionExpression"==t.type)r=new Function("[[ Function ]]");else if("MemberExpression"==t.type)r=l(t);else if("UnaryExpression"==t.type){if("-"==t.operator){var n=x(t.argument);if("number"==typeof n)return-1*n}else if("!"==t.operator){var o=x(t.argument);if("boolean"==typeof o)return!o}r="[[ UnaryExpression ]]"}else if("NewExpression"==t.type||"BinaryExpression"==t.type)r="[[ "+t.type+" ]]";else{e.warn("Cannot interpret AST "+t.type+" at "+e.__P_219_1+(t.loc?" ["+t.loc.start.line+","+t.loc.start.column+"]":""));r=null}return r}var y={class:{static:{"@":"object",type:"string",statics:"object",environment:"object",defer:"function"},normal:{"@":"object","@construct":"object","@destruct":"object",type:"string",extend:"function",implement:"object",include:"object",construct:"function",statics:"object",properties:"object",members:"object",environment:"object",events:"object",defer:"function",destruct:"function"}},interface:{extend:"object",statics:"object",members:"object",properties:"object",events:"object"},mixin:{include:"object",statics:"object",members:"object",properties:"object",events:"object",destruct:"function",construct:"function"},theme:{title:"string",aliases:"object",type:"string",extend:"object",colors:"object",borders:"object",decorations:"object",fonts:"object",icons:"object",widgets:"object",appearances:"object",meta:"object",include:"object",patch:"object",boot:"function"}};var v={construct:"$$constructor",destruct:"$$destructor",defer:null};function b(r){var n=r.node,o=t(n.key),a=y[e.__P_219_22.type];"class"===e.__P_219_22.type&&(a=a[e.__P_219_22.isStatic?"static":"normal"]);void 0===a[o]&&e.addMarker("compiler.invalidClassDefinitionEntry",n.loc,e.__P_219_22.type,o)}function q(t,r,n){if("defer"==r){e.__P_219_25=!0;e.__P_219_20=!0}e.__P_219_22.functionName=v[r]||r;void 0!==v[r]&&_(r,null,n);i(t,n);t.traverse(w);s(t,n);t.skip();e.__P_219_22.functionName=null}var P={ObjectMethod:function(e){if(e.parentPath.parentPath==this.classDefPath){var r=t(e.node.key);b(e);q(e,r,e.node)}else{e.skip();e.traverse(w)}},ObjectProperty:function(r){if(r.parentPath.parentPath==this.classDefPath){var n=r.node,o=t(n.key);b(r);if(void 0===v[o]){if("extend"==o)if(function(t){return"MemberExpression"==t.value.type||"Identifier"==t.value.type||"NullLiteral"==t.value.type||"class"!==e.__P_219_22.type&&"ArrayExpression"==t.value.type&&t.value.elements.every(function(e){return"MemberExpression"==e.type||"Identifier"==e.type})}(n)){e.__P_219_22.superClass=l(n.value);e._requireClass(e.__P_219_22.superClass,{location:r.node.loc})}else{e.addMarker("compiler.invalidExtendClause",n.value.loc);e.__P_219_23=!0}else if("type"==o){var a=n.value.value;e.__P_219_22.isAbstract="abstract"===a;e.__P_219_22.isStatic="static"===a;e.__P_219_22.isSingleton="singleton"===a}else if("implement"==o){r.skip();r.traverse(g,{collectedClasses:e.__P_219_22.interfaces})}else if("include"==o){r.skip();r.traverse(g,{collectedClasses:e.__P_219_22.mixins})}else if("members"==o||"statics"==o||"@"==o){e.__P_219_22._topLevel={path:r,keyName:o};r.skip();r.traverse(w);e.__P_219_22._topLevel=null}else if("properties"==o){r.skip();n.value.properties?n.value.properties.forEach(function(e){var r=t(e.key),n=_("properties",r,e),o=x(e.value);n.name=r;n.propertyType="new";["refine","themeable","event","inheritable","apply","async","group","nullable","init"].forEach(function(e){return n[e]=o[e]});void 0!==o.nullable&&(n.allowNull=o.nullable);void 0!==o.check&&(qx.lang.Type.isArray(o.check)?n.possibleValues=o.check:n.check=o.check);void 0!==o.init&&(n.defaultValue=o.init)}):e.addMarker("class.invalidProperties",n.loc||null);r.traverse(w)}else if("events"==o){r.skip();n.value.properties&&n.value.properties.forEach(function(e){var r=t(e.key),n=_("events",r,e);n.name=r;n.type=x(e.value)});r.traverse(w)}else if("aliases"==o){r.skip();if(n.value.properties){var i=_("aliases",null,n);i.aliasMap={};n.value.properties.forEach(function(e){var r=t(e.key),n=t(e.value);i.aliasMap[r]=n})}else e.addMarker("class.invalidAliases",n.loc||null)}else if("meta"==o){r.skip();if(n.value.properties){var s=_("themeMeta",null,n);s.themeMetaMap={};n.value.properties.forEach(function(e){var r=t(e.key),n=l(e.value);s.themeMetaMap[r]=n})}else e.addMarker("class.invalidThemeMeta",n.loc||null);r.traverse(w)}}else{var c=r.node.value;c.leadingComments=(r.node.leadingComments||[]).concat(c.leadingComments||[]);q(r,o,c)}}else{r.skip();r.traverse(w)}}},k={"qx.Class.define":"class","qx.Mixin.define":"mixin","qx.Theme.define":"theme","qx.Interface.define":"interface","qx.Bootstrap.define":"class"},w={NewExpression:{enter:function(t){var r=l(t.node.callee);e._requireClass(r,{usage:"dynamic",location:t.node.loc})},exit:function(t){if(e.__P_219_0.isAddCreatedAt()){var r=o.memberExpression(o.identifier("qx"),o.identifier("$$createdAt")),n=o.callExpression(r,[t.node,o.stringLiteral(e.__P_219_1.replace(/\./g,"/")+".js"),o.numericLiteral(t.node.loc?t.node.loc.start.line:0),o.numericLiteral(t.node.loc?t.node.loc.start.column:0)]);t.replaceWith(n);t.skip()}}},ExpressionStatement:{enter:function(e){r(e.node)},exit:function(e){r(e.node)}},EmptyStatement:function(e){r(e.node)},JSXElement:function(t){e.__P_219_28=!0},Program:{exit:function(t){var r=e._compileDbClassInfo(),n={},i=!1;if(r.dependsOn){n.dependsOn={};Object.keys(r.dependsOn).forEach(function(e){var t=n.dependsOn[e]=Object.assign({},r.dependsOn[e]);if(t.load){delete t.load;t.require=!0;i=!0}})}if(r.environment){n.environment=r.environment;var s=r.environment.required;if(s)for(var c in s)if(s[c].load){i=!0;break}}var l=o.variableDeclaration("var",[o.variableDeclarator(o.identifier("$$dbClassInfo"),f(n))]),u=[l];if(i){l=a.parse("qx.Bootstrap.executePendingDefers($$dbClassInfo);").program.body;u.push(l[0])}t.node.body.forEach(function(e){return u.push(e)});l=a.parse(e.__P_219_1+".$$dbClassInfo = $$dbClassInfo;").program.body;u.push(l[0]);var p=o.blockStatement(u),m=o.expressionStatement(o.callExpression(o.functionExpression(null,[],p),[]));t.node.body.splice(0,t.node.body.length,m)}},Literal:function(t){"string"==typeof t.node.value&&(t.node.value=e.encodePrivate(t.node.value))},Identifier:function(t){t.node.name=e.encodePrivate(t.node.name);for(var r={ObjectProperty:1,ObjectMethod:1,FunctionExpression:1,FunctionStatement:1,ArrowFunctionExpression:1,VariableDeclarator:1,FunctionDeclaration:1,CatchClause:1,AssignmentPattern:1,RestElement:1,ArrayPattern:1,SpreadElement:1,ClassDeclaration:1,ClassMethod:1,LabeledStatement:1,BreakStatement:1},n={AssignmentExpression:1,BooleanExpression:1,CallExpression:1,BinaryExpression:1,UnaryExpression:1,WhileStatement:1,IfStatement:1,NewExpression:1,ReturnStatement:1,ConditionalExpression:1,LogicalExpression:1,ForInStatement:1,ArrayExpression:1,SwitchStatement:1,SwitchCase:1,ThrowStatement:1,ExpressionStatement:1,UpdateExpression:1,SequenceExpression:1,ContinueStatement:1,ForStatement:1,TemplateLiteral:1,AwaitExpression:1,DoWhileStatement:1,ForOfStatement:1,TaggedTemplateExpression:1,ClassExpression:1},o=t;o;){var a=o.parentPath.node.type;if("MemberExpression"!=a&&"OptionalMemberExpression"!=a){if(r[a])return;n[a]||e.addMarker("testForUnresolved",t.node.loc,a);break}o=o.parentPath}var i=l(o.node);if(!i.startsWith("(")){var s=i.split(".");e.addReference(s,o.node.loc)}},CallExpression:{enter:function(t){function r(e){if(e>=t.node.arguments.length)return null;var r=t.node.arguments[e];return"StringLiteral"==r.type?r.value:null}function a(r){var n=t.node.loc?t.node.loc.start.line:0,o=e.__P_219_9[r.msgid];if(o){qx.lang.Type.isArray(o.lineNo)||(o.lineNo=[o.lineNo]);o.lineNo.push(n)}else{r.lineNo=n;e.__P_219_9.push(r)}}if(o.isMemberExpression(t.node.callee)){var i=l(t.node.callee),s=null;if("Identifier"==t.node.callee.object.type){for(var u=t.node.callee.object.name,f=u,m=!1,d=e.__P_219_12;d;d=d.parent){for(;!m;){var g=d.vars[f];if("this"===g){m=!0;break}if("string"!=typeof g)break;f=g}if(m||d.isClassMember)break}if(m){i="this"+i.substring(u.length);s=u}}if(k[i]){e.__P_219_26=i.match(/\.([a-zA-Z]+)\./)[1];var x=t.node,y=x.arguments[0].value,v=x.arguments[1];if("ObjectExpression"!=v.type)return;e.__P_219_30(y);h&&e._requireClass("qx.core.Environment",{location:h,defer:!0});var b=_("clazz",null,t.parent);e.__P_219_22.type=k[i];if("Class"==e.__P_219_26||"Bootstrap"==e.__P_219_26){var q=v.properties.find(function(e){return"Identifier"==e.key.type&&"type"==e.key.value});q&&e.__P_219_22.isStatic==q.value.type=="Literal"&&q.value.value}n(b.jsdoc,t.node.loc);e._requireClass(i,{usage:"dynamic",location:t.node.loc});t.skip();t.traverse(P,{classDefPath:t});e.__P_219_31(y)}else if("qx.core.Environment.add"==i){var C=t.node.arguments[0];o.isLiteral(C)&&("string"!=typeof C.value?c.error("Invalid argument to qx.core.Environment.add: "+C.value):e.__P_219_7.provided[C.value]=!0);e._requireClass("qx.core.Environment",{usage:"dynamic",location:t.node.loc})}else if("qx.core.Environment.get"==i){var S=t.node.arguments[0];o.isLiteral(S)&&("string"!=typeof S.value?c.error("Invalid argument to qx.core.Environment.get: "+S.value):e.addEnvCheck(S.value,t.node.loc));e._requireClass("qx.core.Environment",{usage:"dynamic",location:t.node.loc});t.skip();t.traverse(w)}else if("qx.core.Environment.select"==i){var T=t.node.arguments[0];o.isLiteral(T)&&("string"!=typeof T.value?c.error("Invalid argument to qx.core.Environment.select: "+T.value):e.addEnvCheck(T.value,t.node.loc));e._requireClass("qx.core.Environment",{usage:"dynamic",location:t.node.loc});t.skip();t.traverse(w)}else if("this.base"==i){var A;A="Mixin"==e.__P_219_26?p(e.__P_219_22.className+".$$members."+e.__P_219_22.functionName+".base.call"):"$$constructor"==e.__P_219_22.functionName?p(e.__P_219_22.superClass+".constructor.call"):p(e.__P_219_22.className+".prototype."+e.__P_219_22.functionName+".base.call");t.node.arguments[0]=s?o.identifier(s):o.thisExpression();var E=o.callExpression(A,t.node.arguments);t.replaceWith(E)}else if("this.base.apply"==i||"this.base.call"==i){var R,O="this.base.apply"==i?"apply":"call";R="Mixin"==e.__P_219_26?p("this.constructor.superclass.prototype."+e.__P_219_22.functionName+".call"):"$$constructor"==e.__P_219_22.functionName?p(e.__P_219_22.superClass+".constructor."+O):p(e.__P_219_1+".prototype."+e.__P_219_22.functionName+".base."+O);var I=o.callExpression(o.memberExpression(t.node.arguments[1],o.identifier("slice")),[]),j=o.callExpression(o.memberExpression(I,o.identifier("shift")),[]),D=o.callExpression(R,[t.node.arguments[0],j]);t.replaceWith(D)}else if("this.self"==i){var N=p(e.__P_219_1);t.replaceWith(N)}else if("this.tr"==i||"this.marktr"==i||"qx.locale.Manager.tr"==i||"qx.locale.Manager.marktr"==i){var L=r(0);L?a({msgid:L}):e.addMarker("translate.invalidMessageId",t.node.loc,L)}else if("this.trn"==i||"qx.locale.Manager.trn"==i){var M=r(0),G=r(1);M&&G?a({msgid:M,msgid_plural:G}):e.addMarker("translate.invalidMessageIds",t.node.loc,M,G)}else if("this.trc"==i||"qx.locale.Manager.trc"==i){var F=r(0),U=r(1);F&&U?a({msgid:U,comment:F}):e.addMarker("translate.invalidMessageIds",t.node.loc,F,U)}else if("this.trnc"==i||"qx.locale.Manager.trnc"==i){var B=r(0),$=r(1),W=r(2);B&&$&&W?a({msgid:$,msgid_plural:W,comment:B}):e.addMarker("translate.invalidMessageIds3",t.node.loc,B,$,W)}else{var J=i.lastIndexOf(".");if(J>0){var V=i.substring(0,J);e.hasDeclaration(V)||e._requireClass(V,{usage:"dynamic",location:t.node.loc})}}}}},MemberExpression:{exit:function(t){if("Literal"!=t.node.object.type&&"ArrayExpression"!=t.node.object.type&&("MemberExpression"!=t.node.object.type||"ArrayExpression"!=t.node.object.object.type)){var r=l(t.node);if(!r.startsWith("(")){var n=r.split(".");if("this"!==n[0]&&!e.__P_219_15[n[0]]&&!e.hasDeclaration(n[0])){var o=e._requireClass(r,{location:t.node.loc});if(!o||!o.className){if("MemberExpression"==t.container.type)return;e.addReference(n,t.node.loc)}}}}}},ObjectProperty:{exit:function(e){if("readable"==this.__P_219_17&&"FunctionExpression"==e.node.value.type&&null===e.node.value.id){var t="string"==typeof e.node.key.value?e.node.key.value:e.node.key.name;qx.tool.compiler.ClassFile.RESERVED_WORDS[t]||(e.node.value.id=o.identifier(t))}}},Property:function(r){if(e.__P_219_22&&e.__P_219_22._topLevel&&e.__P_219_22._topLevel.path==r.parentPath.parentPath){e.__P_219_22.functionName=t(r.node.key);_(e.__P_219_22._topLevel.keyName,e.__P_219_22.functionName,r.node);r.skip();var n=null;if("readable"==this.__P_219_17&&"FunctionExpression"==r.node.value.type&&null===r.node.value.id){var a="string"==typeof r.node.key.value?r.node.key.value:r.node.key.name;qx.tool.compiler.ClassFile.RESERVED_WORDS[a]||(n=o.identifier(a))}r.traverse(w);n&&(r.node.value.id=n);e.__P_219_22.functionName=null}},ObjectMethod:function(r){if(e.__P_219_22)if(e.__P_219_22._topLevel&&e.__P_219_22._topLevel.path==r.parentPath.parentPath){e.__P_219_22.functionName=t(r.node.key);_(e.__P_219_22._topLevel.keyName,e.__P_219_22.functionName,r.node);r.skip();i(r);r.traverse(w);s(r);e.__P_219_22.functionName=null}else{r.skip();i(r);r.traverse(w);s(r)}},FunctionDeclaration:d,FunctionExpression:d,ArrowFunctionExpression:d,VariableDeclaration:{exit:function(t){r(t.node);t.node.declarations.forEach(function(t){if("Identifier"==t.id.type){var r=null;t.init&&("Identifier"==t.init.type?r=t.init.name:"ThisExpression"==t.init.type&&(r="this"));e.addDeclaration(t.id.name,r)}else"ObjectPattern"==t.id.type?t.id.properties.forEach(function(t){"AssignmentPattern"==t.value.type?e.addDeclaration(t.value.left.name):e.addDeclaration(t.value.name)}):"ArrayPattern"==t.id.type&&t.id.elements.forEach(function(t){t&&("AssignmentPattern"==t.type?e.addDeclaration(t.left.name):e.addDeclaration(t.name))})})}},ClassDeclaration:function(t){e.addDeclaration(t.node.id.name)},ClassMethod:{enter:function(e){i(e,e.node.value,e.node.key)},exit:function(e){s(e,e.node.value,e.node.key)}},CatchClause:{enter:function(t){e.pushScope(null,t.node);e.addDeclaration(t.node.param.name)},exit:function(t){e.popScope(t.node)}}};return{CodeElimination:{visitor:{CallExpression:function(t){var r=l(t.node.callee);if(("qx.core.Environment.select"===r||"qx.core.Environment.get"===r)&&o.isLiteral(t.node.arguments[0])){var n=t.node.arguments[0],a=e.__P_219_0.getEnvironment()[n.value];if(void 0!==a){if("qx.core.Environment.get"===r){t.skip();t.replaceWithSourceString(m(a));return}if("qx.core.Environment.select"===r){var i=t.get("arguments.1"),s=i.node.properties.find(function(e){return e.key.value===a.toString()});s||(s=i.node.properties.find(function(e){return"default"===e.key.value}));if(s){t.replaceWith(s.value);return}}}h=t.node.loc}},IfStatement:{exit:function(e){var t=e.node;o.isLiteral(t.test)&&(t.test.value?e.replaceWith(t.consequent):t.alternate?e.replaceWith(t.alternate):e.remove())}},LogicalExpression:{exit:function(e){var t=e.node;if(o.isLiteral(t.left)&&o.isLiteral(t.right)){var r="&&"==t.operator&&t.left.value&&t.right.value||"||"==t.operator&&(t.left.value||t.right.value);e.replaceWith(f(r))}}},BinaryExpression:{exit:function(e){var t=e.node;if(u(t.left)&&u(t.right))if("+-*/".indexOf(t.operator)>-1){var r;switch(t.operator){case"+":r=t.left.value+t.right.value;break;case"-":r=t.left.value-t.right.value;break;case"/":r=t.left.value/t.right.value;break;case"*":r=t.left.value*t.right.value}e.skip();e.replaceWithSourceString(m(r))}else{var n;switch(t.operator){case"==":n=t.left.value==t.right.value;break;case"===":n=t.left.value===t.right.value;break;case"!=":n=t.left.value!=t.right.value;break;case"!==":n=t.left.value!==t.right.value}void 0!==n&&e.replaceWith(o.booleanLiteral(Boolean(n)))}}},UnaryExpression:{exit:function(e){"!"===e.node.operator&&o.isLiteral(e.node.argument)&&e.replaceWith(o.booleanLiteral(!e.node.argument.value))}}}},Compiler:{visitor:w}}},__P_219_30:function(e){var t=(e||"").lastIndexOf("."),r={className:e,packageName:t>-1?e.substring(0,t):null,name:t>-1?e.substring(t+1):e,superClass:null,interfaces:[],mixins:[],functionName:null};this.__P_219_2.push(r);this.__P_219_22=r;this.__P_219_3[e]=r;this.__P_219_18++},__P_219_31:function(e){if(!this.__P_219_2.length)throw new Error("No __metaStack entries to pop");var t=this.__P_219_2[this.__P_219_2.length-1];if(e&&t.className!=e)throw new Error("Wrong __metaStack entries to pop, expected "+e+" found "+t.className);this.__P_219_2.pop();t=this.__P_219_2[this.__P_219_2.length-1]||null;this.__P_219_22=t},pushScope:function(e,t,r){this.__P_219_12={functionName:e,parent:this.__P_219_12,loc:t.loc,vars:{},unresolved:{},isClassMember:Boolean(r)}},popScope:function(e){var t=this.__P_219_12,r=this.__P_219_12=this.__P_219_12.parent,n=r.unresolved;for(var o in t.unresolved)if(!r.vars[o]){var a=n[o];a||(a=n[o]={name:o,locations:[]});a.locations.push.apply(a.locations,t.unresolved[o].locations)}},isLoadScope:function(){return!this.__P_219_12.parent},hasDefer:function(){return this.__P_219_25},addDeclaration:function(e,t){if(void 0===this.__P_219_12.vars[e]){this.__P_219_12.vars[e]=t||!0;var r=this.__P_219_12.unresolved;delete r[e];var n=new RegExp(e+"\\.");for(var o in r)n.test(o)&&delete r[o]}},hasDeclaration:function(e){var t=e.indexOf(".");t>-1&&(e=e.substring(0,t));for(var r=this.__P_219_12;r;r=r.parent)if(void 0!==r.vars[e])return!0;return!1},addReference:function(e,t){qx.lang.Type.isArray(e)||(e=e.split("."));var r=this.__P_219_12;if(void 0===r.vars[e[0]]&&"this"!==e[0]&&"[]"!==e[0]&&!this.__P_219_15[e[0]]&&!this.hasDeclaration(e[0])){for(var n="",o=0;o<e.length;o++){o&&(n+=".");n+=e[o];if(this.__P_219_15[n]||this.isIgnored(n))return}(e=n)==this.__P_219_1||e.startsWith(this.__P_219_1+".")||e.startsWith("(")||(r.unresolved[e]?t&&r.unresolved[e].locations.push(t):r.unresolved[e]={name:e,locations:t?[t]:[],load:this.isLoadScope(),defer:this.__P_219_20})}},encodePrivate:function(e){if({__proto__:1,__iterator__:1,__dirname:1,__filename:1}[e]||"off"==this.__P_219_17||!e.startsWith("__P_219_29")||!e.match(/^[0-9a-z_$]+$/i))return e;if(e.indexOf("__P_")>-1)return e;var t=this.__P_219_16[e];if(!t){var r=this.__P_219_0.getDatabase();r.manglePrefixes||(r.manglePrefixes={nextPrefix:1,classPrefixes:{}});var n=r.manglePrefixes,o=n.classPrefixes[this.__P_219_1];if(!o){o="__P_"+ ++n.nextPrefix+"_";n.classPrefixes[this.__P_219_1]=o}t="readable"==this.__P_219_17?this.__P_219_16[e]=e+o+Object.keys(this.__P_219_16).length:this.__P_219_16[e]=o+Object.keys(this.__P_219_16).length}return t},deleteReference:function(e){delete this.__P_219_12.unresolved[e];var t=e+".";for(var r in this.__P_219_12.unresolved)r.startsWith(t)&&delete this.__P_219_12.unresolved[r]},addIgnore:function(e){var t=this.__P_219_12;t.ignore||(t.ignore={});e.split(",").forEach(function(e){(e=e.trim()).endsWith(".*")?t.ignore[e]=e.substring(0,e.length-2):e.endsWith("*")?t.ignore[e]=e.substring(0,e.length-1):t.ignore[e]=!0})},isIgnored:function(e){for(var t=this.__P_219_12;t;t=t.parent)if(t.ignore){if(t.ignore[e])return!0;for(var r in t.ignore)if(!0!==t.ignore[r]&&e.startsWith(t.ignore[r]))return!0}return!1},removeIgnore:function(e){var t=this.__P_219_12;if(t){e.split(",").forEach(function(e){return delete t.ignore[e]})}},addEnvCheck:function(e,t){var r=this,n={load:r.isLoadScope(),defer:r.__P_219_20,construct:r.__P_219_22&&"$$constructor"==r.__P_219_22.functionName,location:t},o=r.__P_219_7.required[e];o||(o=r.__P_219_7.required[e]={});n.load&&(o.load=!0);n.defer&&(o.defer=!0);n.construct&&(o.construct=!0);r._requireClass("qx.core.Environment",{location:t});if(void 0===qx.tool.compiler.ClassFile.ENVIRONMENT_CONSTANTS[e]){var a=qx.tool.compiler.ClassFile.ENVIRONMENT_CHECKS[e];if(a&&a.className){r._requireClass(a.className,{load:n.load,location:t});o.className=a.className}else a||r._requireClass(e,{load:n.load,location:t})}},addMarker:function(e,t){var r=e="qx.tool.compiler."+e,n=e.indexOf("#");if(n>-1)e=e.substring(0,n);else{r+="#";t&&(t.line?r+=t.line:t.start&&t.start.line&&(r+=t.start.line))}if(!this.__P_219_11[r]){this.__P_219_11[r]=!0;var o={msgId:e};if(t){t.line&&(t={start:t});if(t.start){var a={line:t.start.line};t.start.column&&(a.column=t.start.column);o.pos={start:a};if(t.end&&t.end.line){var i={line:t.end.line};t.end.column&&(i.column=t.end.column);o.pos.end=i}}}var s=qx.lang.Array.fromArguments(arguments,2);s.length&&(o.args=s);this.__P_219_10.push(o)}},_requireClass:function(e,t){var r=this;if(qx.lang.Type.isArray(e)){e.forEach(function(e){return r._requireClass(e)});return null}var n=this;if(e==this.__P_219_1)return null;if(!e)throw new Error("No classname");if(this.isIgnored(e))return null;var o={load:n.isLoadScope(),defer:n.__P_219_20,construct:n.__P_219_22&&"$$constructor"==n.__P_219_22.functionName};if(t)for(var a in t)o[a]=t[a];var i=n.__P_219_0.getSymbolType(e),s=i?i.symbolType:null,c=i?i.className:null;if("package"!=s&&c&&c!=n.__P_219_1){if("member"==s&&n.isIgnored(c))return null;var l=n.__P_219_6[c];l||(l=n.__P_219_6[c]={});void 0!==o.where&&("ignore"==o.where?l.ignore=!0:"require"==o.where&&(l.require=!0));if(o.load){l.load=!0;if("dynamic"===o.usage){"static"!==l.usage&&(l.usage="dynamic");l.load=!0}else if(!l.load){l.load=!0;l.usage="static"}}if(o.defer){o.load?l.defer="load":"load"!==l.defer&&(l.defer="runtime");e.startsWith(n.__P_219_1)||qx.tool.compiler.ClassFile.DEFER_SAFE_SYMBOLS.some(function(t){return e.startsWith(t)})}o.construct&&(l.construct=!0);n.deleteReference(c)}return i},_requireAsset:function(e){e.indexOf("/")<0&&e.indexOf(".")>-1&&(e=e.replace(/\./g,"/"));qx.lang.Array.contains(this.__P_219_8,e)||this.__P_219_8.push(e)},getAssets:function(){return this.__P_219_8},__P_219_32:function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if("Property"==n.type){if("Identifier"==n.key.type&&n.key.name==t)return n;if("StringLiteral"==n.key.type&&n.key.value==t)return n}}return null},getRequiredClasses:function(){return this.__P_219_6},getUnresolvedSymbols:function(){return this.__P_219_12.unresolved},getClassName:function(){return this.__P_219_1}},defer:function(e){e.RESERVED_WORDS={};"abstract  arguments await  boolean break byte  case  catch char  class  const continue debugger  default delete  do double  else  enum eval export extends  false final finally float for function goto  if  implements  import in  instanceof  int interface let  long  native  new null  package private protected public  return  short static super  switch  synchronized  this throw throws  transient true try typeof  var void volatile  while with  yield".split(/\s+/).forEach(function(t){return e.RESERVED_WORDS[t]=!0})},statics:{getSourcePath:function(e,t){return s.join(e.getRootDir(),e.getSourcePath(),t.replace(/\./g,s.sep)+e.getSourceFileExtension(t))},getOutputPath:function(e,t){return s.join(e.getOutputDir(),"transpiled",t.replace(/\./g,s.sep)+".js")},getNamespace:function(e){var t=e.match(/^([^.]+)\./);return t&&t[1]||null},JSX_OPTIONS:{pragma:"qx.html.Jsx.createElement",pragmaFrag:"qx.html.Jsx.FRAGMENT"},DEFER_SAFE_SYMBOLS:["qx.core.Environment","qx.Bootstrap","qx.core.Aspect"],QX_GLOBALS:["qx.$$domReady","qx.$$environment","qx.$$libraries","qx.$$loader","qx.$$locales","qx.$$namespaceRoot","qx.$$resources","qx.$$packageData","qx.$$start","qx.$$translations"],COMMON_GLOBALS:["Array","ArrayBuffer","Boolean","Date","DataView","EvalError","Error","Float32Array","Float64Array","Function","GeneratorFunction","Generator","Infinity","Int8Array","Int16Array","Int32Array","JSON","Map","Math","NaN","Number","Object","Proxy","Promise","RangeError","ReferenceError","Reflect","RegExp","Set","String","Symbol","SyntaxError","TypedArray","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","arguments","atob","btoa","console","clearInterval","clearTimeout","decodeURI","decodeURIComponent","document","encodeURI","encodeURIComponent","escape","error","eval","isNaN","isFinite","navigator","parseInt","parseFloat","setInterval","setTimeout","undefined","unescape","window"],BROWSER_GLOBALS:["ActiveXObject","Blob","CustomEvent","DOMParser","DOMException","Event","FileReader","FormData","Image","MutationObserver","XPathResult","XMLHttpRequest","XMLSerializer","XPathEvaluator","alert","document","history","location","navigator","performance","getComputedStyle","localStorage"],NODE_GLOBALS:["Module","require","module","process","setImmediate","__dirname","__filename"],RHINO_GLOBALS:["Packages","java"],RESERVED_WORDS:null,ENVIRONMENT_CONSTANTS:{true:!0,"qx.allowUrlSettings":!1,"qx.allowUrlVariants":!1,"qx.debug.property.level":0,"qx.debug":!0,"qx.debug.ui.queue":!0,"qx.debug.touchpad.detection":!1,"qx.aspects":!1,"qx.dynlocale":!0,"qx.dyntheme":!0,"qx.blankpage":"qx/static/blank.html","qx.debug.databinding":!1,"qx.debug.dispose":!1,"qx.optimization.basecalls":!1,"qx.optimization.comments":!1,"qx.optimization.privates":!1,"qx.optimization.strings":!1,"qx.optimization.variables":!1,"qx.optimization.variants":!1,"module.databinding":!0,"module.logger":!0,"module.property":!0,"module.events":!0,"qx.nativeScrollBars":!1,"qx.automaticMemoryManagement":!0,"qx.promise":!0,"qx.promise.warnings":!0,"qx.promise.longStackTraces":!0},ENVIRONMENT_CHECKS:{"browser.documentmode":{key:"browser.documentmode",type:"Integer",className:"qx.bom.client.Browser",method:"getDocumentMode"},"browser.name":{key:"browser.name",type:"String",className:"qx.bom.client.Browser",method:"getName"},"browser.quirksmode":{key:"browser.quirksmode",type:"Boolean",className:"qx.bom.client.Browser",method:"getQuirksMode"},"browser.version":{key:"browser.version",type:"String",className:"qx.bom.client.Browser",method:"getVersion"},"runtime.name":{key:"runtime.name",type:" String ",className:"qx.bom.client.Runtime",method:"getName"},"css.borderradius":{key:"css.borderradius",type:"String or null",className:"qx.bom.client.Css",method:"getBorderRadius"},"css.borderimage":{key:"css.borderimage",type:"String or null",className:"qx.bom.client.Css",method:"getBorderImage"},"css.borderimage.standardsyntax":{key:"css.borderimage.standardsyntax",type:"Boolean or null",className:"qx.bom.client.Css",method:"getBorderImageSyntax"},"css.boxmodel":{key:"css.boxmodel",type:"String",className:"qx.bom.client.Css",method:"getBoxModel"},"css.boxshadow":{key:"css.boxshadow",type:"String or null",className:"qx.bom.client.Css",method:"getBoxShadow"},"css.gradient.linear":{key:"css.gradient.linear",type:"String or null",className:"qx.bom.client.Css",method:"getLinearGradient"},"css.gradient.filter":{key:"css.gradient.filter",type:"Boolean",className:"qx.bom.client.Css",method:"getFilterGradient"},"css.gradient.radial":{key:"css.gradient.radial",type:"String or null",className:"qx.bom.client.Css",method:"getRadialGradient"},"css.gradient.legacywebkit":{key:"css.gradient.legacywebkit",type:"Boolean",className:"qx.bom.client.Css",method:"getLegacyWebkitGradient"},"css.placeholder":{key:"css.placeholder",type:"Boolean",className:"qx.bom.client.Css",method:"getPlaceholder"},"css.textoverflow":{key:"css.textoverflow",type:"String or null",className:"qx.bom.client.Css",method:"getTextOverflow"},"css.rgba":{key:"css.rgba",type:"Boolean",className:"qx.bom.client.Css",method:"getRgba"},"css.usermodify":{key:"css.usermodify",type:"String or null",className:"qx.bom.client.Css",method:"getUserModify"},"css.appearance":{key:"css.appearance",type:"String or null",className:"qx.bom.client.Css",method:"getAppearance"},"css.float":{key:"css.float",type:"String or null",className:"qx.bom.client.Css",method:"getFloat"},"css.userselect":{key:"css.userselect",type:"String or null",className:"qx.bom.client.Css",method:"getUserSelect"},"css.userselect.none":{key:"css.userselect.none",type:"String or null",className:"qx.bom.client.Css",method:"getUserSelectNone"},"css.boxsizing":{key:"css.boxsizing",type:"String or null",className:"qx.bom.client.Css",method:"getBoxSizing"},"css.animation":{key:"css.animation",type:"Object or null",className:"qx.bom.client.CssAnimation",method:"getSupport"},"css.animation.requestframe":{key:"css.animation.requestframe",type:"String or null",className:"qx.bom.client.CssAnimation",method:"getRequestAnimationFrame"},"css.transform":{key:"css.transform",type:"Object or null",className:"qx.bom.client.CssTransform",method:"getSupport"},"css.transform.3d":{key:"css.transform.3d",type:"Boolean",className:"qx.bom.client.CssTransform",method:"get3D"},"css.transition":{key:"css.transition",type:"Object or null",className:"qx.bom.client.CssTransition",method:"getSupport"},"css.inlineblock":{key:"css.inlineblock",type:"String or null",className:"qx.bom.client.Css",method:"getInlineBlock"},"css.opacity":{key:"css.opacity",type:"Boolean",className:"qx.bom.client.Css",method:"getOpacity"},"css.textShadow":{key:"css.textShadow",type:"Boolean",className:"qx.bom.client.Css",method:"getTextShadow"},"css.textShadow.filter":{key:"css.textShadow.filter",type:"Boolean",className:"qx.bom.client.Css",method:"getFilterTextShadow"},"css.alphaimageloaderneeded":{key:"css.alphaimageloaderneeded",type:"Boolean",className:"qx.bom.client.Css",method:"getAlphaImageLoaderNeeded"},"css.pointerevents":{key:"css.pointerevents",type:"Boolean",className:"qx.bom.client.Css",method:"getPointerEvents"},"css.flexboxSyntax":{key:"css.flexboxSyntax",type:"String or null",className:"qx.bom.client.Css",method:"getFlexboxSyntax"},"device.name":{key:"device.name",type:"String",className:"qx.bom.client.Device",method:"getName"},"device.type":{key:"device.type",type:"String",className:"qx.bom.client.Device",method:"getType"},"device.pixelRatio":{key:"device.pixelRatio",type:"Number",className:"qx.bom.client.Device",method:"getDevicePixelRatio"},"device.touch":{key:"device.touch",type:"String",className:"qx.bom.client.Device",method:"getTouch"},"ecmascript.error.stacktrace":{key:"ecmascript.error.stacktrace",type:"String or null",className:"qx.bom.client.EcmaScript",method:"getStackTrace"},"ecmascript.mutationobserver":{key:"ecmascript.mutationobserver",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getMutationObserver"},"ecmascript.array.indexof":{key:"ecmascript.array.indexof",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayIndexOf"},"ecmascript.array.lastindexof":{key:"ecmascript.array.lastindexof",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayLastIndexOf"},"ecmascript.array.foreach":{key:"ecmascript.array.foreach",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayForEach"},"ecmascript.array.filter":{key:"ecmascript.array.filter",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayFilter"},"ecmascript.array.map":{key:"ecmascript.array.map",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayMap"},"ecmascript.array.some":{key:"ecmascript.array.some",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArraySome"},"ecmascript.array.find":{key:"ecmascript.array.find",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayFind"},"ecmascript.array.findIndex":{key:"ecmascript.array.findIndex",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayFindIndex"},"ecmascript.array.every":{key:"ecmascript.array.every",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayEvery"},"ecmascript.array.reduce":{key:"ecmascript.array.reduce",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayReduce"},"ecmascript.array.reduceright":{key:"ecmascript.array.reduceright",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getArrayReduceRight"},"ecmascript.function.bind":{key:"ecmascript.function.bind",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getFunctionBind"},"ecmascript.object.keys":{key:"ecmascript.object.keys",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getObjectKeys"},"ecmascript.date.now":{key:"ecmascript.date.now",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getDateNow"},"ecmascript.date.parse":{key:"ecmascript.date.parse",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getDateParse"},"ecmascript.error.toString":{key:"ecmascript.error.toString",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getErrorToString"},"ecmascript.string.trim":{key:"ecmascript.string.trim",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getStringTrim"},"ecmascript.string.startsWith":{key:"ecmascript.string.startsWith",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getStringStartsWith"},"ecmascript.string.endsWith":{key:"ecmascript.string.endsWith",type:"Boolean",className:"qx.bom.client.EcmaScript",method:"getStringEndsWith"},"engine.name":{key:"engine.name",type:"String",className:"qx.bom.client.Engine",method:"getName"},"engine.version":{key:"engine.version",type:"String",className:"qx.bom.client.Engine",method:"getVersion"},"event.mspointer":{key:"event.mspointer",type:"Boolean",className:"qx.bom.client.Event",method:"getMsPointer"},"event.touch":{key:"event.touch",type:"Boolean",className:"qx.bom.client.Event",method:"getTouch"},"event.help":{key:"event.help",type:"Boolean",className:"qx.bom.client.Event",method:"getHelp"},"event.hashchange":{key:"event.hashchange",type:"Boolean",className:"qx.bom.client.Event",method:"getHashChange"},"event.dispatchevent":{key:"event.dispatchevent",type:"Boolean",className:"qx.bom.client.Event",method:"getDispatchEvent"},"event.customevent":{key:"event.customevent",type:"Boolean",className:"qx.bom.client.Event",method:"getCustomEvent"},"event.mouseevent":{key:"event.mouseevent",type:"Boolean",className:"qx.bom.client.Event",method:"getMouseEvent"},"event.mousecreateevent":{key:"event.mousecreateevent",type:"String",className:"qx.bom.client.Event",method:"getMouseCreateEvent"},"event.mousewheel":{key:"event.mousewheel",type:"Map",className:"qx.bom.client.Event",method:"getMouseWheel"},"event.auxclick":{key:"event.auxclick",type:"Boolean",className:"qx.bom.client.Event",method:"getAuxclickEvent"},"html.audio":{key:"html.audio",type:"Boolean",className:"qx.bom.client.Html",method:"getAudio"},"html.audio.mp3":{key:"html.audio.mp3",type:"String",className:"qx.bom.client.Html",method:"getAudioMp3"},"html.audio.ogg":{key:"html.audio.ogg",type:"String",className:"qx.bom.client.Html",method:"getAudioOgg"},"html.audio.wav":{key:"html.audio.wav",type:"String",className:"qx.bom.client.Html",method:"getAudioWav"},"html.audio.au":{key:"html.audio.au",type:"String",className:"qx.bom.client.Html",method:"getAudioAu"},"html.audio.aif":{key:"html.audio.aif",type:"String",className:"qx.bom.client.Html",method:"getAudioAif"},"html.canvas":{key:"html.canvas",type:"Boolean",className:"qx.bom.client.Html",method:"getCanvas"},"html.classlist":{key:"html.classlist",type:"Boolean",className:"qx.bom.client.Html",method:"getClassList"},"html.fullscreen":{key:"html.fullscreen",type:"Boolean",className:"qx.bom.client.Html",method:"getFullScreen"},"html.geolocation":{key:"html.geolocation",type:"Boolean",className:"qx.bom.client.Html",method:"getGeoLocation"},"html.storage.local":{key:"html.storage.local",type:"Boolean",className:"qx.bom.client.Html",method:"getLocalStorage"},"html.storage.session":{key:"html.storage.session",type:"Boolean",className:"qx.bom.client.Html",method:"getSessionStorage"},"html.storage.userdata":{key:"html.storage.userdata",type:"Boolean",className:"qx.bom.client.Html",method:"getUserDataStorage"},"html.svg":{key:"html.svg",type:"Boolean",className:"qx.bom.client.Html",method:"getSvg"},"html.video":{key:"html.video",type:"Boolean",className:"qx.bom.client.Html",method:"getVideo"},"html.video.h264":{key:"html.video.h264",type:"String",className:"qx.bom.client.Html",method:"getVideoH264"},"html.video.ogg":{key:"html.video.ogg",type:"String",className:"qx.bom.client.Html",method:"getVideoOgg"},"html.video.webm":{key:"html.video.webm",type:"String",className:"qx.bom.client.Html",method:"getVideoWebm"},"html.vml":{key:"html.vml",type:"Boolean",className:"qx.bom.client.Html",method:"getVml"},"html.webworker":{key:"html.webworker",type:"Boolean",className:"qx.bom.client.Html",method:"getWebWorker"},"html.filereader":{key:"html.filereader",type:"Boolean",className:"qx.bom.client.Html",method:"getFileReader"},"html.xpath":{key:"html.xpath",type:"Boolean",className:"qx.bom.client.Html",method:"getXPath"},"html.xul":{key:"html.xul",type:"Boolean",className:"qx.bom.client.Html",method:"getXul"},"html.console":{key:"html.console",type:"Boolean",className:"qx.bom.client.Html",method:"getConsole"},"html.element.contains":{key:"html.element.contains",type:"Boolean",className:"qx.bom.client.Html",method:"getContains"},"html.element.compareDocumentPosition":{key:"html.element.compareDocumentPosition",type:"Boolean",className:"qx.bom.client.Html",method:"getCompareDocumentPosition"},"html.element.textContent":{key:"html.element.textContent",type:"Boolean",className:"qx.bom.client.Html",method:"getTextContent"},"html.image.naturaldimensions":{key:"html.image.naturaldimensions",type:"Boolean",className:"qx.bom.client.Html",method:"getNaturalDimensions"},"html.history.state":{key:"html.history.state",type:"Boolean",className:"qx.bom.client.Html",method:"getHistoryState"},"html.selection":{key:"html.selection",type:"String",className:"qx.bom.client.Html",method:"getSelection"},"html.node.isequalnode":{key:"html.node.isequalnode",type:"Boolean",className:"qx.bom.client.Html",method:"getIsEqualNode"},"xml.implementation":{key:"xml.implementation",type:"Boolean",className:"qx.bom.client.Xml",method:"getImplementation"},"xml.domparser":{key:"xml.domparser",type:"Boolean",className:"qx.bom.client.Xml",method:"getDomParser"},"xml.selectsinglenode":{key:"xml.selectsinglenode",type:"Boolean",className:"qx.bom.client.Xml",method:"getSelectSingleNode"},"xml.selectnodes":{key:"xml.selectnodes",type:"Boolean",className:"qx.bom.client.Xml",method:"getSelectNodes"},"xml.getelementsbytagnamens":{key:"xml.getelementsbytagnamens",type:"Boolean",className:"qx.bom.client.Xml",method:"getElementsByTagNameNS"},"xml.domproperties":{key:"xml.domproperties",type:"Boolean",className:"qx.bom.client.Xml",method:"getDomProperties"},"xml.attributens":{key:"xml.attributens",type:"Boolean",className:"qx.bom.client.Xml",method:"getAttributeNS"},"xml.createelementns":{key:"xml.createelementns",type:"Boolean",className:"qx.bom.client.Xml",method:"getCreateElementNS"},"xml.createnode":{key:"xml.createnode",type:"Boolean",className:"qx.bom.client.Xml",method:"getCreateNode"},"xml.getqualifieditem":{key:"xml.getqualifieditem",type:"Boolean",className:"qx.bom.client.Xml",method:"getQualifiedItem"},"html.stylesheet.createstylesheet":{key:"html.stylesheet.createstylesheet",type:"Boolean",className:"qx.bom.client.Stylesheet",method:"getCreateStyleSheet"},"html.stylesheet.insertrule":{key:"html.stylesheet.insertrule",type:"Boolean",className:"qx.bom.client.Stylesheet",method:"getInsertRule"},"html.stylesheet.deleterule":{key:"html.stylesheet.deleterule",type:"Boolean",className:"qx.bom.client.Stylesheet",method:"getDeleteRule"},"html.stylesheet.addimport":{key:"html.stylesheet.addimport",type:"Boolean",className:"qx.bom.client.Stylesheet",method:"getAddImport"},"html.stylesheet.removeimport":{key:"html.stylesheet.removeimport",type:"Boolean",className:"qx.bom.client.Stylesheet",method:"getRemoveImport"},"io.maxrequests":{key:"io.maxrequests",type:"Integer",className:"qx.bom.client.Transport",method:"getMaxConcurrentRequestCount"},"io.ssl":{key:"io.ssl",type:"Boolean",className:"qx.bom.client.Transport",method:"getSsl"},"io.xhr":{key:"io.xhr",type:"String",className:"qx.bom.client.Transport",method:"getXmlHttpRequest"},locale:{key:"locale",type:"String",className:"qx.bom.client.Locale",method:"getLocale"},"locale.variant":{key:"locale.variant",type:"String",className:"qx.bom.client.Locale",method:"getVariant"},"locale.default":{key:"locale.default",type:"String",className:"qx.bom.client.Locale",method:null},"os.name":{key:"os.name",type:"String",className:"qx.bom.client.OperatingSystem",method:"getName"},"os.version":{key:"os.version",type:"String",className:"qx.bom.client.OperatingSystem",method:"getVersion"},"os.scrollBarOverlayed":{key:"os.scrollBarOverlayed",type:"Boolean",className:"qx.bom.client.Scroll",method:"scrollBarOverlayed"},phonegap:{key:"phonegap",type:"Boolean",className:"qx.bom.client.PhoneGap",method:"getPhoneGap"},"phonegap.notification":{key:"phonegap.notification",type:"Boolean",className:"qx.bom.client.PhoneGap",method:"getNotification"},"plugin.divx":{key:"plugin.divx",type:"Boolean",className:"qx.bom.client.Plugin",method:"getDivX"},"plugin.divx.version":{key:"plugin.divx.version",type:"String",className:"qx.bom.client.Plugin",method:"getDivXVersion"},"plugin.flash":{key:"plugin.flash",type:"Boolean",className:"qx.bom.client.Flash",method:"isAvailable"},"plugin.flash.express":{key:"plugin.flash.express",type:"Boolean",className:"qx.bom.client.Flash",method:"getExpressInstall"},"plugin.flash.strictsecurity":{key:"plugin.flash.strictsecurity",type:"Boolean",className:"qx.bom.client.Flash",method:"getStrictSecurityModel"},"plugin.flash.version":{key:"plugin.flash.version",type:"String",className:"qx.bom.client.Flash",method:"getVersion"},"plugin.gears":{key:"plugin.gears",type:"Boolean",className:"qx.bom.client.Plugin",method:"getGears"},"plugin.activex":{key:"plugin.activex",type:"Boolean",className:"qx.bom.client.Plugin",method:"getActiveX"},"plugin.skype":{key:"plugin.skype",type:"Boolean",className:"qx.bom.client.Plugin",method:"getSkype"},"plugin.pdf":{key:"plugin.pdf",type:"Boolean",className:"qx.bom.client.Plugin",method:"getPdf"},"plugin.pdf.version":{key:"plugin.pdf.version",type:"String",className:"qx.bom.client.Plugin",method:"getPdfVersion"},"plugin.quicktime":{key:"plugin.quicktime",type:"Boolean",className:"qx.bom.client.Plugin",method:"getQuicktime"},"plugin.quicktime.version":{key:"plugin.quicktime.version",type:"String",className:"qx.bom.client.Plugin",method:"getQuicktimeVersion"},"plugin.silverlight":{key:"plugin.silverlight",type:"Boolean",className:"qx.bom.client.Plugin",method:"getSilverlight"},"plugin.silverlight.version":{key:"plugin.silverlight.version",type:"String",className:"qx.bom.client.Plugin",method:"getSilverlightVersion"},"plugin.windowsmedia":{key:"plugin.windowsmedia",type:"Boolean",className:"qx.bom.client.Plugin",method:"getWindowsMedia"},"plugin.windowsmedia.version":{key:"plugin.windowsmedia.version",type:"String",className:"qx.bom.client.Plugin",method:"getWindowsMediaVersion"},"qx.allowUrlSettings":{key:"qx.allowUrlSettings",type:"Boolean",default:"false"},"qx.allowUrlVariants":{key:"qx.allowUrlVariants",type:"Boolean",default:"false"},"qx.application":{key:"qx.application",type:"String"},"qx.aspects":{key:"qx.aspects",type:"Boolean",default:"false"},"qx.debug":{key:"qx.debug",type:"Boolean",default:"true"},"qx.debug.databinding":{key:"qx.debug.databinding",type:"Boolean",default:"false"},"qx.debug.dispose":{key:"qx.debug.dispose",type:"Boolean",default:"false"},"qx.debug.dispose.level":{key:"qx.debug.dispose.level",type:"Integer",default:"0"},"qx.debug.io":{key:"qx.debug.io",type:"Boolean",default:"false"},"qx.debug.io.remote":{key:"qx.debug.io.remote",type:"Boolean",default:"false"},"qx.debug.io.remote.data":{key:"qx.debug.io.remote.data",type:"Boolean",default:"false"},"qx.debug.property.level":{key:"qx.debug.property.level",type:"Integer",default:"0"},"qx.debug.ui.queue":{key:"qx.debug.ui.queue",type:"Boolean",default:"true"},"qx.dynlocale":{key:"qx.dynlocale",type:"Boolean",default:"true"},"qx.dyntheme":{key:"qx.dyntheme",type:"Boolean",default:"true"},"qx.globalErrorHandling":{key:"qx.globalErrorHandling",type:"Boolean",className:"qx.event.GlobalError",method:null,default:"true {@link qx.event.GlobalError}"},"qx.mobile.nativescroll":{key:"qx.mobile.nativescroll",type:"Boolean",className:"qx.bom.client.Scroll",method:"getNativeScroll"},"qx.promise.warnings":{key:"qx.promise.warnings",type:"Boolean",className:"qx.Promise",method:null},"qx.promise.longStackTraces":{key:"qx.promise.longStackTraces",type:"Boolean",className:"qx.Promise",method:null},"qx.optimization.basecalls":{key:"qx.optimization.basecalls",type:"Boolean"},"qx.optimization.comments":{key:"qx.optimization.comments",type:"Boolean"},"qx.optimization.privates":{key:"qx.optimization.privates",type:"Boolean"},"qx.optimization.strings":{key:"qx.optimization.strings",type:"Boolean"},"qx.optimization.variables":{key:"qx.optimization.variables",type:"Boolean"},"qx.optimization.variants":{key:"qx.optimization.variants",type:"Boolean"},"qx.revision":{key:"qx.revision",type:"String"},"qx.theme":{key:"qx.theme",type:"String"},"qx.version":{key:"qx.version",type:"String"},"qx.blankpage":{key:"qx.blankpage",type:"String"},"module.databinding":{key:"module.databinding",type:"Boolean",default:"true"},"module.logger":{key:"module.logger",type:"Boolean",default:"true"},"module.property":{key:"module.property",type:"Boolean",default:"true"},"module.events":{key:"module.events",type:"Boolean",default:"true"},"html.dataurl":{key:"html.dataurl",type:"Boolean",className:"qx.bom.client.Html",method:"getDataUrl"},"plugin.pdfjs":{key:"plugin.pdfjs",type:"Boolean",className:"qx.bom.client.Pdfjs",method:"getPdfjs"}}}});module.exports=qx.tool.compiler.ClassFile;qx.tool.compiler.ClassFile.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.Target":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./Target");module.exports=qx.Class.define("qx.tool.compiler.targets.SourceTarget",{extend:qx.tool.compiler.targets.Target,properties:{copyResources:{check:"Boolean",init:!0}},members:{_writeApplication:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getCopyResources()){e.next=3;break}e.next=3;return t.syncAssets();case 3:e.next=5;return qx.tool.compiler.targets.SourceTarget.prototype._writeApplication.base.call(this,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),toString:function(){return"Source Target: "+this.getOutputDir()}}});qx.tool.compiler.targets.SourceTarget.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs"),r=require("path"),n=require("tmp"),o=require("http"),a=require("fontkit"),i=require("../util").createLog("font");qx.Class.define("qx.tool.compiler.app.WebFont",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_225_0=e},properties:{name:{check:"String"},defaultSize:{check:"Integer",init:40},mapping:{init:null,nullable:!0,check:"String"},comparisonString:{init:null,nullable:!0,check:"String"},resources:{check:"Array"}},members:{__P_225_0:null,__P_225_1:null,_loadLocalFont:function(e){var t=this;return new Promise(function(n,o){var a=r.join(t.__P_225_0.getRootDir(),r.join(t.__P_225_0.getResourcePath(),e));t.__P_225_2(a,n,o)})},_loadRemoteFont:function(e){return new Promise(function(r,a){o.get(e,function(e){var o,i=e.statusCode,s=e.headers["content-type"];200!==i?o=new Error("Request Failed.\nStatus Code: ".concat(i)):/^font\/(ttf|svg|eot|woff|woff2)$/.test(s)||(o=new Error("Invalid content-type.\n"+"Expected font/ttf, font/svg, font/eot, font/woff or font/woff2 but received ".concat(s)));if(o){e.resume();a(o)}else n.tmpName(function(n,o){if(n)a(n);else{var i=t.createWriteStream(o);i.on("close",function(){this.__P_225_2(o,r,a);t.unlink(o)}.bind(this));e.on("data",function(e){i.write(e)});e.on("end",function(){i.end()})}}.bind(this))}.bind(this)).on("error",function(e){a(e)})}.bind(this))},__P_225_2:function(e,n,o){a.open(e,null,function(e,a){var s=this;if(e)o(e);else{var c={};if(this.getMapping()){var l=r.join(this.__P_225_0.getRootDir(),r.join(this.__P_225_0.getResourcePath(),this.getMapping()));t.readFile(l,{encoding:"utf-8"},function(e,t){if(e){i.error("Cannot read mapping file '".concat(l,"': ").concat(e.code));o(e)}else{var r=JSON.parse(t);Object.keys(r).forEach(function(e){var t=parseInt(r[e],16),n=a.glyphForCodePoint(t);n.id?c["@"+s.getName()+"/"+e]=[Math.ceil(s.getDefaultSize()*n.advanceWidth/n.advanceHeight),s.getDefaultSize(),t]:qx.tool.compiler.Console.log("WARN: no glyph found for ".concat(a," ").concat(e,": ").concat(t))},s);n(c)}})}else{var u={},p=a.GSUB.lookupList.toArray();a.GSUB.featureList[0].feature.lookupListIndexes.forEach(function(e){var t=p[e].subTables[0],r=[];t.coverage.rangeRecords.forEach(function(e){for(var t=e.start;t<=e.end;t++){var n=a.stringsForGlyph(t)[0];r.push(n)}});t.ligatureSets.toArray().forEach(function(e,t){var n=r[t];e.forEach(function(e){var t=a.stringsForGlyph(e.glyph)[0];if(t){var r=n+e.components.map(function(e){return a.stringsForGlyph(e)[0]}).join("");u[t.charCodeAt(0).toString(16)]=r}})})});a.characterSet.forEach(function(e){var t=a.glyphForCodePoint(e),r=t.name||u[e.toString(16)];r&&(t.path.commands.length>0||t.layers)&&(c["@"+s.getName()+"/"+r]=[Math.ceil(s.getDefaultSize()*t.advanceWidth/t.advanceHeight),s.getDefaultSize(),e])},this);n(c)}}}.bind(this))},getBootstrapCode:function(e,t,r){var n="";r&&(n="qx.$$fontBootstrap={};\n");var o={size:this.getDefaultSize(),lineHeight:1,family:[this.getName()],sources:[{family:this.getName(),source:this.getResources()}]};this.getComparisonString()&&(o.comparisonString=this.getComparisonString());return n+"qx.$$fontBootstrap['"+this.getName()+"']="+JSON.stringify(o)+";"},generateForTarget:function(e){var t=this;return new Promise(function(e,r){var n,o=_createForOfIteratorHelper(t.getResources());try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a.match(/^.*[/\\]([^/\\\?#]+).*$/)[1].match(/\.(ttf|otf|woff|woff2)$/)){if(a.match(/^https?:\/\//)){t._loadRemoteFont(a).then(function(r){t.__P_225_1=r;e()}).catch(function(e){r(e)});return}t._loadLocalFont(a).then(function(r){t.__P_225_1=r;e()}).catch(function(e){r(e)});return}}}catch(e){o.e(e)}finally{o.f()}r("Failed to load/validate FontMap for webfont (expected ttf, otf, woff or woff2) ".concat(t.getName()))})},generateForApplication:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.__P_225_1||null);case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),toString:function(){var e=this.getName();e||(e=JSON.stringify(this.getResources()));return e}}});qx.tool.compiler.app.WebFont.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.utils.Values",{statics:{binaryIndexOf:function(e,t){for(var r,n,o=0,a=e.length-1;o<=a;)if((n=e[r=(o+a)/2|0])<t)o=r+1;else{if(!(n>t))return r;a=r-1}return-1},binaryStartsWith:function(e,t){for(var r,n,o=0,a=e.length-1;o<=a;){if((n=e[r=(o+a)/2|0]).startsWith(t)){for(;r>0&&e[r-1].startsWith(t);)r--;return r}n<t?o=r+1:n>t&&(a=r-1)}return-1},merge:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r&&r.forEach(function(t){for(var r in t)e[r]=t[r]});return e}}});qx.tool.utils.Values.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.IndexedArray":{},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("path");require("@qooxdoo/framework");var r=require("fs"),n=require("../util"),o=require("jsonlint"),a=n.promisify(r.readFile);require("./SourceTarget");qx.Class.define("qx.tool.compiler.targets.TypeScriptWriter",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_236_0=e},properties:{outputTo:{init:"qooxdoo.d.ts",check:"String"}},members:{__P_236_1:"    ",__P_236_2:null,__P_236_3:null,__P_236_0:null,__P_236_4:null,__dirname:null,__P_236_5:null,run:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_236_4={};e.next=3;return new Promise(function(e,a){var i=new Date;o.__P_236_2=r.createWriteStream(t.join(o.__P_236_0.getOutputDir(),o.getOutputTo()));o.write("// Generated declaration file at ".concat(i,"\n"));o.writeBase().then(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=o.__P_236_0.getAnalyser();o.__P_236_3=new qx.tool.utils.IndexedArray;n?n.getDependencies().forEach(function(e){"q"!=e&&"qxWeb"!=e&&o.__P_236_3.push(e)}):t.getLibraries().forEach(function(e){var t=e.getKnownSymbols();for(var r in t){"class"===t[r]&&"q"!==r&&"qxWeb"!==r&&o.__P_236_3.push(r)}});o.__P_236_3.sort();r=null;a=0;i=function e(){if(!(a>=o.__P_236_3.getLength())){var t=o.__P_236_3.getItem(a++),n=t.lastIndexOf("."),i="";n>-1&&(i=t.substring(0,n));if(r!=i){null!==r&&o.write("}\n");i?o.write("declare module "+i+" {\n"):o.write("declare {\n");r=i}return o.loadAPIFile(t).then(function(e){return o.writeClass(e)}).then(function(){return e()}).catch(function(e){return o.error("Error while processing file: "+t+" error: "+e.stack)})}};return e.abrupt("return",i().then(function(){return o.write("}\n")}).then(function(){return o.__P_236_2.end()}));case 8:case"end":return e.stop()}},e)}))).then(e).catch(a)});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),write:function(e){this.__P_236_2.write(e)},loadAPIFile:function(e){var r=this;if("Object"===e||"Array"===e||"Error"===e)return null;if(this.__P_236_4[e])return Promise.resolve(this.__P_236_4[e]);var n=t.join(this.__P_236_0.getOutputDir(),"transpiled",e.replace(/\./g,"/")+".json");return a(n,"UTF-8").then(function(t){return r.__P_236_4[e]=o.parse(t)}).catch(function(t){return r.error("Error parsing "+e+": "+t.stack)})},writeBase:function(){var e=this;return a(t.join(__dirname,"TypeScriptWriter-base_declaration.txt"),"UTF-8").then(function(t){return e.write(t)})},getType:function(e){if(!e||"[[ Function ]]"==e)return"any";"object"==_typeof(e)&&(e=e.name);var t=qx.tool.compiler.targets.TypeScriptWriter.TYPE_MAPPINGS[e];return t||(this.__P_236_3.contains(e)?e:"any")},writeConstructor:function(e){this.write(this.__P_236_1+"constructor ("+this.serializeParameters(e,!0)+");\n")},writeMethods:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&Object.keys(e).length){var o=qx.tool.compiler.targets.TypeScriptWriter.IGNORE[this.__P_236_5.className],a=n?"Statics":"Members";for(var i in e){var s=e[i];if("function"==s.type){var c=o&&o.indexOf(i)>-1,l="";a="";if(s.access){"protected"===s.access&&(l+="protected ");if("private"===s.access)continue}n&&(l+="static ");if("interface"!=t.type&&s.abstract){l+="abstract ";a+="Abstract "}s.mixin&&(a+="Mixin ");s.overriddenFrom&&(a+="Overridden from "+s.overriddenFrom+" ");l+=this.__P_236_6(i)+"(";l+=this.serializeParameters(s);l+=")";var u="void";if(s.jsdoc&&s.jsdoc["@return"]){var p=s.jsdoc["@return"][0];p&&p.type&&(u=this.getType(p.type))}l+=": "+u;a&&(a=" // "+a);if(s.jsdoc&&s.jsdoc["@description"]&&s.jsdoc["@description"][0]){this.write(this.__P_236_1+"/**\n");s.jsdoc["@description"][0].body.split("\n").forEach(function(e){r.write(r.__P_236_1+" * "+e+"\n")});this.write(this.__P_236_1+" */\n")}this.write(this.__P_236_1+(c?"// ":"")+l+";"+a+"\n")}}}},__P_236_6:function(e){return e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?e:'"'+e+'"'},serializeParameters:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="";if(e&&e.jsdoc){var o=e.jsdoc["@param"];o&&o.forEach(function(e,o){var a="any",i=e.paramName||"unnamed"+o,s=i;"varargs"==i&&(r=!0);if(e.optional||r){s+="?";r=!0}s+=": ";if(e.type){var c=null;qx.lang.Type.isArray(e.type)?1==e.type.length&&(c=e.type[0]):c=e.type;if(c){a=t.getType(c);c.dimensions&&(a+="[]")}}s+=a;o>0&&(n+=", ");n+=s})}return n},writeClass:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_236_5=t;r="";t.superClass&&"Object"!==t.superClass&&"Array"!==t.superClass&&"Error"!==t.superClass&&"any"!=(n=this.getType(t.superClass))&&(r=" extends "+n);o="class ";"interface"===t.type?o="interface ":t.abstract&&(o="abstract "+o);this.write("  // "+t.className+"\n");this.write("  "+o+t.name+r);t.interfaces&&t.interfaces.length&&this.write(" implements "+t.interfaces.join(", "));this.write(" {\n");"class"==t.type&&this.writeConstructor(t.construct);t.isSingleton&&this.writeMethods({getInstance:{type:"function",access:"public",jsdoc:{"@return":[{type:t.className}]}}},t,!0);this.writeMethods(t.statics,t,!0);this.writeMethods(t.members,t);this.write("\n  }\n");this.__P_236_5=null;case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),writeModule:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(r=t.packageName)?this.write("declare module "+r+" {\n"):this.write("declare ");e.next=4;return this.writeClass(t);case 4:r&&this.write("}\n");case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},statics:{IGNORE:{"qx.ui.virtual.core.CellEvent":["init"],"qx.ui.table.columnmodel.resizebehavior.Default":["set"],"qx.ui.progressive.renderer.table.Widths":["set"],"qx.ui.table.columnmodel.resizebehavior":["set"],"qx.ui.table.pane.CellEvent":["init"],"qx.ui.mobile.dialog.Manager":["error"],"qx.ui.mobile.container.Navigation":["add"],"qx.ui.website.Table":["filter","sort"],"qx.ui.website.DatePicker":["init","sort"],"qx.event.type.Orientation":["init"],"qx.event.type.KeySequence":["init"],"qx.event.type.KeyInput":["init"],"qx.event.type.GeoPosition":["init"],"qx.event.type.Drag":["init"],"qx.bom.request.SimpleXhr":["addListener","addListenerOnce"],"qx.event.dispatch.AbstractBubbling":["dispatchEvent"],"qx.event.dispatch.Direct":["dispatchEvent"],"qx.event.dispatch.MouseCapture":["dispatchEvent"],"qx.event.type.Native":["init"],"qx.html.Element":["removeListener","removeListenerById"],"qx.html.Flash":["setAttribute"],"qx.util.LibraryManager":["get","set"]},TYPE_MAPPINGS:{Widget:"qx.ui.core.Widget",LayoutItem:"qx.ui.core.LayoutItem",AbstractTreeItem:"qx.ui.tree.core.AbstractTreeItem",ILayer:"qx.ui.virtual.core.ILayer",Axis:"qx.ui.virtual.core.Axis",DateFormat:"qx.util.format.DateFormat",LocalizedString:"qx.locale.LocalizedString",Decorator:"qx.ui.decoration.Decorator",Event:"qx.event.type.Event",CanvasRenderingContext2D:"CanvasRenderingContext2D",MWidgetController:"qx.ui.list.core.MWidgetController",IDesktop:"qx.ui.window.IDesktop",IWindowManager:"qx.ui.window.IWindowManager",Pane:"qx.ui.virtual.core.Pane",Class:"qx.Class",Interface:"qx.Interface",Mixin:"qx.Mixin",Theme:"qx.Theme",Boolean:"boolean",String:"string",Color:"string",Font:"string",Function:"Function",Date:"Date",Window:"Window",Document:"Document",document:"Document",Stylesheet:"StyleSheet",Node:"Node","Custom check function":"Custom check function",Error:"ErrorImpl",Element:"HTMLElement",RegExp:"RegExp",var:"any",Array:"qx.data.Array",Object:"any",Map:"IMap",Integer:"number",Number:"number",Double:"number",Float:"number",PositiveInteger:"number",PositiveNumber:"number"}}});qx.tool.compiler.targets.TypeScriptWriter.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.Promisify":{},"qx.tool.compiler.targets.meta.Part":{},"qx.tool.compiler.targets.meta.Package":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.targets.meta.ApplicationMeta",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.__P_238_0=e;this.__P_238_1=t;this.__P_238_2=[];this.__P_238_3={urisBefore:[],cssBefore:[]};this.__P_238_4=[];this.__P_238_5={};this.__P_238_6=[];this.__P_238_7=[];this.__P_238_8={}},properties:{environment:{},appLibrary:{check:"qx.tool.compiler.app.Library"},bootMetaJs:{check:"qx.tool.compiler.targets.meta.IJavascriptMeta"},sourceUri:{check:"String"},resourceUri:{check:"String"}},members:{__P_238_0:null,__P_238_1:null,__P_238_2:null,__P_238_3:null,__P_238_4:null,__P_238_5:null,__P_238_6:null,__P_238_7:null,setEnvironmentValue:function(e,t){var r=this.getEnvironment();void 0===t?delete r[e]:r[e]=t},getEnvironmentValue:function(e,t){var r=this.getEnvironment(),n=r[e];if(void 0===n){void 0!==t&&(r[e]=t);n=t}return n},getApplication:function(){return this.__P_238_1},getTarget:function(){return this.__P_238_0},getApplicationRoot:function(){return this.__P_238_0.getApplicationRoot(this.__P_238_1)},getAnalyser:function(){return this.__P_238_1.getAnalyser()},syncAssets:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<e.__P_238_6.length)){t.next=8;break}n=e.__P_238_6[r];t.next=5;return qx.tool.utils.Promisify.poolEachOf(n.getAssets(),10,function(t){return t.sync(e.__P_238_0)});case 5:r++;t.next=1;break;case 8:case"end":return t.stop()}},t)}))()},addLibrary:function(e){this.__P_238_2.push(e)},getAppLibrary:function(){return this.__P_238_1.getAnalyser().getLibraryFromClassname(this.__P_238_1.getClassName())},getLibraries:function(){return this.__P_238_2},addExternal:function(e,t){this.__P_238_3[e].push("__external__:"+t)},addPreload:function(e,t){this.__P_238_3[e].push(t)},getPreloads:function(){return this.__P_238_3},addPreBootCode:function(e){this.__P_238_4.push(e)},getPreBootCode:function(){return this.__P_238_4.join("\n")},createPart:function(e){var t=new qx.tool.compiler.targets.meta.Part(this.getTarget(),e,this.__P_238_7.length);this.__P_238_7.push(t);this.__P_238_8[e]=t;return t},getParts:function(){return this.__P_238_7},getPart:function(e){return this.__P_238_8[e]||null},getPackages:function(){return Object.values(this.__P_238_6)},createPackage:function(){var e=new qx.tool.compiler.targets.meta.Package(this,this.__P_238_6.length);this.__P_238_6.push(e);return e},getLocalePackage:function(e){var t=this.getPart(e);t||(t=this.createPart(e)).addPackage(this.createPackage());return t.getDefaultPackage()},addResource:function(e,t){this.__P_238_5[e]=t},getResources:function(){return this.__P_238_5}}});qx.tool.compiler.targets.meta.ApplicationMeta.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("source-map");qx.Class.define("qx.tool.compiler.targets.meta.AbstractJavascriptMeta",{extend:qx.core.Object,construct:function(e,t,r){qx.core.Object.constructor.call(this);this._appMeta=e;this.__filename=t;this.__P_237_0=r},properties:{needsWriteToDisk:{init:!1,check:"Boolean"}},members:{_appMeta:null,__filename:null,__P_237_0:null,__P_237_1:null,getAppMeta:function(){return this._appMeta},getFilename:function(){return this.__filename},wrap:function(e){this.__P_237_1=e},getWrapper:function(){return this.__P_237_1},unwrap:function(){return this.__P_237_1?this.__P_237_1.unwrap():this},writeToDisk:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.isNeedsWriteToDisk()){r.next=11;break}(n=new qx.tool.utils.Utils.LineCountingTransform).pipe(t.createWriteStream(e.__filename,"utf8"));r.next=5;return new Promise(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.on("finish",r);t.next=3;return e.writeSourceCodeToStream(n);case 3:n.end();case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 5:r.next=7;return e.getSourceMap();case 7:if(!(o=r.sent)){r.next=11;break}r.next=11;return t.writeFileAsync(e.__filename+".map",JSON.stringify(o,null,2),"utf8");case 11:case"end":return r.stop()}},r)}))()},writeSourceCodeToStream:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("No implementation for ".concat(t.classname,".writeSourceCodeToStream"));case 1:case"end":return e.stop()}},e)}))()},getSourceMap:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e)}))()},_copySourceMap:function(e,t){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i,s,c;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:a=new r.SourceMapGenerator({file:n.getFilename()+".map"});i=regeneratorRuntime.mark(function o(i){var s,l,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:s=e[i];l=t[i];o.next=4;return s.getSourceMap();case 4:if(u=o.sent){(c=new r.SourceMapConsumer(u)).eachMapping(function(e){e={generated:{line:e.generatedLine+l,column:e.generatedColumn},original:{line:e.originalLine||1,column:e.originalColumn||1},source:e.source||s.getFilename()};a.addMapping(e)});n._appMeta.getTarget().getSaveSourceInMap&&n._appMeta.getTarget().getSaveSourceInMap()&&c.sources.forEach(function(e){return a.setSourceContent(e,c.sourceContentFor(e))})}case 6:case"end":return o.stop()}},o)});s=0;case 3:if(!(s<e.length)){o.next=8;break}return o.delegateYield(i(s),"t0",5);case 5:s++;o.next=3;break;case 8:return o.abrupt("return",JSON.parse(a.toString()));case 9:case"end":return o.stop()}},o)}))()}}});qx.tool.compiler.targets.meta.AbstractJavascriptMeta.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.meta.AbstractJavascriptMeta":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("upath");qx.Class.define("qx.tool.compiler.targets.meta.BootJs",{extend:qx.tool.compiler.targets.meta.AbstractJavascriptMeta,construct:function(e){qx.tool.compiler.targets.meta.AbstractJavascriptMeta.constructor.call(this,e,"".concat(e.getApplicationRoot(),"index.js"));this.__P_239_0=[];this.__P_239_1={}},properties:{needsWriteToDisk:{init:!0,refine:!0}},members:{__P_239_0:null,__P_239_2:null,addEmbeddedJs:function(e){if(!this.__P_239_1[e.toHashCode()]){this.__P_239_0.push(e);this.__P_239_1[e.toHashCode()]=e}},writeSourceCodeToStream:function(e){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function o(){var a,i,s,c,l,u,p,f,m,d,_,h,g,x;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:a=n._appMeta;i=a.getApplication();s=a.getTarget();c=a.getApplicationRoot();l={EnvSettings:a.getEnvironment(),Libraries:a.getLibraries().map(function(e){return e.getNamespace()}),SourceUri:a.getSourceUri(),ResourceUri:a.getResourceUri(),Resources:a.getResources(),Translations:{C:null},Locales:{C:null},Parts:{},Packages:{},UrisBefore:a.getPreloads().urisBefore,CssBefore:a.getPreloads().cssBefore,Boot:"boot",ClosureParts:{},BootIsInline:!1,NoCacheParam:!1,DecodeUrisPlug:void 0,BootPart:void 0,TranspiledPath:void 0,PreBootCode:a.getPreBootCode()};a.getParts().forEach(function(e){return e.serializeInto(l.Parts)});a.getPackages().forEach(function(e){return e.serializeInto(l.Packages)});"browser"!==i.getType()&&(l.TranspiledPath=r.relative(c,r.join(s.getOutputDir(),"transpiled")));a.getTarget().getLocales().forEach(function(e){l.Translations[e]=null;l.Locales[e]=null});n.__P_239_2=[];o.next=12;return t.readFileAsync(i.getLoaderTemplate(),{encoding:"utf-8"});case 12:u=o.sent;p=u.split("\n");f=0;case 15:if(!(f<p.length)){o.next=42;break}m=p[f];case 17:if(!(d=m.match(/\%\{([^}]+)\}/))){o.next=37;break}_=d[1];h="";if("BootPart"!=_){o.next=32;break}g=0;case 22:if(!(g<n.__P_239_0.length)){o.next=30;break}n.__P_239_2.push(e.getLineNumber());o.next=26;return n.__P_239_0[g].unwrap().writeSourceCodeToStream(e);case 26:e.write("\n");case 27:g++;o.next=22;break;case 30:o.next=33;break;case 32:void 0!==l[_]&&(h="PreBootCode"==_?l[_]:JSON.stringify(l[_],null,2));case 33:x=m.substring(0,d.index)+h+m.substring(d.index+_.length+3);m=x;o.next=17;break;case 37:m.match(/^\s*delayDefer:\s*false\b/)&&(m=m.replace(/false/,"true"));e.write(m+"\n");case 39:f++;o.next=15;break;case 42:case"end":return o.stop()}},o)}))()},getSourceMap:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var n,o,a,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==e.__P_239_2){t.next=2;break}throw new Error("Cannot get the source map for ".concat(e," until the stream has been written"));case 2:t.next=4;return e._copySourceMap(e.__P_239_0,e.__P_239_2);case 4:n=t.sent;o=e._appMeta.getTarget();for(a=0;a<n.sources.length;a++){n.sources[a]=r.relative("",n.sources[a]);i=o.getPathMapping(n.sources[a]);n.sources[a]=i||n.sources[a]}return t.abrupt("return",n);case 8:case"end":return t.stop()}},t)}))()}}});qx.tool.compiler.targets.meta.BootJs.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.meta.AbstractJavascriptMeta":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("upath");qx.Class.define("qx.tool.compiler.targets.meta.PolyfillJs",{extend:qx.tool.compiler.targets.meta.AbstractJavascriptMeta,construct:function(e){qx.tool.compiler.targets.meta.AbstractJavascriptMeta.constructor.call(this,e,"".concat(e.getApplicationRoot(),"polyfill.js"))},properties:{needsWriteToDisk:{init:!0,refine:!0}},members:{writeSourceCodeToStream:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=r.join(require.resolve("@babel/polyfill"),"../../dist/polyfill.js");a=t.createReadStream(o,"utf8");n.next=4;return new Promise(function(t,r){a.on("end",t);a.on("error",r);a.pipe(e,{end:!1})});case 4:case"end":return n.stop()}},n)}))()},getSourceMap:function(){return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e)}))()}}});qx.tool.compiler.targets.meta.PolyfillJs.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.meta.AbstractJavascriptMeta":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs;qx.Class.define("qx.tool.compiler.targets.meta.Javascript",{extend:qx.tool.compiler.targets.meta.AbstractJavascriptMeta,construct:function(e,t,r){qx.tool.compiler.targets.meta.AbstractJavascriptMeta.constructor.call(this,e,t,r)},members:{compile:function(){},writeSourceCodeToStream:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=t.createReadStream(r.getFilename(),"utf8");n.next=3;return new Promise(function(t,r){o.on("end",t);o.on("error",r);o.pipe(e,{end:!1})});case 3:case"end":return n.stop()}},n)}))()},getSourceMap:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.existsSync(e.getFilename()+".map")){r.next=2;break}return r.abrupt("return",null);case 2:r.next=4;return t.readFileAsync(e.getFilename()+".map","utf8");case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r)}))()}}});qx.tool.compiler.targets.meta.Javascript.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs"),r=require("path");require("@qooxdoo/framework");var n=require("xml2js"),o=require("../util"),a=(0,require("util").promisify)(t.readFile),i=o.createLog("cldr"),s=require("cldr");qx.Class.define("qx.tool.compiler.app.Cldr",{extend:qx.core.Object,statics:{getParentLocale:function(e){return s.resolveParentLocaleId(e.toLowerCase())},loadCLDR:function(e){var t=new n.Parser,s=r.dirname(require.resolve("cldr"));if(!s)throw new Error("Cannot find cldr path");i.debug("Loading CLDR "+s);return a(r.join(s,"../3rdparty/cldr/common/main",e+".xml"),{encoding:"utf-8"}).then(function(e){return o.promisifyThis(t.parseString,t,e)}).then(function(e){function t(e,t,r,n){if(!e)return null;for(var o=0;o<e.length;o++){var a=e[o];if(a.$&&a.$[t]==r)return"function"==typeof n?n(a):a}return null}function r(t,r){void 0===r&&(r=e);for(var n=t.split("."),o=0;o<n.length;o++){var a=n[o],i=a.indexOf("["),s=null;if(i>-1){s=a.substring(i+1,a.length-1);a=a.substring(0,i)}var c=r[a];if(!c)return null;if(null!==s){if(!qx.lang.Type.isArray(c))return null;if(void 0===(c=c[s]))return null}r=c}return r}function n(e,t){var n=r(e,t);return n&&"string"!=typeof n&&void 0!==n._?n._:n}var o=t(r("ldml.dates[0].calendars[0].calendar"),"type","gregorian"),a={};a.alternateQuotationEnd=r("ldml.delimiters[0].alternateQuotationEnd[0]");a.alternateQuotationStart=r("ldml.delimiters[0].alternateQuotationStart[0]");a.quotationEnd=r("ldml.delimiters[0].quotationEnd[0]");a.quotationStart=r("ldml.delimiters[0].quotationStart[0]");function i(e){return"string"==typeof e?e:e&&void 0!==e._?e._:""}function s(e){return e.dateFormat[0].pattern[0]}if(null!==o){var c=function(e){return e.timeFormat.pattern};t(r("dayPeriods[0].dayPeriodContext[0].dayPeriodWidth",o),"type","wide",function(e){a.cldr_am=t(e.dayPeriod,"type","am",i);a.cldr_pm=t(e.dayPeriod,"type","pm",i)});var l=r("dateFormats[0].dateFormatLength",o),u=r("dateTimeFormats[0].availableFormats[0].dateFormatItem",o);a.cldr_date_format_full=t(l,"type","full",s);a.cldr_date_format_long=t(l,"type","long",s);a.cldr_date_format_medium=t(l,"type","medium",s);a.cldr_date_format_short=t(l,"type","short",s);a.cldr_date_time_format_Ed=t(u,"id","Ed",i);a.cldr_date_time_format_Hm=t(u,"id","Hm",i);a.cldr_date_time_format_Hms=t(u,"id","Hms",i);a.cldr_date_time_format_M=t(u,"id","M",i);a.cldr_date_time_format_MEd=t(u,"id","MEd",i);a.cldr_date_time_format_MMM=t(u,"id","MMM",i);a.cldr_date_time_format_MMMEd=t(u,"id","MMMEd",i);a.cldr_date_time_format_MMMd=t(u,"id","MMMd",i);a.cldr_date_time_format_Md=t(u,"id","Md",i);a.cldr_date_time_format_d=t(u,"id","d",i);a.cldr_date_time_format_hm=t(u,"id","hm",i);a.cldr_date_time_format_hms=t(u,"id","hms",i);a.cldr_date_time_format_ms=t(u,"id","ms",i);a.cldr_date_time_format_y=t(u,"id","y",i);a.cldr_date_time_format_yM=t(u,"id","yM",i);a.cldr_date_time_format_yMEd=t(u,"id","yMEd",i);a.cldr_date_time_format_yMMM=t(u,"id","yMMM",i);a.cldr_date_time_format_yMMMEd=t(u,"id","yMMMEd",i);a.cldr_date_time_format_yMMMd=t(u,"id","yMMMd",i);a.cldr_date_time_format_yMd=t(u,"id","yMd",i);a.cldr_date_time_format_yQ=t(u,"id","yQ",i);a.cldr_date_time_format_yQQQ=t(u,"id","yQQQ",i);var p=r("days[0].dayContext",o);t(p,"type","format",function(e){t(e.dayWidth,"type","abbreviated",function(e){a.cldr_day_format_abbreviated_fri=t(e.day,"type","fri",i);a.cldr_day_format_abbreviated_mon=t(e.day,"type","mon",i);a.cldr_day_format_abbreviated_sat=t(e.day,"type","sat",i);a.cldr_day_format_abbreviated_sun=t(e.day,"type","sun",i);a.cldr_day_format_abbreviated_thu=t(e.day,"type","thu",i);a.cldr_day_format_abbreviated_tue=t(e.day,"type","tue",i);a.cldr_day_format_abbreviated_wed=t(e.day,"type","wed",i)})});t(p,"type","format",function(e){t(e.dayWidth,"type","wide",function(e){a.cldr_day_format_wide_fri=t(e.day,"type","fri",i);a.cldr_day_format_wide_mon=t(e.day,"type","mon",i);a.cldr_day_format_wide_sat=t(e.day,"type","sat",i);a.cldr_day_format_wide_sun=t(e.day,"type","sun",i);a.cldr_day_format_wide_thu=t(e.day,"type","thu",i);a.cldr_day_format_wide_tue=t(e.day,"type","tue",i);a.cldr_day_format_wide_wed=t(e.day,"type","wed",i)})});t(p,"type","stand-alone",function(e){a["cldr_day_stand-alone_narrow_fri"]=t(e.dayWidth[0].day,"type","fri",i);a["cldr_day_stand-alone_narrow_mon"]=t(e.dayWidth[0].day,"type","mon",i);a["cldr_day_stand-alone_narrow_sat"]=t(e.dayWidth[0].day,"type","sat",i);a["cldr_day_stand-alone_narrow_sun"]=t(e.dayWidth[0].day,"type","sun",i);a["cldr_day_stand-alone_narrow_thu"]=t(e.dayWidth[0].day,"type","thu",i);a["cldr_day_stand-alone_narrow_tue"]=t(e.dayWidth[0].day,"type","tue",i);a["cldr_day_stand-alone_narrow_wed"]=t(e.dayWidth[0].day,"type","wed",i)});var f=r("months[0].monthContext",o);t(f,"type","format",function(e){t(e.monthWidth,"type","abbreviated",function(e){for(var t=0;t<e.month.length;t++){var r=e.month[t];a["cldr_month_format_abbreviated_"+r.$.type]=i(r)}})});t(f,"type","format",function(e){t(e.monthWidth,"type","wide",function(e){for(var t=0;t<e.month.length;t++){var r=e.month[t];a["cldr_month_format_wide_"+r.$.type]=i(r)}})});t(f,"type","stand-alone",function(e){for(var t=0;t<e.monthWidth[0].month.length;t++){var r=e.monthWidth[0].month[t];a["cldr_month_stand-alone_narrow_"+r.$.type]=i(r)}});var m=r("timeFormats[0].timeFormatLength",o);a.cldr_time_format_full=t(m,"type","full",c);a.cldr_time_format_long=t(m,"type","long",c);a.cldr_time_format_medium=t(m,"type","medium",c);a.cldr_time_format_short=t(m,"type","short",c)}var d=i(r("ldml.numbers[0].defaultNumberingSystem[0]"));if(d)t(r("ldml.numbers[0].symbols"),"numberSystem",d,function(e){a.cldr_number_decimal_separator=e.decimal[0];a.cldr_number_group_separator=e.group[0]});else{a.cldr_number_decimal_separator=n("ldml.numbers[0].symbols[0].decimal[0]");a.cldr_number_group_separator=n("ldml.numbers[0].symbols[0].group[0]")}a.cldr_number_percent_format=n("ldml.numbers[0].percentFormats[0].percentFormatLength[0].percentFormat[0].pattern[0]");function _(e){return qx.lang.Type.isArray(e.displayName)?e.displayName.map(function(e){return i(e)}):i(e.displayName)}var h=r("ldml.dates[0].fields[0].field");a.day=t(h,"type","day",_);a.dayperiod=t(h,"type","dayperiod",_);a.era=t(h,"type","era",_);a.hour=t(h,"type","hour",_);a.minute=t(h,"type","minute",_);a.month=t(h,"type","month",_);a.second=t(h,"type","second",_);a.week=t(h,"type","week",_);a.weekday=t(h,"type","weekday",_);a.year=t(h,"type","year",_);a.zone=t(h,"type","zone",_);return a})}}});qx.tool.compiler.app.Cldr.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.meta.AbstractJavascriptMeta":{construct:!0,require:!0},"qx.tool.utils.Utils":{},"qx.tool.utils.files.Utils":{},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("upath"),n=require("uglify-es");qx.Class.define("qx.tool.compiler.targets.meta.Uglify",{extend:qx.tool.compiler.targets.meta.AbstractJavascriptMeta,construct:function(e,t){qx.tool.compiler.targets.meta.AbstractJavascriptMeta.constructor.call(this,e,t.getFilename());this.__P_243_0=t},properties:{needsWriteToDisk:{init:!0,refine:!0}},members:{__P_243_0:null,writeSourceCodeToStream:function(e){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var a,i,s,c,l,u,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a={compress:{sequences:!1}};e.t0=o._appMeta.getTarget().getMinify();e.next="off"===e.t0?4:"minify"===e.t0?5:"beautify"===e.t0?7:"mangle"===e.t0?10:12;break;case 4:return e.abrupt("return");case 5:a.mangle=!1;return e.abrupt("break",12);case 7:a.mangle=!1;a.output={beautify:!0};return e.abrupt("break",12);case 10:a.mangle=!0;return e.abrupt("break",12);case 12:i=o._appMeta.getApplication();s=o.__P_243_0.getFilename();c=r.basename(s);e.next=17;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=new qx.tool.utils.Utils.ToStringWriteStream;(r=new qx.tool.utils.Utils.LineCountingTransform).pipe(t);e.next=5;return new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.on("finish",t);e.next=3;return o.__P_243_0.writeSourceCodeToStream(r);case 3:r.end();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:return e.abrupt("return",t.toString());case 6:case"end":return e.stop()}},e)}))();case 17:l=e.sent;e.next=20;return qx.tool.utils.files.Utils.safeUnlink(s+".unminified");case 20:e.next=22;return qx.tool.utils.files.Utils.safeRename(s,s+".unminified");case 22:e.next=24;return o.__P_243_0.getSourceMap();case 24:u=e.sent;e.next=27;return qx.tool.utils.files.Utils.safeUnlink(s+".unminified.map");case 27:e.next=29;return qx.tool.utils.files.Utils.safeRename(s+".map",s+".unminified.map");case 29:o.fireDataEvent("minifyingApplication",{application:i,filename:c});a.sourceMap={content:u,url:c+".map",includeSources:!0};p=n.minify(l,a);if(!(f=p.error)){e.next=36;break}"SyntaxError"==f.name&&qx.tool.compiler.Console.print("qx.tool.compiler.build.uglifyParseError",f.line,f.col,f.message,c);throw new Error("UglifyJS failed to minimise");case 36:e.next=38;return t.writeFileAsync(s,p.code,{encoding:"utf8"});case 38:if(o._appMeta.getTarget().isSaveUnminified()){e.next=43;break}e.next=41;return qx.tool.utils.files.Utils.safeUnlink(s+".unminified");case 41:e.next=43;return qx.tool.utils.files.Utils.safeUnlink(s+".unminified.map");case 43:e.next=45;return t.writeFileAsync(s+".map",p.map,{encoding:"utf8"});case 45:o.fireDataEvent("minifiedApplication",{application:i,filename:c});case 46:case"end":return e.stop()}},e)}))()}}});qx.tool.compiler.targets.meta.Uglify.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.utils.IndexedArray",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);this.__P_245_0=[];this.__P_245_1={};this.__P_245_2=!1},properties:{keepSorted:{init:!1,nullable:!1,check:"Boolean"}},members:{__P_245_3:!1,__P_245_0:null,__P_245_1:null,__P_245_2:!1,push:function(e){if(void 0===this.__P_245_1[e]){this.__P_245_0.push(e);this.__P_245_1[e]=this.__P_245_0.length-1;this.__P_245_3=!0}},sort:function(e){var t=this;this.__P_245_0.sort(e);for(var r=this.__P_245_0,n=r.length,o=n-1;o>-1;o--)if(void 0!==r[o]){o<n-1&&r.splice(o+1);break}for(var a=this.__P_245_0,i=a.length,s=0;s<i;s++)if(void 0!==a[s]){s>0&&a.splice(0,s);break}this.__P_245_0.forEach(function(e,r){t.__P_245_1[e]=r});this.__P_245_3=!1},contains:function(e){return void 0!==this.__P_245_1[e]},remove:function(e){var t=this.__P_245_1[e];if(void 0!==t){delete this.__P_245_0[t];delete this.__P_245_1[e];this.__P_245_2=!0}},pop:function(){if(0!=this.__P_245_0.length){this.__P_245_3&&this.isKeepSorted()&&this.sort();do{var e=this.__P_245_0.pop();if(void 0!==e){delete this.__P_245_1[e];return e}}while(this.__P_245_0.length>0)}},shift:function(){if(0!=this.__P_245_0.length){this.__P_245_3&&this.isKeepSorted()&&this.sort();do{var e=this.__P_245_0.shift();if(void 0!==e){delete this.__P_245_1[e];return e}}while(this.__P_245_0.length>0)}},getLength:function(){return this.__P_245_0.length},getItem:function(e){this.__P_245_3&&this.isKeepSorted()&&this.sort();return this.__P_245_0[e]},isEmpty:function(){return this.__P_245_0.length>0},toArray:function(){this.__P_245_3&&this.isKeepSorted()&&this.sort();if(this.__P_245_2){var e=[];this.__P_245_0.forEach(function(t){t&&e.push(t)});return e}return this.__P_245_0.slice()},toObject:function(){this.__P_245_3&&this.isKeepSorted()&&this.sort();var e={};this.__P_245_0.forEach(function(t){e[t]=!0});return e}}});qx.tool.utils.IndexedArray.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.jsdoc.CommandParser",{extend:qx.core.Object,type:"abstract",members:{parseCommand:function(e,t,r){throw new Error("No implementation for "+this.classname+".parseCommand")},resolveType:function(e,t,r){if(e){var n=e.indexOf(".");if(n<0&&(n=t.lastIndexOf("."))>-1){var o=t.substring(0,n+1);if(r){if(r.getCachedClassInfo(o+e))return o+e}}}return e}}});qx.tool.compiler.jsdoc.CommandParser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.CommandParser":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./CommandParser");qx.Class.define("qx.tool.compiler.jsdoc.ParamParser",{extend:qx.tool.compiler.jsdoc.CommandParser,members:{parseCommand:function(e,t,r){var n,o=e.body.match(/^([\S]+)(\s+\{([^}]+)\}([\s\S]+))??$/);if(o){e.paramName=o[1].trim();n=this.resolveType((o[3]||"").trim(),t,r);e.description=o[4]}else if(o=e.body.match(/^(\{([^}]+)\}([\s]+))(\S+)(\s+[\s\S]*)$/)){e.paramName=o[4].trim();n=this.resolveType((o[2]||"").trim(),t,r);e.description=o[5].trim()}if(o){var a=n.indexOf("?");if(a>-1){e.optional=!0;var i=n.substring(a+1).trim();i&&(e.defaultValue=i);n=n.substring(0,a).trim()}var s=n.split("|");s.length>1&&(n=s.map(function(e){var t,r=(e=e.trim()).indexOf("[]");if(r>-1){var n=e.substring(r);t={type:e.substring(0,r)};var o=1;r=0;for(;n.length&&"[]"==n.substring(r,2);){r+=2;o++}t.dimensions=o}else t=e;return t}));e.type=n}else{delete e.paramName;delete e.type;delete e.description}}}});qx.tool.compiler.jsdoc.ParamParser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.CommandParser":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./CommandParser");qx.Class.define("qx.tool.compiler.jsdoc.ReturnParser",{extend:qx.tool.compiler.jsdoc.CommandParser,members:{parseCommand:function(e,t,r){var n=e.body.match(/^(\{([^}]+)\}([\s\S]+)?)?$/);if(n){e.type=this.resolveType((n[2]||"").trim(),t,r);e.description=n[3]||""}else{delete e.type;delete e.description}}}});qx.tool.compiler.jsdoc.ReturnParser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.CommandParser":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./CommandParser");qx.Class.define("qx.tool.compiler.jsdoc.ThrowsParser",{extend:qx.tool.compiler.jsdoc.CommandParser,members:{parseCommand:function(e,t,r){var n=e.body.match(/^(\{([^}]+)\}([\s\S]+)?)?$/);if(n){e.type=this.resolveType((n[2]||"").trim(),t,r);e.description=n[3]||""}else{delete e.type;delete e.description}}}});qx.tool.compiler.jsdoc.ThrowsParser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.CommandParser":{require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./CommandParser");qx.Class.define("qx.tool.compiler.jsdoc.ChildControlParser",{extend:qx.tool.compiler.jsdoc.CommandParser,members:{parseCommand:function(e,t,r){var n=e.body.match(/^([\S]+)(\s+\{([^}]+)\}([\s\S]+))??$/);if(n){e.controlName=n[1].trim();var o=this.resolveType((n[3]||"").trim(),t,r);e.description=(n[4]||"").trim();e.type=o}else{delete e.controlName;delete e.type;delete e.description}}}});qx.tool.compiler.jsdoc.ChildControlParser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.compiler.jsdoc.ParamParser":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.ReturnParser":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.ThrowsParser":{usage:"dynamic",require:!0},"qx.tool.compiler.jsdoc.ChildControlParser":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./ChildControlParser");require("./ParamParser");require("./ReturnParser");require("./ThrowsParser");var t=require("showdown");qx.Class.define("qx.tool.compiler.jsdoc.Parser",{extend:qx.core.Object,statics:{parseComment:function(e){var r={name:"@description",body:""},n=[r];(e=(e=(e=(e=(e=(e=(e=e.replace(/@([^@}\n\r]*)@/g,"<code>$1</code>")).replace(/^[ \t]*\*/gm,"")).replace(/^\s*\*/gm,"*")).replace(/^\s*\*\*\*\*/gm,"\t\t\t*")).replace(/^\s*\*\*\*/gm,"\t\t*")).replace(/^\s*\*\*/gm,"\t*")).split("\n")).forEach(function(e){if(e=e.trimRight()){var t=e.match(/(^.*)([^:]\/\/.*)$/);t&&(e=t[1].trimRight());if(t=e.match(/^\s*(\@[a-zA-Z0-9_]+)(.*)$/)){var o=t[1],a=t[2];"@returns"==o&&(o="@return");"@throw"==o&&(o="@throws");r={name:o,body:a};n.push(r)}else{r.body.length&&(r.body+="\n");r.body+=e}}});var o={},a=new t.Converter;n.forEach(function(e){if("@description"===e.name)try{e.body=a.makeHtml(e.body)}catch(t){qx.tool.compiler.Console.getInstance().isVerbose()&&qx.tool.compiler.Console.info('\n              Markdown conversion problem: \n              Error "'.concat(t.message,'" was thrown parsing \n              "').concat(e.body.trim(),'". \n              Please review your doc comments for compatibility with Markdown syntax.\n              '))}else{var t=e.body.match(/^\s*\(([\s\S]*)\)\s*$/m);t&&(e.body=t[1]);e.body=e.body.trim()}o[e.name]?o[e.name].push(e):o[e.name]=[e]});return o},parseJsDoc:function(e,t,r){for(var n in e){var o=this.__P_226_0[n];o&&e[n].forEach(function(e){return o.parseCommand(e,t,r)})}},__P_226_0:{"@param":new qx.tool.compiler.jsdoc.ParamParser,"@return":new qx.tool.compiler.jsdoc.ReturnParser,"@throws":new qx.tool.compiler.jsdoc.ThrowsParser,"@throw":new qx.tool.compiler.jsdoc.ThrowsParser,"@childControl":new qx.tool.compiler.jsdoc.ChildControlParser}}});qx.tool.compiler.jsdoc.Parser.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.targets.meta.Part",{extend:qx.core.Object,construct:function(e,t,r){qx.core.Object.constructor.call(this);this.__P_242_0=e;this.__P_242_1=t;this.__P_242_2=r;this.__P_242_3=[];this.__P_242_4={}},members:{__P_242_0:null,__P_242_1:null,__P_242_2:-1,__P_242_3:null,__P_242_4:null,addPackage:function(e){if(!this.__P_242_4[e.toHashCode()]){this.__P_242_3.push(e);this.__P_242_4[e.toHashCode()]=e}},hasPackage:function(e){return Boolean(this.__P_242_4[e.toHashCode()])},getDefaultPackage:function(){return this.__P_242_3[0]||null},serializeInto:function(e){var t=e[this.__P_242_1]=[];this.__P_242_3.forEach(function(e){return t.push(String(e.getPackageIndex()))})}}});qx.tool.compiler.targets.meta.Part.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.targets.meta.PackageJavascript":{construct:!0},"qx.lang.Type":{},"qx.lang.Array":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath");qx.Class.define("qx.tool.compiler.targets.meta.Package",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.__P_240_0=e;this.__P_240_1=t;this.__P_240_2=[];this.__P_240_3={};this.__P_240_4={};this.__P_240_5=[];this.__P_240_6=[];this.__P_240_7=new qx.tool.compiler.targets.meta.PackageJavascript(this.__P_240_0,this)},properties:{embedAllJavascript:{init:!1,check:"Boolean"},needsWriteToDisk:{init:!0,check:"Boolean",apply:"_applyNeedsWriteToDisk"}},members:{__P_240_0:null,__P_240_1:-1,__P_240_2:null,__P_240_3:null,__P_240_4:null,__P_240_6:null,__P_240_5:null,__P_240_7:null,isEmpty:function(){if(this.__P_240_2.length>0)return!1;for(var e in this.__P_240_3)if(this.__P_240_3[e])return!1;for(var t in this.__P_240_4)if(this.__P_240_4[t])return!1;return!(this.isEmbedAllJavascript()&&this.__P_240_5.length>0)},getPackageIndex:function(){return this.__P_240_1},addAsset:function(e){this.__P_240_2.push(e)},getAssets:function(){return this.__P_240_2},addLocale:function(e,t){this.__P_240_3[e]=t},getLocales:function(){return this.__P_240_3},addTranslationEntry:function(e,t){var r=this.__P_240_4[e];r||(this.__P_240_4[e]=r={});var n=t.msgstr;qx.lang.Type.isArray(n)||(n=[n]);n[0]&&(r[t.msgid]=n[0]);t.msgid_plural&&n[1]&&(r[t.msgid_plural]=n[1])},getTranslations:function(){return this.__P_240_4},addJavascriptMeta:function(e){this.__P_240_5.push(e)},getJavascriptMetas:function(){return this.__P_240_5},removeJavascriptMeta:function(e){qx.lang.Array.remove(this.__P_240_5,e)},addClassname:function(e){this.__P_240_6.push(e)},getClassnames:function(){return this.__P_240_6},getJavascript:function(){return this.__P_240_7},serializeInto:function(e){var r=e[String(this.__P_240_1)]={uris:[]},n=this.__P_240_0.getApplicationRoot();this.isEmbedAllJavascript()||(r.uris=this.__P_240_5.map(function(e){return t.relative(n,e.getFilename())}));this.isNeedsWriteToDisk()&&r.uris.unshift(t.relative(n,this.__P_240_7.getFilename()))},_applyNeedsWriteToDisk:function(e){this.__P_240_7.setNeedsWriteToDisk(e)}}});qx.tool.compiler.targets.meta.Package.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.targets.meta.AbstractJavascriptMeta":{construct:!0,require:!0},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath");qx.Class.define("qx.tool.compiler.targets.meta.PackageJavascript",{extend:qx.tool.compiler.targets.meta.AbstractJavascriptMeta,construct:function(e,t){qx.tool.compiler.targets.meta.AbstractJavascriptMeta.constructor.call(this,e,"".concat(e.getApplicationRoot(),"package-").concat(t.getPackageIndex(),".js"));this.__P_241_0=t},properties:{needsWriteToDisk:{init:!0,refine:!0}},members:{__P_241_1:null,writeSourceCodeToStream:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=r.__P_241_0;a={locales:o.getLocales(),resources:{},translations:o.getTranslations()};o.getAssets().forEach(function(e){var r=t.extname(e.getFilename());r.length&&(r=r.substring(1));var n=e.getFileInfo(),o=a.resources[e.getFilename()]=[n.width,n.height,r,e.getLibrary().getNamespace()];if(void 0!==n.composite){o.push(n.composite);o.push(n.x);o.push(n.y)}});if(!o.isEmbedAllJavascript()){n.next=10;break}r.__P_241_1=[];(i=new qx.tool.utils.Utils.StripSourceMapTransform).pipe(e);n.next=9;return new Promise(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<o.getJavascriptMetas().length)){t.next=10;break}s=o.getJavascriptMetas()[a];r.__P_241_1.push(e.getLineNumber());t.next=6;return s.unwrap().writeSourceCodeToStream(i);case 6:i.write("\n");case 7:a++;t.next=1;break;case 10:n();case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 9:e.write("//# sourceMappingURL=".concat(t.basename(r.getFilename()),".map?dt=").concat((new Date).getTime(),"\n"));case 10:e.write("qx.$$packageData['".concat(r.__P_241_0.getPackageIndex(),"'] = ").concat(JSON.stringify(a,null,2),";\n"));case 11:case"end":return n.stop()}},n)}))()},writeToDisk:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.compiler.targets.meta.PackageJavascript.prototype.writeToDisk.base.call(e);case 2:if(e.__P_241_0.isEmbedAllJavascript()){t.next=10;break}r=0;case 4:if(!(r<e.__P_241_0.getJavascriptMetas().length)){t.next=10;break}t.next=7;return e.__P_241_0.getJavascriptMetas()[r].unwrap().writeToDisk();case 7:r++;t.next=4;break;case 10:case"end":return t.stop()}},t)}))()},getSourceMap:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.__P_241_0.isEmbedAllJavascript()){t.next=2;break}return t.abrupt("return",null);case 2:if(null!==e.__P_241_1){t.next=4;break}throw new Error("Cannot get the source map for ".concat(e," until the stream has been written"));case 4:return t.abrupt("return",e._copySourceMap(e.__P_241_0.getJavascriptMetas(),e.__P_241_1));case 5:case"end":return t.stop()}},t)}))()}}});qx.tool.compiler.targets.meta.PackageJavascript.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.config.Manifest":{},"qx.tool.cli.ConfigDb":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("process"),r=require("path"),n=require("columnify"),o=qx.tool.utils.Promisify.fs;require("./Command");qx.Class.define("qx.tool.cli.commands.Config",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){function e(e,r){return new qx.tool.cli.commands.Config(e)[r](e).catch(function(e){qx.tool.compiler.Console.log(e.stack||e.message);t.exit(1)})}return{command:"config <key> [value]",describe:"gets/sets persistent configuration",builder:function(t){t.option("quiet",{alias:"q",describe:"Suppresses warnings (eg about unknown configuration keys)",type:"boolean"}).command("set <key> <value>","Sets a configuration value",function(){},function(t){return e(t,"cmdSet")}).command("get <key> [options]","Gets a configuration value",{bare:{type:"boolean",describe:"Restricts output to just the value"}},function(t){return e(t,"cmdGet")}).command("delete <key>","Deletes a configuration value",function(){},function(t){return e(t,"cmdDelete")}).command("list","Lists all known configuration values",{all:{type:"boolean",describe:"Shows all keys, including unset"}},function(t){return e(t,"cmdList")})},handler:function(e){}}},KNOWN_VALUES:{"github.token":{desc:"The API token used to connect to GitHub"},"qx.library":{desc:"The directory where qooxdoo library is installed",set:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:e.next=4;return o.existsAsync(r.join(t,qx.tool.config.Manifest.config.fileName));case 4:if(e.sent){e.next=13;break}e.next=7;return o.existsAsync(r.join(t,"framework/Manifest.json"));case 7:if(!e.sent){e.next=11;break}t=r.join(t,"framework");e.next=13;break;case 11:qx.tool.compiler.Console.error("Cannot set qx.library to ".concat(t," because there is no Manifest.json"));return e.abrupt("return",void 0);case 13:return e.abrupt("return",r.resolve(t));case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"qx.translation.strictPoCompatibility":{desc:"Whether to write PO files with strict compatibility, i.e. include line numbers in output",set:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","true"===t||"false"!==t&&Boolean(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"qx.default.color":{desc:'The default color for console output (eg "white bgRed bold")'},"qx.default.feedback":{desc:"Default value for compiler feedback (override with --[no-]feedback)",set:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","true"===t||"false"!==t&&void 0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}},members:{__P_207_0:function(e){var t=qx.tool.cli.commands.Config.KNOWN_VALUES[e];return t&&t.desc},__P_207_1:function(e){if(!e.quiet){this.__P_207_0(e.key)||qx.tool.compiler.Console.warn("Warning: Unrecognised configuration key "+e.key)}},__P_207_2:function(e){var t=e.lastIndexOf(".");return{key:e,parentKey:t>-1?e.substring(0,t):"",childKey:e.substring(t+1)}},cmdSet:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_207_1(t);e.next=3;return qx.tool.cli.ConfigDb.getInstance();case 3:r=e.sent;n=qx.tool.cli.commands.Config.KNOWN_VALUES[t.key];o=t.value;if(!n||"function"!=typeof n.set){e.next=10;break}e.next=9;return n.set(o);case 9:o=e.sent;case 10:a=this.__P_207_2(t.key);i=r.db(a.parentKey,{});void 0===o?delete i[a.childKey]:i[a.childKey]=o;e.next=15;return r.save();case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),cmdDelete:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_207_1(t);e.next=3;return qx.tool.cli.ConfigDb.getInstance();case 3:r=e.sent;n=this.__P_207_2(t.key);(o=r.db(n.parentKey))&&delete o[n.childKey];e.next=9;return r.save();case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),cmdGet:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__P_207_1(t);e.next=3;return qx.tool.cli.ConfigDb.getInstance();case 3:r=e.sent;n=r.db(t.key);t.bare?qx.tool.compiler.Console.log(n||""):void 0!==n?qx.tool.compiler.Console.log(t.key+"="+n):qx.tool.compiler.Console.log(t.key+" is not set");case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),cmdList:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,o,a,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,t){for(var r in e){var n=e[r],i=t+(t.length?".":"")+r;qx.tool.utils.Utils.isPlainObject(n)?a(n,i):o[i]=!0}};e.next=3;return qx.tool.cli.ConfigDb.getInstance();case 3:r=e.sent;o={};if(t.all)for(i in qx.tool.cli.commands.Config.KNOWN_VALUES)o[i]=!0;a(r.db(),"");(o=Object.keys(o)).sort();o=o.map(function(e){return{key:e,value:r.db(e),description:s.__P_207_0(e)||"Unrecognised key"}});qx.tool.compiler.Console.log(n(o));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.Config.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.cli.commands.Command":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("./Package");require("@qooxdoo/framework");var t=require("fs"),r=require("upath"),n=require("inquirer"),o=r.join(qx.tool.cli.commands.Command.TEMPLATE_DIR,"template_vars");qx.Class.define("qx.tool.cli.commands.Create",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"create <application namespace> [options]",describe:"creates a new qooxdoo project.",builder:{type:{alias:"t",describe:"Type of the application to create. Must be one of "+this.getSkeletonNames().join(", "),nargs:1,requiresArg:!0,type:"string"},out:{alias:"o",describe:"Output directory for the application content."},namespace:{alias:"s",describe:"Top-level namespace."},name:{alias:"n",describe:"Name of application/library (defaults to namespace)."},theme:{describe:"The name of the theme to be used.",default:"indigo"},icontheme:{describe:"The name of the icon theme to be used.",default:"Tango"},noninteractive:{alias:"I",describe:"Do not prompt for missing values"},verbose:{alias:"v",describe:"Verbose logging"}}}},getSkeletonNames:function(){var e=r.join(qx.tool.cli.commands.Command.TEMPLATE_DIR,"skeleton");return t.readdirSync(e).filter(function(n){try{return t.existsSync(r.join(e,n,"Manifest.tmpl.json"))}catch(e){return!1}})}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:C=function(e,n){var o,i=t.readdirSync(e),s=_createForOfIteratorHelper(i);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=r.join(e,l),p=t.statSync(u);if(p.isFile()){var f=r.join(n,l.replace(/\.tmpl/,""));if(u.includes(".tmpl")){var m=t.readFileSync(u,"utf-8");for(var d in c)m=m.replace(new RegExp("\\${".concat(d,"}"),"g"),c[d]);a.verbose&&qx.tool.compiler.Console.info(">>> Creating ".concat(f," from template ").concat(u,"..."));if(t.existsSync(f))throw new qx.tool.utils.Utils.UserError("".concat(f," already exists."));t.writeFileSync(f,m,"utf-8")}else{a.verbose&&qx.tool.compiler.Console.info(">>> Copying ".concat(u," to ").concat(f,"..."));t.copyFileSync(u,f)}}else if(p.isDirectory()){var _,h=n,g="custom"===l?c.namespace.split(/\./):[l],x=_createForOfIteratorHelper(g);try{for(x.s();!(_=x.n()).done;){var y=_.value;h=r.join(h,y);t.mkdirSync(h)}}catch(e){x.e(e)}finally{x.f()}C(u,h)}}}catch(e){s.e(e)}finally{s.f()}};a=this.argv;i={};s=[];c={};e.next=7;return this.getUserQxPath();case 7:i.qooxdoo_path=e.sent;e.prev=8;e.next=11;return this.getLibraryVersion(i.qooxdoo_path);case 11:i.qooxdoo_version=e.sent;e.next=18;break;case 14:e.prev=14;e.t0=e.catch(8);qx.tool.compiler.Console.error(e.t0.message);throw new qx.tool.utils.Utils.UserError("Cannot find qooxdoo framework folder.");case 18:i.template_dir=this.getTemplateDir();i.getLibraryVersion=this.getLibraryVersion.bind(this);l=require(o)(a,i);u=_createForOfIteratorHelper(Object.getOwnPropertyNames(l));e.prev=22;u.s();case 24:if((p=u.n()).done){e.next=40;break}f=p.value;m=l[f];d="function"==typeof m.default?m.default():m.default;if(void 0===m.value){e.next=31;break}c[f]="function"==typeof m.value?m.value.call(c):m.value;return e.abrupt("continue",38);case 31:if(!a.noninteractive){e.next=36;break}if(!m.optional&&!d){e.next=35;break}c[f]=d;return e.abrupt("continue",38);case 35:throw new qx.tool.utils.Utils.UserError("Cannot skip required value for '".concat(f,"'."));case 36:_="Please enter ".concat(m.description," ").concat(m.optional?"(optional)":"",":");s.push({type:m.type||"input",choices:m.choices,name:f,message:_,default:m.default,validate:m.validate||function(e,t){return!0}});case 38:e.next=24;break;case 40:e.next=45;break;case 42:e.prev=42;e.t1=e.catch(22);u.e(e.t1);case 45:e.prev=45;u.f();return e.finish(45);case 48:e.prev=48;e.next=51;return n.prompt(s);case 51:h=e.sent;e.next=57;break;case 54:e.prev=54;e.t2=e.catch(48);throw new qx.tool.utils.Utils.UserError(e.t2.message);case 57:g=_createForOfIteratorHelper(Object.getOwnPropertyNames(l));e.prev=58;g.s();case 60:if((x=g.n()).done){e.next=82;break}y=x.value;v=c[y];void 0!==h[y]&&(v=h[y]);e.t3=y;e.next="namespace"===e.t3?67:"locales"===e.t3?70:"authors"===e.t3?72:79;break;case 67:if(v.match(/^([a-zA-Z_$][0-9a-zA-Z_$]*\.?)+$/)){e.next=69;break}throw new qx.tool.utils.Utils.UserError('Illegal characters in namespace "'.concat(v,'."'));case 69:return e.abrupt("break",79);case 70:v=JSON.stringify(v.split(/,/).map(function(e){return e.trim()}));return e.abrupt("break",79);case 72:if(void 0!==v){e.next=75;break}c.author_map="[]";return e.abrupt("break",79);case 75:b=v.split(/,/).map(function(e){return e.trim()});c.author_map=JSON.stringify(b.map(function(e){var t=e.split(/ /),r=t.pop();return{name:t.join(" "),email:r}}),null,2);v=b.join("\n"+" ".repeat(12));return e.abrupt("break",79);case 79:c[y]=v;case 80:e.next=60;break;case 82:e.next=87;break;case 84:e.prev=84;e.t4=e.catch(58);g.e(e.t4);case 87:e.prev=87;g.f();return e.finish(87);case 90:q=r.normalize(c.out);if(t.existsSync(q)){e.next=103;break}P=r.dirname(q);if(t.existsSync(P)){e.next=95;break}throw new qx.tool.utils.Utils.UserError("Invalid directory ".concat(q));case 95:e.prev=95;t.accessSync(P,t.constants.W_OK);e.next=102;break;case 99:e.prev=99;e.t5=e.catch(95);throw new qx.tool.utils.Utils.UserError("Directory ".concat(P," is not writable."));case 102:t.mkdirSync(q);case 103:k=a.type||c.type;w=r.join(i.template_dir,"skeleton",k);if(!a.type||t.existsSync(w)){e.next=107;break}throw new qx.tool.utils.Utils.UserError("Application type '".concat(a.type,"' does not exist or has not been implemented yet."));case 107:C.bind(this)(w,q);case 108:case"end":return e.stop()}},e,this,[[8,14],[22,42,45,48],[48,54],[58,84,87,90],[95,99]])}));return function(){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.Create.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Compile":{require:!0},"qx.tool.compiler.Console":{defer:"runtime"},"qx.lang.Object":{},"qx.tool.utils.Promisify":{},"qx.tool.utils.files.Utils":{},"qx.tool.utils.Utils":{},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);require("./Compile");require("@qooxdoo/framework");var t=require("fs"),r=require("upath"),n=require("../../compiler/util");qx.Class.define("qx.tool.cli.commands.Deploy",{extend:qx.tool.cli.commands.Compile,statics:{YARGS_BUILDER:{out:{describe:"Output directory for the deployment",alias:"o"},"app-name":{describe:"The name of the application to deploy (default is all apps), can be comma separated list",nargs:1,type:"string"},"source-maps":{describe:"Enable source maps",type:"boolean",default:!1,alias:"m"},target:{alias:"t",describe:"Set the target type. Default is build",type:"string",default:"build"}},getYargsCommand:function(){return{command:"deploy [options]",describe:"deploys qooxdoo application(s)",builder:function(){var e=Object.assign({},qx.tool.cli.commands.Compile.YARGS_BUILDER,qx.tool.cli.commands.Deploy.YARGS_BUILDER);delete e.watch;delete e["write-library-info"];delete e.download;delete e["update-po-files"];delete e["save-unminified"];delete e.bundling;delete e.minify;return e}()}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,o,a,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.argv).clean||qx.tool.compiler.Console.print("qx.tool.cli.deploy.notClean");o={writeLibraryInfo:!1,download:!1,updatePoFiles:!1,saveUnminified:!1,bundling:!0,minify:"mangle",__P_208_0:!0};qx.lang.Object.mergeWith(n,o);e.next=6;return qx.tool.cli.commands.Deploy.prototype.process.base.call(this);case 6:a=null;if(n.appName){o.appName=n.appName;a={};n.appName.split(",").forEach(function(e){return a[e]=!0})}if(!n.clean){e.next=11;break}e.next=11;return qx.tool.utils.Promisify.eachOfSeries(this.getMakers(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getTarget();e.next=3;return qx.tool.utils.Promisify.eachOfSeries(t.getApplications(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||a[t.getName()]){e.next=2;break}return e.abrupt("return");case 2:if(!(o=n.out||"function"==typeof r.getDeployDir&&r.getDeployDir())){e.next=6;break}e.next=6;return qx.tool.utils.files.Utils.deleteRecursive(o);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 11:e.next=13;return qx.tool.utils.Promisify.eachOfSeries(this.getMakers(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(o,s){var c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=o.getTarget();e.next=3;return qx.tool.utils.Promisify.eachOfSeries(o.getApplications(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(o){var l,u,p,f,m,d,_,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||a[o.getName()]){e.next=2;break}return e.abrupt("return");case 2:if(l=n.out||"function"==typeof c.getDeployDir&&c.getDeployDir()){e.next=6;break}qx.tool.compiler.Console.print("qx.tool.cli.deploy.deployDirNotSpecified");return e.abrupt("return");case 6:u=n.sourceMaps||"function"==typeof c.getDeployMap&&c.getDeployMap()||"function"==typeof c.getSaveSourceInMap&&c.getSaveSourceInMap();p=c.getApplicationRoot(o);f=r.join(l,o.getName());e.next=11;return i.__P_208_1(p,f,u);case 11:m=r.join(c.getOutputDir(),"resource");if(!t.existsSync(m)){e.next=19;break}d=r.join(l,"resource");if(0!=s||!n.clean){e.next=17;break}e.next=17;return qx.tool.utils.files.Utils.deleteRecursive(d);case 17:e.next=19;return qx.tool.utils.files.Utils.sync(m,d);case 19:_=r.join(c.getOutputDir(),"index.html");h=r.join(l,"index.html");t.existsSync(_)&&t.copyFileSync(_,h);case 22:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}());case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_208_1:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(o,a,i){var s,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Utils.makeDirs(a);case 2:e.next=4;return t.readdirAsync(o);case 4:s=e.sent;e.next=7;return qx.tool.utils.Promisify.eachOf(s,function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(s){var l,u,p,f,m,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=r.join(o,s);u=r.join(a,s);e.next=4;return t.statAsync(l);case 4:if(e.sent.isFile()){e.next=9;break}e.next=8;return c.__P_208_1(l,u,i);case 8:return e.abrupt("return");case 9:if(".map"!=(p=r.extname(s))||i){e.next=12;break}return e.abrupt("return");case 12:if(".js"!=p||i){e.next=22;break}e.next=15;return n.mkParentPathAsync(u);case 15:f=t.createReadStream(l,{encoding:"utf8",emitClose:!0});m=t.createWriteStream(u,{encoding:"utf8",emitClose:!0});d=new qx.tool.utils.Utils.StripSourceMapTransform;e.next=20;return new qx.Promise(function(e,t){f.on("error",t);m.on("error",t);m.on("finish",e);f.pipe(d);d.pipe(m)});case 20:e.next=24;break;case 22:e.next=24;return qx.tool.utils.files.Utils.copyFile(l,u);case 24:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}()},defer:function(e){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.deploy.deployDirNotSpecified":"No deploy dir configured! Use --out parameter or deployPath target property in compile.json."},"error");qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.deploy.notClean":"Incremental compilation - this is faster but may preserve old artifacts, it is recommended to use --clean command line option"},"warning")}});qx.tool.cli.commands.Deploy.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.cli.Cli":{},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{},"qx.Promise":{},"qx.tool.compiler.app.Library":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("eslint").CLIEngine,r=qx.tool.utils.Promisify.fs;require("./Command");qx.Class.define("qx.tool.cli.commands.Lint",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"lint [files...]",describe:"runs eslint on the current application or as set of single files.",builder:{fix:{describe:"runs eslint with --fix"},"fix-jsdoc-params":{describe:"changes the order or @param name and {Type} to make it compatible for the generator ('name-first') or with JSDoc linting ('type-first').",choices:["off","name-first","type-first"],default:"off"},"use-eslintrc":{describe:"Use the .eslintrc file for configuration, if it exists",default:!0},cache:{describe:"operate only on changed files",default:!1},warnAsError:{alias:"w",describe:"handle warnings as error"},"print-config":{alias:"p",describe:"print the eslint configuration"},format:{alias:"f",describe:"use a specific output format",default:"codeframe"},outputFile:{alias:"o",describe:"specify file to which the report will be written",nargs:1,requiresArg:!0,type:"string"},verbose:{alias:"v",describe:"enables additional progress output to console",type:"boolean"},quiet:{alias:"q",describe:"No output"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,o,a,i,s,c,l,u,p,f=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.__P_209_0();case 2:e.next=4;return qx.tool.cli.Cli.getInstance().getParsedArgs();case 4:n=e.sent;(o=n.eslintConfig||{}).extends=o.extends||["@qooxdoo/qx/browser"];e.t0=Object;e.t1=o.globals||{};e.next=11;return this.__P_209_1(n);case 11:e.t2=e.sent;o.globals=e.t0.assign.call(e.t0,e.t1,e.t2);a=new t({cache:this.argv.cache||!1,baseConfig:o,useEslintrc:this.argv.useEslintrc,fix:this.argv.fix});0===(i=this.argv.files||[]).length&&i.push("source/class/");if(!this.argv.config){e.next=21;break}s=a.getConfigForFile(i[0]);qx.tool.compiler.Console.info(JSON.stringify(s,null,"  "));e.next=41;break;case 21:c=a.executeOnFiles(i);this.argv.fix&&t.outputFixes(c);if(!(c.errorCount>0||c.warningCount>0)){e.next=40;break}l=this.argv.format||"codeframe";u=a.getFormatter(l);p=u(c.results);if(!this.argv.outputFile){e.next=33;break}this.argv.verbose&&qx.tool.compiler.Console.info("Report to be written to ".concat(this.argv.outputFile));e.next=31;return r.writeFileAsync(this.argv.outputFile,p,"UTF-8").then(function(){f.argv.verbose&&qx.tool.compiler.Console.info("Report written to ".concat(f.argv.outputFile))}).catch(function(e){return qx.tool.compiler.Console.error("Error writing report to ".concat(f.argv.outputFile,":")+e.message)});case 31:e.next=38;break;case 33:if(!(c.errorCount>0||this.argv.warnAsError)){e.next=37;break}throw new qx.tool.utils.Utils.UserError(p);case 37:qx.tool.compiler.Console.info(p);case 38:e.next=41;break;case 40:qx.tool.compiler.Console.info("No errors found!");case 41:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_209_1:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r={};if(!e.libraries){t.next=4;break}t.next=4;return qx.Promise.all(e.libraries.map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.compiler.app.Library.createLibrary(t);case 2:n=e.sent;o=n.getNamespace();a=o.split(".");r[a[0]]=!1;case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}},t)}))()},__P_209_0:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=[];if((n=e.argv.fixJsdocParams)&&"off"!==n){o="type-first"===n?/@param\s+([\w$]+)\s+({[\w|[\]{}<>?. ]+})/g:/@param\s+({[\w|[\]{}<>?. ]+})\s+([\w$]+)/g;r.push({files:"source/class/**/*.js",from:o,to:"@param $2 $1"})}t.next=5;return e.migrate(null,r);case 5:case"end":return t.stop()}},t)}))()}}});qx.tool.cli.commands.Lint.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.cli.Cli":{}}};qx.Bootstrap.executePendingDefers(e);require("./Command");require("@qooxdoo/framework");qx.Class.define("qx.tool.cli.commands.Pkg",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"pkg <command> [options]",desc:"alias for 'qx package'.",builder:function(e){qx.tool.cli.Cli.addYargsCommands(e,["Install","List","Publish","Remove","Update","Upgrade","Migrate"],"qx.tool.cli.commands.package");return e.demandCommand().showHelpOnFail().help()},handler:function(e){}}}}});qx.tool.cli.commands.Pkg.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Compile":{require:!0},"qx.tool.compiler.Console":{defer:"runtime"},"qx.Promise":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath"),r=require("process"),n=require("ps-tree");require("./Compile");qx.Class.define("qx.tool.cli.commands.Run",{extend:qx.tool.cli.commands.Compile,statics:{YARGS_BUILDER:{inspect:{describe:"Whether to start node for debugging (ie with the --inspect argument)",type:"boolean",default:!1},"inspect-brk":{describe:"Whether to start node for debugging and break immediately (ie with the --inspect-brk argument)",type:"boolean",default:!1}},getYargsCommand:function(){return{command:"run [configFile]",describe:"runs a server application (written in node) with continuous compilation, using compile.json",builder:Object.assign(qx.tool.cli.commands.Compile.YARGS_BUILDER,qx.tool.cli.commands.Run.YARGS_BUILDER)}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o,a,i,s,c,l,u,p,f,m,d=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=function(e){return new qx.Promise(function(t,o){n(e,function(n,a){if(n)o(n);else{a.forEach(function(e){try{r.kill(e.PID)}catch(e){}});try{r.kill(e)}catch(e){}t()}})})};this.argv.watch=!0;this.argv["machine-readable"]=!1;this.argv.feedback=!1;e.next=6;return qx.tool.cli.commands.Run.prototype.process.base.call(this);case 6:if(!(o=this._getConfig()).run){qx.tool.compiler.Console.print("qx.tool.cli.run.noRunConfig");r.exit(-1)}if(!o.run.application){qx.tool.compiler.Console.print("qx.tool.cli.run.noAppName");r.exit(-1)}a=null;i=null;this.getMakers().forEach(function(e){var t=e.getApplications().filter(function(e){return e.getName()==o.run.application});if(t.length){if(a){qx.tool.compiler.Console.print("qx.tool.cli.run.tooManyMakers");r.exit(-1)}if(1!=t.length){qx.tool.compiler.Console.print("qx.tool.cli.run.tooManyApplications");r.exit(-1)}a=e;i=t[0]}});if(!i){qx.tool.compiler.Console.print("qx.tool.cli.run.noAppName");r.exit(-1)}if("node"!=i.getType()){qx.tool.compiler.Console.print("qx.tool.cli.run.mustBeNode");r.exit(-1)}s=a.getTarget();l=t.join(s.getApplicationRoot(i),"index.js");u=o.run.arguments||"";p="";this.argv["inspect-brk"]?p=" --inspect-brk":this.argv.inspect&&(p=" --inspect");f="node".concat(p," ").concat(l," ").concat(u);m=!0;this.addListener("making",function(e){m=!1});this.addListener("writtenApplication",function(e){i===e.getData()&&(m=!0)});this.addListener("made",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.__P_211_0){e.next=11;break}if(m){e.next=3;break}return e.abrupt("return");case 3:e.prev=3;e.next=6;return c(d.__P_211_0.pid);case 6:e.next=10;break;case 8:e.prev=8;e.t0=e.catch(3);case 10:d.__P_211_0=null;case 11:console.log("Starting application: "+f);(r=d.__P_211_0=require("child_process").exec(f)).stdout.setEncoding("utf8");r.stdout.on("data",function(e){console.log(e)});r.stderr.setEncoding("utf8");r.stderr.on("data",function(e){console.error(e)});r.on("close",function(e){console.log("Application has terminated");this.__P_211_0=null});r.on("error",function(e){console.error("Application has failed: "+e)});case 19:case"end":return e.stop()}},e,null,[[3,8]])}));return function(t){return e.apply(this,arguments)}}());case 24:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},defer:function(e){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.run.noRunConfig":"Cannot run anything because the config.json does not have a `run` configuration","qx.tool.cli.run.noAppName":"Cannot run anything because the config.json does not specify a unique application name","qx.tool.cli.run.mustBeNode":"The application %1 is not a node application (only node applications are supported)","qx.tool.cli.run.tooManyMakers":"Cannot run anything because multiple targets are detected","qx.tool.cli.run.tooManyApplications":"Cannot run anything because multiple applications are detected"},"error")}});qx.tool.cli.commands.Run.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Compile":{require:!0},"qx.tool.utils.Website":{},"qx.tool.compiler.Console":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath"),r=require("process"),n=require("express"),o=require("http"),a=qx.tool.utils.Promisify.fs;require("app-module-path").addPath(r.cwd()+"/node_modules");require("./Compile");qx.Class.define("qx.tool.cli.commands.Serve",{extend:qx.tool.cli.commands.Compile,statics:{YARGS_BUILDER:{"listen-port":{alias:"p",describe:"The port for the web browser to listen on",type:"number",default:8080},"show-startpage":{alias:"S",describe:"Show the startpage with the list of applications and additional information",type:"boolean",default:null},"rebuild-startpage":{alias:"R",describe:"Rebuild the startpage with the list of applications and additional information",type:"boolean",default:!1}},getYargsCommand:function(){return{command:"serve",describe:"runs a webserver to run the current application with continuous compilation, using compile.json",builder:function(){var e=Object.assign({},qx.tool.cli.commands.Compile.YARGS_BUILDER,qx.tool.cli.commands.Serve.YARGS_BUILDER);delete e.watch;return e}()}}},events:{beforeStart:"qx.event.type.Data",afterStart:"qx.event.type.Event"},members:{_website:null,process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.argv.watch=!0;this.argv["machine-readable"]=!1;this.argv.feedback=!1;e.next=5;return qx.tool.cli.commands.Serve.prototype.process.base.call(this);case 5:t=this._website=new qx.tool.utils.Website;e.next=8;return a.existsAsync(t.getTargetDir());case 8:if(e.sent){e.next=14;break}qx.tool.compiler.Console.info(">>> Building startpage...");e.next=12;return this._website.rebuildAll();case 12:e.next=15;break;case 14:this.argv.rebuildStartpage&&this._website.startWatcher();case 15:e.next=17;return this.runWebServer();case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),showStartpage:function(){return this.__P_212_0},runWebServer:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var i,s,c,l,u,p,f,m,d,_=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=this.getMakers().filter(function(e){return e.getApplications().some(function(e){return e.getStandalone()})});s=[];c=null;l=null;i.forEach(function(e){e.getApplications().forEach(function(t){if(t.isBrowserApp()&&t.getStandalone()){s.push(t);null===l&&(l=e);null===c&&t.getWriteIndexHtmlToRoot()&&(c=e)}})});c||1!==s.length||(c=l);this.__P_212_0=this.argv.showStartpage;null===this.__P_212_0&&(this.__P_212_0=null===c);u=this._getConfig();p=n();f=new qx.tool.utils.Website;if(this.__P_212_0){e.next=15;break}p.use("/",n.static(c.getTarget().getOutputDir()));e.next=28;break;case 15:e.next=17;return this.getAppQxPath();case 17:m=e.sent;e.next=20;return a.existsAsync(t.join(m,"docs"));case 20:if(e.sent){e.next=22;break}m=t.dirname(m);case 22:p.use("/docs",n.static(t.join(m,"docs")));p.use("/apps",n.static(t.join(m,"apps")));p.use("/",n.static(f.getTargetDir()));d=[];i.forEach(function(e){var r=e.getTarget(),o=t.normalize("/"+r.getOutputDir());p.use(o,n.static(r.getOutputDir()));d.push({target:{type:r.getType(),outputDir:o},apps:e.getApplications().filter(function(e){return e.getStandalone()}).map(function(e){return{isBrowser:e.isBrowserApp(),name:e.getName(),type:e.getType(),title:e.getTitle()||e.getName(),appClass:e.getClassName(),description:e.getDescription(),outputPath:r.getProjectDir(e)}})})});p.get("/serve.api/apps.json",function(e,t){t.set("Content-Type","application/json");t.send(JSON.stringify(d,null,2))});case 28:this.addListenerOnce("made",function(e){var t=o.createServer(p);_.fireDataEvent("beforeStart",{server:t,application:p});t.on("error",function(e){if("EADDRINUSE"===e.code){qx.tool.compiler.Console.print("qx.tool.cli.serve.webAddrInUse",u.serve.listenPort);r.exit(-1)}else qx.tool.compiler.Console.log("Error when starting web server: "+e)});t.listen(u.serve.listenPort,function(){qx.tool.compiler.Console.print("qx.tool.cli.serve.webStarted","http://localhost:"+u.serve.listenPort);_.fireEvent("afterStart")})});case 29:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),__P_212_0:null},defer:function(e){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.serve.webStarted":"Web server started, please browse to %1","qx.tool.cli.serve.webAddrInUse":"Web server cannot start because port %1 is already in use"})}});qx.tool.cli.commands.Serve.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.files.Utils":{},"qx.tool.compiler.Console":{},"qx.tool.cli.commands.Create":{},"qx.tool.cli.commands.package.Install":{}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.fs,r=require("process"),n=require("upath"),o=require("rimraf"),a=require("dot");require("jstransformer-dot");var i=require("metalsmith"),s=require("metalsmith-layouts"),c=require("metalsmith-markdown"),l=require("node-sass"),u=require("chokidar");a.templateSettings.strip=!1;qx.Class.define("qx.tool.utils.Website",{extend:qx.core.Object,statics:{APP_NAMESPACE:"apps",SOURCE_DIR:n.join(qx.tool.$$resourceDir,"website"),TARGET_DIR:n.join(qx.tool.$$resourceDir,"website/build")},construct:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};qx.core.Object.apply(this,arguments);var t=qx.tool.utils.Website;this.initSourceDir(t.SOURCE_DIR);this.initTargetDir(t.TARGET_DIR);this.initAppsNamespace(t.APP_NAMESPACE);var r,n=_createForOfIteratorHelper(Object.getOwnPropertyNames(e));try{for(n.s();!(r=n.n()).done;){var o=r.value;this.set(o,e[o])}}catch(e){n.e(e)}finally{n.f()}},properties:{appsNamespace:{check:"String",deferredInit:!0},sourceDir:{check:"String",deferredInit:!0},targetDir:{check:"String",deferredInit:!0}},members:{__P_249_0:null,__P_249_1:!1,__P_249_2:null,__P_249_3:!1,__P_249_4:!1,startWatcher:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.stopWatcher();case 2:t.next=4;return qx.tool.utils.files.Utils.correctCase(e.getSourceDir());case 4:r=t.sent;e._watcher=u.watch([r],{});e._watcher.on("change",function(t){return e.__P_249_5("change",t)});e._watcher.on("add",function(t){return e.__P_249_5("add",t)});e._watcher.on("unlink",function(t){return e.__P_249_5("unlink",t)});e._watcher.on("ready",_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.triggerRebuild(!0);case 2:e.__P_249_1=!0;case 3:case"end":return t.stop()}},t)})));e._watcher.on("error",function(e){qx.tool.compiler.Console.print("ENOSPC"==e.code?"qx.tool.cli.watch.enospcError":"qx.tool.cli.watch.watchError",e)});case 11:case"end":return t.stop()}},t)}))()},stopWatcher:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._watcher){t.next=5;break}t.next=3;return e._watcher.stop();case 3:e._watcher=null;e.__P_249_1=!1;case 5:case"end":return t.stop()}},t)}))()},isWatching:function(){return Boolean(this._watcher)},waitForRebuildComplete:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.__P_249_6){t.next=3;break}t.next=3;return e.__P_249_6;case 3:case"end":return t.stop()}},t)}))()},rebuildAll:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return e.generateSite();case 2:t.next=4;return e.compileScss();case 4:case"end":return t.stop()}},t)}))()},__P_249_5:function(e,t){this.__P_249_1&&(t.toLowerCase().startsWith(this.getTargetDir().toLowerCase())||this.triggerRebuild(!1))},triggerRebuild:function(e){var t=this;if(this.__P_249_3)this.__P_249_4=!0;else{var r=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return t.rebuildAll();case 2:if(!t.__P_249_4){e.next=6;break}t.__P_249_4=!1;e.next=6;return r();case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.__P_249_3=!0;e.prev=1;t.__P_249_6=r();e.next=5;return t.__P_249_6;case 5:t.__P_249_6=null;case 6:e.prev=6;t.__P_249_3=!1;return e.finish(6);case 9:case"end":return e.stop()}},e,null,[[1,,6,9]])}));return function(){return e.apply(this,arguments)}}();if(this.__P_249_2){clearTimeout(this.__P_249_2);this.__P_249_2=null}this.__P_249_2=setTimeout(n,e?1:250)}},getPages:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o,a,i,s,c,l,u,p;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:s=function(e,t){var r={url:e,title:t},n=a[e];void 0!==n?o[n]=r:i.push(r)};n=t.metadata();o=[];a={};n.site.pages&&n.site.pages.forEach(function(e,t){return"string"==typeof e?a[e]=t:null});i=[];c=_createForOfIteratorHelper(Object.getOwnPropertyNames(e));try{for(c.s();!(l=c.n()).done;){u=l.value;p=e[u];"index.html"===u?s("/",p.title||"Home Page"):(p.permalink||p.navigation)&&s(p.permalink||u,p.title||"Home Page")}}catch(e){c.e(e)}finally{c.f()}i.forEach(function(e){return o.push(e)});n.site.pages=o;case 10:case"end":return r.stop()}},r)}))()},loadPartials:function(e,r){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function i(){var s,c,l,u,p,f,m,d,_,h,g;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:s=r.metadata();c=n.join(o.getSourceDir(),"partials");i.next=4;return t.readdirAsync(c,"utf8");case 4:e=i.sent;l=_createForOfIteratorHelper(e);i.prev=6;l.s();case 8:if((u=l.n()).done){i.next=32;break}p=u.value;if(f=p.match(/^(.+)\.([^.]+)$/)){i.next=13;break}return i.abrupt("continue",30);case 13:m=_slicedToArray(f,3),m[0],d=m[1],_=m[2];i.next=17;return t.readFileAsync(n.join(c,p),"utf8");case 17:h=i.sent;g=void 0;i.prev=19;g=a.template(h);i.next=27;break;case 23:i.prev=23;i.t0=i.catch(19);qx.tool.compiler.Console.log("Failed to load partial "+p+": "+i.t0);return i.abrupt("continue",30);case 27:g.name=p;s.partials[p]=g;"html"===_&&(s.partials[d]=g);case 30:i.next=8;break;case 32:i.next=37;break;case 34:i.prev=34;i.t1=i.catch(6);l.e(i.t1);case 37:i.prev=37;l.f();return i.finish(37);case 40:case"end":return i.stop()}},i,null,[[6,34,37,40],[19,23]])}))()},generateSite:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return new Promise(function(t,r){i(e.getSourceDir()).metadata({site:{title:"Qooxdoo Application Server",description:'Mini website used by "qx serve"',email:"info@qooxdoo.org",twitter_username:"qooxdoo",github_username:"qooxdoo",pages:["/","/about/"]},baseurl:"",url:"",lang:"en",partials:{}}).source(n.join(e.getSourceDir(),"src")).destination(e.getTargetDir()).clean(!0).use(e.loadPartials.bind(e)).use(c()).use(e.getPages.bind(e)).use(s({engine:"dot"})).build(function(e){e?r(e):t()})});case 2:case"end":return t.stop()}},t)}))()},compileScss:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return new Promise(function(t,r){l.render({file:n.join(e.getSourceDir(),"sass","qooxdoo.scss"),outFile:n.join(e.getTargetDir(),"qooxdoo.css")},function(e,n){e?r(e):t(n)})});case 2:o=r.sent;r.next=5;return t.writeFileAsync(n.join(e.getTargetDir(),"qooxdoo.css"),o.css,"utf8");case 5:case"end":return r.stop()}},r)}))()},buildDevtools:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i,s,c,l,u,p;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=e.getAppsNamespace();r.chdir(e.getTargetDir());s=n.join(e.getTargetDir(),i);a.next=5;return t.existsAsync(s);case 5:if(!a.sent){a.next=7;break}o.sync(s);case 7:c={noninteractive:!0,namespace:i,theme:"indigo",icontheme:"Tango"};a.next=10;return new qx.tool.cli.commands.Create(c).process();case 10:r.chdir(s);l=0,u=["apiviewer","widgetbrowser","playground","demobrowser"];case 12:if(!(l<u.length)){a.next=19;break}p=u[l];a.next=16;return new qx.tool.cli.commands.package.Install({}).install("qooxdoo/qxl."+p);case 16:l++;a.next=12;break;case 19:case"end":return a.stop()}},a)}))()}}});qx.tool.utils.Website.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Serve":{require:!0},"qx.tool.cli.commands.Compile":{},"qx.core.Assert":{},"qx.tool.cli.api.Test":{},"qx.tool.compiler.Console":{defer:"runtime"},"qx.data.Array":{}}};qx.Bootstrap.executePendingDefers(e);require("./Serve");var t=require("fs"),r=require("path"),n=require("process");qx.Class.define("qx.tool.cli.commands.Test",{extend:qx.tool.cli.commands.Serve,statics:{CONFIG_FILENAME:"compile-test.json",YARGS_BUILDER:{verbose:{describe:"Verbose logging",alias:"v",type:"boolean"},diag:{describe:"show diagnostic output",type:"boolean"},terse:{describe:"show only summary and errors",type:"boolean"},class:{describe:"only run tests of this class",type:"string"},method:{describe:"only run tests of this method",type:"string"},"fail-fast":{describe:"Exit on first failing test",defaut:!0,type:"boolean"},serve:{describe:"Run built-in server",default:!0,type:"boolean"}},getYargsCommand:function(){return{command:"test",describe:"run test for current project",builder:function(){var e=Object.assign({},qx.tool.cli.commands.Compile.YARGS_BUILDER,qx.tool.cli.commands.Serve.YARGS_BUILDER,qx.tool.cli.commands.Test.YARGS_BUILDER);delete e.watch;delete e["machine-readable"];delete e.feedback;return e}()}}},events:{runTests:"qx.event.type.Data"},members:{errorCode:0,__P_213_0:null,registerTest:function(e){var t=this;qx.core.Assert.assertInstance(e,qx.tool.cli.api.Test);e.addListenerOnce("changeExitCode",function(r){var o=r.getData();o&&(t.errorCode=o);if(0===o)e.getName()&&!t.argv.quiet&&qx.tool.compiler.Console.info("Test '".concat(e.getName(),"' passed."));else{e.getName()&&qx.tool.compiler.Console.error("Test '".concat(e.getName(),"' failed with exit code ").concat(o,"."));t.argv.failFast&&n.exit(o)}});this.__P_213_0.push(e)},process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.argv.watch=!1;this.argv["machine-readable"]=!1;this.argv.feedback=!1;!this.argv.configFile&&t.existsSync(r.join(n.cwd(),qx.tool.cli.commands.Test.CONFIG_FILENAME))&&(this.argv.configFile=qx.tool.cli.commands.Test.CONFIG_FILENAME);this.addListener("making",function(){if(!o.hasListener("runTests")){qx.tool.compiler.Console.error("No test runner registered!\n               Please register a testrunner, e.g. testtapper with:\n               qx package install @qooxdoo/qxl.testtapper\n              ");n.exit(-1)}});this.__P_213_0=new qx.data.Array;this.addListener("afterStart",function(){o.fireDataEvent("runTests",o).then(function(){n.exit(o.errorCode)})});if(!this.argv.serve){e.next=12;break}e.next=10;return qx.tool.cli.commands.Test.prototype.process.base.call(this);case 10:e.next=15;break;case 12:e.next=14;return qx.tool.cli.commands.Compile.prototype.process.call(this);case 14:this.fireEvent("afterStart");case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},defer:function(e){qx.tool.compiler.Console.addMessageIds({"qx.tool.cli.test.noAppName":"Cannot run anything because the config.json does not specify a unique application name","qx.tool.cli.test.tooManyMakers":"Cannot run anything because multiple targets are detected","qx.tool.cli.test.tooManyApplications":"Cannot run anything because multiple applications are detected"})}});qx.tool.cli.commands.Test.$$dbClassInfo=e}();function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.config.Manifest":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("fs"),r=require("process"),n=require("upath");require("../Command");qx.Class.define("qx.tool.cli.commands.add.Class",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"class <classname> [options]",describe:"adds a new class file to the current project, based on a template.",builder:{type:{alias:"t",describe:"the type of the class (optional).",default:"default"},extend:{alias:"e",describe:"the base class of the new class"},import:{describe:"import the template to the `templates/class` folder of the current project, where it can be customized"},force:{alias:"f",describe:"overwrite an existing file"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o,a,i,s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C,S;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=this.argv;e.next=3;return qx.tool.config.Manifest.getInstance().load();case 3:a=e.sent;i=a.getData();(s=Object.assign({},i.info,i.provides)).authors="";s.classname=o.classname;s.extend=o.extend?o.extend:"qx.core.Object";s.copyright=(new Date).getFullYear();c=o.classname.split(/\./);l=s.namespace.split(/\./);if(c[0]===l[0]){e.next=14;break}throw new qx.tool.utils.Utils.UserError("Invalid top namespace '".concat(c[0],"'. Must be '").concat(l[0],"'."));case 14:u=o.type;f=[n.join(r.cwd(),"templates"),this.getTemplateDir()];m=!1;d=0,_=f;case 18:if(!(d<_.length)){e.next=29;break}h=_[d];p=n.join(h,"class",u+".tmpl.js");e.next=23;return t.existsAsync(p);case 23:if(!e.sent){e.next=26;break}m=!0;return e.abrupt("break",29);case 26:d++;e.next=18;break;case 29:if(m){e.next=31;break}throw new qx.tool.utils.Utils.UserError("Template ".concat(u," does not exist."));case 31:e.next=33;return t.readFileAsync(p,"utf-8");case 33:g=e.sent;y=n.join(r.cwd(),"header.js");try{x=t.readFileSync(y,"utf-8")}catch(e){y=n.join(n.dirname(p),"header.tmpl.js");try{x=t.readFileSync(y,"utf-8")}catch(e){}}if(x){if(y.includes(".tmpl.js"))for(v in s)x=x.replace(new RegExp("\\${".concat(v,"}"),"g"),s[v]);s.header=x}b=g;for(q in s)b=b.replace(new RegExp("\\${".concat(q,"}"),"g"),s[q]);P=n.join.apply(n,["source","class"].concat(_toConsumableArray(c)))+".js";k=n.join(r.cwd(),P);w=!1;try{t.accessSync(k);w=!0}catch(e){}if(!w||o.force){e.next=45;break}throw new qx.tool.utils.Utils.UserError("Class file ".concat(P," already exists. Use --force to overwrite it"));case 45:e.prev=45;require("mkdirp").sync(n.dirname(k),493);e.next=49;return t.writeFileAsync(k,b,"utf-8");case 49:e.next=54;break;case 51:e.prev=51;e.t0=e.catch(45);throw new qx.tool.utils.Utils.UserError("Cannot write to ".concat(k,": ").concat(e.t0.message));case 54:if(!o.import){e.next=66;break}C=n.join(r.cwd(),"templates","class");S=n.join(C,n.basename(p));e.prev=57;require("mkdirp").sync(C,493);e.next=61;return t.writeFileAsync(S,g,"utf-8");case 61:e.next=66;break;case 63:e.prev=63;e.t1=e.catch(57);throw new qx.tool.utils.Utils.UserError("Cannot copy template to ".concat(C,": ").concat(e.t1.message));case 66:case"end":return e.stop()}},e,this,[[45,51],[57,63]])}));return function(){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.add.Class.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Command":{require:!0},"qx.tool.config.Manifest":{},"qx.tool.utils.Utils":{},"qx.tool.compiler.Console":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("fs"),r=require("process"),n=require("upath"),o=require("inquirer");require("../Command");qx.Class.define("qx.tool.cli.commands.add.Script",{extend:qx.tool.cli.commands.Command,statics:{getYargsCommand:function(){return{command:"script <scriptpath> [options]",describe:"adds a new script file to the current project, to be loaded before application startup.",builder:{resourcedir:{describe:"The subdirectory of the resource folder in which to place the file",alias:"d",default:"js"},rename:{describe:"Rename the file to the given name",alias:"r"},undo:{describe:"Removes the file that would normally be added with the given arguments",alias:"z"},noninteractive:{alias:"I",describe:"Do not prompt user"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var a,i,s,c,l,u,p,f,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.config.Manifest.getInstance().load();case 2:a=e.sent;i=a.getValue("provides.namespace");s=this.argv.scriptpath;c=n.basename(s);l=n.join(r.cwd(),"source","resource",i,this.argv.resourcedir);u=n.join(l,this.argv.rename||c);p=n.join(i,this.argv.resourcedir,this.argv.rename||c);if(s.endsWith(".js")){e.next=11;break}throw new qx.tool.utils.Utils.UserError("File doesn't seem to be a javascript file.");case 11:e.next=13;return t.existsAsync(s);case 13:e.t0=!e.sent;if(!e.t0){e.next=16;break}e.t0=!this.argv.undo;case 16:if(!e.t0){e.next=18;break}throw new qx.tool.utils.Utils.UserError("File does not exist: ".concat(s));case 18:e.next=20;return t.existsAsync(u);case 20:e.t1=e.sent;if(!e.t1){e.next=23;break}e.t1=!this.argv.undo;case 23:if(!e.t1){e.next=30;break}if(this.argv.noninteractive){e.next=30;break}f={type:"confirm",name:"doOverwrite",message:"Script already exists and will be overwritten. Do you want to proceed?",default:"y"};e.next=28;return o.prompt(f);case 28:e.sent.doOverwrite||r.exit(0);case 30:m=a.getValue("externalResources.script")||[];if(!this.argv.undo){e.next=40;break}m.includes(p)&&(m=m.filter(function(e){return e!==p}));e.next=35;return t.existsAsync(u);case 35:if(!e.sent){e.next=38;break}e.next=38;return t.unlinkAsync(u);case 38:e.next=47;break;case 40:e.next=42;return t.existsAsync(l);case 42:if(e.sent){e.next=44;break}require("mkdirp").sync(l,493);case 44:e.next=46;return t.copyFileAsync(s,u);case 46:m.includes(p)||m.push(p);case 47:qx.tool.compiler.Console.debug(m);a.setValue("externalResources.script",m).save();case 49:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.add.Script.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){r.push(i.value);if(t&&r.length===t)break}}catch(e){o=!0;a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.compiler.Console":{},"qx.tool.utils.Utils":{},"qx.tool.cli.ConfigDb":{},"qx.tool.config.Registry":{},"qx.tool.config.Abstract":{},"qx.tool.config.Manifest":{},"qx.tool.utils.Json":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("fs"),r=require("upath"),n=require("process"),o=require("@octokit/rest").Octokit,a=require("semver"),i=require("inquirer"),s=require("glob");qx.Class.define("qx.tool.cli.commands.package.Publish",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"publish",describe:"publishes a new release of the package on GitHub. Requires a GitHub access token. By default, makes a patch release.",builder:{type:{alias:"t",describe:"Set the release type",nargs:1,requiresArg:!0,choices:"major,premajor,minor,preminor,patch,prepatch,prerelease".split(/,/),type:"string",default:"patch"},noninteractive:{alias:"I",describe:"Do not prompt user"},"use-version":{alias:"V",describe:"Use given version number"},prerelease:{alias:"p",describe:"Publish as a prerelease (as opposed to a stable release)"},quiet:{alias:"q",describe:"No output"},message:{alias:"m",describe:"Set commit/release message"},dryrun:{alias:"d",describe:"Show result only, do not publish to GitHub"},verbose:{alias:"v",describe:"Verbose logging"},force:{alias:"f",describe:"Ignore warnings (such as demo check)"},"create-index":{alias:"i",describe:"Create an index file (qooxdoo.json) with paths to Manifest.json files"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s,c,l,u,p,f,m,d,_,h,g,x,y,v,b,q,P,k,w,C,S,T,A,E,R,O,I,j,D,N,L,M,G,F,U,B,$,W,J,V,H,z,Y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.commands.package.Publish.prototype.process.base.call(this);case 2:s=this.argv;e.next=5;return this.getUserQxVersion();case 5:c=e.sent;s.verbose&&qx.tool.compiler.Console.log(">>> qooxdoo version:  ".concat(c));e.next=9;return this.exec("git status --porcelain");case 9:if(""===e.sent.trim()){e.next=12;break}throw new qx.tool.utils.Utils.UserError("Please commit or stash all remaining changes first.");case 12:e.next=14;return this.exec("git status --porcelain --branch");case 14:if(!e.sent.includes("ahead")){e.next=17;break}throw new qx.tool.utils.Utils.UserError("Please push all local commits to GitHub first.");case 17:e.next=19;return qx.tool.cli.ConfigDb.getInstance();case 19:l=e.sent;if((u=l.db("github",{})).token){e.next=30;break}e.next=24;return i.prompt([{type:"input",name:"token",message:"Publishing to GitHub requires an API token - visit https://github.com/settings/tokens to obtain one (you must assign permission to publish);\nWhat is your GitHub API Token ? "}]);case 24:if((p=e.sent).token){e.next=28;break}qx.tool.compiler.Console.error("You have not provided a GitHub token.");return e.abrupt("return");case 28:u.token=p.token;l.save();case 30:if(f=u.token){e.next=33;break}throw new qx.tool.utils.Utils.UserError("GitHub access token required.");case 33:m=new o({auth:f});if(!s.i){e.next=37;break}e.next=37;return this.__P_216_0(s);case 37:h=[];x=n.cwd();y=qx.tool.config.Registry.getInstance();e.next=42;return y.exists();case 42:if(!e.sent){e.next=68;break}e.next=45;return y.load();case 45:d=y.getValue("libraries");v=_createForOfIteratorHelper(d);e.prev=47;v.s();case 49:if((b=v.n()).done){e.next=58;break}q=b.value;e.next=53;return new qx.tool.config.Abstract(qx.tool.config.Manifest.config).set({baseDir:r.join(x,q.path)}).load();case 53:P=e.sent;h.push(P);if(!_||q.main){_=P.getValue("info.version");g=P}case 56:e.next=49;break;case 58:e.next=63;break;case 60:e.prev=60;e.t0=e.catch(47);v.e(e.t0);case 63:e.prev=63;v.f();return e.finish(63);case 66:e.next=75;break;case 68:e.next=70;return qx.tool.config.Manifest.getInstance().load();case 70:g=e.sent;h.push(g);if(s.force||!g.getValue("provides.namespace").includes(".demo")){e.next=74;break}throw new qx.tool.utils.Utils.UserError("This seems to be the library demo. Please go into the library root directory to publish the library.");case 74:d=[{path:"."}];case 75:if(!s.useVersion){e.next=82;break}if(k=a.coerce(s.useVersion)){e.next=79;break}throw new qx.tool.utils.Utils.UserError("".concat(s.useVersion," is not a valid version number."));case 79:k=k.toString();e.next=86;break;case 82:w=g.getValue("info.version");if(a.valid(w)){e.next=85;break}throw new qx.tool.utils.Utils.UserError("Invalid version number in Manifest. Must be a valid semver version (x.y.z).");case 85:k=a.inc(w,s.type);case 86:C="v".concat(k);e.prev=87;e.next=90;return this.exec("git config --get remote.origin.url");case 90:S=e.sent.trim();e.next=96;break;case 93:e.prev=93;e.t1=e.catch(87);throw new qx.tool.utils.Utils.UserError("Cannot determine remote repository.");case 96:T=S.replace(/(https:\/\/github.com\/|git@github.com:)/,"").replace(/\.git/,"");A=T.split(/\//),E=_slicedToArray(A,2),R=E[0],O=E[1];s.verbose&&qx.tool.compiler.Console.log(">>> Repository:  ".concat(T));I=!1;e.prev=100;e.next=103;return m.repos.getReleaseByTag({owner:R,repo:O,tag:C});case 103:I=!0;e.next=108;break;case 106:e.prev=106;e.t2=e.catch(100);case 108:if(!I){e.next=110;break}throw new qx.tool.utils.Utils.UserError("A release with tag '".concat(C," already exists.'"));case 110:e.prev=110;e.next=113;return m.repos.getAllTopics({owner:R,repo:O});case 113:j=e.sent;D=j.data.names;e.next=122;break;case 117:e.prev=117;e.t3=e.catch(110);if(!e.t3.message.includes("Bad credentials")){e.next=121;break}throw new qx.tool.utils.Utils.UserError("Your token is invalid.");case 121:throw e.t3;case 122:N=!0;if(s.noninteractive){e.next=129;break}L={type:"confirm",name:"doRelease",message:"This will ".concat(s.version?"set":"increment"," the version to ").concat(k," and create a release of the current master on GitHub. Do you want to proceed?"),default:"y"};e.next=127;return i.prompt(L);case 127:M=e.sent;N=M.doRelease;case 129:N||n.exit(0);G=g.getValue("requires.@qooxdoo/framework");a.satisfies(c,G,{loose:!0})||(G+="^"+c);for(F=0,U=h;F<U.length;F++){(B=U[F]).setValue("requires.@qooxdoo/framework",G).setValue("info.version",k);if(s.dryrun){if(!s.quiet){qx.tool.compiler.Console.info("Dry run: Not committing ".concat(B.getRelativeDataPath()," with the following content:"));qx.tool.compiler.Console.info(B.getData())}}else B.save()}$=r.join(n.cwd(),"package.json");e.next=136;return t.existsAsync($);case 136:if(!e.sent){e.next=148;break}e.next=139;return qx.tool.utils.Json.loadJsonAsync($);case 139:(W=e.sent).version=k;if(!this.argv.dryrun){e.next=145;break}qx.tool.compiler.Console.info("Dry run: Not changing package.json version...");e.next=148;break;case 145:e.next=147;return qx.tool.utils.Json.saveJsonAsync($,W);case 147:this.argv.quiet||qx.tool.compiler.Console.info("Updated version in package.json.");case 148:if(s.dryrun){qx.tool.compiler.Console.info("Dry run: not creating tag and release '".concat(C,"' of ").concat(T,"..."));n.exit(0)}if(!s.message){e.next=153;break}J=s.message.replace(/"/g,'\\"');e.next=159;break;case 153:if(s.noninteractive){e.next=159;break}V={type:"input",name:"message",message:"Please enter a commit message:"};e.next=157;return i.prompt([V]);case 157:H=e.sent;J=H.message;case 159:J||(J="Release v".concat(k));s.quiet||qx.tool.compiler.Console.info("Creating tag and release '".concat(C,"' of ").concat(T,"..."));e.prev=161;e.next=164;return this.run("git",["add","--all"]);case 164:e.next=166;return this.run("git",["commit",'-m "'.concat(J,'"'),"--allow-empty"]);case 166:e.next=168;return this.run("git",["push"]);case 168:z={owner:R,repo:O,tag_name:C,target_commitish:"master",name:C,body:J,draft:!1,prerelease:Boolean(s.prerelease)};e.next=171;return m.repos.createRelease(z);case 171:s.quiet||qx.tool.compiler.Console.info("Published new version '".concat(C,"'."));e.next=177;break;case 174:e.prev=174;e.t4=e.catch(161);throw new qx.tool.utils.Utils.UserError(e.t4.message);case 177:Y="qooxdoo-package";if(D.includes(Y)){e.next=183;break}D.push(Y);e.next=182;return m.repos.replaceTopics({owner:R,repo:O,names:D});case 182:s.quiet||qx.tool.compiler.Console.info("Added GitHub topic '".concat(Y,"'."));case 183:case"end":return e.stop()}},e,this,[[47,60,63,66],[87,93],[100,106],[110,117],[161,174]])}));return function(){return e.apply(this,arguments)}}(),__P_216_0:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,a){o.verbose&&!o.quiet&&qx.tool.compiler.Console.info("Creating index file...");s(qx.tool.config.Manifest.config.fileName,{matchBase:!0},function(){var s=_asyncToGenerator(regeneratorRuntime.mark(function s(c,l){var u,p,f,m,d;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:c&&a(c);l&&l.length||a(new qx.tool.utils.Utils.UserError("No Manifest.json files could be found"));if(!(l.length>1)){s.next=8;break}p=l.map(function(e){var o=qx.tool.utils.Json.parseJson(t.readFileSync(r.join(n.cwd(),e),"utf-8"));return{name:o.info.name+(o.info.summary?": "+o.info.summary:""),value:e}});s.next=6;return i.prompt({name:"mainpath",message:"Please choose the main library",type:"list",choices:p});case 6:f=s.sent;u=f.mainpath;case 8:m={libraries:l.map(function(e){return l.length>1&&e===u?{path:r.dirname(e),main:!0}:{path:r.dirname(e)}})};d=qx.tool.config.Registry.getInstance();if(!o.dryrun){s.next=15;break}qx.tool.compiler.Console.info("Dry run: not creating index file ".concat(d.getRelativeDataPath()," with the following content:"));qx.tool.compiler.Console.info(m);s.next=20;break;case 15:s.next=17;return d.load(m);case 17:s.next=19;return d.save();case 19:o.quiet||qx.tool.compiler.Console.info("Created index file ".concat(d.getRelativeDataPath(),"'."));case 20:e();case 21:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.Publish.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.cli.commands.Package":{require:!0},"qx.tool.utils.Utils":{},"qx.tool.compiler.Console":{},"qx.tool.utils.Json":{},"qx.tool.config.Manifest":{},"qx.tool.config.Compile":{}}};qx.Bootstrap.executePendingDefers(e);require("../Package");require("@qooxdoo/framework");var t=require("fs"),r=require("upath"),n=require("rimraf");qx.Class.define("qx.tool.cli.commands.package.Remove",{extend:qx.tool.cli.commands.Package,statics:{getYargsCommand:function(){return{command:"remove [uri]",describe:"removes a package from the configuration.",builder:{verbose:{alias:"v",describe:"Verbose logging"},quiet:{alias:"q",describe:"No output"}}}}},members:{process:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var o,a,i,s,c,l,u,p,f,m,d,_,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.cli.commands.package.Remove.prototype.process.base.call(this);case 2:if(this.argv.uri){e.next=4;break}throw new qx.tool.utils.Utils.UserError("No repository name given.");case 4:e.next=6;return this.getLockfileData();case 6:o=e.sent;a=this.argv.uri.split(/\//);i=a.length>2?"uri":"repo_name";s=[];c=[];l=_createForOfIteratorHelper(o.libraries);e.prev=12;l.s();case 14:if((u=l.n()).done){e.next=30;break}if((p=u.value)[i]!==this.argv.uri){e.next=27;break}e.next=19;return this.__P_217_0(p.uri);case 19:e.next=21;return this.__P_217_1(p.uri);case 21:f=p.path.split(/\//).length;m=p.path;f>a.length&&(m=r.dirname(m));s.includes(m)||s.push(m);e.next=28;break;case 27:c.push(p);case 28:e.next=14;break;case 30:e.next=35;break;case 32:e.prev=32;e.t0=e.catch(12);l.e(e.t0);case 35:e.prev=35;l.f();return e.finish(35);case 38:if(s.length){d=_createForOfIteratorHelper(s);try{for(d.s();!(_=d.n()).done;){h=_.value;n.sync(h)}}catch(e){d.e(e)}finally{d.f()}this.argv.quiet||qx.tool.compiler.Console.info("Deleted ".concat(s.length," entries for ").concat(this.argv.uri))}else this.argv.verbose&&qx.tool.compiler.Console.warn("No entry for ".concat(this.argv.uri));o.libraries=c;t.writeFileSync(this.getLockfilePath(),JSON.stringify(o,null,2),"utf-8");this.argv.verbose&&qx.tool.compiler.Console.info(">>> Done.");case 42:case"end":return e.stop()}},e,this,[[12,32,35,38]])}));return function(){return e.apply(this,arguments)}}(),__P_217_1:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.Json.loadJsonAsync(qx.tool.config.Manifest.config.fileName);case 2:if(!(r=e.sent).requires||!r.requires[t]){e.next=7;break}delete r.requires[t];e.next=7;return qx.tool.utils.Json.saveJsonAsync(qx.tool.config.Manifest.config.fileName,r);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),__P_217_0:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,a,i,s,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.getLockfileData();case 2:n=e.sent;if(o=n.libraries.find(function(e){return e.uri===t})){e.next=6;break}throw new Error("Repo for "+t+" is not an installed package");case 6:e.next=8;return qx.tool.utils.Json.loadJsonAsync(r.join(o.path,qx.tool.config.Manifest.config.fileName));case 8:if((a=e.sent)&&a.provides&&a.provides.application){e.next=12;break}this.argv.verbose&&qx.tool.compiler.Console.info(">>> No application to remove.");return e.abrupt("return");case 12:e.next=14;return qx.tool.utils.Json.loadJsonAsync(qx.tool.config.Compile.config.fileName);case 14:i=e.sent;s=a.provides.application;if(!(c=i.applications.find(function(e){return s.name&&e.name?s.name===e.name:s.class===e.class}))){e.next=23;break}l=i.applications.indexOf(c);i.applications.splice(l,1);this.argv.verbose&&qx.tool.compiler.Console.info(">>> Removed application "+(c.name||c.class));e.next=23;return qx.tool.utils.Json.saveJsonAsync(qx.tool.config.Compile.config.fileName,i);case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}});qx.tool.cli.commands.package.Remove.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.IndexedArray":{construct:!0},"qx.tool.compiler.resources.Manager":{},"qx.tool.utils.Json":{},"qx.tool.compiler.Console":{},"qx.tool.compiler.jsdoc.Parser":{},"qx.lang.Type":{},"qx.lang.String":{},"qx.lang.Array":{},"qx.tool.compiler.ClassFile":{},"qx.tool.utils.files.Utils":{},"qx.tool.utils.Promisify":{},"qx.tool.compiler.app.Cldr":{},"qx.tool.compiler.app.Translation":{},"qx.Promise":{},"qx.tool.compiler.Version":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs"),r=require("async");require("@qooxdoo/framework");var n=require("./util"),o=require("jsonlint"),a=require("object-hash");require("./ClassFile");require("./app/Library");require("./resources/Manager");var i=n.promisify(t.readFile),s=n.promisify(t.writeFile),c=n.createLog("analyser");qx.Class.define("qx.tool.compiler.Analyser",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_218_0=e||"db.json";this.__P_218_1=[];this.__P_218_2={};this.__P_218_3=new qx.tool.utils.IndexedArray;this.__P_218_4={};this.__P_218_5={};this.__P_218_6={};this.__P_218_7={}},properties:{outputDir:{nullable:!0,check:"String"},trackLineNumbers:{check:"Boolean",init:!1,nullable:!1},processResources:{init:!0,nullable:!1,check:"Boolean"},addCreatedAt:{init:!1,nullable:!1,check:"Boolean"},environment:{init:null,check:"Map",apply:"_applyEnvironment"},babelConfig:{init:null,nullable:!0,check:"Object"},ignores:{init:[],nullable:!1,check:"Array"},globalSymbols:{init:[],nullable:!1,check:"Array"},manglePrivates:{init:"readable",check:["off","readable","unreadable"]},writePoLineNumbers:{init:!1,check:"Boolean"}},events:{compilingClass:"qx.event.type.Data",compiledClass:"qx.event.type.Data",alreadyCompiledClass:"qx.event.type.Data",saveDatabase:"qx.event.type.Data"},members:{__P_218_8:!1,__P_218_9:null,__P_218_0:null,__P_218_10:null,__P_218_1:null,__P_218_2:null,__P_218_11:null,__P_218_3:null,__P_218_4:null,__P_218_5:null,__P_218_6:null,__P_218_7:null,__P_218_12:!1,__P_218_13:null,__P_218_14:null,open:function(){var e;if(this.__P_218_8)e=Promise.resolve();else{this.__P_218_8=!0;var t=null;this.isProcessResources()&&(t=new qx.tool.compiler.resources.Manager(this));this.__P_218_9=t;e=Promise.all([this.loadDatabase(),t&&t.loadDatabase()])}return e},initialScan:function(e){var t=this;this.__P_218_10||(this.__P_218_10={});c.debug("Scanning source code");r.parallel([function(e){t.__P_218_9?t.__P_218_9.findAllResources().then(function(){return e()}).catch(e):e(null)},function(e){r.each(t.__P_218_1,function(e,t){e.scanForClasses(function(r){c.debug("Finished scanning for "+e.getNamespace());t(r)})},function(t){c.debug("Finished scanning for all libraries");e(t)})}],function(t){c.debug("processed source and resources");e(t)})},loadDatabase:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.utils.Json.loadJsonAsync(e.getDbFilename());case 2:t.t0=t.sent;if(t.t0){t.next=5;break}t.t0={};case 5:e.__P_218_10=t.t0;case 6:case"end":return t.stop()}},t)}))()},resetDatabase:function(){this.__P_218_10=null;if(this.__P_218_9){this.__P_218_9.dispose();this.__P_218_9=null}this.__P_218_8=!1;return this.open()},saveDatabase:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:c.debug("saving generator database");e.fireDataEvent("saveDatabase",e.__P_218_10);t.next=4;return qx.tool.utils.Json.saveJsonAsync(e.getDbFilename(),e.__P_218_10).then(function(){return e.__P_218_9&&e.__P_218_9.saveDatabase()});case 4:case"end":return t.stop()}},t)}))()},getDatabase:function(){return this.__P_218_10},analyseClasses:function(e){var t=this;this.__P_218_10||(this.__P_218_10={});var n=this.__P_218_10,a={},c={},l={},u=this.addListener("compiledClass",function(e){var t=e.getData();if(t.oldDbClassInfo){t.oldDbClassInfo.extends&&(l[t.oldDbClassInfo.extends]=!0);t.oldDbClassInfo.implement&&t.oldDbClassInfo.implement.forEach(function(e){return l[e]=!0});t.oldDbClassInfo.include&&t.oldDbClassInfo.include.forEach(function(e){return l[e]=!0})}t.dbClassInfo.extends&&(l[t.dbClassInfo.extends]=!0);t.dbClassInfo.implement&&t.dbClassInfo.implement.forEach(function(e){return l[e]=!0});t.dbClassInfo.include&&t.dbClassInfo.include.forEach(function(e){return l[e]=!0});c[t.classFile.getClassName()]=t});r.each(this.__P_218_1,function(e,t){e.scanForClasses(t)},function(){var n=0,o=t.__P_218_11=t.__P_218_3.toArray();function a(e){var r=[],n=t.__P_218_10.classInfo[e];if(n.dependsOn)for(var o in n.dependsOn)n.dependsOn[o].construct&&r.push(o);return r}r.whilst(function(){return n<o.length},function(e){t.getClassInfo(o[n++],function(r,n){if(n){var o=n.dependsOn;for(var a in o)t._addRequiredClass(a)}if(r&&"ENOCLASSFILE"===r.code){qx.tool.compiler.Console.error(r.message);r=null}return e(r)})},function(r){if(r)e&&e(r);else{o.forEach(function(e){var r=t.__P_218_10.classInfo[e];(function(e){var r=[],n=t.__P_218_10.classInfo[e];if(n&&n.dependsOn)for(var o in n.dependsOn)n.dependsOn[o].load&&a(o).forEach(function(e){r.push(e)});return r})(e).forEach(function(e){r.dependsOn||(r.dependsOn={});r.dependsOn[e]||(r.dependsOn[e]={});r.dependsOn[e].load=!0})});t.removeListenerById(u);(function(){return v.apply(this,arguments)})().then(function(){return e()}).catch(function(t){return e(t)})}})});function p(e,r){function n(r){r&&r.jsdoc&&qx.tool.compiler.jsdoc.Parser.parseJsDoc(r.jsdoc,e,t)}function o(e){var t=r[e];if(t)for(var o in t)n(t[o])}o("properties");o("events");o("members");o("statics");n(r.clazz);n(r.construct);n(r.destruct);n(r.defer)}function f(e,t){return m.apply(this,arguments)}function m(){return(m=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a,i,s,c,l,u,p,f,m,d,_,h,x,y,v,b,q,P;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=function(e,t){if(e&&i(e)&&!i(t.jsdoc)){t.jsdoc||(t.jsdoc={});e["@param"]&&(t.jsdoc["@param"]=qx.lang.Array.clone(e["@param"]));e["@return"]&&(t.jsdoc["@return"]=qx.lang.Array.clone(e["@return"]))}};i=function(e){return e&&(e["@param"]&&e["@param"].length||e["@return"]&&e["@return"].length)};a=function(){return(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var a,i,s,c,l,u,p,f,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=4;break}e.next=3;return g(t);case 3:t=e.sent;case 4:if(t){e.next=6;break}return e.abrupt("return");case 6:["members","properties"].forEach(function(e){if(t[e])for(var o in t[e]){var a=t[e][o];if("function"===a.type||"properties"===e){var i=n[e][o];i||(i=n[e][o]={appearsIn:{},overriddenFrom:null,jsdoc:null,abstract:"interface"===t.type,mixin:"mixin"===t.type&&!r,inherited:!r,access:o.startsWith("__P_218_15")?"private":o.startsWith("_")?"protected":"public"});a.event&&(i.event=a.event);a.property&&(i.property=a.property);"mixin"===t.type&&i.abstract&&(i.mixin=!0);"interface"!==t.type?i.abstract=!1:i.interface=!0;r||(i.appearsIn[t.className]=t.type);r||i.overriddenFrom||(i.overriddenFrom=t.className);i.jsdoc||(i.jsdoc=a.jsdoc)}}});if(!t.interfaces){e.next=15;break}a=0;case 9:if(!(a<t.interfaces.length)){e.next=15;break}e.next=12;return o(t.interfaces[a]);case 12:a++;e.next=9;break;case 15:if(!t.mixins){e.next=23;break}i=0;case 17:if(!(i<t.mixins.length)){e.next=23;break}e.next=20;return o(t.mixins[i]);case 20:i++;e.next=17;break;case 23:if(!t.superClass){e.next=36;break}if(!qx.lang.Type.isArray(t.superClass)){e.next=34;break}s=0;case 26:if(!(s<t.superClass.length)){e.next=32;break}e.next=29;return o(t.superClass[s]);case 29:s++;e.next=26;break;case 32:e.next=36;break;case 34:e.next=36;return o(t.superClass);case 36:if(t.properties){c=function(e,t,o,a,i,s){var c=n.members[t];if(!c||c.abstract){var l=n.members[t]={appearsIn:c?c.appearsIn:{},overriddenFrom:c&&c.appearsIn[0]||null,jsdoc:{"@description":[{name:"@description",body:s}]},property:o,inherited:!r,mixin:e.mixin,access:"public"};a&&(l.jsdoc["@return"]=[{name:"@return",type:a,desc:"Returns the value for "+e.name}]);i&&(l.jsdoc["@param"]=[{name:"@param",type:i,paramName:"value",desc:"Value for "+e.name}])}};for(l in t.properties){u=t.properties[l];p=qx.lang.String.firstUp(l);f=u.check||"any";c(u,"get"+p,"get",f,null,m="Gets the (computed) value of the property <code>"+l+"</code>.\n\nFor further details take a look at the property definition: {@link #"+l+"}.");"Boolean"==f&&c(u,"is"+p,"is",f,null,m);c(u,"set"+p,"set",null,f,"Sets the user value of the property <code>"+l+"</code>.\n\nFor further details take a look at the property definition: {@link #"+l+"}.");c(u,"reset"+p,"reset",null,null,"Resets the user value of the property <code>"+l+"</code>.\n\nThe computed value falls back to the next available value e.g. appearance, init or inheritance value depending on the property configuration and value availability.\n\nFor further details take a look at the property definition: {@link #"+l+"}.");if(u.async){c(u,"get"+p+"Async","getAsync","Promise",null,m="Returns a {@link qx.Promise} which resolves to the (computed) value of the property <code>"+l+"</code>.\nFor further details take a look at the property definition: {@link #"+l+"}.");"Boolean"==f&&c(u,"is"+p+"Async","isAsync","Promise",null,m);c(u,"set"+p+"Async","setAsync","Promise",f,"Sets the user value of the property <code>"+l+"</code>, returns a {@link qx.Promise} which resolves when the value change has fully completed (in the case where there are asynchronous apply methods or events).\n\nFor further details take a look at the property definition: {@link #"+l+"}.")}}}case 37:case"end":return e.stop()}},e)}))).apply(this,arguments)};o=function(e,t){return a.apply(this,arguments)};n={members:{},properties:{}};e.next=7;return o(r,!0);case 7:if(r.properties){for(c in r.properties)if((l=r.properties[c]).refine&&(u=n.properties[c])){l.overriddenFrom=u.overriddenFrom;l.appearsIn=u.appearsIn;s(u.jsdoc,l)}for(p in n.properties)if(((f=n.properties[p]).abstract||f.mixin)&&!r.properties[f]){m=r.properties[p]={type:"property",name:p,abstract:Boolean(f.abstract),mixin:Boolean(f.mixin),access:f.access,overriddenFrom:f.overriddenFrom,event:f.event};f.appearsIn.length&&(m.appearsIn=Object.keys(f.appearsIn));m.appearsIn&&!m.appearsIn.length&&delete m.appearsIn;f.jsdoc&&(m.jsdoc=f.jsdoc);f.overriddenFrom&&(m.overriddenFrom=f.overriddenFrom);m.overriddenFrom||delete m.overriddenFrom}}r.members||(r.members={});for(d in r.members)if("function"===(_=r.members[d]).type&&(h=n.members[d])){_.overriddenFrom=h.overriddenFrom;_.appearsIn=Object.keys(h.appearsIn);s(h.jsdoc,_)}for(x in n.members){y=n.members[x];(v=r.members[x])&&"variable"===v.type&&y&&(v.type="function");if((y.abstract||y.mixin||y.property)&&!v){b=r.members[x]={type:"function",name:x,abstract:Boolean(y.abstract),mixin:Boolean(y.mixin),inherited:Boolean(y.inherited),access:y.access,overriddenFrom:y.overriddenFrom};y.property&&(b.property=y.property);y.appearsIn.length&&(b.appearsIn=Object.keys(y.appearsIn));y.jsdoc&&(b.jsdoc=y.jsdoc);y.overriddenFrom&&(b.overriddenFrom=y.overriddenFrom);b.abstract&&(r.abstract=!0)}}for(q in r.members){(P=r.members[q]).appearsIn&&!P.appearsIn.length&&delete P.appearsIn;P.overriddenFrom||delete P.overriddenFrom}0==Object.keys(r.members).length&&delete r.members;case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}var d={};function _(e,t){return h.apply(this,arguments)}function h(){return(h=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a[r]){e.next=3;break}qx.tool.compiler.Console.log(" *** ERROR *** Writing "+r+" more than once");throw new Error(" *** ERROR *** Writing "+r+" more than once");case 3:a[r]=!0;o=qx.tool.compiler.ClassFile.getOutputPath(t,r)+"on";return e.abrupt("return",s(o,JSON.stringify(n,null,2),{encoding:"utf-8"}));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(e){return x.apply(this,arguments)}function x(){return(x=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("Object"!=r&&"Array"!=r&&"Error"!=r){e.next=2;break}return e.abrupt("return",Promise.resolve(null));case 2:if(!d[r]){e.next=4;break}return e.abrupt("return",Promise.resolve(d[r]));case 4:n=qx.tool.compiler.ClassFile.getOutputPath(t,r)+"on";return e.abrupt("return",i(n,{encoding:"utf-8"}).then(function(e){return o.parse(e)}).then(function(e){return d[r]=e}).catch(function(e){qx.tool.compiler.Console.error("Failed to load meta for "+r+": "+e)}));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(e,t){t.descendants=[];for(var r in n.classInfo){n.classInfo[r].extends==e&&t.descendants.push(r)}}function v(){return(v=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,o,a,i,s,u,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={};for(r in c)(o=d[r]=c[r].classFile.getOuterClassMeta())&&p(r,o);e.t0=regeneratorRuntime.keys(c);case 3:if((e.t1=e.t0()).done){e.next=13;break}a=e.t1.value;if(!(i=d[a])){e.next=11;break}e.next=9;return f(a,i);case 9:y(a,i);t[a]=i;case 11:e.next=3;break;case 13:s=Promise.resolve();u=function(e){!c[e]&&n.classInfo[e]&&(s=s.then(function(){return g(e).then(function(r){if(r){y(e,r);t[e]=r}})}))};for(m in l)u(m);e.next=18;return s.then(function(){return Promise.all(Object.keys(t).map(function(e){return _(e,t[e])}))});case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}},_addRequiredClass:function(e){var t=this;t.__P_218_11||(t.__P_218_11=[]);-1==t.__P_218_11.indexOf(e)&&t.__P_218_11.push(e)},getDependentClasses:function(){return this.__P_218_11},getCachedClassInfo:function(e){return this.__P_218_10?this.__P_218_10.classInfo[e]:null},getClassInfo:function(e,t,r){var n=this;this.__P_218_10||(this.__P_218_10={});var o=this.__P_218_10;if("function"==typeof t){r=t;t=!1}o.classInfo||(o.classInfo={});var a=n.getLibraryFromClassname(e);if(a){var i=qx.tool.compiler.ClassFile.getSourcePath(a,e),s=qx.tool.compiler.ClassFile.getOutputPath(this,e),c=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(){var c,l,u,p,f,m,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return qx.tool.utils.files.Utils.safeStat(i);case 2:if(c=r.sent){r.next=5;break}throw new Error("Cannot find "+i);case 5:l=o.classInfo[e];if(t){r.next=20;break}r.next=9;return qx.tool.utils.files.Utils.safeStat(s);case 9:u=r.sent;r.next=12;return qx.tool.utils.files.Utils.safeStat(s+"on");case 12:p=r.sent;if(!(l&&u&&p)){r.next=20;break}f=null;try{f=l.mtime&&new Date(l.mtime)}catch(e){}if(!f||f.getTime()!=c.mtime.getTime()){r.next=20;break}if(!(u.mtime.getTime()>=c.mtime.getTime())){r.next=20;break}n.fireDataEvent("alreadyCompiledClass",{className:e,dbClassInfo:l});return r.abrupt("return",l);case 20:m=o.classInfo[e]?Object.assign({},o.classInfo[e]):null;l=o.classInfo[e]={mtime:c.mtime,libraryName:a.getNamespace()};d=new qx.tool.compiler.ClassFile(n,e,a);n.fireDataEvent("compilingClass",{dbClassInfo:l,oldDbClassInfo:m,classFile:d});r.next=26;return qx.tool.utils.Promisify.call(function(e){return d.load(e)});case 26:d.writeDbInfo(l);n.fireDataEvent("compiledClass",{dbClassInfo:l,oldDbClassInfo:m,classFile:d});return r.abrupt("return",l);case 29:case"end":return r.stop()}},r)}));return function(){return r.apply(this,arguments)}}();qx.tool.utils.Promisify.callback(c(),r)}else{var l=new Error("Cannot find class file "+e);l.code="ENOCLASSFILE";r&&r(l)}},getCldr:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this;if(!(n=this.__P_218_4[t])){e.next=4;break}return e.abrupt("return",n);case 4:return e.abrupt("return",qx.tool.compiler.app.Cldr.loadCLDR(t).then(function(e){return r.__P_218_4[t]=e}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getTranslation:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this;o=r+":"+t.getNamespace();if(a=n.__P_218_5[o]){e.next=8;break}(a=n.__P_218_5[o]=new qx.tool.compiler.app.Translation(t,r)).setWriteLineNumbers(this.isWritePoLineNumbers());e.next=8;return a.checkRead();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),updateTranslations:function(e,t,r,n){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:r||(r=[]);r=r.filter(function(t){return t!=e});a.next=4;return qx.Promise.all(t.map(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(a){var i,s,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i={};t.next=3;return qx.Promise.all(r.map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=new qx.tool.compiler.app.Translation(t,a);e.next=3;return r.read();case 3:i[t.toHashCode()]=r;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:(s=new qx.tool.compiler.app.Translation(e,a)).setWriteLineNumbers(o.isWritePoLineNumbers());t.next=7;return s.read();case 7:c={};for(l in s.getEntries())c[l]=!0;t.next=11;return qx.Promise.all(o.__P_218_11.map(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(a){var l,u,p,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:f=function(e){return!e||(qx.lang.Type.isArray(e.msgstr)?e.msgstr.every(function(e){return!e}):!e.msgstr)};l=e.isClass(a);u=!l&&r.find(function(e){return e.isClass(a)})||null;if(l||u){t.next=5;break}return t.abrupt("return");case 5:t.next=7;return qx.tool.utils.Promisify.call(function(e){return o.getClassInfo(a,e)});case 7:if((p=t.sent).translations){t.next=10;break}return t.abrupt("return");case 10:p.translations.forEach(function(e){delete c[e.msgid];if(u){var t=s.getEntry(e.msgid);if(!f(t))return;var r=i[u.toHashCode()].getEntry(e.msgid);if(f(r)||n){t||(t=s.getOrCreateEntry(e.msgid));null!==r&&Object.assign(t,r)}}else{var o=s.getOrCreateEntry(e.msgid);e.msgid_plural&&(o.msgid_plural=e.msgid_plural);o.comments||(o.comments={});o.comments.extracted=e.comment;o.comments.reference={};var l=o.comments.reference,p=a.replace(/\./g,"/")+".js",m=function(t){var r=l[p];r||(r=l[p]=[]);r.includes(e.lineNo)||r.push(t)};qx.lang.Type.isArray(e.lineNo)?e.lineNo.forEach(m):m(e.lineNo)}});case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 11:Object.keys(c).forEach(function(e){var t=s.getEntry(e);if(t){t.comments||(t.comments={});if(0==Object.keys(t.comments).length&&""===t.msgstr)s.deleteEntry(e);else{t.comments.extracted="NO LONGER USED";t.comments.reference={}}}});t.next=14;return s.write();case 14:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 4:case"end":return a.stop()}},a)}))()},getQooxdooPath:function(){var e=this.findLibrary("qx");return null!==e?e.getRootDir():null},findLibrary:function(e){return this.__P_218_2[e]},getLibraries:function(){return this.__P_218_1},addLibrary:function(e){this.__P_218_1.push(e);this.__P_218_2[e.getNamespace()]=e},addClass:function(e){this.__P_218_3.push(e)},removeClass:function(e){this.__P_218_3.remove(e)},getSymbolType:function(e){for(var t=0;t<this.__P_218_1.length;t++){var r=this.__P_218_1[t].getSymbolType(e);if(r)return r}return null},getLibraryFromClassname:function(e){var t=this.__P_218_6[e];if(t)return t.library;for(var r=0;r<this.__P_218_1.length;r++){var n=this.__P_218_1[r];if((t=n.getSymbolType(e))&&("class"==t.symbolType||"member"==t.symbolType))return n}return null},getClassFilename:function(e){var t=this.getLibraryFromClassname(e);return t?t.getRootDir()+"/"+t.getSourcePath()+"/"+e.replace(/\./g,"/")+".js":null},setEnvironmentCheck:function(e,t){if("object"==_typeof(e)){var r=e;for(e in r)this.__P_218_7[e]=r[e]}else void 0===t?delete this.__P_218_7[e]:this.__P_218_7[e]=t},getEnvironmentCheck:function(e){return this.__P_218_7[e]},getResourceManager:function(){return this.__P_218_9},getQooxdooVersion:function(){if(this.__P_218_13)return this.__P_218_13;if(!this.__P_218_13){var e=this.findLibrary("qx");e&&(this.__P_218_13=e.getVersion())}return this.__P_218_13},getDbFilename:function(){return this.__P_218_0},getResDbFilename:function(){var e=this.__P_218_0.match(/(^.*)\/([^/]+)$/);return e&&3==e.length?e[1]+"/resource-db.json":"resource-db.json"},_applyEnvironment:function(e){this.__P_218_14=a(e)},isContextChanged:function(){var e=this.getDatabase();return!(!this.__P_218_14||this.__P_218_14===e.environmentHash)||e.compilerVersion!==qx.tool.compiler.Version.VERSION},updateEnvironmentData:function(){var e=this.getLibraries().reduce(function(e,t){e[t.getNamespace()]=t.getVersion();return e},{}),t=this.getDatabase();t.libraries=e;t.environmentHash=this.__P_218_14;t.compilerVersion=qx.tool.compiler.Version.VERSION}}});module.exports=qx.tool.compiler.Analyser;qx.tool.compiler.Analyser.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.compiler.resources.ImageLoader":{construct:!0},"qx.tool.compiler.resources.MetaLoader":{construct:!0},"qx.tool.compiler.resources.ScssConverter":{construct:!0},"qx.tool.utils.Json":{},"qx.tool.utils.Values":{},"qx.lang.Type":{},"qx.Promise":{},"qx.tool.utils.files.Utils":{},"qx.tool.compiler.resources.Asset":{},"qx.tool.utils.Promisify":{},"qx.lang.Array":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath"),r=require("../util").createLog("resource-manager");qx.Class.define("qx.tool.compiler.resources.Manager",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_232_0=e;this.__P_232_1=e.getResDbFilename()||"resource-db.json";this.__P_232_2=[new qx.tool.compiler.resources.ImageLoader,new qx.tool.compiler.resources.MetaLoader];this.__P_232_3=[new qx.tool.compiler.resources.ScssConverter]},members:{__P_232_1:null,__P_232_4:null,__P_232_0:null,__P_232_5:null,__P_232_6:null,__P_232_2:null,__P_232_3:null,loadDatabase:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.utils.Json.loadJsonAsync(e.__P_232_1);case 2:t.t0=t.sent;if(t.t0){t.next=5;break}t.t0={};case 5:e.__P_232_4=t.t0;case 6:case"end":return t.stop()}},t)}))()},saveDatabase:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.debug("saving resource manager database");return t.abrupt("return",qx.tool.utils.Json.saveJsonAsync(e.__P_232_1,e.__P_232_4));case 2:case"end":return t.stop()}},t)}))()},getDatabase:function(){return this.__P_232_4},findLibraryForResource:function(e){var t=this.findLibrariesForResource(e);if(0==t.length)return null;t.length>1&&this.error("Cannot determine a single library for the URI '".concat(e,"'; ")+"found ".concat(t.map(function(e){return e.getNamespace()}).join(",")," returning first library"));return t[0]},findLibrariesForResource:function(e){var r=this,n=function(){var n,o;if(t.isAbsolute(e))return r.__P_232_0.getLibraries().find(function(r){return e.startsWith(t.resolve(r.getRootDir()))})||null;if(-1!==(o=e.indexOf(":"))){n=e.substring(0,o);return r.__P_232_0.findLibrary(n)||null}var a=e.indexOf("$"),i=e.indexOf("*");if(-1===(o=-1===a?i:-1===i?a:Math.min(a,i)))return r.__P_232_5[e]||null;var s="/"===e[o-1];e=e.substring(0,o-1);if(s)return r.__P_232_5[e]||null;r.__P_232_6||(r.__P_232_6=Object.keys(r.__P_232_5).sort());var c=qx.tool.utils.Values.binaryStartsWith(r.__P_232_6,e);if(c>-1){for(var l={};c<r.__P_232_6.length&&r.__P_232_6[c].startsWith(e);c++)-1!==(o=e.indexOf(":"))&&(l[n=e.substring(0,o)]||(l[n]=r.__P_232_0.findLibrary(n)));return Object.values(l)}return null}();return n?qx.lang.Type.isArray(n)?n:[n]:[]},findAllResources:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=e;(o=e.__P_232_4).resources||(o.resources={});n.__P_232_5={};e.__P_232_6=null;e.__P_232_7={};r.next=8;return qx.Promise.all(n.__P_232_0.getLibraries().map(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(n){var a,i,s,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:(a=o.resources[n.getNamespace()])||(o.resources[n.getNamespace()]=a={});i={};for(s in a)i[s]=!0;c=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(o){var s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:s=t.join(n.getRootDir(),n.get(o));r.next=3;return qx.tool.utils.files.Utils.findAllFiles(s,function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r){var c,l,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:c=r.substring(s.length+1).replace(/\\/g,"/");l=a[c];delete i[c];l||(l=a[c]={});l.resourcePath=o;t.next=7;return qx.tool.utils.files.Utils.safeStat(r).mtime;case 7:l.mtime=t.sent;u=new qx.tool.compiler.resources.Asset(n,c,l);e.__P_232_8(u);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}();r.next=7;return c("resourcePath");case 7:r.next=9;return c("themePath");case 9:r.next=11;return qx.Promise.all(Object.keys(i).map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a[t]){e.next=5;break}delete a[t];e.next=9;break;case 5:e.next=7;return qx.tool.utils.files.Utils.safeStat(t);case 7:e.sent||delete a[t];case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 11:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()));case 8:r.next=10;return qx.tool.utils.Promisify.poolEachOf(Object.values(e.__P_232_7),10,function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,o,a,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return r.load();case 2:if((n=r.getFileInfo()).meta)for(o in n.meta){(a=e.findLibraryForResource(o))||(a=r.getLibrary());if(i=e.__P_232_7[a.getNamespace()+":"+o]){i.addMetaReferee(r);r.addMetaReferTo(i)}else e.warn("Cannot find asset "+o+" referenced in "+r)}if(n.dependsOn){s=[];n.dependsOn.forEach(function(t){var n=e.__P_232_7[t];n?s.push(n):e.warn("Cannot find asset "+t+" depended on by "+r)});s.length&&r.setDependsOn(s)}return t.abrupt("return",null);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 10:case"end":return r.stop()}},r)}))()},__P_232_8:function(e){var t=this;this.__P_232_7[e.toUri()]=e;var r=e.getLibrary(),n=e.getFilename(),o="";n.split("/").forEach(function(e,n){n&&(o+="/");o+=e;var a=t.__P_232_5[o];a?qx.lang.Type.isArray(a)?qx.lang.Array.contains(a,r)||a.push(r):a!==r&&(a=t.__P_232_5[o]=[a,r]):t.__P_232_5[o]=r});e.setLoaders(this.__P_232_2.filter(function(e){return e.matches(n)}));e.setConverters(this.__P_232_3.filter(function(e){return e.matches(n)}))},getAsset:function(e,r){var n=this.findLibraryForResource(e);if(!n){this.warn("Cannot find library for "+e);return null}var o=t.join(n.getRootDir(),n.getResourcePath());e=t.relative(o,t.isAbsolute(e)?e:t.join(o,e));var a=this.__P_232_7[n.getNamespace()+":"+e];if(!a&&r){a=new qx.tool.compiler.resources.Asset(n,e,{resourcePath:"resourcePath"});this.__P_232_8(a)}return a},getAssetsForPaths:function(e){var t=this,r=this.__P_232_4,n={};for(var o in r.resources){var a=r.resources[o];for(var i in a){var s=a[i];if(s.meta)for(var c in s.meta)n[c]=i}}var l=[],u={};e.forEach(function(e){var n=e.indexOf(":"),o=null;if(n>-1){var a=e.substring(0,n),i=t.__P_232_0.findLibrary(a);o=i?[i]:[];e=e.substring(n+1)}else o=t.findLibrariesForResource(e);0!=o.length?o.forEach(function(o){var a=r.resources[o.getNamespace()],i=[];if((n=e.indexOf("*"))>-1){e=e.substring(0,n);i=Object.keys(a).filter(function(t){return t.substring(0,e.length)===e})}else a[e]&&(i=[e]);i.forEach(function(e){if(void 0===u[e]){var r=t.__P_232_7[o.getNamespace()+":"+e],n=r.getFileInfo();if(!0!==n.doNotCopy){(r.getMetaReferees()||[]).forEach(function(t){var r=t.getFileInfo().meta[e];n.composite=r[3];n.x=r[4];n.y=r[5]});l.push(r);u[e]=l.length-1}}})}):t.warn("Cannot find library for "+e)});return l}}});module.exports=qx.tool.compiler.resources.Manager;qx.tool.compiler.resources.Manager.$$dbClassInfo=e}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();a=e.done;return e},e:function(e){i=!0;o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.files.Utils":{},"qx.lang.Type":{},"qx.tool.utils.Promisify":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");var t=require("fs"),r=require("../util"),n=r.promisify(t.readFile),o=r.createLog("translation");qx.Class.define("qx.tool.compiler.app.Translation",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setLibrary(e);t&&this.setLocale(t);this.__P_224_0={};this.__P_224_1={}},properties:{library:{nullable:!1,check:"qx.tool.compiler.app.Library"},locale:{init:"en",nullable:!1,check:"String"},writeLineNumbers:{init:!1,check:"Boolean"}},members:{__P_224_0:null,__P_224_1:null,__P_224_2:0,__P_224_3:null,getPoFilename:function(){var e=this.getLibrary();return e.getRootDir()+"/"+e.getTranslationPath()+"/"+this.getLocale()+".po"},checkRead:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.__P_224_2){e.next=2;break}return e.abrupt("return",this.read());case 2:t=this.getPoFilename();e.next=5;return qx.tool.utils.files.Utils.safeStat(t);case 5:if(!(r=e.sent)||this.__P_224_2!=r.mtime){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.abrupt("return",this.read());case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),read:function(){var e=this,r=this;return r.__P_224_3?r.__P_224_3:r.__P_224_3=new Promise(function(a,i){r.__P_224_0={};r.__P_224_1={};var s=e.getPoFilename();t.stat(s,function(e,t){if(!e){r.__P_224_2=t.mtime;return n(s,{encoding:"utf8"}).then(function(e){var t=null,n=null;function i(e,r,n){var o=null,a=e.match(/^([^[]+)\[([0-9]+)\]$/);if(a){e=a[1];o=parseInt(a[2]);void 0===t[e]&&(t[e]=[]);n&&"string"==typeof t[e][o]?t[e][o]+=r:t[e][o]=r}else n&&"string"==typeof t[e]?t[e]+=r:t[e]=r}e.split("\n").forEach(function(e,a){if(e=e.trim()){t||(t={});var s=e.match(/^#([^ ]?) (.*)$/);if(s){var c,l=s[1],u=s[2];t.comments||(t.comments={});switch(l){case"":t.comments.translator=u;break;case".":t.comments.extracted=u;break;case":":t.comments.reference||(t.comments.reference={});var p=t.comments.reference;(u&&u.match(/[\w/\.]+:\d+/g)||[]).forEach(function(e){var t=e.split(":"),r=t[0],n=parseInt(t[1],10);p[r]?p[r].includes(n)||p[r].push(n):p[r]=[n]});break;case",":t.comments.flags=u.split(",");break;case"|":if(s=u.match(/^([^\s]+)\s+(.*)$/)){t.previous||(t.previous={});var f=s[1];"msgctxt"==f||"msgid"==f?t[f]=s[2]:o.warn("Cannot interpret line "+(a+1))}else o.warn("Cannot interpret line "+(a+1))}}else if('"'!=e[0]||'"'!=e[e.length-1]){if("#"!=e)if(s=e.match(/^([^\s]+)\s+(.*)$/)){c=n=s[1];var m=s[2];m.length>=2&&'"'==m[0]&&'"'==m[m.length-1]&&i(c,m=(m=m.substring(1,m.length-1)).replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\"/g,'"'))}else o.warn("Cannot interpret line "+(a+1))}else{e=e.substring(1,e.length-1);n.match(/^.*\[\d+\]$/)||null!==n&&void 0!==t[n]?i(n,e,!0):o.error("Cannot interpret line because there is no key to append to, line "+(a+1))}}else!function(){if(t){var e;e=t.msgctxt?t.msgctxt+":"+t.msgid:t.msgid;r.__P_224_0[e]=t}t=null;n=null}()});a()})}"ENOENT"!=e.code?i(e):a()})})},write:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.writeTo(this.getPoFilename());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),writeTo:function(e,t){var r=[];function n(e,t){if(void 0!==t&&null!==t){t=t.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/"/g,'\\"');r.push(e+' "'+t+'"')}}for(var o in this.__P_224_0){var a=this.__P_224_0[o];if(a.comments){a.comments.translator&&r.push("# "+a.comments.translator);a.comments.extracted&&r.push("#. "+a.comments.extracted);if(a.comments.reference){var i="#:",s=a.comments.reference;for(var c in s)if(s[c])if(this.isWriteLineNumbers()){var l,u=_createForOfIteratorHelper(s[c]);try{for(u.s();!(l=u.n()).done;){var p=" "+c+":"+l.value;if(i.length+p.length>78){r.push(i);i="#:"+p}else i+=p}}catch(e){u.e(e)}finally{u.f()}}else{var f=" "+c;if(i.length+f.length>78){r.push(i);i="#:"+f}else i+=f}i.length>3&&r.push(i)}a.comments.flags&&r.push("#, "+a.comments.flags.join(","))}else r.push("#");a.msgctxt&&r.push('msgctxt "'+a.msgctxt+'"');n("msgid",a.msgid);n("msgid_plural",a.msgid_plural);if(qx.lang.Type.isArray(a.msgstr))a.msgstr.forEach(function(e,t){n("msgstr["+t+"]",e)});else if(a.msgid_plural){n("msgstr[0]","");n("msgstr[1]","")}else n("msgstr",a.msgstr||"");r.push("")}var m=r.join("\n");return qx.tool.utils.Promisify.fs.writeFileAsync(e,m,{encoding:"utf8"})},hasEntryValue:function(e){var t=this.getEntry(e);return!!t&&(qx.lang.Type.isArray(t.msgstr)?t.msgstr.every(function(e){return Boolean(e)}):Boolean(t.msgstr))},getEntry:function(e){return this.__P_224_0[e]||null},deleteEntry:function(e){var t=this.__P_224_0[e]||null;delete this.__P_224_0[e];return t},getOrCreateEntry:function(e){var t=this.__P_224_0[e];t||(t=this.__P_224_0[e]={msgid:e});return t},getEntries:function(){return this.__P_224_0},getHeaders:function(){return this.__P_224_1}}});module.exports=qx.tool.compiler.app.Translation;qx.tool.compiler.app.Translation.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.resources.AbstractMatcher":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.resources.ResourceLoader",{extend:qx.tool.compiler.resources.AbstractMatcher,type:"abstract",members:{needsLoad:function(e,t,r){var n=null;try{n=t.mtime&&new Date(t.mtime)}catch(e){}return!n||n.getTime()!=r.mtime.getTime()},load:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("No implementation for "+t.classname+".compile");case 1:case"end":return e.stop()}},e)}))()}}});qx.tool.compiler.resources.ResourceLoader.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{usage:"dynamic",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.resources.ResourceLoader":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=qx.tool.utils.Promisify.promisify(require("image-size")),r=require("../util").createLog("resource-manager");qx.Class.define("qx.tool.compiler.resources.ImageLoader",{extend:qx.tool.compiler.resources.ResourceLoader,construct:function(){qx.tool.compiler.resources.ResourceLoader.constructor.call(this,[".png",".gif",".jpg",".jpeg",".svg"])},members:{needsLoad:function(e,t,r){return!t||void 0===t.width||void 0===t.height||qx.tool.compiler.resources.ImageLoader.prototype.needsLoad.base.call(this,e,t,r)},load:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=e.getSourceFilename();a=e.getFileInfo();r.trace("Getting size of "+o);n.prev=3;n.next=6;return t(o);case 6:i=n.sent;a.width=i.width;a.height=i.height;n.next=16;break;case 11:n.prev=11;n.t0=n.catch(3);r.warn("Cannot get image size of "+o+": "+n.t0);delete a.width;delete a.height;case 16:case"end":return n.stop()}},n,null,[[3,11]])}))()}}});qx.tool.compiler.resources.ImageLoader.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.tool.compiler.resources.ResourceLoader":{construct:!0,require:!0},"qx.tool.utils.Json":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("qx.tool.compiler.resources.MetaLoader",{extend:qx.tool.compiler.resources.ResourceLoader,construct:function(){qx.tool.compiler.resources.ResourceLoader.constructor.call(this,".meta")},members:{load:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return qx.tool.utils.Json.loadJsonAsync(e.getSourceFilename());case 2:e.getFileInfo().meta=t.sent;case 3:case"end":return t.stop()}},t)}))()}}});qx.tool.compiler.resources.MetaLoader.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.lang.Array":{},"qx.tool.utils.Promisify":{},"qx.tool.utils.files.Utils":{},"qx.tool.utils.Utils":{}}};qx.Bootstrap.executePendingDefers(e);var t=require("upath");qx.Class.define("qx.tool.compiler.resources.Asset",{extend:qx.core.Object,construct:function(e,t,r){qx.core.Object.constructor.call(this);this.__P_231_0=e;this.__filename=t;this.__P_231_1=r},members:{__P_231_0:null,__filename:null,__P_231_1:null,__P_231_2:null,__P_231_3:null,__P_231_4:null,__P_231_5:null,__P_231_6:null,__P_231_7:null,getLibrary:function(){return this.__P_231_0},getFilename:function(){return this.__filename},getFileInfo:function(){return this.__P_231_1},isThemeFile:function(){return"themePath"==this.__P_231_1.resourcePath},getSourceFilename:function(){return t.relative(process.cwd(),this.isThemeFile()?this.__P_231_0.getThemeFilename(this.__filename):this.__P_231_0.getResourceFilename(this.__filename))},getDestFilename:function(e){var r=null;this.__P_231_3&&(r=this.__P_231_3[this.__P_231_3.length-1].getDestFilename(e,this));return r||t.relative(process.cwd(),t.join(e.getOutputDir(),"resource",this.__filename))},setLoaders:function(e){this.__P_231_2=e.length?e:null},setConverters:function(e){this.__P_231_3=e.length?e:null},addMetaReferee:function(e){this.__P_231_4||(this.__P_231_4=[]);qx.lang.Array.contains(this.__P_231_4,e)||this.__P_231_4.push(e)},getMetaReferees:function(){return this.__P_231_4},addMetaReferTo:function(e){this.__P_231_5||(this.__P_231_5=[]);qx.lang.Array.contains(this.__P_231_5,e)||this.__P_231_5.push(e)},getMetaReferTo:function(){return this.__P_231_5},setDependsOn:function(e){var t=this;this.__P_231_6&&this.__P_231_6.forEach(function(e){return delete e.__P_231_7[t.getFilename]});if(e&&e.length){this.__P_231_6=e;this.__P_231_1.dependsOn=e.map(function(e){return e.toUri()});e.forEach(function(e){e.__P_231_7||(e.__P_231_7={});e.__P_231_7[t.getFilename()]=t})}else{this.__P_231_6=null;delete this.__P_231_1.dependsOn}},getDependsOn:function(){return this.__P_231_6},getDependsOnThisAsset:function(){return this.__P_231_7?Object.values(this.__P_231_7):null},load:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.__P_231_2&&e.__P_231_2.forEach(function(t){return t.load(e)});case 1:case"end":return t.stop()}},t)}))()},sync:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o,a,i,s,c,l,u,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=r.getDestFilename(e);a=r.getSourceFilename();if(!r.__P_231_3){n.next=8;break}n.next=5;return qx.tool.utils.Promisify.some(r.__P_231_3,function(e){return e.isDoNotCopy(a)});case 5:if(!n.sent){n.next=8;break}return n.abrupt("return");case 8:n.next=10;return qx.tool.utils.files.Utils.safeStat(o);case 10:if(!(i=n.sent)){n.next=23;break}s=[r.getSourceFilename()];r.__P_231_6&&r.__P_231_6.forEach(function(e){return s.push(e.getSourceFilename())});n.next=16;return qx.tool.utils.Promisify.some(s,function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return qx.tool.utils.files.Utils.safeStat(t);case 2:r=e.sent;return e.abrupt("return",r&&r.mtime.getTime()>i.mtime.getTime());case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 16:if((c=n.sent)||!r.__P_231_3){n.next=21;break}n.next=20;return qx.tool.utils.Promisify.some(r.__P_231_3,function(t){return t.needsConvert(e,r,a,o,r.isThemeFile())});case 20:c=n.sent;case 21:if(c){n.next=23;break}return n.abrupt("return");case 23:n.next=25;return qx.tool.utils.Utils.makeParentDir(o);case 25:if(!r.__P_231_3){n.next=43;break}l=[];if(1!=r.__P_231_3.length){n.next=36;break}n.next=30;return r.__P_231_3[0].convert(e,r,a,o,r.isThemeFile());case 30:n.t0=n.sent;if(n.t0){n.next=33;break}n.t0=[];case 33:l=n.t0;n.next=38;break;case 36:u=null;qx.tool.utils.Promisify.each(r.__P_231_3,function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(i,s){var c,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:c=u||a;p=s===r.__P_231_3.length-1?o:t.join(require("os").tmpdir(),t.basename(a)+"-pass"+(s+1)+"-");n.next=4;return i.convert(e,r,c,p,r.isThemeFile());case 4:n.t0=n.sent;if(n.t0){n.next=7;break}n.t0=[];case 7:n.t0.forEach(function(e){return l.push(e)});u=p;case 10:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}());case 38:p=e.getAnalyser().getResourceManager();l=l.map(function(e){return p.getAsset(t.resolve(e),!0)}).filter(function(e){return e!==r});r.setDependsOn(l);n.next=45;break;case 43:n.next=45;return qx.tool.utils.files.Utils.copyFile(a,o);case 45:case"end":return n.stop()}},n)}))()},toUri:function(){return this.__P_231_0.getNamespace()+":"+this.__filename},toString:function(){return this.toUri()}}});qx.tool.compiler.resources.Asset.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs");require("@qooxdoo/framework");qx.Class.define("qx.tool.compiler.Preprocess",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_221_0=e},members:{__P_221_0:null,run:function(e,r){var n=this;t.readFile(this.__P_221_0,{encoding:"utf8"},function(o,a){o?r(o):n._process(a,function(n){"string"==typeof e?t.writeFile(e,n,{encoding:"utf8"},r):"function"==typeof e?e(n,r):r(null,n)})})},_process:function(e,t){t(e=e.replace(/(''|"")?\/\*#([^\n]+)([\s\S]*)\*\//gm,function(e,t,r,n){var o=t[0],a="";(n="'"==o?n.replace(/'/gm,"\\'"):n.replace(/"/gm,'\\"')).split("\n").forEach(function(e,t){if(0!=t){t>1&&(a+=" + \n");a+=o+e+"\\n"+o}});return a}))}}});module.exports=qx.tool.compiler.Preprocess;qx.tool.compiler.Preprocess.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.tool.utils.Promisify":{require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.files.Utils":{}}};qx.Bootstrap.executePendingDefers(e);require("../../utils/Promisify");var t=qx.tool.utils.Promisify.fs,r=require("upath");require("@qooxdoo/framework");var n=require("crypto"),o=require("source-map");require("./Target");qx.Class.define("qx.tool.compiler.targets.SourceCodeCopier",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);var r=e.lastIndexOf("."),a=e.substring(0,r);this.__P_234_0=a+"-tmp.js";this.__P_234_1=a+".js";this.__P_234_2=a+".js.map";this.__P_234_3=t.createWriteStream(this.__P_234_0);this.__P_234_4=n.createHash("sha256");this.__P_234_4.setEncoding("hex");this.__P_234_5=new o.SourceMapGenerator({file:this.__P_234_2});this.__P_234_6=0},members:{__P_234_1:null,__P_234_0:null,__P_234_2:null,__P_234_3:null,__P_234_4:null,__P_234_7:null,__P_234_5:null,__P_234_6:null,getOutputFilename:function(){return this.__P_234_1},open:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var o,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return qx.tool.utils.files.Utils.safeStat(e.__P_234_1);case 2:if(!r.sent){r.next=11;break}(o=n.createHash("sha256")).setEncoding("hex");r.next=8;return t.readFileAsync(e.__P_234_1,"utf8");case 8:a=r.sent;o.write(a);e.__P_234_7=e.__P_234_4.read();case 11:case"end":return r.stop()}},r)}))()},__P_234_8:function(e){this.__P_234_4.write(e);this.__P_234_3.write(e)},addSourceFile:function(e,r){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var i,s,c,l,u,p;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=e+".map";s=0;a.next=4;return t.readFileAsync(e,"utf8");case 4:c=(c=a.sent).replace(/\/\/[@#]\ssourceMappingURL[^\r\n]*/g,"//");c+="\n";n.__P_234_8(c);for(l=0;l<c.length;l++)"\n"===c[l]&&s++;a.next=11;return qx.tool.utils.files.Utils.safeStat(i);case 11:if(!a.sent){a.next=20;break}u=r||e;a.next=16;return t.readFileAsync(i,"utf8");case 16:c=a.sent;(p=new o.SourceMapConsumer(c)).eachMapping(function(e){e={generated:{line:e.generatedLine+n.__P_234_6,column:e.generatedColumn},original:{line:e.originalLine||1,column:e.originalColumn||1},source:u};n.__P_234_5.addMapping(e)});p.sources.forEach(function(e){return n.__P_234_5.setSourceContent(u,p.sourceContentFor(e))});case 20:n.__P_234_6+=s;case 21:case"end":return a.stop()}},a)}))()},close:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.__P_234_8("\n//# sourceMappingURL="+r.basename(e.__P_234_2)+"\n");e.__P_234_3.end();e.__P_234_4.end();o=e.__P_234_4.read();if(e.__P_234_7&&o===e.__P_234_7){n.next=10;break}n.next=7;return t.renameAsync(e.__P_234_0,e.__P_234_1);case 7:n.next=9;return t.writeFileAsync(e.__P_234_2,JSON.stringify(JSON.parse(e.__P_234_5.toString()),null,2),"utf8");case 9:return n.abrupt("return",!0);case 10:n.next=12;return t.unlinkAsync(e.__P_234_0);case 12:return n.abrupt("return",!1);case 13:case"end":return n.stop()}},n)}))()}}});qx.tool.compiler.targets.SourceCodeCopier.$$dbClassInfo=e}();function asyncGeneratorStep(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)})}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.Json":{},"qx.tool.utils.Logger":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./Logger");var t=["trace","debug","info","warn","error","fatal"];function r(e){return e<10?"0"+e:String(e)}var n="";function o(e,t){(e=String(e)).length<t&&(e=(e+function(e){for(;n.length<e;)n+="     ";return n}(t)).substring(0,t));return e}qx.Class.define("qx.tool.utils.LogManager",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);var e=this;this._loggers={};this._levels={};this._sinks=[];this._config={};this._defaultSink=qx.tool.utils.LogManager.consoleSink;this.addSink(this._defaultSink);t.forEach(function(t,r){e._levels[t]=r});this._defaultLevel=this._levels.info},statics:{__P_246_0:null,getInstance:function(){this.__P_246_0||(this.__P_246_0=new qx.tool.utils.LogManager);return this.__P_246_0},nullSink:function(e,t,r){},consoleSink:function(e,t,n){var a,i=new Date,s=i.getFullYear()+"-"+r(i.getMonth()+1)+"-"+r(i.getDate())+" "+r(i.getHours())+":"+r(i.getMinutes())+":"+r(i.getSeconds())+"."+((a=i.getMilliseconds())<10?"00"+a:a<100?"0"+a:String(a));console.log(s+" ["+o(t,5)+"] "+o(e.getId(),15)+" "+n)}},members:{loadConfig:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=4;break}e.next=3;return qx.tool.utils.Json.loadJsonAsync(t);case 3:t=e.sent;case 4:r=this;this._config=t;this._defaultLevel=this.getLoggerLevel("__P_246_1","info");for(n in this._loggers)(o=this._loggers[n]).setMinLevel(r.getLoggerLevel(o.getId()));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getLogger:function(e){var t=this._loggers[e];t||(t=this._loggers[e]=new qx.tool.utils.Logger(e,this.getLoggerLevel(e)));return t},getLoggerLevel:function(e,t){var r=this._config&&this._config.categories&&this._config.categories[e],n=r&&r.level;n&&(n=this._levels[n]);return"number"==typeof n?n:t?this._levels[t]:this._defaultLevel},addSink:function(e){this._sinks.push(e)},removeSink:function(e){var t=this._sinks.indexOf(e);t>-1&&this._sinks.splice(t,1)},output:function(e,r,n){"string"!=typeof r&&(r=t[r]);this._sinks.forEach(function(t){t.call(this,e,r,n)})},setDefaultSink:function(e){var t=this._defaultSink;this._defaultSink&&this.removeSink(this._defaultSink);this._defaultSink=e;e&&this.addSink(e);return t}}});module.exports=qx.tool.utils.LogManager;qx.tool.utils.LogManager.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.tool.utils.LogManager":{}}};qx.Bootstrap.executePendingDefers(e);require("@qooxdoo/framework");require("./LogManager");qx.Class.define("qx.tool.utils.Logger",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.set({id:e,minLevel:t})},properties:{id:{check:"String"},minLevel:{check:"Integer"}},members:{is:function(e){"string"==typeof e&&(e=qx.tool.utils.LogManager.getInstance()._levels[e]);return this.getMinLevel()<=e},log:function(e,t){this.is(e)&&this._output(e,t)},_output:function(e,t){qx.tool.utils.LogManager.getInstance().output(this,e,t)},trace:function(e){return this.log("trace",e)},debug:function(e){return this.log("debug",e)},info:function(e){return this.log("info",e)},warn:function(e){return this.log("warn",e)},error:function(e){return this.log("error",e)},fatal:function(e){return this.log("fatal",e)}}});module.exports=qx.tool.utils.Logger;qx.tool.utils.Logger.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);var t=require("fs"),r=require("async");require("@qooxdoo/framework");qx.Class.define("qx.tool.utils.files.FindFiles",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_250_0=e},properties:{matchFiles:{init:null,nullable:!0,check:"RegEx"}},members:{__P_250_0:null,scan:function(e,n){n=n||function(){};var o=this;!function n(a,i){r.waterfall([function(e){t.readdir(a,e)},function(i,s){r.forEach(i,function(r,i){t.stat(a+"/"+r,function(t,s){t?i(t):s.isDirectory()?n(a+"/"+r,i):s.isFile()?o._onFindFile(a+"/"+r,e,i):i()})},s)}],i)}(this.__P_250_0,n)},_onFindFile:function(e,t,r){var n=this.getMatchFiles();n&&!n.test(e)||t(e,r)}}});module.exports=qx.tool.utils.files.FindFiles;qx.tool.utils.files.FindFiles.$$dbClassInfo=e}();qx.$$packageData[1]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-1.js.map